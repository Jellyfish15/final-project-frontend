/*! For license information please see all.js.LICENSE.txt */
var e,t,s={7878:e=>{const t=e=>{e.style.display="none"},s=e=>{e.style.display=""};e.exports={hide:t,show:s,setText:(e,i)=>{if(!i||i.length<=0)return e.innerText="",void t(e);e.innerText=i,s(e)}}},7604:(e,t,s)=>{s.r(t),s.d(t,{default:()=>A});var i=s(6673),r=s.n(i);const n=r().getComponent("ClickableComponent"),a=class extends n{setItem(e){const{action:t,source:s}=e;this.source=s;const i=s.info();this.setTitle(i.title||s.publicId()),this.setPoster(this.source.poster().url({transformation:{aspect_ratio:"16:9",crop:"pad",background:"black"}})),this.setAction(t)}setTitle(e){this.title.innerText=e}setAction(e){this.action=e}handleClick(){super.handleClick(),this.player().trigger("recommendationshide"),this.action()}};var o=s(7878),l=s.n(o);const h=r().dom||r(),c=class extends a{setItem(e){super.setItem(e);const t=this.source.info();if(this.setTitle(t.title),this.setSubtitle(t.subtitle),t.description){const e=300,s=t.description.length>e?t.description.substring(0,e)+"...":t.description;this.setDescription(s)}}setPoster(e){this.poster.style.backgroundImage=`url('${e}')`}setTitle(e){l().setText(this.title,e),this.setAriaCheck(this.title,!!e)}setSubtitle(e){l().setText(this.subtitle,e),this.setAriaCheck(this.subtitle,!!e)}setDescription(e){l().setText(this.description,e),this.setAriaCheck(this.description,!!e)}setAriaCheck(e){arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}clearItem(){this.setTitle(""),this.setSubtitle(""),this.setDescription(""),this.poster.style.backgroundImage=null}createEl(){const e=super.createEl("div",{className:"vjs-recommendations-overlay-item vjs-recommendations-overlay-item-primary"});return this.poster=h.createEl("div",{className:"vjs-recommendations-overlay-item-primary-image"}),this.title=h.createEl("h2",{ariaLabel:"Recmmendation Title"}),this.setAriaCheck(this.title,!1),this.title.innerHTML="",this.subtitle=h.createEl("h3",{ariaLabel:"Recmmendation Subtitle"}),this.setAriaCheck(this.subtitle,!1),this.subtitle.innerHTML="",this.description=h.createEl("p"),this.setAriaCheck(this.description,!1),this.description.innerHTML="",this.content=h.createEl("div",{className:"vjs-recommendations-overlay-item-info vjs-recommendations-overlay-item-primary-content"}),this.content.appendChild(this.title),this.content.appendChild(this.subtitle),this.content.appendChild(this.description),e.appendChild(this.poster),e.appendChild(this.content),e}},d=r().dom||r(),u=class extends a{setItem(e){super.setItem(e),this.setDuration("")}setPoster(e){this.el().style.backgroundImage=`url('${e}')`}setDuration(e){this.duration.innerText=e}createEl(){const e=super.createEl("div",{className:"vjs-recommendations-overlay-item vjs-recommendations-overlay-item-secondary"});this.title=d.createEl("span",{className:"vjs-recommendations-overlay-item-secondary-title"}),this.title.innerHTML="",this.duration=d.createEl("span",{className:"vjs-recommendations-overlay-item-secondary-duration"}),this.duration.innerHTML="";const t=d.createEl("div",{className:"vjs-recommendations-overlay-item-info"});return t.appendChild(this.title),t.appendChild(this.duration),e.appendChild(t),e}handleClick(){super.handleClick(),this.action()}},p=r().getComponent("Component"),f=class extends p{setItems(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.clearItems(),t&&t.forEach((e=>{const t=new u(this.player());t.setItem(e),this.addChild(t)}))}clearItems(){this.children().forEach((()=>{this.removeChild(this.children()[0])}))}createEl(){return super.createEl("div",{className:"vjs-recommendations-overlay-item-secondary-container"})}},g=r().getComponent("Component");class m extends g{constructor(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];super(e,...s),this._primary=new c(e),this._secondaryContainer=new f(e),this.addChild(this._primary),this.addChild(this._secondaryContainer)}setItems(e){this._primary.setItem(e);for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];this._secondaryContainer.setItems(...s)}createEl(){return super.createEl("div",{className:"aspect-ratio-content"})}}const y=class extends g{constructor(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];super(e,...s),this._content=new m(e),this.addChild(this._content)}setItems(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];this._content.setItems(e,...s)}clearItems(){this._content._primary.clearItem(),this._content._secondaryContainer.clearItems()}createEl(){return super.createEl("div",{className:"vjs-recommendations-overlay-content"})}},v=r().getComponent("ClickableComponent"),_=class extends v{createEl(){return super.createEl("span",{className:"vjs-recommendations-overlay-hide vjs-icon-close"})}handleClick(){this.options_.clickHandler()}},b=r().getComponent("Component");class T extends b{constructor(e,t){for(var s=arguments.length,i=new Array(s>2?s-2:0),r=2;r<s;r++)i[r-2]=arguments[r];super(e,...i),this._content=new y(e),this.addChild(this._content),this.addChild(new _(e,{clickHandler:()=>{this.close()}},...i)),this.setEvents(e),this.doNotOpen=!1}setEvents(e){this.on(e,"recommendationschanged",((e,t)=>{this.setItems(...t.items)})),this.on(e,"recommendationsnoshow",this.setDoNotOpen),this.on(e,"recommendationsshow",this.open),this.on(e,"recommendationshide",this.close),this.on(e,"cldsourcechanged",(()=>{this.clearItems(),this.close()}))}setDoNotOpen(){this.doNotOpen=!0}open(){this.doNotOpen||(this._showControlsOnClose=this.player().controls(),this.player().controls(!1),this.el().style.visibility="visible")}clearItems(){this._content.clearItems()}close(){this.el().style.visibility="hidden",this._showControlsOnClose&&this.player().controls(!0)}createEl(){const e="vjs-recommendations-overlay",t=super.createEl("div",{className:e});return r().dom.addClass(t,e),t}setItems(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];this.doNotOpen=!1,s=s.slice(0,3),this._content.setItems(e,...s)}handleClick(){this.stopPropagation()}dispose(){super.dispose()}}r().registerComponent("recommendationsOverlay",T);const A=T},9987:(e,t,s)=>{s.d(t,{default:()=>q});var i=s(6673),r=s.n(i);const n=function(e){const[t,s,i]=e.split(":").reverse();let r=null;return isNaN(t)||(r=60*(+i||0)*60+60*(+s||0)+ +t),r};var a=s(9339);const o={location:"right",toggleIcon:"",width:"20%",startState:"openOnPlay",autoClose:2,transformation:{quality:"auto",width:"auto",fetch_format:"auto",crop:"scale"},products:[],showPostPlayOverlay:!1},l="goto",h="seek",c="shoppable-panel-visible",d="shoppable-panel-hidden",u="shoppable-products-overlay",p="cld-spbl-panel",f="cld-spbl-toggle",g="cld-spbl-toggle-icon",m="cld-spbl-bar-inner",y="animate",v="cld-spbl-item",_="cld-spbl-img";var b=s(1104);const T=r().dom||r(),A=r().getComponent("Component");class E extends A{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.options_=t,this.player_=e,this.player_.on(b.f.SHOW_PRODUCTS_OVERLAY,this.renderProducts),this.dispose=()=>{this.layout_.dispose()}}renderProducts=()=>{this.player_.removeClass(c),this.player_.addClass(d),this.player_.addClass(u),this.layout_.innerHTML="";const e=this.player_.currentTime();this.options_.products.filter((t=>t.hotspots&&t.hotspots.some((t=>n(t.time)===e)))).forEach((t=>{const s=(0,a.I)(t.hotspots,(t=>n(t.time)===e)),i=T.createEl("div",{className:"cld-spbl-product-hotspot-name"},{},t.productName),r=T.createEl("div",{className:"cld-spbl-product-tooltip cld-spbl-product-tooltip-"+s.tooltipPosition},{},i),o=T.createEl("a",{className:"cld-spbl-product-hotspot accent-color-text",href:s.clickUrl,target:"_blank"},{style:"left:"+s.x+"; top:"+s.y+";"},r);this.layout_.appendChild(o)})),this.player_.one(b.f.SEEKING,this.clearLayout),this.player_.one(b.f.PLAY,this.clearLayout)};clearLayout=()=>{this.layout_.innerHTML="",this.player_.removeClass(u)};createEl(){const e=this.player_.currentDimensions();return this.layout_=T.createEl("div",{className:"cld-spbl-products-overlay",style:`padding-top: ${e.height/e.width*100}%;`}),this.layout_}}r().registerComponent("ShoppableProductsOverlay",E);const S=E,C=r().dom||r(),w=r().getComponent("ClickableComponent");class k extends w{constructor(e,t){super(e,t),this.options_=t}handleClick(e){e.preventDefault(),e.stopPropagation(),this.options_.clickHandler()}createEl(){let e={},t={};this.options_.toggleIcon?(e={className:`${g} cld-spbl-toggle-custom-icon vjs-icon-close`},t={style:`background-image: url(${this.options_.toggleIcon})`}):e={className:`${g} vjs-icon-cart`};const s=C.createEl("span",e,t),i=super.createEl("a",{className:`${f} base-color-bg`});return i.appendChild(s),this.player_.on(b.f.PRODUCT_BAR_MIN,(()=>{setTimeout((()=>{s.classList.add(y),setTimeout((()=>{s.classList.remove(y)}),1e3)}),500)})),i}}r().registerComponent("shoppablePanelToggle",k);const L=k,I=r().dom||r(),P=r().getComponent("Component");class R extends P{constructor(e,t){super(e,t),this.player_=e,this.player().addClass("cld-shoppable-panel"),this.player().addClass(d),this.contentWrpEl_=I.createEl("div",{className:"cld-spbl-bar"}),this.contentBannerEl_=I.createEl("div",{className:"cld-spbl-banner-msg base-color-text"},{},this.options_.bannerMsg||"Shop the Video"),this.contentWrpEl_.appendChild(this.contentBannerEl_);const s=new S(this.player_,this.options_);this.contentWrpEl_.appendChild(s.el_),this.contentEl_=I.createEl("div",{className:m}),this.contentWrpEl_.appendChild(this.contentEl_),this.player().el().appendChild(this.contentWrpEl_),this.addChild(new L(this.player_,{toggleIcon:this.options_.toggleIcon,clickHandler:()=>{this.togglePanel()}})),this.addChild("ShoppablePanel",this.options_),this.dispose=()=>{this.removeLayout(),super.dispose()},this.togglePanel=e=>{!0===e?(this.player().removeClass(d),this.player().addClass(c)):!1===e?(this.player().removeClass(c),this.player().addClass(d)):(this.player().toggleClass(d),this.player().toggleClass(c));let t=this.player().hasClass(c)?"productBarMax":"productBarMin";this.player().trigger(t)},"open"===this.options_.startState&&this.togglePanel(!0),this.player_.on(b.f.PLAY,(()=>{this.player_.currentTime()<.01&&("openOnPlay"===this.options_.startState&&this.togglePanel(!0,this.options_.autoClose),this.options_.autoClose&&-1!==this.options_.startState.indexOf("open")&&setTimeout((()=>{this.contentEl_.matches(":hover")?this.contentEl_.addEventListener("mouseleave",(()=>{this.togglePanel(!1)}),{once:!0}):this.togglePanel(!1)}),1e3*this.options_.autoClose))}))}createEl(){return super.createEl("div")}}r().registerComponent("shoppableBarLayout",R);const x=R;var D=s(2858),O=s.n(D),M=s(4650);const N=r().getComponent("ClickableComponent"),F=r().dom||r(),B={width:132};class j extends N{constructor(e,t){super(e,t),this.options_=t,this.isDragged=!1}handleClick(e){e.preventDefault(),e.stopPropagation(),this.el_.matches(`.dragged .${v}`)||this.options_.clickHandler(e),this.isDragged=!1}getTitle(){return this.options_.conf.title}createEl(){const e=super.createEl("a",{className:`${v} base-color-bg accent-color-text`,href:"#"});e.setAttribute("data-product-id",this.options_.conf.productId||""),e.setAttribute("data-product-name",this.options_.conf.productName||""),this.options_.conf.onHover&&U(e,this.options_.conf.onHover,this.options_.item.cloudinaryConfig()),this.options_.conf.onClick&&$(e,this.options_.conf.onClick);const t=super.createEl("img",{className:_},{src:this.options_.item.url(B)});if(e.appendChild(t),this.getTitle()){const t=F.createEl("div",{className:"cld-spbl-item-info base-color-semi-bg text-color-text"}),s=F.createEl("span",{className:"cld-spbl-item-title"},{},this.getTitle());t.appendChild(s),e.appendChild(t)}return e}}const U=(e,t,s)=>{if(e.setAttribute("data-hover-action",t.action),"overlay"===t.action){const s=F.createEl("span",{className:"cld-spbl-overlay-text base-color-text"},{},t.args),i=F.createEl("span",{className:"cld-spbl-overlay text-color-semi-bg base-color-text"},{title:t.args},s);e.appendChild(i)}else{const i=new M.A(t.args.publicId,{cloudinaryConfig:s,transformation:t.args.transformation}),r=F.createEl("img",{className:`${_} cld-spbl-hover-img`},{src:i.url(B)});e.appendChild(r)}},$=(e,t)=>{e.setAttribute("data-click-action",t.action),e.setAttribute("data-pause",t.pause),t.action===h?e.setAttribute("data-seek",t.args.time):t.action===l&&e.setAttribute("data-goto-url",t.args.url)};r().registerComponent("shoppablePanelItem",j);const H=j,V=r().getComponent("Component");class G extends V{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.options=t;const s=()=>{this.render()};e.on(b.f.SHOPPABLE_ITEM_CHANGED,s),this.render(),this.dispose=()=>{super.dispose(),e.off(b.f.SHOPPABLE_ITEM_CHANGED,s)}}createEl(){const e=super.createEl();return[p,"base-color-bg"].map((t=>e.classList.add(t))),e}removeAll(){const e=this.children();for(let t=e.length-1;t>=0;--t)this.removeChild(e[t])}getItems(){const e=this.player_.cloudinary.cloudinaryConfig();return this.options.products.map((t=>{t.onHover&&"object"==typeof t.onHover.args&&(t.onHover.args.transformation=Object.assign({},this.options.transformation,t.onHover.args.transformation));const s={productId:t.productId,productName:t.productName,title:t.title,onHover:t.onHover,onClick:t.onClick,startTime:t.startTime,endTime:t.endTime};return{imageSrc:new M.A(t.publicId,{cloudinaryConfig:e,transformation:Object.assign({},this.options.transformation,t.transformation)}),conf:s}}))}scrollToActiveItem(){const e=this.el_.getElementsByClassName("active");if(e.length>0){const t=e[0].offsetTop-12;"scrollBehavior"in document.documentElement.style?this.el_.scrollTo({top:t,behavior:"smooth"}):this.el_.scrollTop=t}}render(){this.removeAll();const e=this.getItems(),t=O()((()=>this.scrollToActiveItem()),1e3);e.forEach(((e,s)=>{const i=new H(this.player(),{item:e.imageSrc,conf:e.conf,next:1===s,current:0===s,clickHandler:e=>{let t=e.currentTarget||e.target,s=this.player_.ended()?"productClickPost":"productClick";if(this.player_.trigger(s,{productId:t.dataset.productId,productName:t.dataset.productName}),t.dataset.clickAction===l)window.open(t.dataset.gotoUrl,"_blank");else if(t.dataset.clickAction===h){const e=n(t.dataset.seek);null!==e&&(this.player_.addClass("vjs-has-started"),this.player_.postModal&&this.player_.postModal.close(),this.player_.currentTime(e),this.player_.removeClass(c),this.player_.addClass(d),this.player_.addClass(u),this.player_.one("seeked",(()=>this.player_.trigger("showProductsOverlay"))))}"false"!==t.dataset.pause&&(this.player_.pause(),n(t.dataset.pause)&&setTimeout((()=>{this.player_.play()}),1e3*n(t.dataset.pause)))}});i.on("mouseover",(e=>{let t=e.currentTarget||e.target,s=this.player_.ended()?"productHoverPost":"productHover";this.player_.trigger(s,{productId:t.dataset.productId,productName:t.dataset.productName})})),void 0!==e.conf.startTime&&void 0!==e.conf.endTime&&this.player_.on(b.f.TIME_UPDATE,(()=>{const s=this.player_.currentTime();s>=e.conf.startTime&&s<e.conf.endTime?(i.el_.classList.add("active"),t()):i.el_.classList.contains("active")&&i.el_.classList.remove("active")})),this.addChild(i)}))}}r().registerComponent("shoppablePanel",G);const W=G,z=r().dom||r(),K=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.options_={...t,postPlay:!0},this.player_=e,this.render(),this.handleDragToScroll(),this.dispose=()=>{this.layout_.dispose()}}handleDragToScroll(){const e=this.player_.postModal.el_.querySelector(`.${p}`);let t=!1,s=0,i=0;e.addEventListener("mousedown",(r=>{t=!0,s=r.pageX-e.offsetLeft,i=e.scrollLeft})),document.addEventListener("mouseup",(i=>{t=!1,setTimeout((()=>{e.classList.remove("dragged")}),300);const r=i.pageX-e.offsetLeft-s;Math.abs(r)>5&&i.preventDefault()})),document.addEventListener("mousemove",(r=>{if(!t)return;r.preventDefault();const n=r.pageX-e.offsetLeft-s;e.scrollLeft=i-n,Math.abs(n)>5&&!e.classList.contains("dragged")&&e.classList.add("dragged")}))}render(){this.player_.postModal=null;const e=z.createEl("div",{className:"cld-spbl-post-play"}),t=new W(this.player_,this.options_),s=z.createEl("div",{className:"cld-spbl-post-title base-color-text"},{},this.options_.bannerMsg||"Shop the Video"),i=this.player_.cloudinary.currentPoster();i.transformation([i.transformation().toOptions?i.transformation().toOptions():{},{effect:"blur:3000"}]);const r=z.createEl("div",{className:"cld-spbl-post-play-bg",style:`background-image: url("${i.url()}")`}),n=z.createEl("button",{className:"cld-spbl-replay-btn base-color-bg vjs-icon-replay",onclick:()=>{this.player_.trigger("replay"),this.player_.postModal.close(),this.player_.play()}},{},"Replay");e.appendChild(r),e.appendChild(s),e.appendChild(t.el()),e.appendChild(n),this.player_.postModal=this.player_.createModal(e,{name:"postModal",uncloseable:!0}),this.player_.addClass("cld-spbl-post-modal"),this.player_.postModal.on("beforemodalclose",(()=>{this.player_.removeClass("cld-spbl-post-modal")}))}},q=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.options_=r().obj.merge(o,t),this.player_=e,this.options_.showPostPlayOverlay&&this.player_.on(b.f.ENDED,(()=>{this.player_.addChild(new K(this.player_,this.options_))}));const s=this.options_.width;this._injectCSS(`\n      .${m} {\n        transform: translateX(${s});\n      }\n      .${c} .vjs-control-bar {\n        width: calc(100% - ${s});\n      }\n      .${f} {\n        right: ${s};\n      }\n      .${p}{\n        width: ${s};\n      }\n    `),this._setListeners()}_setListeners(){const e=this._resizeHandler.bind(this);this.player_.on(b.f.RESIZE,e),window.addEventListener("resize",e),this.dispose=()=>{this.player_.off(b.f.RESIZE,e),window.removeEventListener("resize",e),this.layout_.dispose()}}_injectCSS(e){const t=document.createElement("style");t.innerHTML=e,this.player_.el_.appendChild(t)}_resizeHandler(){const e=[["sm",0,80],["md",81,110],["lg",111,170]],t=parseFloat(this.options_.width)/100*this.player_.el_.clientWidth;let s=!1;if(t){for(const[i,r,n]of e)t>r&&t<=n&&(this.layout_.contentWrpEl_.setAttribute("size",i),s=i);s||this.layout_.contentWrpEl_.removeAttribute("size")}}init(){this.render()}render(){this.layout_=new x(this.player_,this.options_)}}},7668:(e,t,s)=>{s.d(t,{A:()=>a});var i=s(6673),r=s.n(i);var n=s(608);const a={logoOnclickUrl:"https://cloudinary.com/",showLogo:!0,showJumpControls:!1,playsinline:r().browser.IS_IOS,skin:"dark",controls:!1,chaptersButton:!1,pictureInPictureToggle:!1,seekThumbnails:!0,aiHighlightsGraph:!1,visualSearch:!1,download:!1,preload:n.Am.AUTO,textTrackSettings:!1,loop:!1,muted:!1,posterOptions:{},sourceTypes:["auto"],contextMenu:{content:e=>{const t=e.loop(),s=e.paused(),i=e.muted(),r=e.isFullscreen(),n={class:"player-version",label:"Cloudinary Player v3.4.2"};return e.controls()?[{label:t?"Unloop":"Loop",listener:()=>{e.loop(!t)}},{label:s?"Play":"Pause",listener:()=>{s?e.play():e.pause()}},{label:i?"Unmute":"Mute",listener:()=>{e.muted(!i)}},{label:r?"Exit Fullscreen":"Fullscreen",listener:()=>{r?e.exitFullscreen():e.requestFullscreen()}},n]:[n]}},floatingWhenNotVisible:n.rT.NONE,hideContextMenu:!1,analytics:!1,cloudinaryAnalytics:!0,allowUsageReport:!0,playedEventPercents:[25,50,75,100],adaptiveStreaming:{strategy:"balanced"},html5:{handlePartialData:!1,nativeTextTracks:!1},disableSeekWhileScrubbingOnMobile:!0}},7623:(e,t,s)=>{s.d(t,{Ay:()=>xt,wR:()=>Pt.w,Qc:()=>Rt.interactionAreasService,OC:()=>wt,Fk:()=>kt,xY:()=>St,Iy:()=>Ct});var i=s(7171),r=s.n(i),n=s(6673),a=s.n(n);const o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let l;const h=new Uint8Array(16);function c(){if(!l){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");l=crypto.getRandomValues.bind(crypto)}return l(h)}const d=[];for(let e=0;e<256;++e)d.push((e+256).toString(16).slice(1));const u=function(e,t,s){if(o.randomUUID&&!t&&!e)return o.randomUUID();const i=(e=e||{}).random||(e.rng||c)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){s=s||0;for(let e=0;e<16;++e)t[s+e]=i[e];return t}return function(e,t=0){return(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase()}(i)};var p=s(5685),f=s.n(p),g=s(2832),m=s.n(g),y=s(8446),v=s.n(y),_=s(8953),b=s.n(_),T=s(7571),A=s.n(T);const E=a().getComponent("ClickableComponent");a().registerComponent("JumpForwardButton",class extends E{handleClick(e){super.handleClick(e),this.player().currentTime(this.player().currentTime()+10)}createEl(){return a().dom.createEl("button",{className:"vjs-control vjs-icon-skip-10-plus vjs-icon-forward-10 vjs-button",ariaLabel:"Jump forward 10 seconds"})}});const S=a().getComponent("ClickableComponent");a().registerComponent("JumpBackButton",class extends S{handleClick(e){super.handleClick(e),this.player().currentTime(this.player().currentTime()-10)}createEl(){return a().dom.createEl("button",{className:"vjs-control vjs-icon-skip-10-min vjs-icon-replay-10 vjs-button",ariaLabel:"Jump back 10 seconds"})}});const C=a().getComponent("ClickableComponent");a().registerComponent("logoButton",class extends C{createEl(){const e=this.options_.playerOptions,t=e.showLogo?"block":"none",s=e.logoImageUrl?`background-image: url(${e.logoImageUrl})`:"";return a().dom.createEl("a",{},{class:"vjs-control vjs-cloudinary-button vjs-button",href:e.logoOnclickUrl,target:"_blank",style:`display: ${t}; ${s}`,"aria-label":"Logo link"})}});const w=a().getComponent("Component");a().registerComponent("progressControlEventsBlocker",class extends w{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}createEl(){return super.createEl("div",{className:"vjs-progress-control-events-blocker"})}});var k=s(7878),L=s.n(k),I=s(2415),P=s(8033);const R=a().dom||a(),x=a().getComponent("Component");a().registerComponent("titleBar",class extends x{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.on(e,"cldsourcechanged",((e,t)=>{let{source:s}=t;return this.setItem(s)}))}setItem(e){if(!e)return this.setTitle(""),void this.setDescription("");const t=e.info();this.setTitle(t.title),this.setDescription(t.subtitle);const s=e.title&&!0===e.title(),i=e.description&&!0===e.description();(s||i)&&this.fetchAutoMetadata(e,s,i)}fetchAutoMetadata(e,t,s){if(e.isRawUrl)return;const i=e.cloudinaryConfig(),r=e.publicId();if(!i?.cloud_name||!r)return;const n=`${(0,P.k$)(i)}/_applet_/video_service/video_metadata/${e.getInitOptions().type||"upload"}/${(0,I.G)(r)}.json`;fetch(n,{headers:{"X-Cld-Video-Player-Version":"3.4.2"}}).then((e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.json()})).then((e=>{t&&e.title&&this.setTitle(e.title),s&&e.description&&this.setDescription(e.description)})).catch((e=>{console.warn(`Failed to fetch metadata for ${r}:`,e)}))}setTitle(e){const t="string"==typeof e?e:"";return L().setText(this.titleEl,t),this.refresh(),t}setDescription(e){const t="string"==typeof e?e:"";return L().setText(this.descriptionEl,t),this.refresh(),t}refresh(){(()=>this.titleEl.innerText)()||(()=>this.descriptionEl.innerText)()?this.show():this.hide()}createEl(){this.titleEl=R.createEl("div",{className:"vjs-title-bar-title"}),this.descriptionEl=R.createEl("div",{className:"vjs-title-bar-subtitle"});const e=super.createEl("div",{append:this.titleEl,className:"vjs-title-bar"});return e.appendChild(this.titleEl),e.appendChild(this.descriptionEl),e}});const D=a().getComponent("MenuItem");class O extends D{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,{...t,selectable:!0,multiSelectable:!1,selected:!!t.selected,label:t.label}),this.value=t.value,this._ssIndex=t.index,this._onSelect="function"==typeof t.onSelect?t.onSelect:null}handleClick(e){super.handleClick(e),this._onSelect&&this._onSelect({index:this._ssIndex,value:this.value,label:this.options_.label})}}a().registerComponent("SourceMenuItem",O);const M=O,N=a().getComponent("MenuButton"),F=a().getComponent("MenuItem");a().registerComponent("sourceSwitcherButton",class extends N{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.controlText(t.tooltip||"Sources"),this._emptyLabel=t.emptyLabel||"No sources",this._items=Array.isArray(t.items)?t.items:[],this._selectedIndex=Number.isInteger(t.defaultIndex)?t.defaultIndex:void 0,this._onSelected="function"==typeof t.onSelected?t.onSelected:null,this._setEnabled(this._items.length>0)}buildCSSClass(){return`vjs-source-switcher-button${Array.isArray(this._items)&&0!==this._items.length?"":" vjs-source-switcher-disabled"} ${super.buildCSSClass()}`}createItems(){if(!Array.isArray(this._items)||0===this._items.length){const e=new F(this.player_,{label:this._emptyLabel,selectable:!1});return e.addClass("vjs-source-switcher-empty"),e.disable(),[e]}return this._items.map(((e,t)=>{let{label:s,value:i}=e;return new M(this.player_,{label:s,value:i,index:t,selected:t===this._selectedIndex,onSelect:e=>this._handleItemSelect(e)})}))}_handleItemSelect(e){let{index:t}=e;this._selectedIndex!==t&&this.setSelected(t)}setItems(e){this._items=Array.isArray(e)?e:[],this._selectedIndex=this._items.length?0:void 0,this._setEnabled(this._items.length>0),this._rebuildMenu()}setSelected(e){if(!Array.isArray(this._items)||null==e||e<0||e>=this._items.length)return;this._selectedIndex=e,this.menu&&"function"==typeof this.menu.children&&this.menu.children().forEach((t=>{t instanceof F&&t.selected(t._ssIndex===e)}));const{value:t}=this._items[e];this._onSelected&&this._onSelected({index:e,value:t},this.player_)}setOnSelected(e){this._onSelected="function"==typeof e?e:null}_rebuildMenu(){if(!this.menu)return;this.menu.children().slice().forEach((e=>this.menu.removeChild(e))),this.createItems().forEach((e=>this.menu.addItem(e)));const e=this.el&&this.el();if(e){const t=0===this._items.length;e.classList.toggle("vjs-source-switcher-disabled",t),e.setAttribute("aria-disabled",String(t))}}_setEnabled(e){const t=this.el&&this.el();t&&(t.classList.toggle("vjs-source-switcher-disabled",!e),t.setAttribute("aria-disabled",String(!e)))}});var B="3.0.1";const j=a().getTech("Html5"),U=a().registerPlugin||a().plugin,$=["abort","emptied","loadstart","play"],H=["abort","emptied"],V=["ad-playback","ads-ready?","postroll?","preroll?"];let G=0;const W=function(){const e=[];let t,s,i=!1,r=!0;const n=t=>function(s,i){if(this.perSourceBehaviors.disabled())return;const r=2===arguments.length,n=this.currentSrc(),a=[s],o=arguments[arguments.length-1],l=r?this:s,h=o.bind(l),c=(...e)=>{const s=this.currentSrc()!==n;this.perSourceBehaviors.disabled()||((s||t)&&this.off(...a),s||h(...e))};return c.guid=h.guid=o.guid="psb-"+ ++G,r||a.push(i),a.push(c),e.push(a),this.on(...a)};this.perSourceBehaviors={disable:function(){return this.clearTimeout(s),s=null,i=!0,i}.bind(this),disabled:()=>i,enable:()=>(i=!1,i),enabled:()=>!i,isSrcStable:()=>r,VERSION:B},this.onPerSrc=n(),this.onePerSrc=n(!0),this.on("dispose",(()=>{e.length=0})),this.on($,(i=>{if(this.perSourceBehaviors.disabled()||s||((e,t)=>{return!!e.usingPlugin("ads")&&((e=>e.usingPlugin("ads")&&"function"==typeof e.ads.inAdBreak)(e)?e.ads.isInAdMode()&&"loadstart"!==t.type:(s=e.ads.state,V.indexOf(s)>-1));var s})(this,i))return;r&&H.indexOf(i.type)>-1&&(r=!1,this.trigger("sourceunstable"));const n=[],a=e=>n.push({time:Date.now(),event:e});a(i),this.on(j.Events,a),s=this.setTimeout((()=>{const i=this.currentSrc();r=!0,s=null,this.off(j.Events,a),i&&i!==t&&(e.forEach((e=>this.off(...e))),e.length=0,this.trigger("sourcechanged",{interimEvents:n,from:t,to:i}),t=i)}),1)}))};W.VERSION=B,U("perSourceBehaviors",W);let z={};const K=function(){function e(e,t){return this.player=e,this.options=t,this.initializeHighlightsGraph(),this}return e.prototype.src=function(e){this.resetPlugin(),this.options.src=e,this.initializeHighlightsGraph()},e.prototype.detach=function(){this.resetPlugin()},e.prototype.resetPlugin=function(){this.graphHolder&&this.graphHolder.parentNode.removeChild(this.graphHolder),delete this.progressBar,delete this.graphHolder,delete this.lastStyle},e.prototype.initializeHighlightsGraph=function(){this.options.src&&fetch(this.options.src,{credentials:this.player.cloudinary.source?.().withCredentials?"include":"omit"}).then((e=>e.json())).then((e=>{this.setupHighlightsGraphElement(),this.graphHolder&&this.createHighlightsGraph(e)}))},e.prototype.setupHighlightsGraphElement=function(){if(this.progressBar=this.player.$(".vjs-progress-control"),!this.progressBar)return;const e=this.player.$(".vjs-highlights-graph-display")||document.createElement("div");e.setAttribute("class","vjs-highlights-graph-display"),this.progressBar.appendChild(e),this.graphHolder=e},e.prototype.createPath=function(e,t,s){const i=t/(e.length-1),r=e.map(((e,t)=>({x:t*i,y:s-e*s}))),n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("fill","lightblue");let a=`M ${r[0].x},${r[0].y}`;for(let e=0;e<r.length-1;e++){const t=(r[e].x+r[e+1].x)/2,s=(r[e].y+r[e+1].y)/2;a+=` Q ${r[e].x},${r[e].y} ${t},${s}`}return a+=` Q ${r[r.length-1].x},${r[r.length-1].y} ${r[r.length-1].x},${r[r.length-1].y}`,a+=` L ${r[r.length-1].x},${s} L ${r[0].x},${s} Z`,n.setAttribute("d",a),n},e.prototype.createHighlightsGraph=function(e){const t=e.data,s=this.player.$(".vjs-highlights-graph-display > svg")||document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("viewBox","0 0 600 20"),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("width",600),s.setAttribute("height",20),s.innerHTML="";const i=this.createPath(t,600,20);s.appendChild(i),this.graphHolder.appendChild(s)},e}();var q=s(5871),Y=s(6827),X=s.n(Y),Q=s(1104);const Z={percentsplayed:{percents:[25,50,75,100]}},J={events:[Q.f.PERCENTS_PLAYED,Q.f.PAUSE_NO_SEEK,Q.f.SEEK,Q.f.MUTE,Q.f.UNMUTE,Q.f.QUALITY_CHANGED]};class ee extends(X()){constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.player=e;const s=a().obj.merge(J,t);let i={lastState:void 0},r=0,n=0,o=!1,l=[],h=[],c=null,d=!1;const u=()=>{l=[],h=[]};this.events=te(s.events,Z),i={lastState:void 0},r=n=0,o=!1,u(),this.player.on(Q.f.PLAY,(()=>{d&&(this.player.trigger("replay"),d=!1)}).bind(this)),this.player.on(Q.f.ENDED,(()=>{d=!0}).bind(this)),(this.events.percentsplayed||this.events.timeplayed||this.events.seek||this.events.totaltimeplayed)&&this.player.on(Q.f.TIME_UPDATE,(e=>{const t=this.player.currentTime(),s=this.player.duration(),i=(t,s)=>{s.originalType="timeupdate",this.emit(t,e,s)};if(this.events.percentsplayed&&this.events.percentsplayed.percents.forEach((e=>{se(t,s,e)&&-1===l.indexOf(e)&&(l.push(e),i(Q.f.PERCENTS_PLAYED,{percent:e}))})),this.events.timeplayed){const e=this.events.timeplayed;(e.interval?[Math.floor(t/e.interval)*e.interval]:e.times).forEach((e=>{ie(t,e)&&-1===h.indexOf(e)&&(h.push(e),i(Q.f.TIME_PLAYED,{time:e}))}))}this.events.seek&&(r=n,n=t,Math.abs(r-n)>1&&(o=!0,u(),i(Q.f.SEEK,{seekStart:r,seekEnd:n})))}).bind(this)),(this.events.mute||this.events.unmute)&&this.player.on(Q.f.VOLUME_CHANGE,(e=>{this.player.muted()&&"muted"!==i.lastState?(i.lastState="muted",this.emit(Q.f.MUTE,e)):this.player.muted()||"unmuted"===i.lastState||(i.lastState="unmuted",this.emit(Q.f.UNMUTE,e))}).bind(this)),this.events.pausenoseek&&(this.player.on(Q.f.PAUSE,(e=>{Math.round(this.player.currentTime())===Math.round(this.player.duration())||o||this.emit(Q.f.PAUSE_NO_SEEK,e)}).bind(this)),this.player.on(Q.f.PLAY,(()=>{o=!1}).bind(this))),this.player.on(Q.f.LOADED_METADATA,(()=>{this.player.currentSource().src!==c&&(u(),c=this.player.currentSource().src)}).bind(this)),this.player.on(Q.f.LOADED_DATA,(e=>{let t=this,s=this.player.textTracks(),i=null;for(let e=0;e<s.length;e++)"segment-metadata"===s[e].label&&(i=s[e]);let r=null;i&&i.on("cuechange",(function(){let s=i.activeCues[0];if(s){let i=s.value.resolution;if(r!==i){let s={from:r,to:i};t.emit(Q.f.QUALITY_CHANGED,e,s)}r=i}}))}).bind(this))}}const te=(e,t)=>{let s=e;return"Array"===e.constructor.name&&(s=e.reduce(((e,s)=>{const i=t[s]||{};return b()(s)?e[s.type]=Object.assign({},i,s):e[s]=i,e}),{})),s},se=function(e,t,s){return ie(e,t*s/100,arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5)},ie=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e<=t+s&&e>=t-s},re=ee,ne=[Q.f.PLAY,Q.f.PAUSE,Q.f.ENDED,Q.f.VOLUME_CHANGE,Q.f.RESIZE,Q.f.ERROR,Q.f.FULL_SCREEN_CHANGE,Q.f.START,Q.f.VIDEO_LOAD,Q.f.PERCENTS_PLAYED,Q.f.SEEK,Q.f.PLAYER_LOAD],ae={percentsplayed:{percents:[25,50,75,100]}},oe={events:ne,category:"Video",defaultLabel:e=>e.cloudinary?.currentPublicId()||e.currentSource().src};class le{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.player=e,this.options=a().obj.merge(oe,t),this.events=te(this.options.events,ae);const s=(0,q.sliceProperties)(this.events,Q.f.PERCENTS_PLAYED,Q.f.TIME_PLAYED,Q.f.PAUSE,Q.f.SEEK);s.pause&&(delete s.pause,s.pausenoseek={}),this._extendedEvents=new re(e,{events:s}),this._currentSource=null,this._startTracked=null,this._endTracked=null,this.resetState()}init(){this.events.shoppable&&(this.player.on("productHover",((e,t)=>{this.track({action:"productHover",label:t.productName})}).bind(this)),this.player.on("productClick",((e,t)=>{this.track({action:"productClick",label:t.productName})}).bind(this)),this.player.on("productHoverPost",((e,t)=>{this.track({action:"productHoverPostPlay",label:t.productName})}).bind(this)),this.player.on("productClickPost",((e,t)=>{this.track({action:"productClickPostPlay",label:t.productName})}).bind(this)),this.player.on("productBarMin",(()=>{this.track({action:"shoppableBar",label:"closed"})}).bind(this)),this.player.on("productBarMax",(()=>{this.track({action:"shoppableBar",label:"opened"})}).bind(this)),this.player.on("replay",(()=>{this.track({action:"replay"})}).bind(this))),this.events.play&&this.player.on(Q.f.PLAY,(()=>{this.track({action:"Play"})}).bind(this)),this.events.ended&&this.player.on(Q.f.ENDED,(()=>{this._endTracked||(this.track({action:"Ended",nonInteraction:!0}),this._endTracked=!0)}).bind(this)),this.events.volumechange&&this.player.on(Q.f.VOLUME_CHANGE,(()=>{const e=this.player.muted()?0:this.player.volume();this.track({action:"Volume Change",value:e})}).bind(this)),this.events.resize&&this.player.on(Q.f.RESIZE,(()=>{const e=`Resize - ${this.player.width()}x${this.player.height()}}`;this.track({action:e})}).bind(this)),this.events.error&&this.player.on(Q.f.ERROR,(()=>{this.track({action:"Error",nonInteraction:!0})}).bind(this)),this.events.start&&this.player.on(Q.f.PLAYING,(()=>{this._startTracked&&(this.track({action:"Start"}),this._startTracked=!0)}).bind(this)),this.events.fullscreenchange&&this.player.on(Q.f.FULL_SCREEN_CHANGE,(()=>{const e=this.player.isFullscreen()?"Enter Fullscreen":"Exit Fullscreen";this.track({action:e})}).bind(this)),this.events.percentsplayed&&this._extendedEvents.on(Q.f.PERCENTS_PLAYED,((e,t)=>{const{percent:s}=t;this.track({action:`${s} Percents Played`,nonInteraction:!0})}).bind(this)),this.events.timeplayed&&this._extendedEvents.on(Q.f.TIME_PLAYED,((e,t)=>{const{time:s}=t;this.track({action:`${s} Seconds Played`,value:s,nonInteraction:!0})}).bind(this)),this.events.pause&&this._extendedEvents.on(Q.f.PAUSE_NO_SEEK,(()=>{this.track({action:"Pause"})}).bind(this)),this.events.seek&&this._extendedEvents.on(Q.f.SEEK,((e,t)=>{const{seekStart:s,seekEnd:i}=t;this.track({action:"Seek Start",value:s}),this.track({action:"Seek End",value:i})}).bind(this)),this.events.playerload&&(()=>{this.track({action:"Player Load",label:window.location.href,nonInteraction:!0})})(),this.player.on(Q.f.LOADED_METADATA,this.loadedmetadata.bind(this))}track(e){let{action:t,label:s,value:i=null,nonInteraction:r=!1}=e;const n={event_category:this.options.category,event_label:s||this.options.defaultLabel(this.player),value:i||Math.round(this.player.currentTime()),non_interaction:r};window.gtag("event",t,n)}videoload(){this.track({action:"Video Load",nonInteraction:!0})}resetState(){this._currentSource="",this._startTracked=!1,this._endTracked=!1}loadedmetadata(){const e=this.player.currentSource().src;e!==this._currentSource&&(this.resetState(),this._currentSource=e,this.events.videoload&&this.videoload())}}var he=s(3171);const ce={fraction:.5,isMuted:!0};class de{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object.assign({},ce,t),this.player=e;let s=(0,q.sliceProperties)(t,"fraction"),i=!1,r=!1,n=null,a=null;this.init=()=>{d(),c()};const o=()=>{window.removeEventListener("DOMContentLoaded",c,!1),window.removeEventListener("load",c,!1),window.removeEventListener("scroll",c,!1),window.removeEventListener("resize",c,!1),this.player.off("pause",n),this.player.off("play",a)},l=()=>{i=!0,r=!1,this.player.pause()},h=()=>{i=!1,r=!0,this.player.play()},c=()=>{(0,he.isElementInViewport)(this.player.el(),{fraction:s.fraction})?this.player.paused()&&h():this.player.paused()||this.player.activePlugins_.floatingPlayer||l()},d=()=>{n=()=>{this.player.waiting||i||o()},a=()=>{r||o()},window.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1),window.addEventListener("scroll",c,!1),window.addEventListener("resize",c,!1),this.player.on("pause",n),this.player.on("play",a)}}}var ue=s(5004),pe=s(5381);const fe=class{constructor(e){this._emitter=e,this._eventHandlers=[]}on(e,t){this._eventHandlers.push({type:e,handler:t}),this._emitter.on(e,t)}one(e,t){var s=this;this._eventHandlers.push({type:e,handler:t,wrapper:function(){t(...arguments),s.off(e,t)}}),this._emitter.one(e,t)}off(e,t){const s=this._eventHandlers?.findIndex((s=>s.type===e&&s.handler===t));if(-1===s)return;const i=this._eventHandlers[s];this._emitter.off(e,i.wrapper||i.handler),this._eventHandlers.splice(s,1)}removeAllListeners(){this._eventHandlers.forEach((e=>{this.off(e)}))}};var ge=s(4650),me=s(7311);const ye={format:"jpg",resource_type:"video",transformation:{flags:"waveform"}},ve=RegExp(`\\.(${["mp3","ogg","wav","mp4"].join("|")})$$`),_e={resource_type:"video",type:"upload",transformation:[]};class be extends pe.A{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};({publicId:e,options:t}=(0,P.a5)(e,t)),e=e.replace(ve,""),t=Object.assign({},_e,t);const{poster:s}=(0,q.sliceAndUnsetProperties)(t,"poster");super(e,t),this._poster=null,this._type=Q.x.AUDIO,this.poster(s)}getPoster(){return this._poster}poster(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?e instanceof ge.A?(this._poster=e,this):(({publicId:e,options:t}=(0,P.a5)(e,t,{tolerateMissingId:!0})),e||(e=this.publicId(),t=Object.assign({},t,ye)),t.cloudinaryConfig=t.cloudinaryConfig||this.cloudinaryConfig(),this._poster=new ge.A(e,t),this):this._poster}generateSources(){return this.sourceTypes().map((e=>{if("audio"===e){const t="mp3",s={},i=this.sourceTransformation()[e]||[this.transformation()];i&&(s.transformation=i),Object.assign(s,{resource_type:"video",format:t});const r=this.queryParams()?(0,me.y)(this.queryParams()):"";return{type:"video/mp4",src:`${this.config().url(this.publicId(),s)}${r}`,cldSrc:this,poster:this.getPoster().url()}}return null}),this)}}const Te=be,Ae={transformation:{},sourceTypes:[],sourceTransformation:[],posterOptions:{}},Ee=["cloudinaryConfig","transformation","sourceTypes","sourceTransformation","posterOptions","autoShowRecommendations"];class Se{constructor(e){var t=this;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,P.M6)(),this.player=e,i=Object.assign({},Ae,i);let r=null,n=null,a=null,o=null,l=null,h=null,c=null,d=null,u=null,p=i.chainTarget,f=null,g=null,m=!1;this.source=function(i){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n=Object.assign({},n),!i)return r;let a=null;if(i instanceof pe.A)a=i;else{let{publicId:e,options:s}=(0,P.a5)(i,n);a=t.buildSource(e,s)}const o=a.recommendations();if(o&&o.length){let t=null,i=!1;n.recommendationOptions&&({disableAutoShow:i,itemBuilder:t}=(0,q.sliceAndUnsetProperties)(n.recommendationOptions,"disableAutoShow","itemBuilder")),async function(e){try{return e.getChild("recommendationsOverlay")||(await Promise.all([s.e(869),s.e(410)]).then(s.bind(s,7604)),e.addChild("recommendationsOverlay")),e}catch(e){console.error("Failed to load plugin:",e)}}(e).then((()=>{y(o,{disableAutoShow:i,itemBuilder:t})}))}else _();r=a,c=a.transformation();const l=n.sourceTypes&&n.sourceTypes.some((e=>e.includes("dash")))||"string"==typeof i&&i.endsWith(".mpd"),h=n.sourceTypes&&n.sourceTypes.some((e=>e.includes("hls")))||"string"==typeof i&&i.endsWith(".m3u8");return!l&&!h||t.player.adaptiveStreamingLoaded?n.skipRefresh||b():s.e(26).then(s.bind(s,7707)).then((()=>{t.player.adaptiveStreaming({...n.adaptiveStreaming,isDash:l,debug:n.debug,withCredentials:n.withCredentials}).then((()=>{b()}))})).catch((e=>{console.error("Failed to load adaptive streaming plugin:",e),b()})),t.player.trigger("cldsourcechanged",{source:a,sourceOptions:n}),p},this.buildSource=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=null;return({publicId:e,options:s}=(0,P.a5)(e,s)),s.cloudinaryConfig=(0,P.lP)(t.cloudinaryConfig(),s.cloudinaryConfig||{}),s.transformation=(0,P.N7)(t.transformation(),s.transformation||{}),s.sourceTransformation=s.sourceTransformation||t.sourceTransformation(),s.sourceTypes=s.sourceTypes||t.sourceTypes(),s.poster=s.poster||A(),s.queryParams=Object.assign(s.queryParams||{},s.allowUsageReport?{_s:"vp-3.4.2"}:{}),i=s.sourceTypes.indexOf("audio")>-1?new Te(e,s):new pe.A(e,s),i},this.posterOptions=e=>e?(l=e,p):l,this.disablePoster=e=>{this.player.poster(" "),this.player.posterImage.el().style.backgroundColor=e},this.cloudinaryConfig=e=>e?(h=e,p):h,this.transformation=e=>e?(c=e,p):c,this.sourceTypes=e=>e?(d=e,p):d,this.getCurrentSources=()=>n,this.sourceTransformation=e=>e?(u=e,p):u,this.on=function(){return f.on(...arguments)},this.one=function(){return f.one(...arguments)},this.off=function(){return f.off(...arguments)},this.autoShowRecommendations=e=>void 0===e?m:(m=e,p),this.dispose=()=>{this.playlist&&this.playlist()&&this.disposePlaylist(),_(),r=void 0,f.removeAllListeners()};const y=(e,t)=>{let{disableAutoShow:s=!1,itemBuilder:i=null}=t;if(_(),!Array.isArray(e)&&"function"!=typeof e&&!e.then)throw new Error('"recommendations" must be either an array or a function');g={},i=i||(e=>({source:e instanceof pe.A?e:this.buildSource(e),action:()=>this.source(e)})),g.sourceChangedHandler=()=>{const t=e=>{if(void 0!==e&&e.length>0){const t=e.map((e=>i(e)));this.player.trigger("recommendationschanged",{items:t})}else this.player.trigger("recommendationsnoshow");g.sources=e};v()(e)?t(e()):e.then?e.then(t):t(e)},g.sourceChangedHandler(),g.endedHandler=()=>{!s&&this.autoShowRecommendations()&&this.player.trigger("recommendationsshow")},this.on("ended",g.endedHandler)},_=()=>{g&&(this.off("cldsourcechanged",g.sourceChangedHandler),this.off("ended",g.endedHandler),delete g.endedHandler,delete g.sourceChangedHandler),g=null},b=()=>{const e=this.source();if(!e)return;const t=Object.assign({},this.player.cloudinary.posterOptions(),e.getInitOptions().poster);t.posterColor?this.disablePoster(t.posterColor):e.poster()&&this.player.poster(e.poster().url()),n=e.generateSources().reduce(((e,t)=>{if(t.isAdaptive)if(t.type.split("; ")[1]&&"MediaSource"in window){let s=`video/mp4; ${t.type.split("; ")[1]||""}`;T(s)&&e.push(t)}else e.push(t);else e.push(t);return e}),[]),this.player.src(n),a=e,this.playlist&&(o=this.playlist())},T=e=>document.createElement("video").canPlayType(e)||"MediaSource"in window&&MediaSource.isTypeSupported(e),A=()=>{const e=Object.assign({},this.posterOptions());e.transformation=e.transformation||{},!e.transformation.width&&!e.transformation.height||e.transformation.crop||(e.transformation.crop="scale");const t=this.player.el();if(t&&t.clientWidth&&t.clientHeight&&!(0,ue.isKeyInTransformation)(e.transformation,"width")&&!(0,ue.isKeyInTransformation)(e.transformation,"height")){const s=e=>100*Math.ceil(e/100);e.transformation=(0,P.N7)(e.transformation,{width:s(t.clientWidth),height:s(t.clientHeight),crop:"limit"})}return e};f=new fe(this.player);const E=(0,q.sliceAndUnsetProperties)(i,...Ee);var S,C;S=this,C=E,Object.entries(C).forEach((e=>{let[t,s]=e;S[t]&&"function"==typeof S[t]&&S[t](s)})),this.on("sourcechanged",((e,t)=>{let s=t.to;a&&a.contains(s)?this.source()||(this.playlist&&o&&this.playlist(o),this.source(a,{skipRefresh:!0})):(this.player.trigger("cldsourcechanged",{}),this.dispose())}))}currentSourceType(){return this.source().getType()}currentPublicId(){return this.source()&&this.source().publicId()}currentPoster(){return this.source()&&this.source().poster()}}var Ce=s(4679),we=s.n(Ce),ke=s(4138);class Le{constructor(e,t){this.player=e,this.cloudinaryAnalytics=(0,ke.connectCloudinaryAnalytics)(this.player.videoElement,{playerAdapter:this.getCloudinaryVideoPlayerAdapter()}),this.currentVideoMetadata={cloudName:null,publicId:null},this.analyticsOptions=t}getMetadata=()=>({cloudName:this.player.cloudinary.cloudinaryConfig().cloud_name,publicId:this.player.cloudinary.currentPublicId()});sourceChanged=(e,t)=>{let{source:s}=t;const i=this.getMetadata();if(i.cloudName&&i.publicId){const e="live"===s?.resourceConfig().type;this.currentVideoMetadata=i,this.cloudinaryAnalytics.startManualTracking({...i,...e?{type:"live"}:{}},{...we()(this.analyticsOptions)?this.analyticsOptions:{},videoPlayerType:"cloudinary video player",videoPlayerVersion:"3.4.2"})}else this.currentVideoMetadata.cloudName===i.cloudName&&this.currentVideoMetadata.publicId===i.publicId||this.cloudinaryAnalytics.stopManualTracking()};getCloudinaryVideoPlayerAdapter=()=>{const e=(e,t)=>(this.player.on(e,t),()=>{this.player.off(e,t)});return{onCanPlay:t=>e("canplay",t),onCanPlayThrough:t=>e("canplaythrough",t),onComplete:t=>e("complete",t),onDurationChange:t=>e("durationchange",t),onEmptied:t=>e("emptied",t),onEnded:t=>e("ended",t),onError:t=>e("error",t),onLoadedData:t=>e("loadeddata",t),onLoadedMetadata:t=>e("loadedmetadata",t),onLoadStart:t=>e("loadstart",t),onPause:t=>e("pause",t),onPlay:t=>e("play",t),onPlaying:t=>e("playing",t),onProgress:t=>e("progress",t),onRateChange:t=>e("ratechange",t),onSeeked:t=>e("seeked",t),onSeeking:t=>e("seeking",t),onStalled:t=>e("stalled",t),onSuspend:t=>e("suspend",t),onTimeUpdate:t=>e("timeupdate",t),onVolumeChange:t=>e("volumechange",t),onWaiting:t=>e("waiting",t),getCurrentSrc:()=>this.player.videoElement.currentSrc,getCurrentTime:()=>this.player.currentTime(),getReadyState:()=>this.player.videoElement.readyState,getDuration:()=>this.player.duration()}};init(){this.player.on(Q.f.CLD_SOURCE_CHANGED,this.sourceChanged)}}var Ie=s(7134);const Pe=a().getComponent("MenuItem"),Re=class extends Pe{handleClick(){super.handleClick(),this.options_.listener()}createEl(){const e=(0,Ie.n)("span",{class:"vjs-menu-item-text"+(this.options_.class?` ${this.options_.class}`:"")});return e.appendChild(document.createTextNode(this.localize(this.options_.label))),(0,Ie.n)("li",{class:"vjs-menu-item",tabIndex:-1},e)}},xe=a().getComponent("Menu"),De=class extends xe{constructor(e,t){var s;super(e,t),s=this,t.content.forEach((t=>{let i=null;i=v()(t.listener)?t.listener:"string"==typeof t.href?()=>window.open(t.href):()=>!0,this.addItem(new Re(e,{label:t.label,class:t.class,listener:function(){i(...arguments),s.dispose()}}))}))}setPosition(e,t){(0,he.setPosition)(this.el(),e,t)}createEl(){const e=super.createEl();if(a().dom.addClass(e,"vjs-context-menu-ui"),this.options_.position){const{left:e,top:t}=this.options_.position;this.setPosition(e,t)}return e}},Oe={cancel:!0,sensitivity:10,wait:500,disabled:!1},Me="vjs-contextmenu";function Ne(e,t){if(e.contextmenu.options.disabled)return e;const s={target:e,type:Me};return["clientX","clientY","pageX","pageY","screenX","screenY"].forEach((e=>{s[e]=t[e]})),e.trigger(s)}function Fe(e){const t=this.contextmenu.current;if(!t)return;const s=this.contextmenu.options.wait;"touchend"===e.type&&(new Date).getTime()-t.time>=s&&Ne(this,e),this.contextmenu.current=null}function Be(e){const t=this.contextmenu.current;if(!t)return;const s=e.touches[0],i=this.contextmenu.options.sensitivity;(s.screenX-t.screenX>i||s.screenY-t.screenY>i)&&(this.contextmenu.current=null)}function je(e){if(this.contextmenu.current)return;const t=e.touches[0];this.contextmenu.current={screenX:t.screenX,screenY:t.screenY,time:(new Date).getTime()}}function Ue(e){this.contextmenu.options.cancel&&!this.contextmenu.options.disabled&&e.preventDefault(),Ne(this,e),this.off(["touchcancel","touchend"],Fe),this.off("touchmove",Be),this.off("touchstart",je)}a().registerPlugin("contextmenu",(function(e){this.contextmenu.options=a().obj.merge(Oe,e),this.on("contextmenu",Ue),this.on(["touchcancel","touchend"],Fe),this.on("touchmove",Be),this.on("touchstart",je),this.ready((()=>this.addClass(Me)))}));const $e={showNativeOnRecurringEvent:!1};class He{constructor(e,t){if(!Array.isArray(t.content)&&!v()(t.content))throw new Error('"content" required');const s=Object.assign({},$e,t);this.player=e;const i=(0,q.sliceProperties)(s,"content","showNativeOnRecurringEvent");this.init=()=>{this.player.contextmenu(),this.player.on("vjs-contextmenu",n),this.player.ready((()=>this.player.addClass("vjs-context-menu")))};const r=e=>{const t=this.menu.el();t.style.visibility="hidden",this.player.el().appendChild(t);const s=t.getBoundingClientRect();this.player.el().removeChild(t),t.style.visibility="visible";const i=(0,he.getPointerPosition)(this.player.el(),e),r=this.player.el().getBoundingClientRect();let n=r.height-r.height*i.y+1,a=Math.round(r.width*i.x)+1,o=n,l=a;return n+s.height>r.height&&(o=n+s.height-r.height>s.height/2?n-s.height-1:r.height-s.height),a+s.width>r.width&&(l=a+s.width-r.width>s.width/2?a-s.width-1:r.width-s.width),o<n&&l<a&&(o=n-s.height-1,l=a-s.width-1),o=Math.max(0,o),l=Math.max(0,l),{left:l,top:o}},n=e=>{if(this.menu&&(this.menu.dispose(),i.showNativeOnRecurringEvent))return;i.showNativeOnRecurringEvent&&(this.player.contextmenu.options.cancel=!1),e.preventDefault();let t=i.content;v()(t)&&(t=t(this.player)),this.menu=new De(this.player,{content:t});const{left:s,top:n}=r(e);this.menu.setPosition(s,n);const o=e=>{("click"!==e.type||3!==e.which&&2!==e.button)&&this.menu.dispose()};this.menu.on("dispose",(()=>{this.player.contextmenu.options.cancel=!0,this.player.removeChild(this.menu),a().off(document,["click","tap"],o),delete this.menu})),this.player.addChild(this.menu),a().on(document,["click","tap"],o)}}}var Ve=s(608);const Ge={fraction:.5,collapsedWidth:300,floatTo:"right"};class We{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object.assign({},Ge,t),t.floatTo&&t.floatTo!==Ve.rT.LEFT&&t.floatTo!==Ve.rT.RIGHT&&(t.floatTo=Ge.floatTo),this.player=e;const s=this.player.el();let i=(0,q.sliceProperties)(t,"fraction"),r=null,n=!1,a=!1;this.init=()=>{c(),"object"==typeof this.player.ima&&d()};const o=e=>{const t=document.createElement("div");for(e.appendChild(t);e.firstChild!==t;)t.appendChild(e.firstChild);return t},l=()=>{window.removeEventListener("DOMContentLoaded",g,!1),window.removeEventListener("load",g,!1),window.removeEventListener("scroll",g,!1),window.removeEventListener("resize",g,!1)},h=()=>{window.addEventListener("DOMContentLoaded",g,!1),window.addEventListener("load",g,!1),window.addEventListener("scroll",g,!1),window.addEventListener("resize",g,!1)},c=()=>{this.player.on("play",g),this.player.on("play",h),this.player.on("dispose",l)},d=()=>{const e=s.getBoundingClientRect();r=o(s);const t=o(r);t.setAttribute("class","cld-video-player-floater-inner"),t.setAttribute("style","padding-bottom: "+100*e.height/e.width+"%;");const i=document.createElement("button");i.setAttribute("class","cld-video-player-floater-close"),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><polygon fill-rule="evenodd" points="370 7.41 368.59 6 364 10.59 359.41 6 358 7.41 362.59 12 358 16.59 359.41 18 364 13.41 368.59 18 370 16.59 365.41 12" transform="translate(-358 -6)"/></svg>',i.onclick=()=>{p(),f()},r.appendChild(i)},u=()=>{const{ima:e}=this.player;e&&e.adsActive&&e.getAdsManager().resize(n?r.clientWidth:s.clientWidth,n?r.clientHeight:s.clientHeight)},p=()=>{r.classList.remove("cld-video-player-floating"),n=!1,u()},f=()=>{l(),this.player.off("play",g),this.player.off("play",h)},g=()=>{(0,he.isElementInViewport)(this.player.el(),{fraction:i.fraction})?n&&p():n||(r||d(),a||(()=>{const e=s.getBoundingClientRect();r.setAttribute("class",`cld-video-player-floater cld-video-player-floater-bottom-${t.floatTo}`),r.setAttribute("style",["width: "+t.collapsedWidth+"px;","top: "+e.top+"px;","left: "+e.left+"px;","right: "+(document.documentElement.clientWidth-e.right)+"px;","bottom: "+(document.documentElement.clientHeight-e.bottom)+"px;"].join("")),a=!0})(),n=!0,setTimeout((()=>{r.classList.add("cld-video-player-floating"),u()})))}}}var ze=s(7588),Ke=s(3066);let qe={},Ye={};const Xe=function(){function e(e,t){return this.player=e,this.options=t,this.initializeThumbnails(),this}return e.prototype.src=function(e){this.resetPlugin(),this.options.src=e,this.initializeThumbnails()},e.prototype.detach=function(){this.resetPlugin()},e.prototype.resetPlugin=function(){this.thumbnailHolder&&this.thumbnailHolder.parentNode.removeChild(this.thumbnailHolder),delete this.vttData,delete this.thumbnailHolder,delete this.lastStyle},e.prototype.initializeThumbnails=function(){this.options.src&&fetch(this.options.src,{credentials:this.player.cloudinary.source?.().withCredentials?"include":"omit"}).then((e=>e.text())).then((e=>{this.vttData=this.processVtt(e),this.setupThumbnailElement()}))},e.prototype.setupThumbnailElement=function(){if(!this.vttData[0])return;const e=this.player.$(".vjs-progress-holder .vjs-mouse-display");this.thumbnailHolder=this.player.$(".vjs-vtt-thumbnail-display")||a().dom.createEl("div",void 0,{class:"vjs-vtt-thumbnail-display",style:`width: ${this.vttData[0].css.width}`}),this.thumbnailHolder.innerHTML="",this.thumbnailHolder.setAttribute("class","vjs-vtt-thumbnail-display"),e.appendChild(this.thumbnailHolder);const t=parseInt(this.vttData[0].css.width,10)/2,s=this.updateThumbnailStyle.bind(this);this.player.getDescendant(["controlBar","progressControl","seekBar","mouseTimeDisplay"]).update=function(e,i){const r=i*this.player_.duration(),n=e.width;s(r),this.getChild("timeTooltip").updateTime(e,i,r,(()=>{e.width*i<t?this.el_.style.left=`${t}px`:e.width*i+t>n?this.el_.style.left=e.width-t+"px":this.el_.style.left=e.width*i+"px"})),this.getChild("timeTooltip").write(a().time.formatTime(r))}},e.prototype.getStyleForTime=function(e){for(let t=0;t<this.vttData.length;++t){let s=this.vttData[t];if(e>=s.start&&e<s.end){if(s.css.url&&!Ye[s.css.url]){let e=new Image;e.src=s.css.url,Ye[s.css.url]=e}return s.css}}},e.prototype.updateThumbnailStyle=function(e){let t=this.getStyleForTime(e);if(t){if(this.thumbnailHolder.style.opacity="1",!this.lastStyle||this.lastStyle!==t){this.lastStyle=t;for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(this.thumbnailHolder.style[e]=t[e])}}else this.thumbnailHolder.style.opacity="0"},e.prototype.processVtt=function(e){let t=[];return e.split(/[\r\n][\r\n]/i).forEach((e=>{if(e.match(/([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?( ?--> ?)([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?[\r\n]{1}.*/gi)){let s=e.split(/[\r\n]/i),i=s[0].split(/ ?--> ?/i),r=i[0],n=i[1],a=s[1].split("/").pop(),o=this.getVttCss(a);t.push({start:this.getSecondsFromTimestamp(r),end:this.getSecondsFromTimestamp(n),css:o})}})),t},e.prototype.getPropsFromDef=function(e){let t=e.split(/#xywh=/i),s=t[0],i=t[1].match(/[0-9]+/gi);return{x:i[0],y:i[1],w:i[2],h:i[3],image:s}},e.prototype.getVttCss=function(e){let t={};e=[this.options.src.split(/([^\/]*)$/gi).shift().trim(),e.trim()].join("/");let s=this.getPropsFromDef(e);return t.background='url("'+s.image+'") no-repeat -'+s.x+"px -"+s.y+"px",t.width=s.w+"px",t.height=s.h+"px",t.url=s.image,t},e.prototype.getSecondsFromTimestamp=function(e){const[t,s,i]=e.split(":").map(parseFloat);return 60*t*60+60*s+i},e}();var Qe=s(7707);const Ze=class{seperator=",";timestampToSeconds(e){const[t,s]=e.split(","),i=parseInt(s),[r,n,a]=t.split(":").map((e=>parseInt(e))),o=.001*i+a+60*n+3600*r;return Math.round(1e3*o)/1e3}correctFormat(e){let t=e.replace(".",",");var s,[i,r]=t.split(",");s=this.fixed_str_digit(3,r);var[n,a,o]=i.split(":");return`${this.fixed_str_digit(2,n,!1)}:${this.fixed_str_digit(2,a,!1)}:${this.fixed_str_digit(2,o,!1)},${s}`}fixed_str_digit(e,t,s=!0){return t.length==e?t:t.length>e?t.slice(0,e):t.length<e?s?t.padEnd(e,"0"):t.padStart(e,"0"):void 0}tryComma(e){let t=(e=e.replace(/\r/g,"")).split(/(\d+)\n(\d{1,2}:\d{2}:\d{2},\d{1,3}) --> (\d{1,2}:\d{2}:\d{2},\d{1,3})/g);return t.shift(),t}tryDot(e){let t=(e=e.replace(/\r/g,"")).split(/(\d+)\n(\d{1,2}:\d{2}:\d{2}\.\d{1,3}) --> (\d{1,2}:\d{2}:\d{2}\.\d{1,3})/g);return t.shift(),this.seperator=".",t}fromSrt(e){var t=e,s=this.tryComma(t);0==s.length&&(s=this.tryDot(t));for(var i=[],r=0;r<s.length;r+=4){const e=this.correctFormat(s[r+1].trim()),t=this.correctFormat(s[r+2].trim());var n={id:s[r].trim(),startTime:e,startSeconds:this.timestampToSeconds(e),endTime:t,endSeconds:this.timestampToSeconds(t),text:s[r+3].trim()};i.push(n)}return i}toSrt(e){var t="";const s="\r\n";for(var i=0;i<e.length;i++){var r=e[i];t+=r.id+s,t+=r.startTime+" --\x3e "+r.endTime+s,t+=r.text.replace("\n",s)+s+s}return t}},Je=async e=>(new Ze).fromSrt(e).filter((e=>e)).map((e=>({startTime:e.startSeconds,endTime:e.endSeconds,text:e.text}))),et=async e=>{const t=e.trim().split(/\r?\n/),s=[];let i=[];const r=e=>{const[t,s]=e.split("."),[i,r,n]=t.split(":").map(Number);return 3600*i+60*r+n+(parseFloat(`0.${s}`)||0)},n=e=>{const t=e.filter(Boolean);if(t.length<2)return null;const s=t[0].includes("--\x3e")?0:1,i=t[s],[n,a]=i.split("--\x3e"),o=n.trim(),[l,...h]=a.trim().split(/\s+/),c=h.join(" "),d=t.slice(s+1).join("\n").trim();return{startTime:r(o),endTime:r(l),text:d,settings:c||null}};let a=!1;for(const e of t)if(/^(NOTE|STYLE|REGION)/.test(e.trim()))a=!0;else if(a&&""===e.trim())a=!1;else if(!a)if(""===e.trim()){const e=n(i);e&&s.push(e),i=[]}else i.push(e);if(i.length>0){const e=n(i);e&&s.push(e)}return s},tt=function(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return`${e}/_applet_/video_service/transcription/${t}/${i?`${i}/`:""}${(0,I.G)(s)}.transcript`},st={aiHighlightsGraph:function(e){this.ready((()=>{!function(e,t){e.addClass("vjs-ai-highlights-graph"),e.aiHighlightsGraph=new K(e,t)}(this,a().obj.merge(z,e))}))},analytics:function(){new le(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).init()},autoplayOnScroll:function(){new de(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).init()},cloudinary:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.chainTarget=e.chainTarget||this,this.cloudinary=new Se(this,e)},cloudinaryAnalytics:function(){new Le(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).init()},contextMenu:function(){new He(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).init()},floatingPlayer:function(){new We(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).init()},sourceSwitcher:function(){const e=this;return{reInit:t=>{const s=e.getChild("controlBar").getChild("sourceSwitcherButton");if(!s)return void a().log.warn("SourceSwitcherButton not found in controlBar.");const i=t.sources.map((e=>({value:e.publicId,label:e.label||e.publicId})));s.setItems(i),s.setOnSelected((()=>{})),s.setSelected(t.selectedIndex),s.setOnSelected((e=>{let{index:s}=e;t.onSourceChange(t.sources[s])}))}}},styledTextTracks:async function(e){const t=this;try{t.ready((()=>((e,t)=>{const s={theme:e.theme||"default",fontFace:e.fontFace,fontSize:e.fontSize,gravity:e.gravity||"bottom",box:e.box,style:e.style,wordHighlightStyle:e.wordHighlightStyle},i=document.createElement("style");t.el_.appendChild(i);const r=t.textTrackDisplay.el().classList;r.forEach((e=>{e.startsWith("cld-styled-text-tracks")&&r.remove(e)})),r.add("cld-styled-text-tracks"),r.add(`cld-styled-text-tracks-theme-${s.theme}`),s.gravity.split("-").forEach((e=>{r.add(`cld-styled-text-tracks-gravity-${e}`)}));const n=(e,t)=>{if(Object.entries(e)){const s=Object.entries(e).reduce(((e,t)=>{let[s,i]=t;return e+`${s}: ${i} !important; `}),"");i.innerHTML+=`${t} { ${s} } `}},a=e=>{const s=`\n      .${(0,Ke.playerClassPrefix)(t)} .vjs-text-track-cue > div,\n      .${(0,Ke.playerClassPrefix)(t)} ::cue\n    `;n(e,s)};if(s.fontFace&&((0,ze.fontFace)(t.textTrackDisplay.el(),s.fontFace),a({"font-family":s.fontFace})),s.box){const{x:e,y:i,width:r,height:a}=s.box;(e=>{const s=`\n      .${(0,Ke.playerClassPrefix)(t)} .vjs-text-track-display.cld-styled-text-tracks,\n      .${(0,Ke.playerClassPrefix)(t)} ::-webkit-media-text-track-display\n    `;n(e,s)})({translate:`${e||0} ${i||0}`,...r?{width:r}:void 0,...a?{height:a}:void 0})}s.fontSize&&a({"font-size":s.fontSize}),s.style&&a(s.style),s.wordHighlightStyle&&(n(s.wordHighlightStyle,`.${(0,Ke.playerClassPrefix)(t)} .cld-paced-text-tracks .vjs-text-track-cue b`),n(s.wordHighlightStyle,"video::cue(b)"))})(e,t)))}catch(e){console.error("Failed to load plugin:",e)}},vttThumbnails:function(e){this.ready((()=>{!function(e,t){e.addClass("vjs-vtt-thumbnails"),e.vttThumbnails=new Xe(e,t)}(this,a().obj.merge(qe,e))}))},chapters:async function(e){const t=this;try{const{default:i}=await Promise.all([s.e(869),s.e(625)]).then(s.bind(s,9234));t.ready((()=>i(e,t)))}catch(e){console.error("Failed to load plugin:",e)}},colors:async function(e){const t=this;try{const{default:i}=await Promise.all([s.e(869),s.e(691)]).then(s.bind(s,9454)),r=i(t,e);return t.cloudinary.colors=r,r}catch(e){console.error("Failed to load colors plugin:",e)}},imaPlugin:async function(e,t){await Promise.all([s.e(869),s.e(330)]).then(s.bind(s,2650));const i=v()(e.ads),r="object"==typeof google&&"object"==typeof google.ima;if(t.ads&&(!i||!r))return i||console.warn("contribAds is not loaded"),r||console.warn("imaSdk is not loaded"),!1;e.ima({id:e.el().id,adTagUrl:t.ads.adTagUrl,disableFlashAds:!0,prerollTimeout:t.ads.prerollTimeout||5e3,postrollTimeout:t.ads.postrollTimeout||5e3,showCountdown:!1!==t.ads.showCountdown,adLabel:t.ads.adLabel||"Advertisement",locale:t.ads.locale||"en",autoPlayAdBreaks:!1!==t.ads.autoPlayAdBreaks,debug:t.ads.denug}),Object.keys(t.ads).length>0&&"object"==typeof e.ima&&("first-video"===t.ads.adsInPlaylist?e.one(Q.f.SOURCE_CHANGED,(()=>{e.ima.playAdBreak()})):e.on(Q.f.SOURCE_CHANGED,(()=>{e.ima.playAdBreak()})))},playlist:async function(e){const t=this;try{const{default:i}=await Promise.all([s.e(869),s.e(33)]).then(s.bind(s,5826)),r=i(t,e);return t.cloudinary.playlist=r,r}catch(e){console.error("Failed to load plugin:",e)}},shoppable:async function(e,t){const{default:i}=await Promise.all([s.e(869),s.e(525)]).then(s.bind(s,9987));new i(e,t.shoppable).init()},interactionAreas:async function(e,t,i){try{const{interactionAreasService:r}=await Promise.all([s.e(869),s.e(404)]).then(s.bind(s,1066));r(e,t,i)}catch(e){console.error("Failed to load plugin:",e)}},visualSearch:async function(e){const t=this;try{const{default:i}=await Promise.all([s.e(869),s.e(728)]).then(s.bind(s,9148));t.ready((()=>i(e,t)))}catch(e){console.error("Failed to load plugin:",e)}},share:async function(e){const t=this;try{const{default:i}=await Promise.all([s.e(869),s.e(976)]).then(s.bind(s,2130));t.ready((()=>i(e,t)))}catch(e){console.error("Failed to load share plugin:",e)}},adaptiveStreaming:Qe.default,textTracksManager:function(){const e=this,t=new WeakMap;let s=null;const i=(e,s)=>{const i=t.get(e);t.set(e,{...i,...s})},r=(s,r)=>{const{kind:n=("transcript"===s?"captions":"subtitles"),label:a=("transcript"===s?"Captions":"Subtitles"),default:o,srclang:l,src:h}=r;"transcript"===s&&e.textTrackDisplay.el().classList.add("cld-paced-text-tracks");const{track:c}=e.addRemoteTextTrack({kind:n,label:a,srclang:l,default:o,mode:o?"showing":"disabled"});((e,s)=>{const i=new AbortController;t.set(e,{status:"idle",load:async()=>{const{status:r}=t.get(e);"idle"===r&&(await s(i.signal),(e=>{if(!e||"string"!=typeof e.mode)return;const t=e.mode;e.mode="showing"===t?"hidden":"showing",setTimeout((()=>{e.mode=t}),0)})(e))},abortLoading:()=>{const{status:s}=t.get(e);"pending"===s&&i.abort()}})})(c,(async t=>{i(c,{status:"pending"});const n=(()=>{if(h)return h;if("transcript"!==s)return;const t=e.cloudinary.source(),i=t.publicId(),r=t.resourceConfig().type,n=(0,P.k$)(e.cloudinary.cloudinaryConfig()),a=tt(n,r,i);return(l?tt(n,r,i,l):null)||a})(),a=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{polling:s=!1,interval:i=3e3,maxAttempts:r=10,signal:n,onSuccess:a,onError:o,onAttempt:l}=t;let h=0;const c=async()=>{if(n?.aborted)throw new DOMException("Aborted","AbortError");h++,l?.(h);const t=await fetch(e,{signal:n});if(202===t.status&&s){if(h<r)return new Promise(((e,t)=>{const s=setTimeout((()=>{c().then(e).catch(t)}),i);n?.addEventListener("abort",(()=>{clearTimeout(s),t(new DOMException("Aborted","AbortError"))}),{once:!0})}));throw new Error(`Polling max attempts reached (${r}) for ${e}`)}if(!t.ok)throw new Error(`Failed fetching from ${e} with status code ${t.status}`);const o=await t.text();return a?.(o),o};try{return await c()}catch(e){"AbortError"===e.name?console.warn("Polling aborted"):console.error(e),o?.(e)}}(n,{signal:t,polling:"transcript"===s&&!h,interval:2e3,maxAttempts:10,responseStatusAsPending:202,onSuccess:()=>i(c,{status:"success"}),onError:e=>{((e,t)=>{i(e,{status:"error",error:t})})(c,e),console.warn(`[${c.label}] Text track could not be loaded`)}});if(a){const e="srt"===s?Je:"vtt"===s?et:e=>(async(e,t)=>((e,t)=>{const s=[],i=e=>{let{startTime:i,endTime:r,text:n}=e;s.push({startTime:i+t.timeOffset,endTime:r+t.timeOffset,text:n})};return e.forEach((e=>{const r=e.words;if(r){const e=t.maxWords||r.length;for(let n=0;n<r.length;n+=e)t.wordHighlight?r.slice(n,Math.min(n+e,r.length)).forEach(((t,s)=>{i({startTime:t.start_time,endTime:t.end_time,text:r.slice(n,n+e).map((e=>e===t?`<b>${e.word}</b>`:e.word)).join(" ")}),r[s+1]&&t.end_time<r[s+1].start_time&&i({startTime:t.end_time,endTime:r[s+1].start_time,text:r.slice(n,n+e).map((e=>e.word)).join(" ")})})):s.push({startTime:r[n].start_time,endTime:r[Math.min(n+e-1,r.length-1)].end_time,text:r.slice(n,n+e).map((e=>e.word)).join(" ")})}else i({startTime:e.start_time,endTime:e.end_time,text:e.transcript})})),s})(JSON.parse(e),t))(e,{maxWords:r.maxWords,wordHighlight:r.wordHighlight,timeOffset:r.timeOffset??0}),t=await e(a);(o=c)&&o.cues&&Array.from(o.cues).forEach((e=>{try{o.removeCue(e)}catch(t){console.warn("Failed to remove cue:",e,t)}})),((e,t)=>{t.forEach((t=>{let{startTime:s,endTime:i,text:r,settings:n}=t;const a=new VTTCue(s,i,r);n&&n.split(/\s+/).forEach((e=>{const[t,s]=e.split(":");if(t&&s)switch(t){case"line":a.line=isNaN(s)?s:parseFloat(s);break;case"position":a.position=parseFloat(s);break;case"size":a.size=parseFloat(s);break;case"align":a.align=s}})),e.addCue(a)}))})(c,t),(e=>{i(e,{status:"applied"})})(c)}var o}))},n=e=>{const i=s;s=e;const r=t.get(i);r&&r.abortLoading();const n=t.get(s);n&&n.load()};return e.on("texttrackchange",(()=>{const t=e.textTracks();let i=null;for(let e=0;e<t.length;e++){const s=t[e];if("showing"===s.mode){i=s;break}}s!==i&&n(i)})),{removeAllTextTracks:()=>{const t=e.remoteTextTracks();if(t)for(let s=t.tracks_.length-1;s>=0;s--)e.removeRemoteTextTrack(t.tracks_[s])},addTextTracks:function(){for(var t=arguments.length,s=new Array(t),i=0;i<t;i++)s[i]=arguments[i];e.one("loadedmetadata",(()=>{(t=>{t.forEach((e=>{e.src&&e.src.endsWith(".vtt")?r("vtt",e):e.src&&e.src.endsWith(".srt")?r("srt",e):e.src&&!e.src.endsWith(".transcript")||r("transcript",e)}));const s=Array.from(e.remoteTextTracks()).find((e=>e.default));s&&n(s)})(...s)}))}}}},it=st;var rt=s(5104),nt=s(7668);const at=e=>class extends e{constructor(){var e;super(),e=this;const t={data:{},handlers:{}};this.on=function(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const n=i.length-1,a=i[n];return t.handlers[a]=function(t){t.Player=e;for(var s=arguments.length,i=new Array(s>1?s-1:0),r=1;r<s;r++)i[r-1]=arguments[r];a(t,...i)},i[n]=t.handlers[a],e.videojs.on(...i)},this.one=function(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const n=i.length-1,a=i[n];return t.handlers[a]=function(s){s.Player=e;for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];a(s,...r),delete t.handlers[a]},i[n]=t.handlers[a],e.videojs.one(...i)},this.off=function(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const n=i.length-1,a=i[n];i[n]=t.handlers[a];const o=e.videojs.off(...i);return delete t.handlers[a],o},this.trigger=function(){e.videojs.trigger(...arguments)}}};var ot=s(8838),lt=s(5779);const ht=e=>!f()(e)||null,ct=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{posterOptions:ht(e.posterOptions),posterOptionsPublicId:e.posterOptions&&ht(e.posterOptions.publicId),autoShowRecommendations:e.autoShowRecommendations,fontFace:e.fontFace,sourceTypes:e.sourceTypes,chapters:!0===e.chapters?"auto":e.chapters&&e.chapters.url?"url":e.chapters?"inline-chapters":void 0,visualSearch:e.visualSearch,download:ht(e.download),recommendations:e.recommendations&&e.recommendations.length,...ht(e.adaptiveStreaming)?{abrStrategy:e?.adaptiveStreaming?.strategy===nt.A.adaptiveStreaming.strategy?void 0:e?.adaptiveStreaming?.strategy}:{},shoppable:ht(e.shoppable),shoppableProductsLength:e.shoppable&&e.shoppable.products&&e.shoppable.products.length,...e.title||e.description||e.info?{sourceInfo:ht(e.info),sourceTitle:"string"==typeof e.title?e.title:e.info?.title,sourceDescription:"string"==typeof e.description?e.description:e.info?.subtitle||e.info?.description}:{},...ht(e.textTracks)?dt(e.textTracks):{},videoSources:!!e.videoSources}},dt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=[e.captions,...e.subtitles||[]];return{textTracks:ht(e),textTracksLength:t.length,textTracksOptions:ht(e.options)&&Object.keys(e.options).join(","),pacedTextTracks:ht(e)&&JSON.stringify(e||{}).includes('"maxWords":')||null,wordHighlight:ht(e)&&JSON.stringify(e||{}).includes('"wordHighlight":')||null,transcriptLanguages:t.filter((e=>!e.url)).map((e=>e.language||"")).join(",")||null,transcriptAutoLoaded:t.some((e=>!e.url))||null,transcriptFromURl:t.some((e=>e.url?.endsWith(".transcript")))||null,vttFromUrl:t.some((e=>e.url?.endsWith(".vtt")))||null,srtFromUrl:t.some((e=>e.url?.endsWith(".srt")))||null,...e.options?{styledTextTracksTheme:e.options.theme,styledTextTracksFont:e.options.fontFace,styledTextTracksFontSize:e.options.fontSize,styledTextTracksGravity:e.options.gravity,styledTextTracksBox:ht(e.options.box),styledTextTracksStyle:ht(e.options.style),styledTextTracksWordHighlightStyle:ht(e.options.wordHighlightStyle)}:{}}},ut=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{adsAdTagUrl:e.adTagUrl,adsShowCountdown:e.showCountdown,adsAdLabel:e.adLabel,adsLocale:e.locale,adsPrerollTimeout:e.prerollTimeout,adsPostrollTimeout:e.postrollTimeout,adsAdsInPlaylist:e.adsInPlaylist}},pt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{playlist:e.playlist,playlistByTag:e.playlistByTag,playlistWidgetDirection:e.direction,playlistWidgetTotal:e.total}};Object.keys(it).forEach((e=>{a().registerPlugin(e,it[e])})),(0,ot.go)();class ft extends(rt.A.mixin(at)){static all(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];return[...document.querySelectorAll(e)].map((e=>new ft(e,...s)))}get playerOptions(){return this.options.playerOptions}constructor(e,t,s){super(),this.videoElement=(0,ot.iG)(e),this.options=(0,ot.Wi)(this.videoElement,t),this._videojsOptions=this.options.videojsOptions,this.videoElement.classList.add("video-js"),rt.A.fontFace(this.videoElement,this.playerOptions.fontFace),"init"===this._videojsOptions.bigPlayButton&&(this.videoElement.classList.add("vjs-big-play-button-init-only"),this._videojsOptions.bigPlayButton=!0),this.videojs=a()(this.videoElement,this._videojsOptions),this._isPlayerConfigValid=!0,this.playerOptions.debug&&(0,lt.I6)(this.options).then((e=>{if(!e)return this._isPlayerConfigValid=!1,void this.videojs.error("invalid player configuration")})),this._videojsOptions.muted&&this.videojs.volume(.4),this.playerOptions.fluid&&this.fluid(this.playerOptions.fluid),this._setCssClasses(),this._initPlugins(),this._initJumpButtons(),this._initPictureInPicture(),this._setVideoJsListeners(s)}getVPInstanceId(){return this.vpInstanceId||(this.vpInstanceId=u()),this.vpInstanceId}_sendInternalAnalytics(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Object.assign({},this.playerOptions,this.options.videojsOptions,e);if(t.allowUsageReport)try{const e=t._internalAnalyticsMetadata??{},r=(i={aiHighlightsGraph:(s=t).aiHighlightsGraph,analytics:ht(s.analytics),autoplay:s.autoplay,autoplayMode:s.autoplayMode,bigPlayButton:s.bigPlayButton,className:s.class,cloudinaryAnalytics:!!s.cloudinaryAnalytics,cloudinaryAnalyticsOptions:b()(s.cloudinaryAnalytics),controls:s.controls,floatingWhenNotVisible:s.floatingWhenNotVisible,fluid:s.fluid,height:s.height,hideContextMenu:s.hideContextMenu,logoImageUrl:s.logoImageUrl,logoOnclickUrl:s.logoOnclickUrl,loop:s.loop,maxTries:s.maxTries,muted:s.muted,playbackRates:s.playbackRates,playedEventPercents:s.playedEventPercents,playedEventTimes:s.playedEventTimes,playsinline:s.playsinline,preload:s.preload,videoTimeout:s.videoTimeout,seekThumbnails:s.seekThumbnails,showJumpControls:s.showJumpControls,chaptersButton:s.chaptersButton,pictureInPictureToggle:s.pictureInPictureToggle,showLogo:s.showLogo,skin:s.skin,videoJS:ht(s.videoJS),width:s.width,withCredentials:s.withCredentials,debug:s.debug,type:s.type,colors:s.colors&&JSON.stringify(s.colors),controlBar:JSON.stringify(s.controlBar)!==JSON.stringify(nt.A.controlBar)&&JSON.stringify(s.controlBar),...ct(s.sourceOptions||{}),...ut(s.ads),...pt(s.playlistWidget)},Object.entries(i).reduce(((e,t)=>{let[s,i]=t;return i!==nt.A[s]&&null!=i&&(e[s]=i),e}),{})),n=new URLSearchParams(r).toString(),a=new URLSearchParams({vpVersion:"3.4.2",vpInstanceId:this.getVPInstanceId(),cloudName:t.cloudinary.cloud_name,...e}).toString();fetch(`https://analytics-api-s.cloudinary.com/video_player_source?${n}&${a}`)}catch(e){console.warn(e)}var s,i}_resetReTryVideoState=()=>{this.reTryVideoStateRetriesCount=0,this.videojs.clearTimeout(this.reTryVideoStateTimeoutId)};_setVideoJsListeners(e){this.videojs.on(Q.f.ERROR,(()=>{const e=this.videojs.error();if(e){const t=this._isPlayerConfigValid&&this.videojs.cloudinary.currentSourceType();[3===e.code&&a().browser.IS_SAFARI,4===e.code].includes(!0)&&[Q.x.AUDIO,Q.x.VIDEO].includes(t)?this.isLiveStream?(this.videojs.error({code:P.bo.CUSTOM,message:"Live Stream not started"}),this.reloadVideoUntilAvailable()):(this.videojs.error(null),rt.A.handleCldError(this,this.playerOptions)):this._resetReTryVideoState()}})),this.videojs.tech_.on(Q.f.RETRY_PLAYLIST,(()=>{m()(this.videojs,"hls.stats.mediaRequestsErrored",0)>0&&(this._resetReTryVideoState(),rt.A.handleCldError(this,this.playerOptions))})),this.videojs.on(Q.f.PLAY,this._resetReTryVideoState),this.videojs.on(Q.f.CAN_PLAY_THROUGH,this._resetReTryVideoState),this.videojs.on(Q.f.CLD_SOURCE_CHANGED,this._onSourceChange.bind(this)),this.videojs.ready((()=>{this._onReady(),e&&e(this)}))}_initPlugins(){this._initIma(),this._initAutoplay(),this._initContextMenu(),this._initPerSrcBehaviors(),this._initCloudinary(),this._initAnalytics(),this._initCloudinaryAnalytics(),this._initFloatingPlayer(),this._initVisualSearch(),this._initShare(),this._initColors(),this._initTextTracks(),this._initHighlightsGraph(),this._initSeekThumbs(),this._initChapters(),this._initInteractionAreas(),this._initSourceSwitcher()}_isFullScreen(){return this.videojs.player().isFullscreen()}_initIma(){this.playerOptions.ads&&0!==Object.keys(this.playerOptions.ads).length&&it.imaPlugin(this.videojs,this.playerOptions)}setTextTracks(e){if(this.textTracksManager.removeAllTextTracks(),e){const t=Object.keys(e),s=[];for(const i of t)if("options"!==i){const t=Array.isArray(e[i])?e[i]:[e[i]];for(const e of t)s.push({...e,kind:i,label:e.label,srclang:e.language,default:!!e.default,src:e.url})}this.textTracksManager.addTextTracks(s),e.options&&this.videojs.styledTextTracks&&this.videojs.styledTextTracks(e.options)}}_initSeekThumbs(){this.playerOptions.seekThumbnails&&this.videojs.on(Q.f.CLD_SOURCE_CHANGED,((e,t)=>{let{source:s}=t;if(!s||s.getType()===Q.x.AUDIO||"live"===s.resourceConfig().type||(0,P.iT)(s.publicId())||this.videojs.activePlugins_&&this.videojs.activePlugins_.vr)return;const i=s.publicId(),r=Object.assign({},s.transformation());r&&(delete r.streaming_profile,delete r.video_codec),r.flags=r.flags||[],r.flags.push("sprite");const n=s.config().url(`${i}.vtt`,{transformation:r}).replace(/\.json$/,"");v()(this.videojs.vttThumbnails)?this.videojs.vttThumbnails({src:n}):this.videojs.vttThumbnails.src(n)}))}_initHighlightsGraph(){this.playerOptions.aiHighlightsGraph&&this.videojs.on(Q.f.CLD_SOURCE_CHANGED,((e,t)=>{let{source:s}=t;if(!s||s.getType()===Q.x.AUDIO||(0,P.iT)(s.publicId()))return;const i=s.publicId(),n=r()(s.transformation(),["start_offset","end_offset","duration"]),a=Object.assign({},n);a.effect="preview",a.flags=a.flags||[],a.flags.push("getinfo");const o=s.config().url(`${i}`,{transformation:a}).replace(/\.json$/,"");v()(this.videojs.aiHighlightsGraph)?this.videojs.aiHighlightsGraph({src:o}):this.videojs.aiHighlightsGraph.src(o)}))}_initChapters(){!this.playerOptions.chaptersButton&&this.videojs.controlBar&&this.videojs.controlBar.removeChild("chaptersButton"),this.videojs.on(Q.f.CLD_SOURCE_CHANGED,((e,t)=>{let{source:s}=t;f()(s?._chapters)&&!0!==s?._chapters||!this.videojs.chapters?this.videojs.chapters?.resetPlugin&&this.videojs.chapters.resetPlugin():v()(this.videojs.chapters)?this.videojs.chapters(s._chapters):this.videojs.chapters.src(s._chapters)}))}_initInteractionAreas(){this.videojs.on(Q.f.READY,(async()=>{this.options.videojsOptions.interactionDisplay&&this.videojs.interactionAreas&&this.videojs.interactionAreas(this,this.playerOptions,this._videojsOptions)}))}_initVisualSearch(){this.videojs.on(Q.f.CLD_SOURCE_CHANGED,((e,t)=>{let{source:s}=t;s?._visualSearch&&this.videojs.visualSearch?v()(this.videojs.visualSearch)?this.videojs.visualSearch(s._visualSearch):this.videojs.visualSearch.createSearchUI(s._visualSearch):!s?._visualSearch&&this.videojs.visualSearch?.clearUI&&this.videojs.visualSearch.clearUI()}))}_initShare(){this.videojs.on(Q.f.CLD_SOURCE_CHANGED,((e,t)=>{let{source:s}=t;this.videojs.share&&(s?._download&&v()(this.videojs.share)&&this.videojs.share({download:!0}),v()(this.videojs.share)||(s?._download?this.videojs.share.addDownloadButton?.():this.videojs.share.removeDownloadButton?.()))}))}_initColors(){this.playerOptions.colors&&this.videojs.colors({colors:this.playerOptions.colors})}_initTextTracks(){this.textTracksManager=this.videojs.textTracksManager(),this.videojs.on(Q.f.CLD_SOURCE_CHANGED,((e,t)=>{let{source:s}=t;s?._textTracks&&this.setTextTracks(s._textTracks)}))}_initPerSrcBehaviors(){this.videojs.perSourceBehaviors&&this.videojs.perSourceBehaviors()}_initJumpButtons(){!this.playerOptions.showJumpControls&&this.videojs.controlBar&&(this.videojs.controlBar.removeChild("JumpForwardButton"),this.videojs.controlBar.removeChild("JumpBackButton"))}_initPictureInPicture(){!this.playerOptions.pictureInPictureToggle&&this.videojs.controlBar&&this.videojs.controlBar.removeChild("pictureInPictureToggle")}_initCloudinary(){const e=this.playerOptions.cloudinary;e.chainTarget=this,!1!==e.secure&&(0,P.lP)(e,{secure:!0});const t={cloudinaryConfig:e,...this.playerOptions.sourceOptions};this.videojs.cloudinary(t)}_initAnalytics(){const e=this.playerOptions.analytics;if(window.gtag||!e){if(e){const t="object"==typeof e?e:{};this.videojs.analytics(t)}}else console.error("Google Analytics script (gtag) is missing.")}_initCloudinaryAnalytics(){if(this.playerOptions.cloudinaryAnalytics){this.videojs.videoElement=this.videoElement;const e=b()(this.playerOptions.cloudinaryAnalytics)?this.playerOptions.cloudinaryAnalytics:{};this.videojs.cloudinaryAnalytics(e)}}_initSourceSwitcher(){if(this.sourceSwitcher=this.videojs.sourceSwitcher(),this.videojs.on(Q.f.CLD_SOURCE_CHANGED,((e,t)=>{let{source:s}=t;const i=s.videoSources?.(),r=!!Array.isArray(i)&&!!i.length;if(this.videojs.controlBar){const e=r?"show":"hide",t=this.videojs.controlBar.getChild("sourceSwitcherButton");t&&"function"==typeof t?.[e]&&t[e]()}if(r){const e=i.findIndex((e=>{let{publicId:t}=e;return t===s.publicId()}));this.sourceSwitcher.reInit({sources:i,selectedIndex:-1===e?0:e,onSourceChange:e=>{let{publicId:t,...s}=e;return this.source(t,{...s,videoSources:i})}})}})),Array.isArray(this.playerOptions.sourceOptions?.videoSources)&&this.playerOptions.sourceOptions?.videoSources.length){const{publicId:e,label:t,...s}=this.playerOptions.sourceOptions.videoSources[0];this.source(e,{...s,videoSources:this.playerOptions.sourceOptions.videoSources})}}reTryVideoStateUntilAvailable(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;if("number"!=typeof this.reTryVideoStateRetriesCount&&(this.reTryVideoStateRetriesCount=0),this.videojs.readyState()>=(/iPad|iPhone|iPod/.test(navigator.userAgent)?1:4))this.reTryVideoStateRetriesCount=0;else if(this.reTryVideoStateRetriesCount<e)this.reTryVideoStateRetriesCount++,this.reTryVideoStateTimeoutId=this.videojs.setTimeout((()=>this.reTryVideoStateUntilAvailable(e,t)),t);else{let e=new Error("Video is not ready please try later");this.videojs.trigger("error",e)}}_resetReloadVideo=()=>{this.reloadVideoRetriesCount=0,this.videojs.clearTimeout(this.reloadVideoTimeoutId)};reloadVideoUntilAvailable(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;"number"!=typeof this.reloadVideoRetriesCount&&(this.reloadVideoRetriesCount=0),this.reloadVideoRetriesCount<e?(this.reloadVideoRetriesCount++,this.reloadVideoTimeoutId=this.videojs.setTimeout((()=>{const s=this.currentSourceUrl();(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";return new Promise(((s,i)=>{const r=document.createElement("video");r.setAttribute("crossorigin","anonymous");const n="live"===t?"onprogress":"canplay";r[n]=()=>{r.onerror=null,r[n]=null,s()},r.onerror=()=>i(),r.src=e,r.load()}))})(s,this.isLiveStream?"live":"default").then((()=>this.source(s))).catch((()=>this.reloadVideoUntilAvailable(e,t)))}),t)):this.videojs.trigger("error",new Error("Sorry, we could not load your video"))}_initAutoplay(){"on-scroll"===this.playerOptions.autoplayMode&&this.videojs.autoplayOnScroll()}_initContextMenu(){this.playerOptions.hideContextMenu||this.videojs.contextMenu(nt.A.contextMenu)}_initFloatingPlayer(){this.playerOptions.floatingWhenNotVisible!==Ve.rT.NONE&&this.videojs.floatingPlayer({floatTo:this.playerOptions.floatingWhenNotVisible})}_setCssClasses(){this.videojs.addClass(rt.A.CLASS_PREFIX),this.videojs.addClass(rt.A.playerClassPrefix(this.videojs)),rt.A.setSkinClassPrefix(this.videojs,rt.A.skinClassPrefix(this.videojs))}_onReady(){this._setExtendedEvents();const e=this.playerOptions.sourceOptions.source||this.playerOptions.sourceOptions.publicId;if(e){const t=Object.assign({},this.playerOptions.sourceOptions);this.source(e,t)}}_onSourceChange(e,t){let{source:s,sourceOptions:i}=t;this._sendInternalAnalytics({...i&&{sourceOptions:i}}),this.isLiveStream="live"===s?.resourceConfig()?.type}_setExtendedEvents(){const e=[];this.playerOptions.playedEventPercents&&e.push({type:Q.f.PERCENTS_PLAYED,percents:this.playerOptions.playedEventPercents}),this.playerOptions.playedEventTimes&&e.push({type:Q.f.TIME_PLAYED,times:this.playerOptions.playedEventTimes}),e.push(Q.f.SEEK,Q.f.MUTE,Q.f.UNMUTE,Q.f.QUALITY_CHANGED);const t=new re(this.videojs,{events:e});Object.keys(t.events).forEach((e=>{t.on(e,((t,s)=>{this.videojs.trigger({type:e,eventData:s})}))}))}cloudinaryConfig(e){return this.videojs.cloudinary.cloudinaryConfig(e)}currentPublicId(){return this.videojs.cloudinary.currentPublicId()}currentSourceUrl(){return this.videojs.currentSource().src}currentPoster(){return this.videojs.cloudinary.currentPoster()}source(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(({publicId:e,options:t}=(0,P.a5)(e,t)),!this._isPlayerConfigValid)return;if(this.playerOptions.debug&&(t.debug=!0,(0,lt.Is)(t).then((e=>{e||this.videojs.error("invalid source configuration")}))),e instanceof pe.A)return this.videojs.cloudinary.source(e,t);t={...this.playerOptions.sourceOptions||{},...t},t.shoppable&&this.videojs.shoppable&&this.videojs.shoppable(this.videojs,t),this._resetReloadVideo(),this._resetReTryVideoState();const s=this.videojs.options_.maxTries||3,i=this.videojs.options_.videoTimeout||55e3;return this.reTryVideoStateUntilAvailable(s,i),this.videojs.cloudinary.source(e,t)}posterOptions(e){return this.videojs.cloudinary.posterOptions(e)}skin(e){return void 0!==e&&A()(e)&&rt.A.setSkinClassPrefix(this.videojs,e),rt.A.skinClassPrefix(this.videojs)}playlist(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.playerOptions.playlistWidget={...this.playerOptions.playlistWidget||{show:!1},playlist:!0},t=Object.assign({},t,{playlistWidget:this.playerOptions.playlistWidget}),this.videojs.one(Q.f.READY,(async()=>{(await this.videojs.playlist(t))(e,t)})),this.videojs.cloudinary.playlist?this.videojs.cloudinary.playlist(e,t):this}playlistByTag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.playerOptions.playlistWidget={...this.playerOptions.playlistWidget||{show:!1},playlistByTag:!0},t=Object.assign({},t,{playlistWidget:this.playerOptions.playlistWidget}),new Promise((s=>{this.videojs.one(Q.f.READY,(async()=>{(await this.videojs.playlist(t))(await this.sourcesByTag(e,t),t),s(this)}))}))}sourcesByTag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.videojs.cloudinary.sourcesByTag(e,t)}fluid(e){return void 0===e?this.videojs.fluid():(e?this.videojs.addClass(Ve.gi):this.videojs.removeClass(Ve.gi),this.videojs.fluid(e),this.videojs.trigger(Q.f.FLUID,e),this)}play(){return this.playWasCalled=!0,this.videojs.play(),this}stop(){return this.pause(),this.currentTime(0),this}playPrevious(){return this.playlist().playPrevious(),this}playNext(){return this.playlist().playNext(),this}transformation(e){return this.videojs.cloudinary.transformation(e)}sourceTypes(e){return this.videojs.cloudinary.sourceTypes(e)}sourceTransformation(e){return this.videojs.cloudinary.sourceTransformation(e)}autoShowRecommendations(e){return this.videojs.cloudinary.autoShowRecommendations(e)}duration(){return this.videojs.duration()}height(e){return e?(this.videojs.height(e),this):this.videojs.height()}width(e){return e?(this.videojs.width(e),this):this.videojs.width()}volume(e){return e?(this.videojs.volume(e),this):this.videojs.volume()}mute(){return this.isMuted()||this.videojs.muted(!0),this}unmute(){return this.isMuted()&&this.videojs.muted(!1),this}isMuted(){return this.videojs.muted()}pause(){return this.videojs.pause(),this}currentTime(e){return e||0===e?(this.videojs.currentTime(e),this):this.videojs.currentTime()}maximize(){return this.isMaximized()||this.videojs.requestFullscreen(),this}exitMaximize(){return this.isMaximized()&&this.videojs.exitFullscreen(),this}isMaximized(){return this.videojs.isFullscreen()}dispose(){this.videojs.dispose()}controls(e){return void 0===e?this.videojs.controls():(this.videojs.controls(e),this)}ima(){return{playAd:this.videojs.ima.playAd}}loop(e){return void 0===e?this.videojs.loop():(this.videojs.loop(e),this)}el(){return this.videojs.el()}}const gt=ft;var mt=s(6606);const yt=e=>!!mt.defaultProfiles.find((t=>{let{name:s}=t;return e===s})),vt=async(e,t,s)=>{const{profile:i,...r}=t;try{const t=i?await(async(e,t)=>{if(yt(e))return(e=>{const t=mt.defaultProfiles.find((t=>{let{name:s}=t;return e===s}));if(!t)throw new Error(`Default profile with name ${e} does not exist`);return t.config})(e);const s=(0,P.k$)(t.cloudinaryConfig),i=(0,P.iT)(e)?e:`${s}/_applet_/video_service/video_player_profiles/${e.replaceAll(" ","+")}.json`;return fetch(i,{method:"GET"}).then((e=>e.json()))})(i,r):{},n=Object.assign({},t.playerOptions,t.sourceOptions,r,{_internalAnalyticsMetadata:{newPlayerMethod:!0,profile:yt(i)?i:!!i}}),a=new gt(e,n,s),o=a.source;return a.source=(e,s)=>{const i=Object.assign({},t.sourceOptions,s);return o.call(a,e,i)},a}catch(t){throw new gt(e,r).videojs.error("Invalid profile"),t}};var _t=s(5072),bt=s.n(_t);const Tt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;const s=r()((e=>{let t={};for(const s of Object.keys(e))t[bt()(s)]=e[s];return t})(e),Ve._V);return Object.assign(e,{cloudinaryConfig:t||s})},At=e=>(t,s,i)=>new gt(t,Tt(s,e),i),Et=e=>(t,s,i)=>gt.all(t,Tt(s,e),i),St=At(),Ct=Et(),wt=(e,t,s)=>vt(e,Tt(t,undefined),s);const kt=(e,t,s)=>{const i=document.querySelectorAll(e),r=Tt(t,void 0);return[...i].map((e=>vt(e,r,s)))},Lt={...window.cloudinary||{},videoPlayer:St,videoPlayers:Ct,player:wt,players:kt,Cloudinary:{new:e=>(console.warn("Cloudinary.new() is deprecated and will be removed. Please use cloudinary.videoPlayer() instead."),{videoPlayer:At(e),videoPlayers:Et(e)})}};window.cloudinary=Lt;const It=Lt;s(833),s(9234);var Pt=s(9454),Rt=(s(2650),s(5826),s(1066));s(9148),s(2130),s(9987),s(7604);const xt=It},8592:(e,t,s)=>{s.d(t,{$n:()=>i,Lp:()=>n,mM:()=>r});const i={fastStart:{capLevelToPlayerSize:!0,ignoreDevicePixelRatio:!0,maxDevicePixelRatio:2,abrEwmaDefaultEstimate:4194304,abrEwmaDefaultEstimateMax:4194304,enableWorker:!1,startLevel:0},balanced:{capLevelToPlayerSize:!0,ignoreDevicePixelRatio:!0,maxDevicePixelRatio:2,abrEwmaDefaultEstimate:4194304,abrEwmaDefaultEstimateMax:4194304,enableWorker:!1},highQuality:{capLevelToPlayerSize:!0,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:2,abrEwmaDefaultEstimate:4194304,abrEwmaDefaultEstimateMax:4194304,enableWorker:!1}},r=Object.keys(i),n=window.matchMedia&&window.matchMedia("(dynamic-range: high)").matches},833:(e,t,s)=>{s.d(t,{default:()=>To});const i=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},r=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=n},n=Number.MAX_SAFE_INTEGER||9007199254740991;let a=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),o=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),l=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var h="manifest",c="level",d="audioTrack",u="subtitleTrack",p="main",f="audio",g="subtitle";class m{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class y{constructor(e,t,s,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new m(e),this.fast_=new m(t),this.defaultTTFB_=i,this.ttfb_=new m(e)}update(e,t){const{slow_:s,fast_:i,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new m(e,s.getEstimate(),s.getTotalWeight())),i.halfLife!==t&&(this.fast_=new m(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new m(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){const s=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function v(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)({}).hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},_.apply(null,arguments)}function b(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function T(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?b(Object(s),!0).forEach((function(t){v(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):b(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class A{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=E,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const E=function(){},S={trace:E,debug:E,log:E,warn:E,info:E,error:E};function C(){return _({},S)}function w(e,t,s){return t[e]?t[e].bind(t):function(e,t){const s=self.console[e];return s?s.bind(self.console,`${t?"["+t+"] ":""}[${e}] >`):E}(e,s)}const k=C(),L=k;function I(e=!0){if("undefined"!=typeof self)return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function P(e,t){const s=Object.keys(e),i=Object.keys(t),r=s.length,n=i.length;return!r||!n||r===n&&!s.some((e=>-1===i.indexOf(e)))}function R(e,t=!1){if("undefined"!=typeof TextDecoder){const s=new TextDecoder("utf-8").decode(e);if(t){const e=s.indexOf("\0");return-1!==e?s.substring(0,e):s}return s.replace(/\0/g,"")}const s=e.length;let i,r,n,a="",o=0;for(;o<s;){if(i=e[o++],0===i&&t)return a;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:r=e[o++],a+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=e[o++],n=e[o++],a+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&n)}}return a}const x=function(e){let t="";for(let s=0;s<e.length;s++){let i=e[s].toString(16);i.length<2&&(i="0"+i),t+=i}return t};function D(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var O,M={exports:{}},N=(O||(O=1,function(e,t){var s,i,r,n,a;s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(e,t,s){if(s=s||{},e=e.trim(),!(t=t.trim())){if(!s.alwaysNormalize)return e;var r=a.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=a.normalizePath(r.path),a.buildURLFromParts(r)}var n=a.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return s.alwaysNormalize?(n.path=a.normalizePath(n.path),a.buildURLFromParts(n)):t;var o=a.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var h={scheme:o.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(h.netLoc=o.netLoc,"/"!==n.path[0]))if(n.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+n.path;h.path=a.normalizePath(d)}else h.path=o.path,n.params||(h.params=o.params,n.query||(h.query=o.query));return null===h.path&&(h.path=s.alwaysNormalize?a.normalizePath(n.path):n.path),a.buildURLFromParts(h)},parseURL:function(e){var t=s.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(r,"");e.length!==(e=e.replace(n,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=a}(M)),M.exports);class F{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var B="audio",j="video",U="audiovideo";class ${constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof e&&(e={url:e}),this.base=e,function(e,t){const s=W(e,t);s&&(s.enumerable=!0,Object.defineProperty(e,t,s))}(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let i;i=1===s.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(s[1]),this._byteRange=[i,parseInt(s[0])+i]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[B]:null,[j]:null,[U]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new F),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=N.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[B]=null,e[j]=null,e[U]=null}}function H(e){return"initSegment"!==e.sn}class V extends ${constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(i(e)&&i(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=i(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){i(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return H(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,s,i,r,n=!1){const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,s),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,r)):a[e]={startPTS:t,endPTS:s,startDTS:i,endDTS:r,partial:n}}}class G extends ${constructor(e,t,s,i,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const n=e.enumeratedString("BYTERANGE");n&&this.setByteRange(n,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function W(e,t){const s=Object.getPrototypeOf(e);if(s){return Object.getOwnPropertyDescriptor(s,t)||W(s,t)}}const z=Math.pow(2,32)-1,K=[].push,q={video:1,audio:2,id3:3,text:4};function Y(e){return String.fromCharCode.apply(null,e)}function X(e,t){const s=e[t]<<8|e[t+1];return s<0?65536+s:s}function Q(e,t){const s=J(e,t);return s<0?4294967296+s:s}function Z(e,t){let s=Q(e,t);return s*=Math.pow(2,32),s+=Q(e,t+4),s}function J(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function ee(e,t,s){e[t]=s>>24,e[t+1]=s>>16&255,e[t+2]=s>>8&255,e[t+3]=255&s}function te(e,t){const s=[];if(!t.length)return s;const i=e.byteLength;for(let r=0;r<i;){const n=Q(e,r),a=n>1?r+n:i;if(Y(e.subarray(r+4,r+8))===t[0])if(1===t.length)s.push(e.subarray(r+8,a));else{const i=te(e.subarray(r+8,a),t.slice(1));i.length&&K.apply(s,i)}r=a}return s}function se(e){const t=[],s=e[0];let i=8;const r=Q(e,i);i+=4;let n=0,a=0;0===s?(n=Q(e,i),a=Q(e,i+4),i+=8):(n=Z(e,i),a=Z(e,i+8),i+=16),i+=2;let o=e.length+a;const l=X(e,i);i+=2;for(let s=0;s<l;s++){let s=i;const n=Q(e,s);s+=4;const a=2147483647&n;if(1==(2147483648&n)>>>31)return L.warn("SIDX has hierarchical references (not supported)"),null;const l=Q(e,s);s+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/r,start:o,end:o+a-1}}),o+=a,s+=4,i=s}return{earliestPresentationTime:n,timescale:r,version:s,referencesCount:l,references:t}}function ie(e){const t=[],s=te(e,["moov","trak"]);for(let e=0;e<s.length;e++){const i=s[e],r=te(i,["tkhd"])[0];if(r){let e=r[0];const s=Q(r,0===e?12:20),n=te(i,["mdia","mdhd"])[0];if(n){e=n[0];const r=Q(n,0===e?12:20),a=te(i,["mdia","hdlr"])[0];if(a){const e=Y(a.subarray(8,12)),n={soun:B,vide:j}[e],o=re(te(i,["mdia","minf","stbl","stsd"])[0]);n?(t[s]={timescale:r,type:n,stsd:o},t[n]=T({timescale:r,id:s},o)):t[s]={timescale:r,type:e,stsd:o}}}}}return te(e,["moov","mvex","trex"]).forEach((e=>{const s=Q(e,4),i=t[s];i&&(i.default={duration:Q(e,12),flags:Q(e,20)})})),t}function re(e){const t=e.subarray(8),s=t.subarray(86),i=Y(t.subarray(4,8));let r,n=i;const a="enca"===i||"encv"===i;if(a){const e=te(t,[i])[0];te(e.subarray("enca"===i?28:78),["sinf"]).forEach((e=>{const t=te(e,["schm"])[0];if(t){const s=Y(t.subarray(4,8));if("cbcs"===s||"cenc"===s){const t=te(e,["frma"])[0];t&&(n=Y(t))}}}))}const o=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const e=te(s,["avcC"])[0];e&&e.length>3&&(n+="."+oe(e[1])+oe(e[2])+oe(e[3]),r=ne("avc1"===o?"dva1":"dvav",s));break}case"mp4a":{const e=te(t,[i])[0],s=te(e.subarray(28),["esds"])[0];if(s&&s.length>7){let e=4;if(3!==s[e++])break;e=ae(s,e),e+=2;const t=s[e++];if(128&t&&(e+=2),64&t&&(e+=s[e++]),4!==s[e++])break;e=ae(s,e);const i=s[e++];if(64!==i)break;if(n+="."+oe(i),e+=12,5!==s[e++])break;e=ae(s,e);const r=s[e++];let a=(248&r)>>3;31===a&&(a+=1+((7&r)<<3)+((224&s[e])>>5)),n+="."+a}break}case"hvc1":case"hev1":{const e=te(s,["hvcC"])[0];if(e&&e.length>12){const t=e[1],s=["","A","B","C"][t>>6],i=31&t,r=Q(e,2),a=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);n+="."+s+i,n+="."+r.toString(16).toUpperCase(),n+="."+a+o;let h="";for(let e=l.length;e--;){const t=l[e];(t||h)&&(h="."+t.toString(16).toUpperCase()+h)}n+=h}r=ne("hev1"==o?"dvhe":"dvh1",s);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":n=ne(n,s)||n;break;case"vp09":{const e=te(s,["vpcC"])[0];if(e&&e.length>6){const t=e[4],s=e[5],i=e[6]>>4&15;n+="."+le(t)+"."+le(s)+"."+le(i)}break}case"av01":{const e=te(s,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,i=31&e[1],a=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,h=2===t&&o?l?12:10:o?10:8,c=(16&e[2])>>4,d=(8&e[2])>>3,u=(4&e[2])>>2,p=3&e[2],f=1,g=1,m=1,y=0;n+="."+t+"."+le(i)+a+"."+le(h)+"."+c+"."+d+u+p+"."+le(f)+"."+le(g)+"."+le(m)+"."+y,r=ne("dav1",s)}break}}return{codec:n,encrypted:a,supplemental:r}}function ne(e,t){const s=te(t,["dvvC"]),i=s.length?s[0]:te(t,["dvcC"])[0];if(i){const t=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return e+"."+le(t)+"."+le(s)}}function ae(e,t){const s=t+5;for(;128&e[t++]&&t<s;);return t}function oe(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function le(e){return(e<10?"0":"")+e}function he(e){const t=te(e,["schm"])[0];if(t){const s=Y(t.subarray(4,8));if("cbcs"===s||"cenc"===s)return te(e,["schi","tenc"])[0]}return null}function ce(e){const t=Q(e,0);let s=8;1&t&&(s+=4),4&t&&(s+=4);let i=0;const r=Q(e,4);for(let n=0;n<r;n++)256&t&&(i+=Q(e,s),s+=4),512&t&&(s+=4),1024&t&&(s+=4),2048&t&&(s+=4);return i}function de(e,t){const s=new Uint8Array(e.length+t.length);return s.set(e),s.set(t,e.length),s}function ue(e,t){const s=[],i=t.samples,r=t.timescale,n=t.id;let a=!1;return te(i,["moof"]).map((o=>{const l=o.byteOffset-8;te(o,["traf"]).map((o=>{const h=te(o,["tfdt"]).map((e=>{const t=e[0];let s=Q(e,4);return 1===t&&(s*=Math.pow(2,32),s+=Q(e,8)),s/r}))[0];return void 0!==h&&(e=h),te(o,["tfhd"]).map((h=>{const c=Q(h,4),d=16777215&Q(h,0);let u=0;const p=!!(16&d);let f=0;const g=!!(32&d);let m=8;c===n&&(!!(1&d)&&(m+=8),!!(2&d)&&(m+=4),!!(8&d)&&(u=Q(h,m),m+=4),p&&(f=Q(h,m),m+=4),g&&(m+=4),"video"===t.type&&(a=pe(t.codec)),te(o,["trun"]).map((n=>{const o=n[0],h=16777215&Q(n,0),c=!!(1&h);let d=0;const p=!!(4&h),g=!!(256&h);let m=0;const y=!!(512&h);let v=0;const _=!!(1024&h),b=!!(2048&h);let T=0;const A=Q(n,4);let E=8;c&&(d=Q(n,E),E+=4),p&&(E+=4);let S=d+l;for(let l=0;l<A;l++){if(g?(m=Q(n,E),E+=4):m=u,y?(v=Q(n,E),E+=4):v=f,_&&(E+=4),b&&(T=0===o?Q(n,E):J(n,E),E+=4),t.type===j){let t=0;for(;t<v;){const n=Q(i,S);S+=4,fe(a,i[S])&&ge(i.subarray(S,S+n),a?2:1,e+T/r,s),S+=n,t+=n+4}}e+=m/r}})))}))}))})),s}function pe(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function fe(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6==(31&t)}function ge(e,t,s,i){const r=me(e);let n=0;n+=t;let a=0,o=0,l=0;for(;n<r.length;){a=0;do{if(n>=r.length)break;l=r[n++],a+=l}while(255===l);o=0;do{if(n>=r.length)break;l=r[n++],o+=l}while(255===l);const e=r.length-n;let t=n;if(o<e)n+=o;else if(o>e){L.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===a){if(181===r[t++]){const e=X(r,t);if(t+=2,49===e){const e=Q(r,t);if(t+=4,1195456820===e){const e=r[t++];if(3===e){const n=r[t++],o=64&n,l=o?2+3*(31&n):0,h=new Uint8Array(l);if(o){h[0]=n;for(let e=1;e<l;e++)h[e]=r[t++]}i.push({type:e,payloadType:a,pts:s,bytes:h})}}}}}else if(5===a&&o>16){const e=[];for(let s=0;s<16;s++){const i=r[t++].toString(16);e.push(1==i.length?"0"+i:i),3!==s&&5!==s&&7!==s&&9!==s||e.push("-")}const n=o-16,l=new Uint8Array(n);for(let e=0;e<n;e++)l[e]=r[t++];i.push({payloadType:a,pts:s,uuid:e.join(""),userData:R(l),userDataBytes:l})}}}function me(e){const t=e.byteLength,s=[];let i=1;for(;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(s.push(i+2),i+=2):i++;if(0===s.length)return e;const r=t-s.length,n=new Uint8Array(r);let a=0;for(i=0;i<r;a++,i++)a===s[0]&&(a++,s.shift()),n[i]=e[a];return n}function ye(e){const t=e.getUint32(0),s=e.byteOffset,i=e.byteLength;if(i<t)return{offset:s,size:i};if(1886614376!==e.getUint32(4))return{offset:s,size:t};const r=e.getUint32(8)>>>24;if(0!==r&&1!==r)return{offset:s,size:t};const n=e.buffer,a=x(new Uint8Array(n,s+12,16)),o=e.getUint32(28);let l=null,h=null;if(0===r){if(t-32<o||o<22)return{offset:s,size:t};h=new Uint8Array(n,s+32,o)}else if(1===r){if(!o||i<s+32+16*o+16)return{offset:s,size:t};l=[];for(let e=0;e<o;e++)l.push(new Uint8Array(n,s+32+16*e,16))}return{version:r,systemId:a,kids:l,data:h,offset:s,size:t}}const ve=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),_e={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function be(e,t){const s=_e[t];return!!s&&!!s[e.slice(0,4)]}function Te(e,t,s=!0){return!e.split(",").some((e=>!Ae(e,t,s)))}function Ae(e,t,s=!0){var i;const r=I(s);return null!=(i=null==r?void 0:r.isTypeSupported(Ee(e,t)))&&i}function Ee(e,t){return`${t}/mp4;codecs=${e}`}function Se(e){if(e){const t=e.substring(0,4);return _e.video[t]}return 2}function Ce(e){const t=ve();return e.split(",").reduce(((e,s)=>{const i=t&&pe(s)?9:_e.video[s];return i?(2*i+e)/(e?3:2):(_e.audio[s]+e)/(e?2:1)}),0)}const we={},ke=/flac|opus|mp4a\.40\.34/i;function Le(e,t=!0){return e.replace(ke,(e=>function(e,t=!0){if(we[e])return we[e];const s={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let r=0;r<s.length;r++){var i;if(Ae(s[r],"audio",t))return we[e]=s[r],s[r];if("mp3"===s[r]&&null!=(i=I(t))&&i.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t)))}function Ie(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e)))return e;if(t){const s=t.split(",");if(s.length>1){if(e)for(let t=s.length;t--;)if(s[t].substring(0,4)===e.substring(0,4))return s[t];return s[0]}}return t||e}function Pe(e){if(e.startsWith("av01.")){const t=e.split("."),s=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=s[e-4];return t.join(".")}return e}function Re(e){const t=I(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function xe(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const De={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Oe(e,t){return{supported:!1,configurations:t,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:e}}const Me={};function Ne(e,t,s,r,n,a){const o=e.audioCodec?e.audioGroups:null,l=null==a?void 0:a.audioCodec,h=null==a?void 0:a.channels,c=h?parseInt(h):l?1/0:2;let d=null;if(null!=o&&o.length)try{d=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce(((e,s)=>{if(s){const i=t.groups[s];if(!i)throw new Error(`Audio track group ${s} not found`);Object.keys(i.channels).forEach((t=>{e[t]=(e[t]||0)+i.channels[t]}))}return e}),{2:0})}catch(e){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(r,30)||"SDR"!==e.videoRange&&e.videoRange!==s||e.bitrate>Math.max(n,8e6))||!!d&&i(c)&&Object.keys(d).some((e=>parseInt(e)>c))}function Fe(e,t,s){const r=e.videoCodec,n=e.audioCodec;if(!r&&!n||!s)return Promise.resolve(De);const a=[];if(r){const t={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),framerate:e.frameRate||30},s=e.videoRange;"SDR"!==s&&(t.transferFunction=s.toLowerCase());const i=r.split(","),n=navigator.userAgent;if(i.some((e=>pe(e)))&&ve())return Promise.resolve(Oe(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${n})`),a));a.push.apply(a,i.map((e=>({type:"media-source",video:T(T({},t),{},{contentType:Ee(Pe(e),"video")})}))))}return n&&e.audioGroups&&e.audioGroups.forEach((e=>{var s;e&&(null==(s=t.groups[e])||s.tracks.forEach((t=>{if(t.groupId===e){const e=t.channels||"",s=parseFloat(e);i(s)&&s>2&&a.push.apply(a,n.split(",").map((e=>({type:"media-source",audio:{contentType:Ee(e,"audio"),channels:""+s}}))))}})))})),Promise.all(a.map((e=>{const t=function(e){const{audio:t,video:s}=e,i=s||t;if(i){const e=xe(i.contentType);if(s)return`r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${e}_${Math.ceil(s.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${e}`}return""}(e);return Me[t]||(Me[t]=s.decodingInfo(e))}))).then((e=>({supported:!e.some((e=>!e.supported)),configurations:a,decodingInfoResults:e}))).catch((e=>({supported:!1,configurations:a,decodingInfoResults:[],error:e})))}const Be=["NONE","TYPE-0","TYPE-1",null],je=["SDR","PQ","HLG"];function Ue(e){const{canSkipUntil:t,canSkipDateRanges:s,age:i}=e;return t&&i<t/2?s?"v2":"YES":""}class $e{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class He{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>!!e)).map((e=>e.substring(0,4))).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=null==(t=e.supplemental)?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Ve(this._audioGroups,e)}hasSubtitleGroup(e){return Ve(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function Ve(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}const Ge=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(s,i)=>{if(e&&(i=e(s,i)),"object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}})(t));function We(e,t){L.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function ze(e){return e.reduce(((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const i=t.channels||"2";return s.channels[i]=(s.channels[i]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Ke(e){if(!e)return e;const{lang:t,assocLang:s,characteristics:i,channels:r,audioCodec:n}=e;return{lang:t,assocLang:s,characteristics:i,channels:r,audioCodec:n}}function qe(e,t,s){if("attrs"in e){const s=t.indexOf(e);if(-1!==s)return s}for(let i=0;i<t.length;i++)if(Ye(e,t[i],s))return i;return-1}function Ye(e,t,s){const{groupId:i,name:r,lang:n,assocLang:a,default:o}=e,l=e.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===n||function(e,t="--"){return e.length===t.length?e===t:e.startsWith(t)||t.startsWith(e)}(n,t.lang))&&(void 0===n||t.assocLang===a)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e,t=""){const s=e.split(","),i=t.split(",");return s.length===i.length&&!s.some((e=>-1===i.indexOf(e)))}(e.characteristics||"",t.characteristics))&&(void 0===s||s(e,t))}function Xe(e,t){const{audioCodec:s,channels:i}=e;return!(void 0!==s&&(t.audioCodec||"").substring(0,4)!==s.substring(0,4)||void 0!==i&&i!==(t.channels||"2"))}function Qe(e,t,s){for(let i=t;i>-1;i--)if(s(e[i]))return i;for(let i=t+1;i<e.length;i++)if(s(e[i]))return i;return-1}function Ze(e,t){var s;return!!e&&e!==(null==(s=t.loadLevelObj)?void 0:s.uri)}const Je=function(e,t){let s=0,i=e.length-1,r=null,n=null;for(;s<=i;){r=(s+i)/2|0,n=e[r];const a=t(n);if(a>0)s=r+1;else{if(!(a<0))return n;i=r-1}}return null};function et(e,t,s=0,i=0,r=.005){let n=null;if(e){n=t[1+e.sn-t[0].sn]||null;const i=e.endDTS-s;i>0&&i<15e-7&&(s+=15e-7),n&&e.level!==n.level&&n.end<=e.end&&(n=t[2+e.sn-t[0].sn]||null)}else 0===s&&0===t[0].start&&(n=t[0]);if(n&&((!e||e.level===n.level)&&0===tt(s,i,n)||function(e,t,s){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const i=t.tagList.reduce(((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e)),s);return e.start<=i}return!1}(n,e,Math.min(r,i))))return n;const a=Je(t,tt.bind(null,s,i));return!a||a===e&&n?n:a}function tt(e=0,t=0,s){if(s.start<=e&&s.start+s.duration>e)return 0;const i=Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return s.start+s.duration-i<=e?1:s.start-i>e&&s.start?-1:0}function st(e,t,s){const i=1e3*Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return(s.endProgramDateTime||0)-i>e}function it(e,t){return Je(e,(e=>e.cc<t?1:e.cc>t?-1:0))}function rt(e){switch(e.details){case o.FRAG_LOAD_TIMEOUT:case o.KEY_LOAD_TIMEOUT:case o.LEVEL_LOAD_TIMEOUT:case o.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function nt(e,t){const s=rt(t);return e.default[(s?"timeout":"error")+"Retry"]}function at(e,t){const s="linear"===e.backoff?1:Math.pow(2,t);return Math.min(s*e.retryDelayMs,e.maxRetryDelayMs)}function ot(e){return T(T({},e),{errorRetry:null,timeoutRetry:null})}function lt(e,t,s,i){if(!e)return!1;const r=null==i?void 0:i.code,n=t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(r)||!!s);return e.shouldRetry?e.shouldRetry(e,t,s,i,n):n}function ht(e){const t={action:0,flags:0};return e&&(t.resolved=!0),t}var ct="NOT_LOADED",dt="APPENDING",ut="PARTIAL",pt="OK";class ft{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.BUFFER_APPENDED,this.onBufferAppended,this),e.on(l.FRAG_BUFFERED,this.onFragBuffered,this),e.on(l.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.BUFFER_APPENDED,this.onBufferAppended,this),e.off(l.FRAG_BUFFERED,this.onFragBuffered,this),e.off(l.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let t=s.length;t--;){const i=s[t];if(!i)break;const r=i.end;if(i.start<=e&&null!==r&&e<=r)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:i}=this,r=Object.keys(i);for(let n=r.length;n--;){const a=i[r[n]];if((null==a?void 0:a.body.type)===t&&(!s||a.buffered)){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,s,i,r){this.timeRanges&&(this.timeRanges[e]=t);const n=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach((i=>{const a=this.fragments[i];if(!a)return;if(n>=a.body.sn)return;if(!a.buffered&&(!a.loaded||r))return void(a.body.type===s&&this.removeFragment(a.body));const o=a.range[e];o&&(0!==o.time.length?o.time.some((e=>{const s=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return s&&this.removeFragment(a.body),s})):this.removeFragment(a.body))}))}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const s=e.frag,i=mt(s),r=this.fragments[i];if(!r||r.buffered&&s.gap)return;const n=!s.relurl;Object.keys(t).forEach((i=>{const a=s.elementaryStreams[i];if(!a)return;const o=t[i],l=n||!0===a.partial;r.range[i]=this.getBufferedTimes(s,e.part,l,o)})),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=s.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),gt(r)||this.removeParts(s.sn-1,s.type)):this.removeFragment(r.body)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=yt(s,(t=>t.fragment.sn>=e)))}fragBuffered(e,t){const s=mt(e);let i=this.fragments[s];!i&&t&&(i=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,s,i){const r={time:[],partial:s},n=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||n;for(let e=0;e<i.length;e++){const t=i.start(e)-this.bufferPadding,s=i.end(e)+this.bufferPadding;if(l>=t&&o<=s){r.time.push({startPTS:Math.max(n,i.start(e)),endPTS:Math.min(a,i.end(e))});break}if(n<s&&a>t){const t=Math.max(n,i.start(e)),s=Math.min(a,i.end(e));s>t&&(r.partial=!0,r.time.push({startPTS:t,endPTS:s}))}else if(a<=t)break}return r}getPartialFragment(e){let t,s,i,r=null,n=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach((l=>{const h=o[l];h&&gt(h)&&(s=h.body.start-a,i=h.body.end+a,e>=s&&e<=i&&(t=Math.min(e-s,i-e),n<=t&&(r=h.body,n=t)))})),r}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||gt(t))}getState(e){const t=mt(e),s=this.fragments[t];return s?s.buffered?gt(s)?ut:pt:dt:ct}isTimeBuffered(e,t,s){let i,r;for(let n=0;n<s.length;n++){if(i=s.start(n)-this.bufferPadding,r=s.end(n)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const s=t.frag,i=t.part?null:t,r=mt(s);this.fragments[r]={body:s,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:i,timeRanges:r,type:n}=t;if("initSegment"===s.sn)return;const a=s.type;if(i){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(i)}this.timeRanges=r;const o=r[n];this.detectEvictedFragments(n,o,a,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=mt(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let i=s.length;i--;){const r=t[s[i]];if((null==r?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,s,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach((n=>{const a=this.fragments[n];if(!a)return;const o=a.body;o.type!==s||i&&!o.gap||o.start<t&&o.end>e&&(a.buffered||r)&&this.removeFragment(o)}))}removeFragment(e){const t=mt(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const t=e.sn;this.activePartLists[e.type]=yt(s,(e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const s=null==(e=this.hls)||null==(t=e.latestLevelDetails)?void 0:t.partList;s&&s.forEach((e=>e.clearElementaryStreamInfo()))}}function gt(e){var t,s,i;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(s=e.range.audio)?void 0:s.partial)||(null==(i=e.range.audiovideo)?void 0:i.partial))}function mt(e){return`${e.type}_${e.level}_${e.sn}`}function yt(e,t){return e.filter((e=>{const s=t(e);return s||e.clearElementaryStreamInfo(),s}))}class vt{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case 0:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case 1:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}class _t{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let e=0;e<4;e++)s[e]=t.getUint32(4*e);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,i=s[0],r=s[1],n=s[2],a=s[3],o=this.invSubMix,l=o[0],h=o[1],c=o[2],d=o[3],u=new Uint32Array(256);let p=0,f=0,g=0;for(g=0;g<256;g++)u[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let s=f^f<<1^f<<2^f<<3^f<<4;s=s>>>8^255&s^99,e[p]=s,t[s]=p;const o=u[p],g=u[o],m=u[g];let y=257*u[s]^16843008*s;i[p]=y<<24|y>>>8,r[p]=y<<16|y>>>16,n[p]=y<<8|y>>>24,a[p]=y,y=16843009*m^65537*g^257*o^16843008*p,l[s]=y<<24|y>>>8,h[s]=y<<16|y>>>16,c[s]=y<<8|y>>>24,d[s]=y,p?(p=o^u[u[u[m^o]]],f^=u[u[f]]):p=f=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,i=0;for(;i<t.length&&s;)s=t[i]===this.key[i],i++;if(s)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const n=this.ksRows=4*(r+6+1);let a,o;const l=this.keySchedule=new Uint32Array(n),h=this.invKeySchedule=new Uint32Array(n),c=this.sBox,d=this.rcon,u=this.invSubMix,p=u[0],f=u[1],g=u[2],m=u[3];let y,v;for(a=0;a<n;a++)a<r?y=l[a]=t[a]:(v=y,a%r==0?(v=v<<8|v>>>24,v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v],v^=d[a/r|0]<<24):r>6&&a%r==4&&(v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v]),l[a]=y=(l[a-r]^v)>>>0);for(o=0;o<n;o++)a=n-o,v=3&o?l[a]:l[a-4],h[o]=o<4||a<=4?v:p[c[v>>>24]]^f[c[v>>>16&255]]^g[c[v>>>8&255]]^m[c[255&v]],h[o]=h[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,s){const i=this.keySize+6,r=this.invKeySchedule,n=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],h=a[2],c=a[3],d=this.uint8ArrayToUint32Array_(s);let u=d[0],p=d[1],f=d[2],g=d[3];const m=new Int32Array(e),y=new Int32Array(m.length);let v,_,b,T,A,E,S,C,w,k,L,I,P,R;const x=this.networkToHostOrderSwap;for(;t<m.length;){for(w=x(m[t]),k=x(m[t+1]),L=x(m[t+2]),I=x(m[t+3]),A=w^r[0],E=I^r[1],S=L^r[2],C=k^r[3],P=4,R=1;R<i;R++)v=o[A>>>24]^l[E>>16&255]^h[S>>8&255]^c[255&C]^r[P],_=o[E>>>24]^l[S>>16&255]^h[C>>8&255]^c[255&A]^r[P+1],b=o[S>>>24]^l[C>>16&255]^h[A>>8&255]^c[255&E]^r[P+2],T=o[C>>>24]^l[A>>16&255]^h[E>>8&255]^c[255&S]^r[P+3],A=v,E=_,S=b,C=T,P+=4;v=n[A>>>24]<<24^n[E>>16&255]<<16^n[S>>8&255]<<8^n[255&C]^r[P],_=n[E>>>24]<<24^n[S>>16&255]<<16^n[C>>8&255]<<8^n[255&A]^r[P+1],b=n[S>>>24]<<24^n[C>>16&255]<<16^n[A>>8&255]<<8^n[255&E]^r[P+2],T=n[C>>>24]<<24^n[A>>16&255]<<16^n[E>>8&255]<<8^n[255&S]^r[P+3],y[t]=x(v^u),y[t+1]=x(T^p),y[t+2]=x(b^f),y[t+3]=x(_^g),u=w,p=k,f=L,g=I,t+=4}return y.buffer}}class bt{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=function(e){switch(e){case 0:return"AES-CBC";case 1:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${e}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class Tt{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,s=t&&new DataView(e.buffer).getUint8(t-1);return s?e.slice(0,t-s):e}(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,i){return this.useSoftware?new Promise(((r,n)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,s,i);const o=this.flush();o?r(o.buffer):n(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,s,i)}softwareDecrypt(e,t,s,i){const{currentIV:r,currentResult:n,remainderData:a}=this;if(0!==i||16!==t.byteLength)return L.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=de(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;r&&(s=r);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new _t),l.expandKey(t);const h=n;return this.currentResult=l.decrypt(o.buffer,0,s),this.currentIV=o.slice(-16).buffer,h||null}webCryptoDecrypt(e,t,s,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,i));this.key=t,this.fastAesKey=new bt(this.subtle,t,i)}return this.fastAesKey.expandKey().then((t=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new vt(this.subtle,new Uint8Array(s),i).decrypt(e.buffer,t)):Promise.reject(new Error("web crypto not initialized")))).catch((r=>(L.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,i))))}onWebCryptoError(e,t,s,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,i);const r=this.flush();if(r)return r.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%16;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(L.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const At=Math.pow(2,17);class Et{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new wt({type:a.NETWORK_ERROR,details:o.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(s?"part list":"url")),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,n=i.loader;return new Promise(((l,h)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some((e=>"GAP"===e[0])))return void h(Ct(e));e.gap=!1}const c=this.loader=r?new r(i):new n(i),d=St(e);e.loader=c;const u=ot(i.fragLoadPolicy.default),p={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:At};e.stats=c.stats;const f={onSuccess:(t,s,i,r)=>{this.resetLoader(e,c);let n=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(n.slice(0,16)),n=n.slice(16)),l({frag:e,part:null,payload:n,networkDetails:r})},onError:(t,i,r,n)=>{this.resetLoader(e,c),h(new wt({type:a.NETWORK_ERROR,details:o.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:T({url:s,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:r,stats:n}))},onAbort:(t,s,i)=>{this.resetLoader(e,c),h(new wt({type:a.NETWORK_ERROR,details:o.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:(t,s,i)=>{this.resetLoader(e,c),h(new wt({type:a.NETWORK_ERROR,details:o.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:i,stats:t}))}};t&&(f.onProgress=(s,i,r,n)=>t({frag:e,part:null,payload:r,networkDetails:n})),c.load(d,p,f)}))}loadPart(e,t,s){this.abort();const i=this.config,r=i.fLoader,n=i.loader;return new Promise(((l,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void h(Ct(e,t));const c=this.loader=r?new r(i):new n(i),d=St(e,t);e.loader=c;const u=ot(i.fragLoadPolicy.default),p={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:At};t.stats=c.stats,c.load(d,p,{onSuccess:(i,r,n,a)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const o={frag:e,part:t,payload:i.data,networkDetails:a};s(o),l(o)},onError:(s,i,r,n)=>{this.resetLoader(e,c),h(new wt({type:a.NETWORK_ERROR,details:o.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:T({url:d.url,data:void 0},s),error:new Error(`HTTP Error ${s.code} ${s.text}`),networkDetails:r,stats:n}))},onAbort:(s,i,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),h(new wt({type:a.NETWORK_ERROR,details:o.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:r,stats:s}))},onTimeout:(s,i,r)=>{this.resetLoader(e,c),h(new wt({type:a.NETWORK_ERROR,details:o.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:r,stats:s}))}})}))}updateStatsFromPart(e,t){const s=e.stats,i=t.stats,r=i.total;if(s.loaded+=i.loaded,r){const i=Math.round(e.duration/t.duration),n=Math.min(Math.round(s.loaded/r),i),a=(i-n)*Math.round(s.loaded/n);s.total=s.loaded+a}else s.total=Math.max(s.loaded,s.total);const n=s.loading,a=i.loading;n.start?n.first+=a.first-a.start:(n.start=a.start,n.first=a.first),n.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function St(e,t=null){const s=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},n=s.byteRangeStartOffset,a=s.byteRangeEndOffset;if(i(n)&&i(a)){var o;let t=n,s=a;if("initSegment"===e.sn&&("AES-128"===(l=null==(o=e.decryptdata)?void 0:o.method)||"AES-256"===l)){const e=a-n;e%16&&(s=a+(16-e%16)),0!==n&&(r.resetIV=!0,t=n-16)}r.rangeStart=t,r.rangeEnd=s}var l;return r}function Ct(e,t){const s=new Error(`GAP ${e.gap?"tag":"attribute"} found`),i={type:a.MEDIA_ERROR,details:o.FRAG_GAP,fatal:!1,frag:e,error:s,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new wt(i)}class wt extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class kt extends A{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Lt{constructor(e,t,s,i=0,r=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=s,this.size=i,this.part=r,this.partial=n}}const It={length:0,start:()=>0,end:()=>0};class Pt{static isBuffered(e,t){if(e){const s=Pt.getBuffered(e);for(let e=s.length;e--;)if(t>=s.start(e)&&t<=s.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=Pt.getBuffered(e);return Pt.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const i=Pt.bufferedRanges(e);if(i.length)return Pt.bufferedInfo(i,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort(((e,t)=>e.start-t.start||t.end-e.end));let i=-1,r=[];if(s)for(let n=0;n<e.length;n++){t>=e[n].start&&t<=e[n].end&&(i=n);const a=r.length;if(a){const t=r[a-1].end;e[n].start-t<s?e[n].end>t&&(r[a-1].end=e[n].end):r.push(e[n])}else r.push(e[n])}else r=e;let n,a=0,o=t,l=t;for(let e=0;e<r.length;e++){const h=r[e].start,c=r[e].end;if(-1===i&&t>=h&&t<=c&&(i=e),t+s>=h&&t<c)o=h,l=c,a=l-t;else if(t+s<h){n=h;break}}return{len:a,start:o||0,end:l||0,nextStart:n,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||It}catch(e){return L.log("failed to get media.buffered",e),It}}}const Rt=/\{\$([a-zA-Z0-9-_]+)\}/g;function xt(e){return Rt.test(e)}function Dt(e,t){if(null!==e.variableList||e.hasVariableRefs){const s=e.variableList;return t.replace(Rt,(t=>{const i=t.substring(2,t.length-1),r=null==s?void 0:s[i];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),t):r}))}return t}function Ot(e,t,s){let i,r,n=e.variableList;if(n||(e.variableList=n={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{const e=new self.URL(s).searchParams;if(!e.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${s}"`);r=e.get(i)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else i=t.NAME,r=t.VALUE;i in n?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=r||""}function Mt(e,t,s){const i=t.IMPORT;if(s&&i in s){let t=e.variableList;t||(e.variableList=t={}),t[i]=s[i]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const Nt=/^(\d+)x(\d+)$/,Ft=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Bt{constructor(e,t){"string"==typeof e&&(e=Bt.parseAttrList(e,t)),_(this,e)}get clientAttrs(){return Object.keys(this).filter((e=>"X-"===e.substring(0,2)))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const s=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)s[e]=parseInt(t.slice(2*e,2*e+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce(((e,t)=>(e[t.toLowerCase()]=!0,e)),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=Nt.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const i={};for(Ft.lastIndex=0;null!==(s=Ft.exec(e));){const r=s[1].trim();let n=s[2];const a=0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1;let o=!1;if(a)n=n.slice(1,-1);else switch(r){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(a||o))n=Dt(t,n);else if(!o&&!a)switch(r){case"CLOSED-CAPTIONS":if("NONE"===n)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":L.warn(`${e}: attribute ${r} is missing quotes`)}i[r]=n}return i}}function jt(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class Ut{constructor(e,t,s=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(r=null==t?void 0:t.tagOrder)?r:s,t){const s=t.attr;for(const t in s)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==s[t]){L.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=_(new Bt({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);i(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(L.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(i(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&i(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class $t{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&s>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}get hasProgramDateTime(){return!!this.fragments.length&&i(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Ht(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function Vt(e){switch(e){case"AES-128":case"AES-256":return 0;case"AES-256-CTR":return 1;default:throw new Error(`invalid full segment method ${e}`)}}function Gt(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function Wt(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}const zt="undefined"!=typeof self?self:void 0;var Kt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},qt="org.w3.clearkey",Yt="com.apple.streamingkeydelivery",Xt="com.microsoft.playready",Qt="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function Zt(e){switch(e){case Yt:return Kt.FAIRPLAY;case Xt:return Kt.PLAYREADY;case Qt:return Kt.WIDEVINE;case qt:return Kt.CLEARKEY}}function Jt(e){return"edef8ba979d64acea3c827dcd51d21ed"===e?Kt.WIDEVINE:"9a04f07998404286ab92e65be0885f95"===e?Kt.PLAYREADY:"1077efecc0b24d02ace33c1e52e2fb4b"===e||"e2719d58a985b3c9781ab030af78d30e"===e?Kt.CLEARKEY:void 0}function es(e){switch(e){case Kt.FAIRPLAY:return Yt;case Kt.PLAYREADY:return Xt;case Kt.WIDEVINE:return Qt;case Kt.CLEARKEY:return qt}}function ts(e){const{drmSystems:t,widevineLicenseUrl:s}=e,i=t?[Kt.FAIRPLAY,Kt.WIDEVINE,Kt.PLAYREADY,Kt.CLEARKEY].filter((e=>!!t[e])):[];return!i[Kt.WIDEVINE]&&s&&i.push(Kt.WIDEVINE),i}const ss=null!=zt&&null!=(is=zt.navigator)&&is.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var is;function rs(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),s=String.fromCharCode.apply(null,Array.from(t)),i=s.substring(s.indexOf("<"),s.length),r=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(r){const e=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(e){const t=Gt(e).subarray(0,16);return function(e){const t=function(e,t,s){const i=e[t];e[t]=e[s],e[s]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),t}}return null}let ns={};class as{static clearKeyUriToKeyIdMap(){ns={}}constructor(e,t,s,i=[1],r=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!Ht(e)}isSupported(){if(this.method){if(Ht(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Yt:case Qt:case Xt:case qt:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(Ht(this.method)&&this.uri&&!this.iv){"number"!=typeof e&&(L.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let s=12;s<16;s++)t[s]=e>>8*(15-s)&255;return t}(e);return new as(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=function(e){const t=e.split(":");let s=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){const t="base64"===i[0],r=i[1];t?(e.splice(-1,1),s=Gt(r)):s=function(e){const t=Wt(e).subarray(0,16),s=new Uint8Array(16);return s.set(t,16-t.length),s}(r)}}return s}(this.uri);if(t)switch(this.keyFormat){case Qt:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Xt:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(e,t,s){if(16!==e.byteLength)throw new RangeError("Invalid system id");let i,r,n;i=0,r=new Uint8Array,n=new Uint8Array;const a=new Uint8Array(4);return s&&s.byteLength>0&&new DataView(a.buffer).setUint32(0,s.byteLength,!1),function(e,...t){const s=t.length;let i=8,r=s;for(;r--;)i+=t[r].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=255&i,n.set(e,4),r=0,i=8;r<s;r++)n.set(t[r],i),i+=t[r].byteLength;return n}([112,115,115,104],new Uint8Array([0,0,0,0]),e,n,r,a,s||new Uint8Array)}(e,0,t),this.keyId=rs(t);break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=ns[this.uri];if(!e){const t=Object.keys(ns).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16),new DataView(e.buffer,12,4).setUint32(0,t),ns[this.uri]=e}this.keyId=e}return this}}const os=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,ls=/#EXT-X-MEDIA:(.*)/g,hs=/^#EXT(?:INF|-X-TARGETDURATION):/m,cs=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),ds=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class us{static findGroup(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.id===t)return i}}static resolve(e,t){return N.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return hs.test(e)}static parseMasterPlaylist(e,t){const s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:xt(e)},i=[];let r;for(os.lastIndex=0;null!=(r=os.exec(e));)if(r[1]){var n;const e=new Bt(r[1],s),a=Dt(s,r[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:us.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),ys(e.CODECS,o);const h=e["SUPPLEMENTAL-CODECS"];h&&(o.supplemental={},ys(h,o.supplemental)),null!=(n=o.unknownCodecs)&&n.length||i.push(o),s.levels.push(o)}else if(r[3]){const e=r[3],i=r[4];switch(e){case"SESSION-DATA":{const e=new Bt(i,s),t=e["DATA-ID"];t&&(null===s.sessionData&&(s.sessionData={}),s.sessionData[t]=e);break}case"SESSION-KEY":{const e=gs(i,t,s);e.encrypted&&e.isSupported()?(null===s.sessionKeys&&(s.sessionKeys=[]),s.sessionKeys.push(e)):L.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${i}"`);break}case"DEFINE":Ot(s,new Bt(i,s),t);break;case"CONTENT-STEERING":{const e=new Bt(i,s);s.contentSteering={uri:us.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":s.startTimeOffset=ms(i)}}const a=i.length>0&&i.length<s.levels.length;return s.levels=a?i:s.levels,0===s.levels.length&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,s){let i;const r={},n=s.levels,a={AUDIO:n.map((e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec}))),SUBTITLES:n.map((e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec}))),"CLOSED-CAPTIONS":[]};let o=0;for(ls.lastIndex=0;null!==(i=ls.exec(e));){const e=new Bt(i[1],s),n=e.TYPE;if(n){const s=a[n],i=r[n]||[];r[n]=i;const l=e.LANGUAGE,h=e["ASSOC-LANGUAGE"],c=e.CHANNELS,d=e.CHARACTERISTICS,u=e["INSTREAM-ID"],p={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:n,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?us.resolve(e.URI,t):""};if(h&&(p.assocLang=h),c&&(p.channels=c),d&&(p.characteristics=d),u&&(p.instreamId=u),null!=s&&s.length){const e=us.findGroup(s,p.groupId)||s[0];vs(p,e,"audioCodec"),vs(p,e,"textCodec")}i.push(p)}}return r}static parseLevelPlaylist(e,t,s,r,n,a){var o;const l={url:t},h=new $t(t),c=h.fragments,d=[];let u,p,f,g,m=null,y=0,v=0,b=0,T=0,A=0,E=null,S=new V(r,l),C=-1,w=!1,k=null;if(cs.lastIndex=0,h.m3u8=e,h.hasVariableRefs=xt(e),"#EXTM3U"!==(null==(o=cs.exec(e))?void 0:o[0]))return h.playlistParsingError=new Error("Missing format identifier #EXTM3U"),h;for(;null!==(u=cs.exec(e));){w&&(w=!1,S=new V(r,l),S.playlistOffset=b,S.start=b,S.sn=y,S.cc=T,A&&(S.bitrate=A),S.level=s,m&&(S.initSegment=m,m.rawProgramDateTime&&(S.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),k&&(S.setByteRange(k),k=null)));const e=u[1];if(e){S.duration=parseFloat(e);const t=(" "+u[2]).slice(1);S.title=t||null,S.tagList.push(t?["INF",e,t]:["INF",e])}else if(u[3]){if(i(S.duration)){S.playlistOffset=b,S.start=b,f&&Ts(S,f,h),S.sn=y,S.level=s,S.cc=T,c.push(S);const e=(" "+u[3]).slice(1);S.relurl=Dt(h,e),_s(S,E,d),E=S,b+=S.duration,y++,v=0,w=!0}}else{if(u=u[0].match(ds),!u){L.warn("No matches on slow regex match for level playlist!");continue}for(p=1;p<u.length&&void 0===u[p];p++);const e=(" "+u[p]).slice(1),n=(" "+u[p+1]).slice(1),o=u[p+2]?(" "+u[p+2]).slice(1):null;switch(e){case"BYTERANGE":E?S.setByteRange(n,E):S.setByteRange(n);break;case"PROGRAM-DATE-TIME":S.rawProgramDateTime=n,S.tagList.push(["PROGRAM-DATE-TIME",n]),-1===C&&(C=c.length);break;case"PLAYLIST-TYPE":h.type&&As(h,e,u),h.type=n.toUpperCase();break;case"MEDIA-SEQUENCE":0!==h.startSN?As(h,e,u):c.length>0&&Es(h,e,u),y=h.startSN=parseInt(n);break;case"SKIP":{h.skippedSegments&&As(h,e,u);const t=new Bt(n,h),s=t.decimalInteger("SKIPPED-SEGMENTS");if(i(s)){h.skippedSegments+=s;for(let e=s;e--;)c.push(null);y+=s}const r=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(h.recentlyRemovedDateranges=(h.recentlyRemovedDateranges||[]).concat(r.split("\t")));break}case"TARGETDURATION":0!==h.targetduration&&As(h,e,u),h.targetduration=Math.max(parseInt(n),1);break;case"VERSION":null!==h.version&&As(h,e,u),h.version=parseInt(n);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":h.live||As(h,e,u),h.live=!1;break;case"#":(n||o)&&S.tagList.push(o?[n,o]:[n]);break;case"DISCONTINUITY":T++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([e]);break;case"BITRATE":S.tagList.push([e,n]),A=1e3*parseInt(n),i(A)?S.bitrate=A:A=0;break;case"DATERANGE":{const e=new Bt(n,h),t=new Ut(e,h.dateRanges[e.ID],h.dateRangeTagCount);h.dateRangeTagCount++,t.isValid||h.skippedSegments?h.dateRanges[t.id]=t:L.warn(`Ignoring invalid DATERANGE tag: "${n}"`),S.tagList.push(["EXT-X-DATERANGE",n]);break}case"DEFINE":{const e=new Bt(n,h);"IMPORT"in e?Mt(h,e,a):Ot(h,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==h.startCC?As(h,e,u):c.length>0&&Es(h,e,u),h.startCC=T=parseInt(n);break;case"KEY":{const e=gs(n,t,h);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={}),f[e.keyFormat]&&(f=_({},f)),f[e.keyFormat]=e}else L.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${n}"`);break}case"START":h.startTimeOffset=ms(n);break;case"MAP":{const e=new Bt(n,h);if(S.duration){const t=new V(r,l);bs(t,e,s,f),m=t,S.initSegment=m,m.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=m.rawProgramDateTime)}else{const t=S.byteRangeEndOffset;if(t){const e=S.byteRangeStartOffset;k=`${t-e}@${e}`}else k=null;bs(S,e,s,f),m=S,w=!0}m.cc=T;break}case"SERVER-CONTROL":g&&As(h,e,u),g=new Bt(n),h.canBlockReload=g.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=g.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&g.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=g.optionalFloat("PART-HOLD-BACK",0),h.holdBack=g.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{h.partTarget&&As(h,e,u);const t=new Bt(n);h.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=h.partList;e||(e=h.partList=[]);const t=v>0?e[e.length-1]:void 0,s=v++,i=new Bt(n,h),r=new G(i,S,l,s,t);e.push(r),S.duration+=r.duration;break}case"PRELOAD-HINT":{const e=new Bt(n,h);h.preloadHint=e;break}case"RENDITION-REPORT":{const e=new Bt(n,h);h.renditionReports=h.renditionReports||[],h.renditionReports.push(e);break}default:L.warn(`line parsed but not handled: ${u}`)}}}E&&!E.relurl?(c.pop(),b-=E.duration,h.partList&&(h.fragmentHint=E)):h.partList&&(_s(S,E,d),S.cc=T,h.fragmentHint=S,f&&Ts(S,f,h)),h.targetduration||(h.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const I=c.length,P=c[0],R=c[I-1];if(b+=h.skippedSegments*h.targetduration,b>0&&I&&R){h.averagetargetduration=b/I;const e=R.sn;h.endSN="initSegment"!==e?e:0,h.live||(R.endList=!0),P&&void 0===h.startCC&&(h.startCC=P.cc),C>0&&(function(e,t){let s=e[t];for(let i=t;i--;){const t=e[i];if(!t)return;t.programDateTime=s.programDateTime-1e3*t.duration,s=t}}(c,C),P&&d.unshift(P))}else h.endSN=0,h.startCC=0;return h.fragmentHint&&(b+=h.fragmentHint.duration),h.totalduration=b,d.length&&h.dateRangeTagCount&&P&&ps(d,h),h.endCC=T,h}}function ps(e,t){const s=e.length,i=e[s-1],r=t.live?1/0:t.totalduration,n=Object.keys(t.dateRanges);for(let a=n.length;a--;){const o=t.dateRanges[n[a]],l=o.startDate.getTime();o.tagAnchor=i.ref;for(let i=s;i--;){const s=fs(t,l,e,i,r);if(-1!==s){o.tagAnchor=t.fragments[s].ref;break}}}}function fs(e,t,s,i,r){const n=s[i];if(n){const o=n.programDateTime;var a;if(t>=o||0===i)if(t<=o+1e3*(((null==(a=s[i+1])?void 0:a.start)||r)-n.start)){const r=s[i].sn-e.startSN,n=e.fragments;if(n.length>s.length)for(let a=(s[i+1]||n[n.length-1]).sn-e.startSN;a>r;a--){const e=n[a].programDateTime;if(t>=e&&t<e+1e3*n[a].duration)return a}return r}}return-1}function gs(e,t,s){var i,r;const n=new Bt(e,s),a=null!=(i=n.METHOD)?i:"",o=n.URI,l=n.hexadecimalInteger("IV"),h=n.KEYFORMATVERSIONS,c=null!=(r=n.KEYFORMAT)?r:"identity";o&&n.IV&&!l&&L.error(`Invalid IV: ${n.IV}`);const d=o?us.resolve(o,t):"",u=(h||"1").split("/").map(Number).filter(Number.isFinite);return new as(a,d,c,u,l)}function ms(e){const t=new Bt(e).decimalFloatingPoint("TIME-OFFSET");return i(t)?t:null}function ys(e,t){let s=(e||"").split(/[ ,]+/).filter((e=>e));["video","audio","text"].forEach((e=>{const i=s.filter((t=>be(t,e)));i.length&&(t[`${e}Codec`]=i.map((e=>e.split("/")[0])).join(","),s=s.filter((e=>-1===i.indexOf(e))))})),t.unknownCodecs=s}function vs(e,t,s){const i=t[s];i&&(e[s]=i)}function _s(e,t,s){e.rawProgramDateTime?s.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function bs(e,t,s,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=s,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function Ts(e,t,s){e.levelkeys=t;const{encryptedFragments:i}=s;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||i.push(e)}function As(e,t,s){e.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${s[0]})`)}function Es(e,t,s){e.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${s[0]})`)}function Ss(e,t){const s=t.startPTS;if(i(s)){let i,r=0;t.sn>e.sn?(r=s-e.start,i=e):(r=e.start-s,i=t),i.duration!==r&&i.setDuration(r)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration):t.setStart(Math.max(e.start-t.duration,0))}function Cs(e,t,s,r,n,a){r-s<=0&&(L.warn("Fragment should have a positive duration",t),r=s+t.duration,a=n+t.duration);let o=s,l=r;const h=t.startPTS,c=t.endPTS;if(i(h)){const e=Math.abs(h-s);i(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,o=Math.max(s,h),s=Math.min(s,h),n=Math.min(n,t.startDTS),l=Math.min(r,c),r=Math.max(r,c),a=Math.max(a,t.endDTS)}const d=s-t.start;0!==t.start&&t.setStart(s),t.setDuration(r-t.start),t.startPTS=s,t.maxStartPTS=o,t.startDTS=n,t.endPTS=r,t.minEndPTS=l,t.endDTS=a;const u=t.sn;if(!e||u<e.startSN||u>e.endSN)return 0;let p;const f=u-e.startSN,g=e.fragments;for(g[f]=t,p=f;p>0;p--)Ss(g[p],g[p-1]);for(p=f;p<g.length-1;p++)Ss(g[p],g[p+1]);return e.fragmentHint&&Ss(g[g.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function ws(e,t,s,i,r){return new Error(`${e} ${r.url}\nPlaylist starting @${t.startSN}\n${t.m3u8}\n\nPlaylist starting @${s.startSN}\n${s.m3u8}`)}function ks(e,t,s=!0){const i=t.startSN+t.skippedSegments-e.startSN,r=e.fragments,n=i>=0;let a=0;if(n&&i<r.length)a=r[i].start;else if(n&&t.startSN===e.endSN+1)a=e.fragmentEnd;else if(n&&s)a=e.fragmentStart+i*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;a=e.fragmentStart}Ls(t,a)}function Ls(e,t){if(t){const s=e.fragments;for(let i=e.skippedSegments;i<s.length;i++)s[i].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function Is(e,t=1/0){let s=1e3*e.targetduration;if(e.updated){const i=e.fragments,r=4;if(i.length&&s*r>t){const e=1e3*i[i.length-1].duration;e<s&&(s=e)}}else s/=2;return Math.round(s)}function Ps(e,t,s){if(!e)return null;let i=e.fragments[t-e.startSN];return i||(i=e.fragmentHint,i&&i.sn===t?i:t<e.startSN&&s&&s.sn===t?s:null)}function Rs(e,t,s){return e?xs(e.partList,t,s):null}function xs(e,t,s){if(e)for(let i=e.length;i--;){const r=e[i];if(r.index===s&&r.fragment.sn===t)return r}return null}function Ds(e){e.forEach(((e,t)=>{var s;null==(s=e.details)||s.fragments.forEach((e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)}))}))}function Os(e,t){for(let i=0,r=e.length;i<r;i++){var s;if((null==(s=e[i])?void 0:s.cc)===t)return e[i]}return null}function Ms(e,t){if(e){const s=e.start+t;e.start=e.startPTS=s,e.endPTS=s+e.duration}}function Ns(e,t){const s=t.fragments;for(let t=0,i=s.length;t<i;t++)Ms(s[t],e);t.fragmentHint&&Ms(t.fragmentHint,e),t.alignedSliding=!0}function Fs(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const s=Math.min(t.endCC,e.endCC),i=Os(t.fragments,s),r=Os(e.fragments,s);i&&r&&(L.log(`Aligning playlist at start of dicontinuity sequence ${s}`),Ns(i.start-r.start,e))}function Bs(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const s=e.fragments,i=t.fragments;if(!s.length||!i.length)return;let r,n;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(r=Os(i,a),n=Os(s,a)),r&&n||(r=i[Math.floor(i.length/2)],n=Os(s,r.cc)||s[Math.floor(s.length/2)]);const o=r.programDateTime,l=n.programDateTime;o&&l&&Ns((l-o)/1e3-(n.start-r.start),e)}const js={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Us extends kt{constructor(e,t,s,r,n){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=js.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:s,mediaBuffer:r,state:n}=this,a=s?s.currentTime:0,o=Pt.bufferInfo(r||s,a,e.maxBufferHole);if(this.log(`media seeking to ${i(a)?a.toFixed(3):a}, state: ${n}`),this.state===js.ENDED)this.resetLoadingState();else if(t){const s=e.maxFragLookUpTolerance,i=t.start-s,r=t.start+t.duration+s;if(!o.len||r<o.start||i>o.end){const e=a>r;(a<i||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(s&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),a>this.lastCurrentTime&&(this.lastCurrentTime=a),!this.loadingParts)){const e=Math.max(o.end,a),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log(`LL-Part loading ON after seeking to ${a.toFixed(2)} with buffer @${e.toFixed(2)}`),this.loadingParts=t)}this.hls.hasEnoughToStart||o.len||(this.log(`setting startPosition to ${a} because of seek before start`),this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=n,this.hls=e,this.fragmentLoader=new Et(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Tt(e.config)}registerListeners(){const{hls:e}=this;e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(l.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===js.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=js.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,i=this.config.timelineOffset||0;if(s<=i)return!1;const r=e.nextStart;if(r&&r>i&&r<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const n=t.partList;if(null!=n&&n.length){const e=n[n.length-1];return Pt.isBuffered(this.media,e.start+e.duration/2)}const a=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(a)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),s.addEventListener("seeking",this.onMediaSeeking),s.addEventListener("ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===js.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(null!==i){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=js.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){this._doFragLoad(e,t,s,(e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn(`${t.type} sn: ${t.sn}${e.part?" part: "+e.part.index:""} of ${this.fragInfo(t,!1,e.part)}) was dropped during download.`),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)})).then((e=>{if(!e)return;const t=this.state,s=e.frag;this.fragContextChanged(s)?(t===js.FRAG_LOADING||!this.fragCurrent&&t===js.PARSING)&&(this.fragmentTracker.removeFragment(s),this.state=js.IDLE):("payload"in e&&(this.log(`Loaded ${s.type} sn: ${s.sn} of ${this.playlistLabel()} ${s.level}`),this.hls.trigger(l.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))})).catch((t=>{this.state!==js.STOPPED&&this.state!==js.ERROR&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))}))}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===dt){const t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,i?i.len:this.config.maxBufferLength),n=this.backtrackFragment;(1==(n?e.sn-n.sn:0)||this.reduceMaxBufferLength(r,e.duration))&&s.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===ut&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:s};this.hls.trigger(l.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then((e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e})).then((e=>{const{hls:t}=this,{frag:s,payload:i}=e,r=s.decryptdata;if(i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&Ht(r.method)){const n=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,Vt(r.method)).catch((e=>{throw t.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:s}),e})).then((i=>{const r=self.performance.now();return t.trigger(l.FRAG_DECRYPTED,{frag:s,payload:i,stats:{tstart:n,tdecrypt:r}}),e.payload=i,this.completeInitSegmentLoad(e)}))}return this.completeInitSegmentLoad(e)})).catch((t=>{this.state!==js.STOPPED&&this.state!==js.ERROR&&(this.warn(t),this.resetFragmentLoading(e))}))}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==js.STOPPED&&(this.state=js.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?function(e){let t="";const s=e.length;for(let i=0;i<s;i++)t+=`[${e.start(i).toFixed(3)}-${e.end(i).toFixed(3)}]`;return t}(Pt.getBuffered(s)):"(detached)"})`),H(e)){var i;if(e.type!==g){const t=e.elementaryStreams;if(!Object.keys(t).some((e=>!!t[e])))return void(this.state=js.IDLE)}const t=null==(i=this.levels)?void 0:i[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=js.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:i,partsLoaded:r}=e,n=!r||0===r.length||r.some((e=>!e)),a=new Lt(s.level,s.sn,s.stats.chunkCount+1,0,i?i.index:-1,!n);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,r){var n;this.fragCurrent=e;const a=null==t?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;!e.encrypted||null!=(n=e.decryptdata)&&n.key?!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=js.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(l.KEY_LOADED,e),this.state===js.KEY_LOADING&&(this.state=js.IDLE),e})),this.hls.trigger(l.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING"))));const h=this.fragPrevious;if(H(e)&&(!h||e.sn!==h.sn)){const s=this.shouldLoadParts(t.details,e.end);s!==this.loadingParts&&(this.log(`LL-Part loading ${s?"ON":"OFF"} loading sn ${null==h?void 0:h.sn}->${e.sn}`),this.loadingParts=s)}if(s=Math.max(e.start,s||0),this.loadingParts&&H(e)){const i=a.partList;if(i&&r){s>e.end&&a.fragmentHint&&(e=a.fragmentHint);const n=this.getNextPart(i,e,s);if(n>-1){const h=i[n];let c;return e=this.fragCurrent=h.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${h.index} (${n}/${i.length-1}) of ${this.fragInfo(e,!1,h)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state=js.FRAG_LOADING,c=o?o.then((s=>!s||this.fragContextChanged(s.frag)?null:this.doFragPartsLoad(e,h,t,r))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,h,t,r).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(l.FRAG_LOADING,{frag:e,part:h,targetBufferTime:s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(i,s))return Promise.resolve(null)}}if(H(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${a?"["+a.startSN+"-"+a.endSN+"]":""}, target: ${parseFloat(s.toFixed(3))}`),i(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=js.FRAG_LOADING;const c=this.config.progressive;let d;return d=c&&o?o.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,r))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,c?r:void 0),o]).then((([e])=>(!c&&e&&r&&r(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(l.FRAG_LOADING,{frag:e,targetBufferTime:s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,s,i){return new Promise(((r,n)=>{var a;const o=[],h=null==(a=s.details)?void 0:a.partList,c=t=>{this.fragmentLoader.loadPart(e,t,i).then((i=>{o[t.index]=i;const n=i.part;this.hls.trigger(l.FRAG_LOADED,i);const a=Rs(s.details,e.sn,t.index+1)||xs(h,e.sn,t.index+1);if(!a)return r({frag:e,part:n,partsLoaded:o});c(a)})).catch(n)};c(t)}))}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===o.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(l.ERROR,t)}else this.hls.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==js.PARSING)return void(this.fragCurrent||this.state===js.STOPPED||this.state===js.ERROR||(this.state=js.IDLE));const{frag:s,part:i,level:r}=t,n=self.performance.now();s.stats.parsing.end=n,i&&(i.stats.parsing.end=n);const a=this.getLevelDetails(),o=a&&s.sn>a.endSN||this.shouldLoadParts(a,s.end);o!==this.loadingParts&&(this.log(`LL-Part loading ${o?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=o),this.updateLevelTiming(s,i,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(null!=e&&e.partList){var s;const r=e.partList[0];var i;if(t>=r.end+((null==(s=e.fragmentHint)?void 0:s.duration)||0))if((this.hls.hasEnoughToStart?(null==(i=this.media)?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:i,sn:r,part:n}=e;if(null==t||!t[i])return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const a=t[i],o=a.details,l=n>-1?Rs(o,r,n):null,h=l?l.fragment:Ps(o,r,s);return h?(s&&s!==h&&(h.stats=s.stats),{frag:h,part:l,level:a}):null}bufferFragmentData(e,t,s,i,r){var n;if(!e||this.state!==js.PARSING)return;const{data1:a,data2:o}=e;let h=a;if(a&&o&&(h=de(a,o)),null==(n=h)||!n.length)return;const c={type:e.type,frag:t,part:s,chunkMeta:i,parent:t.type,data:h};if(this.hls.trigger(l.BUFFER_APPENDING,c),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Pt.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const s=t.currentTime,i=Pt.bufferInfo(t,s,0),r=e.duration,n=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),a=Math.max(Math.min(e.start-n,i.end-n),s+n);e.start-a>n&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var s;const r=this.getLoadPosition();if(!i(r))return null;const n=this.lastCurrentTime>r||null!=(s=this.media)&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,n)}getFwdBufferInfoAtPos(e,t,s,i){const r=Pt.bufferInfo(e,t,i);if(0===r.len&&void 0!==r.nextStart){const n=this.fragmentTracker.getBufferedFrag(t,s);if(n&&(r.nextStart<=n.end||n.gap)){const s=Math.max(Math.min(r.nextStart,n.end)-t,i);return Pt.bufferInfo(e,t,s)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return s=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,i=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-3*t,s.maxMaxBufferLength/2,i);return r>=i&&(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0)}getAppendedFrag(e,t=p){var s;const i=null==(s=this.fragmentTracker)?void 0:s.getAppendedFrag(e,t);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const s=t.fragments,i=s.length;if(!i)return null;const{config:r}=this,n=s[0].start,a=r.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const h=r.initialLiveManifestSize;if(i<h)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${h})`),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<n){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t,s);const i=this.hls.startPosition,r=this.hls.liveSyncPosition,h=o?(-1!==i&&i>=n?i:r)||o.start:e;this.log(`Setting startPosition to ${h} to match start frag at live edge. mainStart: ${i} liveSyncPosition: ${r} frag.start: ${null==(l=o)?void 0:l.start}`),this.startPosition=this.nextLoadPosition=h}}else e<=n&&(o=s[0]);if(!o){const s=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,s,t)}let h=this.filterReplacedPrimary(o,t);if(!h&&o){const e=o.sn-t.startSN;h=this.filterReplacedPrimary(s[e+1]||null,t)}return this.mapToInitFragWhenRequired(h)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===pt||s===ut&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,i,r){let n=null;if(e.gap&&(n=this.getNextFragment(this.nextLoadPosition,t),n&&!n.gap&&s.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,i,0);if(null!==e&&s.len+e.len>=r){const e=n.sn;return this.loopSn!==e&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e}`),this.loopSn=e),null}}return this.loopSn=void 0,n}get primaryPrefetch(){var e,t;if($s(this.hls.config)&&(null==(e=this.hls.interstitialsManager)||null==(t=e.playingItem)?void 0:t.event))return!0;return!1}filterReplacedPrimary(e,t){if(!e)return e;if($s(this.hls.config)&&e.type!==g){const s=this.hls.interstitialsManager,i=null==s?void 0:s.bufferingItem;if(i){const s=i.event;if(s){if(s.appendInPlace||Math.abs(e.start-i.start)>1||0===i.start)return null}else{if(e.end<=i.start&&!1===(null==t?void 0:t.live))return null;if(e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}}const r=null==s?void 0:s.playerQueue;if(r)for(let t=r.length;t--;){const s=r[t].interstitial;if(s.appendInPlace&&e.start>=s.startTime&&e.end<=s.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,s){let i=-1,r=!1,n=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(n=n&&!o.independent,i>-1&&s<o.start)break;const l=o.loaded;l?i=-1:(r||o.independent||n)&&o.fragment===t&&(i=a),r=l}return i}loadedEndOfParts(e,t){const s=e[e.length-1];return s&&t>s.start&&s.loaded}getInitialLiveFragment(e,t){const s=this.fragPrevious;let r=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),r=function(e,t,s){if(null===t||!Array.isArray(e)||!e.length||!i(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;s=s||0;for(let i=0;i<e.length;++i){const r=e[i];if(st(t,s,r))return r}return null}(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const i=s.sn+1;if(i>=e.startSN&&i<=e.endSN){const n=t[i-e.startSN];s.cc===n.cc&&(r=n,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=it(t,s.cc),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(r=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,s){const{config:i}=this;let{fragPrevious:r}=this,{fragments:n,endSN:a}=s;const{fragmentHint:o}=s,{maxFragLookUpTolerance:l}=i,h=s.partList,c=!!(this.loadingParts&&null!=h&&h.length&&o);let d;var u;(c&&o&&!this.bitrateTest&&h[h.length-1].fragment.sn===o.sn&&(n=n.concat(o),a=o.sn),e<t)?d=et(r,n,e,e<this.lastCurrentTime||e>t-l||null!=(u=this.media)&&u.paused||!this.startFragRequested?0:l):d=n[n.length-1];if(d){const e=d.sn-s.startSN,t=this.fragmentTracker.getState(d);if((t===pt||t===ut&&d.gap)&&(r=d),r&&d.sn===r.sn&&(!c||h[0].fragment.sn>d.sn||!s.live&&!c)&&r&&d.level===r.level){const t=n[e+1];d=d.sn<a&&this.fragmentTracker.getState(t)!==pt?t:null}}return d}alignPlaylists(e,t,s){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const n=e.fragmentStart,a=!t,o=e.alignedSliding&&i(n);if(a||!o&&!n){!function(e,t){e&&(Fs(t,e),!t.alignedSliding&&e&&Bs(t,e),t.alignedSliding||!e||t.skippedSegments||ks(e,t,!1))}(s,e);const i=e.fragmentStart;return this.log(`Live playlist sliding: ${i.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),i}return n}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const r=this.timelineOffset;if(-1===s){const n=null!==this.startTimeOffset,a=n?this.startTimeOffset:e.startTimeOffset;null!==a&&i(a)?(s=t+a,a<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${a} found in ${n?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+r}this.nextLoadPosition=s+r}getLoadPosition(){var e;const{media:t}=this;let s=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&H(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===js.FRAG_LOADING_WAITING_RETRY)||(this.state=js.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;var i;if(this.fragContextChanged(s))return void this.warn(`Frag load error must match current frag to retry ${s.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const r=t.details===o.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(s,!0);const n=t.errorAction,{action:a,flags:l,retryCount:h=0,retryConfig:c}=n||{},d=!!n&&!!c,u=d&&5===a,p=d&&!n.resolved&&1===l;if(!u&&p&&H(s)&&!s.endList)this.resetFragmentErrors(e),this.treatAsGap(s),n.resolved=!0;else if((u||p)&&h<c.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const i=at(c,h);this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${h+1}/${c.maxNumRetry} in ${i}ms`),n.resolved=!0,this.retryDate=self.performance.now()+i,this.state=js.FRAG_LOADING_WAITING_RETRY}else if(c&&n){if(this.resetFragmentErrors(e),!(h<c.maxNumRetry))return void this.warn(`${t.details} reached or exceeded max retry (${h})`);r||3===a||(n.resolved=!0)}else this.state=2===a?js.WAITING_LEVEL:js.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===js.PARSING||this.state===js.PARSED){const t=e.frag,s=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,s),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);const n=!r;return n&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),n}return!1}resetFragmentErrors(e){e===f&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==js.STOPPED&&(this.state=js.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const i=Pt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,s),this.state===js.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==js.STOPPED&&(this.state=js.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,i){const r=s.details;if(r){var n;if(!Object.keys(e.elementaryStreams).reduce(((t,n)=>{const a=e.elementaryStreams[n];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${n} duration reliably (${o})`),t||!1;const h=i?0:Cs(r,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS);return this.hls.trigger(l.LEVEL_PTS_UPDATED,{details:r,level:s,drift:h,type:n,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t}),!1)&&(0===s.fragmentError&&this.treatAsGap(e,s),null===(null==(n=this.transmuxer)?void 0:n.error))){const t=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(t.message),this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=js.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(l.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")}playlistLabel(){return this.playlistType===p?"level":"track"}fragInfo(e,t=!0,s){var i,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${(null!=(i=t&&!s?e.startPTS:(s||e).start)?i:NaN).toFixed(3)}-${(null!=(r=t&&!s?e.endPTS:(s||e).end)?r:NaN).toFixed(3)}]${s&&"main"===e.type?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function $s(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class Hs{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;return e.length?(s=1===e.length?e[0]:function(e,t){const s=new Uint8Array(t);let i=0;for(let t=0;t<e.length;t++){const r=e[t];s.set(r,i),i+=r.length}return s}(e,t),this.reset(),s):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var Vs,Gs={exports:{}},Ws=(Vs||(Vs=1,function(e){var t=Object.prototype.hasOwnProperty,s="~";function i(){}function r(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function n(e,t,i,n,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new r(i,n||e,a),l=s?s+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),o.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(s?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,n=i.length,a=new Array(n);r<n;r++)a[r]=i[r].fn;return a},o.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,r,n,a){var o=s?s+e:e;if(!this._events[o])return!1;var l,h,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,r),!0;case 5:return c.fn.call(c.context,t,i,r,n),!0;case 6:return c.fn.call(c.context,t,i,r,n,a),!0}for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c.fn.apply(c.context,l)}else{var u,p=c.length;for(h=0;h<p;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),d){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,i);break;case 4:c[h].fn.call(c[h].context,t,i,r);break;default:if(!l)for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c[h].fn.apply(c[h].context,l)}}return!0},o.prototype.on=function(e,t,s){return n(this,e,t,s,!1)},o.prototype.once=function(e,t,s){return n(this,e,t,s,!0)},o.prototype.removeListener=function(e,t,i,r){var n=s?s+e:e;if(!this._events[n])return this;if(!t)return a(this,n),this;var o=this._events[n];if(o.fn)o.fn!==t||r&&!o.once||i&&o.context!==i||a(this,n);else{for(var l=0,h=[],c=o.length;l<c;l++)(o[l].fn!==t||r&&!o[l].once||i&&o[l].context!==i)&&h.push(o[l]);h.length?this._events[n]=1===h.length?h[0]:h:a(this,n)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=s,o.EventEmitter=o,e.exports=o}(Gs)),Gs.exports),zs=D(Ws);const Ks="1.6.2",qs={};function Ys(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Xs(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function Qs(e,t){let s=0;return s=(127&e[t])<<21,s|=(127&e[t+1])<<14,s|=(127&e[t+2])<<7,s|=127&e[t+3],s}function Zs(e,t){const s=t;let i=0;for(;Xs(e,t);)i+=10,i+=Qs(e,t+6),Ys(e,t+10)&&(i+=10),t+=i;if(i>0)return e.subarray(s,s+i)}function Js(e,t){return 255===e[t]&&240==(246&e[t+1])}function ei(e,t){return 1&e[t+1]?7:9}function ti(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function si(e,t){return t+1<e.length&&Js(e,t)}function ii(e,t){if(si(e,t)){const s=ei(e,t);if(t+s>=e.length)return!1;const i=ti(e,t);if(i<=s)return!1;const r=t+i;return r===e.length||si(e,r)}return!1}function ri(e,t,s,i,r){if(!e.samplerate){const n=function(e,t,s,i){const r=t[s+2],n=r>>2&15;if(n>12){const t=new Error(`invalid ADTS sampling index:${n}`);return void e.emit(l.ERROR,l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const h=1+(r>>6&3),c=t[s+3]>>6&3|(1&r)<<2,d="mp4a.40."+h,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][n];let p=n;5!==h&&29!==h||(p-=3);const f=[h<<3|(14&p)>>1,(1&p)<<7|c<<3];return L.log(`manifest codec:${i}, parsed codec:${d}, channels:${c}, rate:${u} (ADTS object type:${h} sampling index:${n})`),{config:f,samplerate:u,channelCount:c,codec:d,parsedCodec:d,manifestCodec:i}}(t,s,i,r);if(!n)return;_(e,n)}}function ni(e){return 9216e4/e}function ai(e,t,s,i,r){const n=i+r*ni(e.samplerate),a=function(e,t){const s=ei(e,t);if(t+s<=e.length){const i=ti(e,t)-s;if(i>0)return{headerLength:s,frameLength:i}}}(t,s);let o;if(a){const{frameLength:i,headerLength:r}=a,l=r+i,h=Math.max(0,s+l-t.length);h?(o=new Uint8Array(l-r),o.set(t.subarray(s+r,t.length),0)):o=t.subarray(s+r,s+l);const c={unit:o,pts:n};return h||e.samples.push(c),{sample:c,length:l,missing:h}}const l=t.length-s;return o=new Uint8Array(l),o.set(t.subarray(s,t.length),0),{sample:{unit:o,pts:n},length:l,missing:-1}}function oi(e,t){return Xs(e,t)&&Qs(e,t+6)+10<=e.length-t}function li(e,t){if(e<0)return-li(-e,t);const s=Math.pow(10,t);if(Math.abs(e*s%1-.5)<Number.EPSILON){const t=Math.floor(e*s);return(t%2==0?t:t+1)/s}return Math.round(e*s)/s}function hi(e,t=0,s=1/0){return function(e,t,s,i){const r=(n=e)instanceof ArrayBuffer?n:n.buffer;var n;let a=1;"BYTES_PER_ELEMENT"in i&&(a=i.BYTES_PER_ELEMENT);const o=(d=e)&&d.buffer instanceof ArrayBuffer&&void 0!==d.byteLength&&void 0!==d.byteOffset?e.byteOffset:0,l=(o+e.byteLength)/a,h=(o+t)/a,c=Math.floor(Math.max(0,Math.min(h,l)));var d;return new i(r,c,Math.floor(Math.min(c+Math.max(s,0),l))-c)}(e,t,s,Uint8Array)}function ci(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=R(e.data,!0),s=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:s.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const s=R(e.data.subarray(t),!0);t+=s.length+1;const i=R(e.data.subarray(t));return{key:e.type,info:s,data:i}}const t=R(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?function(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");const s=e.data.subarray(1).indexOf(0);if(-1===s)return;const i=R(hi(e.data,1,s)),r=e.data[2+s],n=e.data.subarray(3+s).indexOf(0);if(-1===n)return;const a=R(hi(e.data,3+s,n));let o;return o="--\x3e"===i?R(hi(e.data,4+s+n)):(l=e.data.subarray(4+s+n))instanceof ArrayBuffer?l:0==l.byteOffset&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer,t.mimeType=i,t.pictureType=r,t.description=a,t.data=o,t;var l}(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const s=R(e.data.subarray(t),!0);t+=s.length+1;const i=R(e.data.subarray(t));return{key:e.type,info:s,data:i}}const t=R(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function di(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),s=Qs(e,4);return{type:t,size:s,data:e.subarray(10,10+s)}}const ui=10,pi=10;function fi(e){let t=0;const s=[];for(;Xs(e,t);){const i=Qs(e,t+6);e[t+5]>>6&1&&(t+=ui),t+=ui;const r=t+i;for(;t+pi<r;){const i=di(e.subarray(t)),r=ci(i);r&&s.push(r),t+=i.size+ui}Ys(e,t)&&(t+=ui)}return s}function gi(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function mi(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),s=1&t[3];let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,s&&(i+=47721858.84),Math.round(i)}}function yi(e){const t=fi(e);for(let e=0;e<t.length;e++){const s=t[e];if(gi(s))return mi(s)}}let vi=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function _i(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class bi{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=de(this.cachedData,e),this.cachedData=null);let s,r=Zs(e,0),n=r?r.length:0;const a=this._audioTrack,o=this._id3Track,l=r?yi(r):void 0,h=e.length;for((null===this.basePTS||0===this.frameIndex&&i(l))&&(this.basePTS=Ti(l,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:vi.audioId3,duration:Number.POSITIVE_INFINITY});n<h;){if(this.canParse(e,n)){const t=this.appendFrame(a,e,n);t?(this.frameIndex++,this.lastPTS=t.sample.pts,n+=t.length,s=n):n=h}else oi(e,n)?(r=Zs(e,n),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:vi.audioId3,duration:Number.POSITIVE_INFINITY}),n+=r.length,s=n):n++;if(n===h&&s!==h){const t=e.slice(s);this.cachedData?this.cachedData=de(this.cachedData,t):this.cachedData=t}}return{audioTrack:a,videoTrack:_i(),id3Track:o,textTrack:_i()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:_i(),id3Track:this._id3Track,textTrack:_i()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Ti=(e,t,s)=>i(e)?90*e:9e4*t+(s?9e4*s.baseTime/s.timescale:0);let Ai=null;const Ei=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Si=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Ci=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],wi=[0,1,1,4];function ki(e,t,s,i,r){if(s+24>t.length)return;const n=Li(t,s);if(n&&s+n.frameLength<=t.length){const a=i+r*(9e4*n.samplesPerFrame/n.sampleRate),o={unit:t.subarray(s,s+n.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=n.channelCount,e.samplerate=n.sampleRate,e.samples.push(o),{sample:o,length:n.frameLength,missing:0}}}function Li(e,t){const s=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,n=e[t+2]>>2&3;if(1!==s&&0!==r&&15!==r&&3!==n){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*Ei[14*(3===s?3-i:3===i?3:4)+r-1],h=Si[3*(3===s?0:2===s?1:2)+n],c=3===o?1:2,d=Ci[s][i],u=wi[i],p=8*d*u,f=Math.floor(d*l/h+a)*u;if(null===Ai){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ai=e?parseInt(e[1]):0}return!!Ai&&Ai<=87&&2===i&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:h,channelCount:c,frameLength:f,samplesPerFrame:p}}}function Ii(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function Pi(e,t){return t+1<e.length&&Ii(e,t)}function Ri(e,t){if(t+1<e.length&&Ii(e,t)){const s=4,i=Li(e,t);let r=s;null!=i&&i.frameLength&&(r=i.frameLength);const n=t+r;return n===e.length||Pi(e,n)}return!1}const xi=(e,t)=>{let s=0,i=5;t+=i;const r=new Uint32Array(1),n=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=e[t];const o=Math.min(i,8),l=8-o;n[0]=4278190080>>>24+l<<l,r[0]=(a[0]&n[0])>>l,s=s?s<<o|r[0]:r[0],t+=1,i-=o}return s};function Di(e,t,s,i,r){if(s+8>t.length)return-1;if(11!==t[s]||119!==t[s+1])return-1;const n=t[s+4]>>6;if(n>=3)return-1;const a=[48e3,44100,32e3][n],o=63&t[s+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+n];if(s+l>t.length)return-1;const h=t[s+6]>>5;let c=0;2===h?c+=2:(1&h&&1!==h&&(c+=2),4&h&&(c+=2));const d=(t[s+6]<<8|t[s+7])>>12-c&1,u=[2,1,2,3,3,4,4,5][h]+d,p=t[s+5]>>3,f=7&t[s+5],g=new Uint8Array([n<<6|p<<1|f>>2,(3&f)<<6|h<<3|d<<2|o>>4,o<<4&224]),m=i+r*(1536/a*9e4),y=t.subarray(s,s+l);return e.config=g,e.channelCount=u,e.samplerate=a,e.samples.push({unit:y,pts:m}),l}const Oi=/\/emsg[-/]ID3/i;function Mi(e,t){return i(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class Ni{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Tt(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,0)}decryptAacSample(e,t,s){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),n=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(n).then((r=>{const n=new Uint8Array(r);i.set(n,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}))}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length)return void s();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,s),this.decrypter.isSync())))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,s=new Int8Array(t);let i=0;for(let t=32;t<e.length-16;t+=160,i+=16)s.set(e.subarray(t,t+16),i);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let i=0;for(let t=32;t<e.length-16;t+=160,i+=16)e.set(s.subarray(i,i+16),t);return e}decryptAvcSample(e,t,s,i,r){const n=me(r.data),a=this.getAvcEncryptedData(n);this.decryptBuffer(a.buffer).then((a=>{r.data=this.getAvcDecryptedUnit(n,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,i)}))}decryptAvcSamples(e,t,s,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length)return void i();const r=e[t].units;for(;!(s>=r.length);s++){const n=r[s];if(!(n.data.length<=48||1!==n.type&&5!==n.type||(this.decryptAvcSample(e,t,s,i,n),this.decrypter.isSync())))return}}}}class Fi{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s,i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){const e=i.units;s=e[e.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const s=t.samples,i=s.length;if(!i)return void t.dropped++;{const t=s[i-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,s){const i=t.byteLength;let r=e.naluState||0;const n=r,a=[];let o,l,h,c=0,d=-1,u=0;for(-1===r&&(d=0,u=this.getNALuType(t,0),r=0,c=1);c<i;)if(o=t[c++],r)if(1!==r)if(o)if(1===o){if(l=c-r-1,d>=0){const e={data:t.subarray(d,l),type:u};a.push(e)}else{const s=this.getLastNalUnit(e.samples);s&&(n&&c<=4-n&&s.state&&(s.data=s.data.subarray(0,s.data.byteLength-n)),l>0&&(s.data=de(s.data,t.subarray(0,l)),s.state=0))}c<i?(h=this.getNALuType(t,c),d=c,u=h,r=0):r=-1}else r=0;else r=3;else r=o?0:2;else r=o?0:1;if(d>=0&&r>=0){const e={data:t.subarray(d,i),type:u,state:r};a.push(e)}if(0===a.length){const s=this.getLastNalUnit(e.samples);s&&(s.data=de(s.data,t))}return e.naluState=r,a}}class Bi{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");i.set(e.subarray(s,s+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&L.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class ji extends Fi{parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let n,a=this.VideoSample,o=!1;s.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach((i=>{var r,l;switch(i.type){case 1:{let t=!1;n=!0;const r=i.data;if(o&&r.length>4){const e=this.readSliceType(r);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var h;t&&null!=(h=a)&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.frame=!0,a.key=t;break}case 5:n=!0,null!=(r=a)&&r.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 6:n=!0,ge(i.data,1,s.pts,t.samples);break;case 7:{var c,d;n=!0,o=!0;const t=i.data,s=this.readSPS(t);if(!e.sps||e.width!==s.width||e.height!==s.height||(null==(c=e.pixelRatio)?void 0:c[0])!==s.pixelRatio[0]||(null==(d=e.pixelRatio)?void 0:d[1])!==s.pixelRatio[1]){e.width=s.width,e.height=s.height,e.pixelRatio=s.pixelRatio,e.sps=[t];const i=t.subarray(1,4);let r="avc1.";for(let e=0;e<3;e++){let t=i[e].toString(16);t.length<2&&(t="0"+t),r+=t}e.codec=r}break}case 8:n=!0,e.pps=[i.data];break;case 9:n=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:n=!0;break;default:n=!1}a&&n&&a.units.push(i)})),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new Bi(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s,i=8,r=8;for(let n=0;n<e;n++)0!==r&&(s=t.readEG(),r=(i+s+256)%256),i=0===r?i:r}readSPS(e){const t=new Bi(e);let s,i,r,n=0,a=0,o=0,l=0;const h=t.readUByte.bind(t),c=t.readBits.bind(t),d=t.readUEG.bind(t),u=t.readBoolean.bind(t),p=t.skipBits.bind(t),f=t.skipEG.bind(t),g=t.skipUEG.bind(t),m=this.skipScalingList.bind(this);h();const y=h();if(c(5),p(3),h(),g(),100===y||110===y||122===y||244===y||44===y||83===y||86===y||118===y||128===y){const e=d();if(3===e&&p(1),g(),g(),p(1),u())for(i=3!==e?8:12,r=0;r<i;r++)u()&&m(r<6?16:64,t)}g();const v=d();if(0===v)d();else if(1===v)for(p(1),f(),f(),s=d(),r=0;r<s;r++)f();g(),p(1);const _=d(),b=d(),T=c(1);0===T&&p(1),p(1),u()&&(n=d(),a=d(),o=d(),l=d());let A=[1,1];if(u()&&u())switch(h()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:A=[h()<<8|h(),h()<<8|h()]}return{width:Math.ceil(16*(_+1)-2*n-2*a),height:(2-T)*(b+1)*16-(T?2:4)*(o+l),pixelRatio:A}}}class Ui extends Fi{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let n,a=this.VideoSample,o=!1;s.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach((i=>{var r,l;switch(i.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.frame=!0,n=!0;break;case 16:case 17:case 18:case 21:var h;n=!0,o&&null!=(h=a)&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:n=!0,null!=(r=a)&&r.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 39:n=!0,ge(i.data,2,s.pts,t.samples);break;case 32:n=!0,e.vps||("object"!=typeof e.params&&(e.params={}),e.params=_(e.params,this.readVPS(i.data)),this.initVPS=i.data),e.vps=[i.data];break;case 33:if(n=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],i.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(i.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!=typeof e.params&&(e.params={});for(const s in t.params)e.params[s]=t.params[s]}this.pushParameterSet(e.sps,i.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0;break;case 34:if(n=!0,"object"==typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(i.data);for(const s in t)e.params[s]=t[s]}this.pushParameterSet(e.pps,i.data,e.vps)}break;case 35:n=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:n=!1}a&&n&&a.units.push(i)})),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let i=0;i<e.byteLength;i++)i>=2&&3===e[i]&&0===e[i-1]&&0===e[i-2]||(t[s]=e[i],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Bi(e);return t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6),{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new Bi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const i=t.readBits(2),r=t.readBoolean(),n=t.readBits(5),a=t.readUByte(),o=t.readUByte(),l=t.readUByte(),h=t.readUByte(),c=t.readUByte(),d=t.readUByte(),u=t.readUByte(),p=t.readUByte(),f=t.readUByte(),g=t.readUByte(),m=t.readUByte(),y=[],v=[];for(let e=0;e<s;e++)y.push(t.readBoolean()),v.push(t.readBoolean());if(s>0)for(let e=s;e<8;e++)t.readBits(2);for(let e=0;e<s;e++)y[e]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),v[e]&&t.readUByte();t.readUEG();const _=t.readUEG();3==_&&t.skipBits(1);const b=t.readUEG(),T=t.readUEG(),A=t.readBoolean();let E=0,S=0,C=0,w=0;A&&(E+=t.readUEG(),S+=t.readUEG(),C+=t.readUEG(),w+=t.readUEG());const k=t.readUEG(),L=t.readUEG(),I=t.readUEG();for(let e=t.readBoolean()?0:s;e<=s;e++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let e=0;e<4;e++)for(let s=0;s<(3===e?2:6);s++)if(t.readBoolean()){const s=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<s;e++)t.readEG()}else t.readUEG();t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const P=t.readUEG();let R=0;for(let e=0;e<P;e++){let s=!1;if(0!==e&&(s=t.readBoolean()),s){e===P&&t.readUEG(),t.readBoolean(),t.readUEG();let s=0;for(let e=0;e<=R;e++){const e=t.readBoolean();let i=!1;e||(i=t.readBoolean()),(e||i)&&s++}R=s}else{const e=t.readUEG(),s=t.readUEG();R=e+s;for(let s=0;s<e;s++)t.readUEG(),t.readBoolean();for(let e=0;e<s;e++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let s=0;s<e;s++){for(let e=0;e<I+4;e++)t.readBits(1);t.readBits(1)}}let x=0,D=1,O=1,M=!0,N=1,F=0;t.readBoolean(),t.readBoolean();let B=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(D=t.readBits(16),O=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),B=t.readBoolean(),B&&(E+=t.readUEG(),S+=t.readUEG(),C+=t.readUEG(),w+=t.readUEG()),t.readBoolean()&&(N=t.readBits(32),F=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const e=t.readBoolean(),i=t.readBoolean();let r=!1;(e||i)&&(r=t.readBoolean(),r&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),r&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let n=0;n<=s;n++){M=t.readBoolean();let s=!1;M||t.readBoolean()?t.readEG():s=t.readBoolean();const n=s?1:t.readUEG()+1;if(e)for(let e=0;e<n;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(i)for(let e=0;e<n;e++)t.readUEG(),t.readUEG(),r&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),x=t.readUEG())}let j=b,U=T;if(A||B){let e=1,t=1;1===_?e=t=2:2==_&&(e=2),j=b-e*S-e*E,U=T-t*w-t*C}const $=i?["A","B","C"][i]:"",H=a<<24|o<<16|l<<8|h;let V=0;for(let e=0;e<32;e++)V=(V|(H>>e&1)<<31-e)>>>0;let G=V.toString(16);return 1===n&&"2"===G&&(G="6"),{codecString:`hvc1.${$}${n}.${G}.${r?"H":"L"}${m}.B0`,params:{general_tier_flag:r,general_profile_idc:n,general_profile_space:i,general_profile_compatibility_flags:[a,o,l,h],general_constraint_indicator_flags:[c,d,u,p,f,g],general_level_idc:m,bit_depth:k+8,bit_depth_luma_minus8:k,bit_depth_chroma_minus8:L,min_spatial_segmentation_idc:x,chroma_format_idc:_,frame_rate:{fixed:M,fps:F/N}},width:j,height:U,pixelRatio:[D,O]}}readPPS(e){const t=new Bi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let r=1;return i&&s?r=0:i?r=3:s&&(r=2),{parallelismType:r}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const $i=188;class Hi{constructor(e,t,s,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.videoParser=null}static probe(e,t){const s=Hi.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),-1!==s}static syncOffset(e){const t=e.length;let s=Math.min(940,t-$i)+1,i=0;for(;i<s;){let r=!1,n=-1,a=0;for(let o=i;o<t;o+=$i){if(71!==e[o]||t-o!==$i&&71!==e[o+$i]){if(a)return-1;break}if(a++,-1===n&&(n=o,0!==n&&(s=Math.min(n+18612,e.length-$i)+1)),r||(r=0===Vi(e,o)),r&&a>1&&(0===n&&a>2||o+$i>s))return n}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:q[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,s,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Hi.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=Hi.createTrack("audio",i),this._id3Track=Hi.createTrack("id3"),this._txtTrack=Hi.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,i=!1){let r;s||(this.sampleAes=null);const n=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let h=n.pid,c=n.pesData,d=a.pid,u=o.pid,p=a.pesData,f=o.pesData,g=null,m=this.pmtParsed,y=this._pmtId,v=e.length;if(this.remainderData&&(v=(e=de(this.remainderData,e)).length,this.remainderData=null),v<$i&&!i)return this.remainderData=e,{audioTrack:a,videoTrack:n,id3Track:o,textTrack:l};const _=Math.max(0,Hi.syncOffset(e));v-=(v-_)%$i,v<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,v,e.buffer.byteLength-v));let b=0;for(let t=_;t<v;t+=$i)if(71===e[t]){const i=!!(64&e[t+1]),v=Vi(e,t);let b;if((48&e[t+3])>>4>1){if(b=t+5+e[t+4],b===t+$i)continue}else b=t+4;switch(v){case h:if(i){if(c&&(r=qi(c,this.logger))){if(null===this.videoParser)switch(n.segmentCodec){case"avc":this.videoParser=new ji;break;case"hevc":this.videoParser=new Ui}null!==this.videoParser&&this.videoParser.parsePES(n,l,r,!1)}c={data:[],size:0}}c&&(c.data.push(e.subarray(b,t+$i)),c.size+=t+$i-b);break;case d:if(i){if(p&&(r=qi(p,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r);break;case"ac3":this.parseAC3PES(a,r)}p={data:[],size:0}}p&&(p.data.push(e.subarray(b,t+$i)),p.size+=t+$i-b);break;case u:i&&(f&&(r=qi(f,this.logger))&&this.parseID3PES(o,r),f={data:[],size:0}),f&&(f.data.push(e.subarray(b,t+$i)),f.size+=t+$i-b);break;case 0:i&&(b+=e[b]+1),y=this._pmtId=Gi(e,b);break;case y:{i&&(b+=e[b]+1);const r=Wi(e,b,this.typeSupported,s,this.observer,this.logger);h=r.videoPid,h>0&&(n.pid=h,n.segmentCodec=r.segmentVideoCodec),d=r.audioPid,d>0&&(a.pid=d,a.segmentCodec=r.segmentAudioCodec),u=r.id3Pid,u>0&&(o.pid=u),null===g||m||(this.logger.warn(`MPEG-TS PMT found at ${t} after unknown PID '${g}'. Backtracking to sync byte @${_} to parse all TS packets.`),g=null,t=_-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=v}}else b++;b>0&&zi(this.observer,new Error(`Found ${b} TS packet/s that do not start with 0x47`),void 0,this.logger),n.pesData=c,a.pesData=p,o.pesData=f;const T={audioTrack:a,videoTrack:n,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(T),T}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:i,textTrack:r}=e,n=s.pesData,a=t.pesData,o=i.pesData;let l;if(n&&(l=qi(n,this.logger))){if(null===this.videoParser)switch(s.segmentCodec){case"avc":this.videoParser=new ji;break;case"hevc":this.videoParser=new Ui}null!==this.videoParser&&(this.videoParser.parsePES(s,r,l,!0),s.pesData=null)}else s.pesData=n;if(a&&(l=qi(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=qi(o,this.logger))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}demuxSampleAes(e,t,s){const i=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new Ni(this.observer,this.config,t);return this.decrypt(i,r)}decrypt(e,t){return new Promise((s=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,(()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,(()=>{s(e)})):s(e)})):r.samples&&t.decryptAvcSamples(r.samples,0,0,(()=>{s(e)}))}))}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const i=this.aacOverFlow;let r,n,a,o=t.data;if(i){this.aacOverFlow=null;const t=i.missing,r=i.sample.unit.byteLength;if(-1===t)o=de(i.sample.unit,o);else{const n=r-t;i.sample.unit.set(o.subarray(0,t),n),e.samples.push(i.sample),s=i.missing}}for(r=s,n=o.length;r<n-1&&!si(o,r);r++);if(r!==s){let e;const t=r<n-1;if(e=t?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES",zi(this.observer,new Error(e),t,this.logger),!t)return}if(ri(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!i)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=ni(e.samplerate);a=i.sample.pts+t}}let l,h=0;for(;r<n;){if(l=ai(e,o,r,a,h),r+=l.length,l.missing){this.aacOverFlow=l;break}for(h++;r<n-1&&!si(o,r);r++);}}parseMPEGPES(e,t){const s=t.data,i=s.length;let r=0,n=0;const a=t.pts;if(void 0!==a)for(;n<i;)if(Pi(s,n)){const t=ki(e,s,n,a,r);if(!t)break;n+=t.length,r++}else n++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const s=t.data,i=t.pts;if(void 0===i)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=s.length;let n,a=0,o=0;for(;o<r&&(n=Di(e,s,o,i,a++))>0;)o+=n}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const s=_({},t,{type:this._videoTrack?vi.emsg:vi.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function Vi(e,t){return((31&e[t+1])<<8)+e[t+2]}function Gi(e,t){return(31&e[t+10])<<8|e[t+11]}function Wi(e,t,s,i,r,n){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=Vi(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){Ki("ADTS AAC",n);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!i){Ki("H.264",n);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:s.mpeg||s.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):n.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){Ki("AC-3",n);break}case 129:s.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):n.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let i=t+5,r=l;for(;r>2;){106===e[i]&&(!0!==s.ac3?n.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3"));const t=e[i+1]+2;i+=t,r-=t}}break;case 194:case 135:return zi(r,new Error("Unsupported EC-3 in M2TS found"),void 0,n),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",n.log("HEVC in M2TS found"))}t+=l+5}return a}function zi(e,t,s,i){i.warn(`parsing error: ${t.message}`),e.emit(l.ERROR,l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_PARSING_ERROR,fatal:!1,levelRetry:s,error:t,reason:t.message})}function Ki(e,t){t.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function qi(e,t){let s,i,r,n,a,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=de(l[0],l[1]),l.splice(1,1);if(s=l[0],1===(s[0]<<16)+(s[1]<<8)+s[2]){if(i=(s[4]<<8)+s[5],i&&i>e.size-6)return null;const h=s[7];192&h&&(n=536870912*(14&s[9])+4194304*(255&s[10])+16384*(254&s[11])+128*(255&s[12])+(254&s[13])/2,64&h?(a=536870912*(14&s[14])+4194304*(255&s[15])+16384*(254&s[16])+128*(255&s[17])+(254&s[18])/2,n-a>54e5&&(t.warn(`${Math.round((n-a)/9e4)}s delta between PTS and DTS, align them`),n=a)):a=n),r=s[8];let c=r+9;if(e.size<=c)return null;e.size-=c;const d=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){s=l[e];let t=s.byteLength;if(c){if(c>t){c-=t;continue}s=s.subarray(c),t-=c,c=0}d.set(s,o),o+=t}return i&&(i-=r+3),{data:d,pts:n,dts:a,len:i}}return null}class Yi{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const Xi=Math.pow(2,32)-1;class Qi{static init(){let e;for(e in Qi.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Qi.types)Qi.types.hasOwnProperty(e)&&(Qi.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Qi.HDLR_TYPES={video:t,audio:s};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Qi.STTS=Qi.STSC=Qi.STCO=r,Qi.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Qi.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Qi.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Qi.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const n=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);Qi.FTYP=Qi.box(Qi.types.ftyp,n,o,n,a),Qi.DINF=Qi.box(Qi.types.dinf,Qi.box(Qi.types.dref,i))}static box(e,...t){let s=8,i=t.length;const r=i;for(;i--;)s+=t[i].byteLength;const n=new Uint8Array(s);for(n[0]=s>>24&255,n[1]=s>>16&255,n[2]=s>>8&255,n[3]=255&s,n.set(e,4),i=0,s=8;i<r;i++)n.set(t[i],s),s+=t[i].byteLength;return n}static hdlr(e){return Qi.box(Qi.types.hdlr,Qi.HDLR_TYPES[e])}static mdat(e){return Qi.box(Qi.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Xi+1)),i=Math.floor(t%(Xi+1));return Qi.box(Qi.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(e){return Qi.box(Qi.types.mdia,Qi.mdhd(e.timescale||0,e.duration||0),Qi.hdlr(e.type),Qi.minf(e))}static mfhd(e){return Qi.box(Qi.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?Qi.box(Qi.types.minf,Qi.box(Qi.types.smhd,Qi.SMHD),Qi.DINF,Qi.stbl(e)):Qi.box(Qi.types.minf,Qi.box(Qi.types.vmhd,Qi.VMHD),Qi.DINF,Qi.stbl(e))}static moof(e,t,s){return Qi.box(Qi.types.moof,Qi.mfhd(e),Qi.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=Qi.trak(e[t]);return Qi.box.apply(null,[Qi.types.moov,Qi.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(Qi.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=Qi.trex(e[t]);return Qi.box.apply(null,[Qi.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Xi+1)),i=Math.floor(t%(Xi+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Qi.box(Qi.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,s[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return Qi.box(Qi.types.sdtp,s)}static stbl(e){return Qi.box(Qi.types.stbl,Qi.stsd(e),Qi.box(Qi.types.stts,Qi.STTS),Qi.box(Qi.types.stsc,Qi.STSC),Qi.box(Qi.types.stsz,Qi.STSZ),Qi.box(Qi.types.stco,Qi.STCO))}static avc1(e){let t,s,i,r=[],n=[];for(t=0;t<e.sps.length;t++)s=e.sps[t],i=s.byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(s));for(t=0;t<e.pps.length;t++)s=e.pps[t],i=s.byteLength,n.push(i>>>8&255),n.push(255&i),n=n.concat(Array.prototype.slice.call(s));const a=Qi.box(Qi.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(n))),o=e.width,l=e.height,h=e.pixelRatio[0],c=e.pixelRatio[1];return Qi.box(Qi.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,Qi.box(Qi.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Qi.box(Qi.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,255&h,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return Qi.box(Qi.types.mp4a,Qi.audioStsd(e),Qi.box(Qi.types.esds,Qi.esds(e)))}static mp3(e){return Qi.box(Qi.types[".mp3"],Qi.audioStsd(e))}static ac3(e){return Qi.box(Qi.types["ac-3"],Qi.audioStsd(e),Qi.box(Qi.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return Qi.box(Qi.types.stsd,Qi.STSD,Qi.mp4a(e));if("ac3"===t&&e.config)return Qi.box(Qi.types.stsd,Qi.STSD,Qi.ac3(e));if("mp3"===t&&"mp3"===e.codec)return Qi.box(Qi.types.stsd,Qi.STSD,Qi.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return Qi.box(Qi.types.stsd,Qi.STSD,Qi.avc1(e));if("hevc"===t&&e.vps)return Qi.box(Qi.types.stsd,Qi.STSD,Qi.hvc1(e))}throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),i=e.width||0,r=e.height||0,n=Math.floor(s/(Xi+1)),a=Math.floor(s%(Xi+1));return Qi.box(Qi.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,r>>8&255,255&r,0,0]))}static traf(e,t){const s=Qi.sdtp(e),i=e.id,r=Math.floor(t/(Xi+1)),n=Math.floor(t%(Xi+1));return Qi.box(Qi.types.traf,Qi.box(Qi.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),Qi.box(Qi.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n])),Qi.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,Qi.box(Qi.types.trak,Qi.tkhd(e),Qi.mdia(e))}static trex(e){const t=e.id;return Qi.box(Qi.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],i=s.length,r=12+16*i,n=new Uint8Array(r);let a,o,l,h,c,d;for(t+=8+r,n.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<i;a++)o=s[a],l=o.duration,h=o.size,c=o.flags,d=o.cts,n.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,h>>>24&255,h>>>16&255,h>>>8&255,255&h,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*a);return Qi.box(Qi.types.trun,n)}static initSegment(e){Qi.types||Qi.init();const t=Qi.moov(e);return de(Qi.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let r=i.length;for(let e=0;e<s.length;e+=1){r+=3;for(let t=0;t<s[e].length;t+=1)r+=2+s[e][t].length}const n=new Uint8Array(r);n.set(i,0),r=i.length;const a=s.length-1;for(let e=0;e<s.length;e+=1){n.set(new Uint8Array([32+e|(e===a?128:0),0,s[e].length]),r),r+=3;for(let t=0;t<s[e].length;t+=1)n.set(new Uint8Array([s[e][t].length>>8,255&s[e][t].length]),r),r+=2,n.set(s[e][t],r),r+=s[e][t].length}const o=Qi.box(Qi.types.hvcC,n),l=e.width,h=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return Qi.box(Qi.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,h>>8&255,255&h,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Qi.box(Qi.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Qi.box(Qi.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}}Qi.types=void 0,Qi.HDLR_TYPES=void 0,Qi.STTS=void 0,Qi.STSC=void 0,Qi.STCO=void 0,Qi.STSZ=void 0,Qi.VMHD=void 0,Qi.SMHD=void 0,Qi.STSD=void 0,Qi.FTYP=void 0,Qi.DINF=void 0;function Zi(e,t,s=1,i=!1){const r=e*t*s;return i?Math.round(r):r}function Ji(e,t=!1){return Zi(e,1e3,1/9e4,t)}let er,tr=null,sr=null;function ir(e,t,s,i){return{duration:t,size:s,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class rr{constructor(e,t,s,i){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.ISGenerated=!1,null===tr){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);tr=e?parseInt(e[1]):0}if(null===sr){const e=navigator.userAgent.match(/Safari\/(\d+)/i);sr=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,i=e.reduce(((e,i)=>{let r=i.pts,n=r-e;return n<-4294967296&&(t=!0,r=nr(r,s),n=r-e),n>0?e:r}),s);return t&&this.logger.debug("PTS rollover detected"),i}remux(e,t,s,i,r,n,a,o){let l,h,c,d,u,p,g=r,m=r;const y=e.pid>-1,v=t.pid>-1,_=t.samples.length,b=e.samples.length>0,T=a&&_>0||_>1;if((!y||b)&&(!v||T)||this.ISGenerated||a){if(this.ISGenerated){var A,E,S,C;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(A=t.pixelRatio)?void 0:A[0])!==(null==(E=e.pixelRatio)?void 0:E[0])||(null==(S=t.pixelRatio)?void 0:S[1])!==(null==(C=e.pixelRatio)?void 0:C[1]))||!e&&T||null===this.nextAudioPts&&b)&&this.resetInitSegment()}this.ISGenerated||(c=this.generateIS(e,t,r,n));const s=this.isVideoContiguous;let i,a=-1;if(T&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!s&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,a>0){this.logger.warn(`[mp4-remuxer]: Dropped ${a} out of ${_} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,m+=(t.samples[0].pts-e)/t.inputTimeScale,i=m}else-1===a&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${_} video samples`),p=!1);if(this.ISGenerated){if(b&&T){const s=this.getVideoStartPts(t.samples),i=(nr(e.samples[0].pts,s)-s)/t.inputTimeScale;g+=Math.max(0,i),m+=Math.max(0,-i)}if(b){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,r,n)),h=this.remuxAudio(e,g,this.isAudioContiguous,n,v||T||o===f?m:void 0),T){const i=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,r,n)),l=this.remuxVideo(t,m,s,i)}}else T&&(l=this.remuxVideo(t,m,s,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(u=ar(s,r,this._initPTS,this._initDTS)),i.samples.length&&(d=or(i,r,this._initPTS))),{audio:h,video:l,initSegment:c,independent:p,text:d,id3:u}}generateIS(e,t,s,i){const r=e.samples,n=t.samples,a=this.typeSupported,o={},l=this._initPTS;let h,c,d,u=!l||i,p="audio/mp4";if(u&&(h=c=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(p="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:p,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):Qi.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(d=e.inputTimeScale,l&&d===l.timescale?u=!1:h=c=r[0].pts-Math.round(d*s))}if(t.sps&&t.pps&&n.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Qi.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(d=t.inputTimeScale,l&&d===l.timescale)u=!1;else{const e=this.getVideoStartPts(n),t=Math.round(d*s);c=Math.min(c,nr(n[0].dts,e)-t),h=Math.min(h,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:h,timescale:d},this._initDTS={baseTime:c,timescale:d}):h=d=void 0,{tracks:o,initPTS:h,timescale:d}}remuxVideo(e,t,s,i){const r=e.inputTimeScale,n=e.samples,h=[],c=n.length,d=this._initPTS;let u,p,f=this.nextAvcDts,g=8,m=this.videoSampleDuration,y=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,b=!1;if(!s||null===f){const e=t*r,i=n[0].pts-nr(n[0].dts,n[0].pts);tr&&null!==f&&Math.abs(e-i-f)<15e3?s=!0:f=e-i}const T=d.baseTime*r/d.timescale;for(let e=0;e<c;e++){const t=n[e];t.pts=nr(t.pts-T,f),t.dts=nr(t.dts-T,f),t.dts<n[e>0?e-1:e].dts&&(b=!0)}b&&n.sort((function(e,t){const s=e.dts-t.dts,i=e.pts-t.pts;return s||i})),u=n[0].dts,p=n[n.length-1].dts;const A=p-u,E=A?Math.round(A/(c-1)):m||e.inputTimeScale/30;if(s){const s=u-f,i=s>E,r=s<-1;if((i||r)&&(i?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ji(s,!0)} ms (${s}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ji(-s,!0)} ms (${s}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!r||f>=n[0].pts||tr)){u=f;const e=n[0].pts-s;if(i)n[0].dts=u,n[0].pts=e;else{let t=!0;for(let i=0;i<n.length&&!(n[i].dts>e&&t);i++){const e=n[i].pts;if(n[i].dts-=s,n[i].pts-=s,i<n.length-1){const s=n[i+1].pts;t=s<=n[i].pts==s<=e}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${Ji(e,!0)}/${Ji(u,!0)}, delta: ${Ji(s,!0)} ms`)}}u=Math.max(0,u);let S=0,C=0,w=u;for(let e=0;e<c;e++){const t=n[e],s=t.units,i=s.length;let r=0;for(let e=0;e<i;e++)r+=s[e].data.length;C+=r,S+=i,t.length=r,t.dts<w?(t.dts=w,w+=E/4|0||1):w=t.dts,y=Math.min(t.pts,y),v=Math.max(t.pts,v)}p=n[c-1].dts;const k=C+4*S+8;let L;try{L=new Uint8Array(k)}catch(e){return void this.observer.emit(l.ERROR,l.ERROR,{type:a.MUX_ERROR,details:o.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:k,reason:`fail allocating video mdat ${k}`})}const I=new DataView(L.buffer);I.setUint32(0,k),L.set(Qi.types.mdat,4);let P=!1,R=Number.POSITIVE_INFINITY,x=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY,O=Number.NEGATIVE_INFINITY;for(let e=0;e<c;e++){const t=n[e],s=t.units;let a,o=0;for(let e=0,t=s.length;e<t;e++){const t=s[e],i=t.data,r=t.data.byteLength;I.setUint32(g,r),g+=4,L.set(i,g),g+=r,o+=4+r}if(e<c-1)m=n[e+1].dts-t.dts,a=n[e+1].pts-t.pts;else{const s=this.config,o=e>0?t.dts-n[e-1].dts:E;if(a=e>0?t.pts-n[e-1].pts:E,s.stretchShortVideoTrack&&null!==this.nextAudioPts){const e=Math.floor(s.maxBufferHole*r),n=(i?y+i*r:this.nextAudioPts)-t.pts;n>e?(m=n-o,m<0?m=o:P=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${n/90} ms to the next segment; using duration ${m/90} ms for the last video frame.`)):m=o}else m=o}const l=Math.round(t.pts-t.dts);R=Math.min(R,m),D=Math.max(D,m),x=Math.min(x,a),O=Math.max(O,a),h.push(ir(t.key,m,o,l))}if(h.length)if(tr){if(tr<70){const e=h[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(sr&&O-x<D-R&&E/D<.025&&0===h[0].cts){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=u;for(let t=0,s=h.length;t<s;t++){const i=e+h[t].duration,r=e+h[t].cts;if(t<s-1){const e=i+h[t+1].cts;h[t].duration=e-r}else h[t].duration=t?h[t-1].duration:E;h[t].cts=0,e=i}}m=P||!m?E:m,this.nextAvcDts=f=p+m,this.videoSampleDuration=m,this.isVideoContiguous=!0;const M={data1:Qi.moof(e.sequenceNumber++,u,_(e,{samples:h})),data2:L,startPTS:y/r,endPTS:(v+m)/r,startDTS:u/r,endDTS:f/r,type:"video",hasAudio:!1,hasVideo:!0,nb:h.length,dropped:e.dropped};return e.samples=[],e.dropped=0,M}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,s,i,r){const n=e.inputTimeScale,h=n/(e.samplerate?e.samplerate:n),c=this.getSamplesPerFrame(e),d=c*h,u=this._initPTS,p="mp3"===e.segmentCodec&&this.typeSupported.mpeg,f=[],g=void 0!==r;let m=e.samples,y=p?0:8,v=this.nextAudioPts||-1;const b=t*n,T=u.baseTime*n/u.timescale;if(this.isAudioContiguous=s=s||m.length&&v>0&&(i&&Math.abs(b-v)<9e3||Math.abs(nr(m[0].pts-T,b)-v)<20*d),m.forEach((function(e){e.pts=nr(e.pts-T,b)})),!s||v<0){if(m=m.filter((e=>e.pts>=0)),!m.length)return;v=0===r?0:i&&!g?Math.max(0,b):m[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let s=0,i=v;s<m.length;s++){const r=m[s],a=r.pts,o=a-i,l=Math.abs(1e3*o/n);if(o<=-t*d&&g)0===s&&(this.logger.warn(`Audio frame @ ${(a/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/n)} ms.`),this.nextAudioPts=v=i=a);else if(o>=t*d&&l<1e4&&g){let t=Math.round(o/d);i=a-t*d,i<0&&(t--,i+=d),0===s&&(this.nextAudioPts=v=i),this.logger.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(i/n).toFixed(3)}s due to ${Math.round(1e3*o/n)} ms gap.`);for(let n=0;n<t;n++){const t=Math.max(i,0);let n=Yi.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);n||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),n=r.unit.subarray()),m.splice(s,0,{unit:n,pts:t}),i+=d,s++}}r.pts=i,i+=d}}let A,E=null,S=null,C=0,w=m.length;for(;w--;)C+=m[w].unit.byteLength;for(let t=0,i=m.length;t<i;t++){const i=m[t],r=i.unit;let n=i.pts;if(null!==S)f[t-1].duration=Math.round((n-S)/h);else{if(s&&"aac"===e.segmentCodec&&(n=v),E=n,!(C>0))return;C+=y;try{A=new Uint8Array(C)}catch(e){return void this.observer.emit(l.ERROR,l.ERROR,{type:a.MUX_ERROR,details:o.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:C,reason:`fail allocating audio mdat ${C}`})}p||(new DataView(A.buffer).setUint32(0,C),A.set(Qi.types.mdat,4))}A.set(r,y);const d=r.byteLength;y+=d,f.push(ir(!0,c,d,0)),S=n}const k=f.length;if(!k)return;const L=f[f.length-1];this.nextAudioPts=v=S+h*L.duration;const I=p?new Uint8Array(0):Qi.moof(e.sequenceNumber++,E/h,_({},e,{samples:f}));e.samples=[];const P=E/n,R=v/n,x={data1:I,data2:A,startPTS:P,endPTS:R,startDTS:P,endDTS:R,type:"audio",hasAudio:!0,hasVideo:!1,nb:k};return this.isAudioContiguous=!0,x}}function nr(e,t){let s;if(null===t)return e;for(s=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=s;return e}function ar(e,t,s,i){const r=e.samples.length;if(!r)return;const n=e.inputTimeScale;for(let a=0;a<r;a++){const r=e.samples[a];r.pts=nr(r.pts-s.baseTime*n/s.timescale,t*n)/n,r.dts=nr(r.dts-i.baseTime*n/i.timescale,t*n)/n}const a=e.samples;return e.samples=[],{samples:a}}function or(e,t,s){const i=e.samples.length;if(!i)return;const r=e.inputTimeScale;for(let n=0;n<i;n++){const i=e.samples[n];i.pts=nr(i.pts-s.baseTime*r/s.timescale,t*r)/r}e.samples.sort(((e,t)=>e.pts-t.pts));const n=e.samples;return e.samples=[],{samples:n}}function lr(e,t){const s=null==e?void 0:e.codec;return s&&s.length>4?s:t===B?"ec-3"===s||"ac-3"===s||"alac"===s?s:"fLaC"===s||"Opus"===s?Le(s,!1):(L.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(L.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}try{er=self.performance.now.bind(self.performance)}catch(e){er=Date.now}const hr=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,i){const r=this.videoTrack=_i("video",1),n=this.audioTrack=_i("audio",1),a=this.txtTrack=_i("text",1);if(this.id3Track=_i("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=ie(e);if(o.video){const{id:e,timescale:t,codec:s,supplemental:i}=o.video;r.id=e,r.timescale=a.timescale=t,r.codec=s,r.supplemental=i}if(o.audio){const{id:e,timescale:t,codec:s}=o.audio;n.id=e,n.timescale=t,n.codec=s}a.id=q.text,r.sampleDuration=0,r.duration=n.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let s=0;s<t;){const i=Q(e,s);if(i>8&&109===e[s+4]&&111===e[s+5]&&111===e[s+6]&&102===e[s+7])return!0;s=i>1?s+i:t}return!1}(e)}demux(e,t){this.timeOffset=t;let s=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=de(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},s=te(e,["moof"]);if(s.length<2)return t.remainder=e,t;const i=s[s.length-1];return t.valid=e.slice(0,i.byteOffset-8),t.remainder=e.slice(i.byteOffset-8),t}(s);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=s;const n=this.extractID3Track(i,t);return r.samples=ue(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return s.samples=ue(e,t),{videoTrack:t,audioTrack:_i(),id3Track:i,textTrack:_i()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const i=te(e.samples,["emsg"]);i&&i.forEach((e=>{const i=function(e){const t=e[0];let s="",i="",n=0,a=0,o=0,l=0,h=0,c=0;if(0===t){for(;"\0"!==Y(e.subarray(c,c+1));)s+=Y(e.subarray(c,c+1)),c+=1;for(s+=Y(e.subarray(c,c+1)),c+=1;"\0"!==Y(e.subarray(c,c+1));)i+=Y(e.subarray(c,c+1)),c+=1;i+=Y(e.subarray(c,c+1)),c+=1,n=Q(e,12),a=Q(e,16),l=Q(e,20),h=Q(e,24),c=28}else if(1===t){c+=4,n=Q(e,c),c+=4;const t=Q(e,c);c+=4;const a=Q(e,c);for(c+=4,o=2**32*t+a,r(o)||(o=Number.MAX_SAFE_INTEGER,L.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=Q(e,c),c+=4,h=Q(e,c),c+=4;"\0"!==Y(e.subarray(c,c+1));)s+=Y(e.subarray(c,c+1)),c+=1;for(s+=Y(e.subarray(c,c+1)),c+=1;"\0"!==Y(e.subarray(c,c+1));)i+=Y(e.subarray(c,c+1)),c+=1;i+=Y(e.subarray(c,c+1)),c+=1}return{schemeIdUri:s,value:i,timeScale:n,presentationTime:o,presentationTimeDelta:a,eventDuration:l,id:h,payload:e.subarray(c,e.byteLength)}}(e);if(Oi.test(i.schemeIdUri)){const e=Mi(i,t);let r=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const n=i.payload;s.samples.push({data:n,len:n.byteLength,dts:e,pts:e,type:vi.emsg,duration:r})}else if(this.config.enableEmsgKLVMetadata&&i.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=Mi(i,t);s.samples.push({data:i.payload,len:i.payload.byteLength,dts:e,pts:e,type:vi.misbklv,duration:Number.POSITIVE_INFINITY})}}))}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class{constructor(e,t,s,i){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=i}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,s,i){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(function(e,t){if(!e||!t)return e;const s=t.keyId;return s&&t.isCommonEncryption&&te(e,["moov","trak"]).forEach((e=>{const t=te(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let i=te(t,["enca"]);const r=i.length>0;r||(i=te(t,["encv"])),i.forEach((e=>{te(r?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=he(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(L.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${x(e)} -> ${x(s)}`),t.set(s,8))}}))}))})),e}(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:s}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const i=this.initData=ie(e);i.audio&&(t=lr(i.audio,B)),i.video&&(s=lr(i.video,j));const r={};i.audio&&i.video?r.audiovideo={container:"video/mp4",codec:t+","+s,supplemental:i.video.supplemental,initSegment:e,id:"main"}:i.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?r.video={container:"video/mp4",codec:s,supplemental:i.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(e,t,s,r,n,a){var o,l;let{initPTS:h,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:r,id3:s,initSegment:void 0};i(c)||(c=this.lastEndTime=n||0);const u=t.samples;if(null==u||!u.length)return d;const p={initPTS:void 0,timescale:1};let f=this.initData;if(null!=(o=f)&&o.length||(this.generateInitSegment(u),f=this.initData),null==(l=f)||!l.length)return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(p.tracks=this.initTracks,this.emitInitSegment=!1);const g=function(e,t){let s=0,r=0,n=0;const a=te(e,["moof","traf"]);for(let e=0;e<a.length;e++){const i=a[e],o=te(i,["tfhd"])[0],l=t[Q(o,4)];if(!l)continue;const h=l.default,c=Q(o,0)|(null==h?void 0:h.flags);let d=null==h?void 0:h.duration;8&c&&(d=Q(o,2&c?12:8));const u=l.timescale||9e4,p=te(i,["trun"]);for(let e=0;e<p.length;e++)s=ce(p[e]),!s&&d&&(s=d*Q(p[e],4)),l.type===j?r+=s/u:l.type===B&&(n+=s/u)}if(0===r&&0===n){let t=1/0,s=0,r=0;const n=te(e,["sidx"]);for(let e=0;e<n.length;e++){const i=se(n[e]);if(null!=i&&i.references){t=Math.min(t,i.earliestPresentationTime/i.timescale);const e=i.references.reduce(((e,t)=>e+t.info.duration||0),0);s=Math.max(s,e+i.earliestPresentationTime/i.timescale),r=s-t}}if(r&&i(r))return r}return r||n}(u,f),m=function(e,t){return te(t,["moof","traf"]).reduce(((t,s)=>{const r=te(s,["tfdt"])[0],n=r[0],a=te(s,["tfhd"]).reduce(((t,s)=>{const a=Q(s,4),o=e[a];if(o){let e=Q(r,4);if(1===n){if(e===z)return L.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=z+1,e+=Q(r,8)}const s=e/(o.timescale||9e4);if(i(s)&&(null===t||s<t))return s}return t}),null);return null!==a&&i(a)&&(null===t||a<t)?a:t}),null)}(f,u),y=null===m?n:m;!a&&h||!function(e,t,s,i){if(null===e)return!0;const r=Math.max(i,1),n=t-e.baseTime/e.timescale;return Math.abs(n-s)>r}(h,y,n,g)&&p.timescale===h.timescale||(p.initPTS=y-n,h&&1===h.timescale&&this.logger.warn(`Adjusting initPTS @${n} from ${h.baseTime/h.timescale} to ${p.initPTS}`),this.initPTS=h={baseTime:p.initPTS,timescale:1});const v=e?y-h.baseTime/h.timescale:c,_=v+g;!function(e,t,s){te(t,["moof","traf"]).forEach((t=>{te(t,["tfhd"]).forEach((i=>{const r=Q(i,4),n=e[r];if(!n)return;const a=n.timescale||9e4;te(t,["tfdt"]).forEach((e=>{const t=e[0],i=s*a;if(i){let s=Q(e,4);if(0===t)s-=i,s=Math.max(s,0),ee(e,4,s);else{s*=Math.pow(2,32),s+=Q(e,8),s-=i,s=Math.max(s,0);const t=Math.floor(s/(z+1)),r=Math.floor(s%(z+1));ee(e,4,t),ee(e,8,r)}}}))}))}))}(f,u,h.baseTime/h.timescale),g>0?this.lastEndTime=_:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const b=!!f.audio,T=!!f.video;let A="";b&&(A+="audio"),T&&(A+="video");const E={data1:u,startPTS:v,startDTS:v,endPTS:_,endDTS:_,type:A,hasAudio:b,hasVideo:T,nb:1,dropped:0};return d.audio="audio"===E.type?E:void 0,d.video="audio"!==E.type?E:void 0,d.initSegment=p,d.id3=ar(s,n,h,h),r.samples.length&&(d.text=or(r,n,h)),d}}},{demux:Hi,remux:rr},{demux:class extends bi{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Zs(e,0);let i=(null==s?void 0:s.length)||0;if(Ri(e,i))return!1;for(let s=e.length;i<s;i++)if(ii(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&Js(e,t)&&ti(e,t)<=e.length-t}(e,t)}appendFrame(e,t,s){ri(e,this.observer,t,s,e.manifestCodec);const i=ai(e,t,s,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},remux:rr},{demux:class extends bi{resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Zs(e,0);let s=(null==t?void 0:t.length)||0;if(t&&11===e[s]&&119===e[s+1]&&void 0!==yi(t)&&xi(e,s)<=16)return!1;for(let t=e.length;s<t;s++)if(Ri(e,s))return L.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return Ii(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,s){if(null!==this.basePTS)return ki(e,t,s,this.basePTS,this.frameIndex)}},remux:rr}];hr.splice(2,0,{demux:class extends bi{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const i=Di(e,t,s,this.basePTS,this.frameIndex);if(-1!==i)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Zs(e,0);if(!t)return!1;const s=t.length;return 11===e[s]&&119===e[s+1]&&void 0!==yi(t)&&xi(e,s)<16}},remux:rr});class cr{constructor(e,t,s,i,r,n){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=n}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,i){const r=s.transmuxing;r.executeStart=er();let n=new Uint8Array(e);const{currentTransmuxState:h,transmuxConfig:c}=this;i&&(this.currentTransmuxState=i);const{contiguous:d,discontinuity:u,trackSwitch:p,accurateTimeOffset:f,timeOffset:g,initSegmentChange:m}=i||h,{audioCodec:y,videoCodec:v,defaultInitPts:_,duration:b,initSegmentData:T}=c,A=function(e,t){let s=null;return e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(s=t),s}(n,t);if(A&&Ht(A.method)){const e=this.getDecrypter(),t=Vt(A.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(n,A.key.buffer,A.iv.buffer,t).then((e=>{const t=this.push(e,null,s);return this.decryptionPromise=null,t})),this.decryptionPromise;{let i=e.softwareDecrypt(n,A.key.buffer,A.iv.buffer,t);if(s.part>-1){const t=e.flush();i=t?t.buffer:t}if(!i)return r.executeEnd=er(),dr(s);n=new Uint8Array(i)}}const E=this.needsProbing(u,p);if(E){const e=this.configureTransmuxer(n);if(e)return this.logger.warn(`[transmuxer] ${e.message}`),this.observer.emit(l.ERROR,l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),r.executeEnd=er(),dr(s)}(u||p||m||E)&&this.resetInitSegment(T,y,v,b,t),(u||m||E)&&this.resetInitialTimestamp(_),d||this.resetContiguity();const S=this.transmux(n,A,g,f,s);this.asyncResult=ur(S);const C=this.currentTransmuxState;return C.contiguous=!0,C.discontinuity=!1,C.trackSwitch=!1,r.executeEnd=er(),S}flush(e){const t=e.transmuxing;t.executeStart=er();const{decrypter:s,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then((()=>this.flush(e)));const n=[],{timeOffset:a}=i;if(s){const t=s.flush();t&&n.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=er();const s=[dr(e)];return this.asyncResult?Promise.resolve(s):s}const h=o.flush(a);return ur(h)?(this.asyncResult=!0,h.then((t=>(this.flushRemux(n,t,e),n)))):(this.flushRemux(n,h,e),this.asyncResult?Promise.resolve(n):n)}flushRemux(e,t,s){const{audioTrack:i,videoTrack:r,id3Track:n,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===p?"level":"track"} ${s.level}`);const h=this.remuxer.remux(i,r,n,a,l,o,!0,this.id);e.push({remuxResult:h,chunkMeta:s}),s.transmuxing.executeEnd=er()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;t&&s&&(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,i,r){const{demuxer:n,remuxer:a}=this;n&&a&&(n.resetInitSegment(e,t,s,i),a.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,i,r){let n;return n=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,s,i,r):this.transmuxUnencrypted(e,s,i,r),n}transmuxUnencrypted(e,t,s,i){const{audioTrack:r,videoTrack:n,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,n,a,o,t,s,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,s,i,r){return this.demuxer.demuxSampleAes(e,t,s).then((e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,s,i,!1,this.id),chunkMeta:r})))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:i}=this;let r;for(let t=0,s=hr.length;t<s;t++){var n;if(null!=(n=hr[t].demux)&&n.probe(e,this.logger)){r=hr[t];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=r.remux,h=r.demux;o&&o instanceof l||(this.remuxer=new l(s,t,i,this.logger)),a&&a instanceof h||(this.demuxer=new h(s,t,i,this.logger),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Tt(this.config)),e}}const dr=e=>({remuxResult:{},chunkMeta:e});function ur(e){return"then"in e&&e.then instanceof Function}class pr{constructor(e,t,s,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=i,this.defaultInitPts=r||null}}class fr{constructor(e,t,s,i,r,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=n}}let gr=0;class mr{constructor(e,t,s,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=gr++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,s=this.hls;if(s&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var i;const e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":s.logger[t.data.logType]&&s.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,s.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error(`${e.message}  (${e.filename}:${e.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=i;const n=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===l.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new zs,this.observer.on(l.FRAG_DECRYPTED,n),this.observer.on(l.ERROR,n);const h=Re(r.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){const s=this.hls.logger;if(r.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{r.workerPath?(s.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=function(e){const t=qs[e];if(t)return t.clientCount++,t;const s=new self.URL(e,self.location.href).href,i={worker:new self.Worker(s),scriptURL:s,clientCount:1};return qs[e]=i,i}(r.workerPath)):(s.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=qs[Ks];if(e)return e.clientCount++,e;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),s=self.URL.createObjectURL(t),i={worker:new self.Worker(s),objectURL:s,clientCount:1};return qs[Ks]=i,i}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:h,id:t,config:Ge(r)})}catch(i){s.warn(`Error setting up "${t}" Web Worker, fallback to inline`,i),this.terminateWorker(),this.error=null,this.transmuxer=new cr(this.observer,h,r,"",t,e.logger)}return}}this.transmuxer=new cr(this.observer,h,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=gr++;const t=this.hls.config,s=Re(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Ge(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=qs[e||Ks];if(t&&1==t.clientCount--){const{worker:s,objectURL:i}=t;delete qs[e||Ks],i&&self.URL.revokeObjectURL(i),s.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,i,r,n,a,o,l,h){var c,d;l.transmuxing.start=self.performance.now();const{instanceNo:u,transmuxer:f}=this,g=n?n.start:r.start,m=r.decryptdata,y=this.frag,v=!(y&&r.cc===y.cc),_=!(y&&l.level===y.level),b=y?l.sn-y.sn:-1,T=this.part?l.part-this.part.index:-1,A=0===b&&l.id>1&&l.id===(null==y?void 0:y.stats.chunkCount),E=!_&&(1===b||0===b&&(1===T||A&&T<=0)),S=self.performance.now();(_||b||0===r.stats.parsing.start)&&(r.stats.parsing.start=S),!n||!T&&E||(n.stats.parsing.start=S);const C=!(y&&(null==(c=r.initSegment)?void 0:c.url)===(null==(d=y.initSegment)?void 0:d.url)),w=new fr(v,E,o,_,g,C);if(!E||v||C){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===p?"level":"track"}: ${l.level} id: ${l.id}\n        discontinuity: ${v}\n        trackSwitch: ${_}\n        contiguous: ${E}\n        accurateTimeOffset: ${o}\n        timeOffset: ${g}\n        initSegmentChange: ${C}`);const e=new pr(s,i,t,a,h);this.configureTransmuxer(e)}if(this.frag=r,this.part=n,this.workerContext)this.workerContext.worker.postMessage({instanceNo:u,cmd:"demux",data:e,decryptdata:m,chunkMeta:l,state:w},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,m,l,w);ur(t)?t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")})):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const t=s.flush(e);ur(t)?t.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")})):this.handleFlushResult(t,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class yr extends A{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const i=null==t?void 0:t.renditionReports;if(i){let r=-1;for(let s=0;s<i.length;s++){const n=i[s];let a;try{a=new self.URL(n.URI,t.url).href}catch(e){this.warn(`Could not construct new URL for Rendition Report: ${e}`),a=n.URI||""}if(a===e){r=s;break}a===e.substring(0,a.length)&&(r=s)}if(-1!==r){const e=i[r],n=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let a=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=s&&Ue(s);return new $e(n,a>=0?a:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}return e}playlistLoaded(e,t,s){const{details:r,stats:n}=t,h=self.performance.now(),c=n.loading.first?Math.max(0,h-n.loading.first):0;r.advancedDateTime=Date.now()-c;const d=this.hls.config.timelineOffset;if(d!==r.appliedTimelineOffset){const e=Math.max(d||0,0);r.appliedTimelineOffset=e,r.fragments.forEach((t=>{t.start=t.playlistOffset+e}))}if(r.live||null!=s&&s.live){const d="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(s),s&&r.fragments.length>0){!function(e,t){if(e===t)return;let s=null;const r=e.fragments;for(let e=r.length-1;e>=0;e--){const t=r[e].initSegment;if(t){s=t;break}}let n;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,s){const i=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,n=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let h=r;h<=n;h++){const r=l[a+h];let n=o[h];if(i&&!n&&r&&(n=t.fragments[h]=r),r&&n){if(s(r,n,h,o),r.url&&r.url!==n.url)return void(t.playlistParsingError=ws(`media sequence mismatch ${n.sn}:`,e,t,0,n));if(r.cc!==n.cc)return void(t.playlistParsingError=ws(`discontinuity sequence mismatch (${r.cc}!=${n.cc})`,e,t,0,n))}}}(e,t,((r,a,o,l)=>{if(!t.startCC&&a.cc!==r.cc){var h,c;const s=r.cc-a.cc;for(let e=o;e<l.length;e++)l[e].cc+=s;t.startCC=null!=(h=null==(c=Ps(e,t.startSN-1))?void 0:c.cc)?h:l[0].cc,t.endCC=l[l.length-1].cc}i(r.startPTS)&&i(r.endPTS)&&(a.setStart(a.startPTS=r.startPTS),a.startDTS=r.startDTS,a.maxStartPTS=r.maxStartPTS,a.endPTS=r.endPTS,a.endDTS=r.endDTS,a.minEndPTS=r.minEndPTS,a.setDuration(r.endPTS-r.startPTS),a.duration&&(n=a),t.PTSKnown=t.alignedSliding=!0),r.hasStreams&&(a.elementaryStreams=r.elementaryStreams),a.loader=r.loader,r.hasStats&&(a.stats=r.stats),r.initSegment&&(a.initSegment=r.initSegment,s=r.initSegment)}));const a=t.fragments,o=t.fragmentHint?a.concat(t.fragmentHint):a;if(s&&o.forEach((e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=s)?void 0:t.relurl)||(e.initSegment=s)})),t.skippedSegments)if(t.deltaUpdateFailed=a.some((e=>!e)),t.deltaUpdateFailed){L.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)a.shift();t.startSN=a[0].sn}else{t.endCC=a[a.length-1].cc,t.canSkipDateRanges&&(t.dateRanges=function(e,t){const{dateRanges:s,recentlyRemovedDateranges:i}=t,r=_({},e);i&&i.forEach((e=>{delete r[e]}));const n=Object.keys(r).length;return n&&Object.keys(s).forEach((e=>{const t=r[e],i=new Ut(s[e].attr,t);i.isValid?(r[e]=i,t||(i.tagOrder+=n)):L.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ge(s[e].attr)}"`)})),r}(e.dateRanges,t));const s=e.fragments.filter((e=>e.rawProgramDateTime));if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<o.length;e++)null===o[e].programDateTime&&_s(o[e],o[e-1],s);ps(s,t)}!function(e,t,s){if(e&&t){let i=0;for(let r=0,n=e.length;r<=n;r++){const n=e[r],a=t[r+i];n&&a&&n.index===a.index&&n.fragment.sn===a.fragment.sn?s(n,a):i--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),n?Cs(t,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):ks(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const l=t.advancedDateTime;if(t.advanced&&l){const e=t.edge;t.driftStart||(t.driftStartTime=l,t.driftStart=e),t.driftEndTime=l,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}(s,r);const e=r.playlistParsingError;if(e){this.warn(e);const s=this.hls;if(!s.config.ignorePlaylistParsingErrors){var u;const{networkDetails:i}=t;return void s.trigger(l.ERROR,{type:a.NETWORK_ERROR,details:o.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(u=r.fragments[0])?void 0:u.type,networkDetails:i,stats:n})}r.playlistParsingError=null}}-1===r.requestScheduled&&(r.requestScheduled=n.loading.start);const p=this.hls.mainForwardBufferInfo,f=p?p.end-p.len:0,g=Is(r,1e3*(r.edge-f));if(r.requestScheduled+g<h?r.requestScheduled=h:r.requestScheduled+=g,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let m,y,v;if(r.canBlockReload&&r.endSN&&r.advanced){const e=this.hls.config.lowLatencyMode,i=r.lastPartSn,n=r.endSN,a=r.lastPartIndex,o=i===n;-1!==a?o?(y=n+1,v=e?0:a):(y=i,v=e?a+1:r.maxPartIndex):y=n+1;const l=r.age,c=l+r.ageHeader;let u=Math.min(c-r.partTarget,1.5*r.targetduration);if(u>0){if(c>3*r.targetduration)this.log(`Playlist last advanced ${l.toFixed(2)}s ago. Omitting segment and part directives.`),y=void 0,v=void 0;else if(null!=s&&s.tuneInGoal&&c-r.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${u} with playlist age: ${r.age}`),u=0;else{const e=Math.floor(u/r.targetduration);y+=e,void 0!==v&&(v+=Math.round(u%r.targetduration/r.partTarget)),this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${l.toFixed(2)}s goal: ${u} skip sn ${e} to part ${v}`)}r.tuneInGoal=u}if(m=this.getDeliveryDirectives(r,t.deliveryDirectives,y,v),e||!o)return r.requestScheduled=h,void this.loadingPlaylist(d,m)}else(r.canBlockReload||r.canSkipUntil)&&(m=this.getDeliveryDirectives(r,t.deliveryDirectives,y,v));m&&void 0!==y&&r.canBlockReload&&(r.requestScheduled=n.loading.first+Math.max(g-2*c,g/2)),this.scheduleLoading(d,m,r)}else this.clearTimer()}scheduleLoading(e,t,s){const i=s||e.details;if(!i)return void this.loadingPlaylist(e,t);const r=self.performance.now(),n=i.requestScheduled;if(r>=n)return void this.loadingPlaylist(e,t);const a=n-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout((()=>this.loadingPlaylist(e,t)),a)}getDeliveryDirectives(e,t,s,i){let r=Ue(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,i=t.part,r=""),new $e(s,i,r)}checkRetry(e){const t=e.details,s=rt(e),i=e.errorAction,{action:r,retryCount:n=0,retryConfig:a}=i||{},o=!!i&&!!a&&(5===r||!i.resolved&&2===r);if(o){var l;if(n>=a.maxNumRetry)return!1;if(s&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=at(a,n);this.clearTimer(),this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,i.resolved=!0}return o}}function vr(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!_r(e[s].attrs,t[s].attrs))return!1;return!0}function _r(e,t,s){const i=e["STABLE-RENDITION-ID"];return i&&!s?i===t["STABLE-RENDITION-ID"]:!(s||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((s=>e[s]!==t[s]))}function br(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class Tr{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(null===this.queues||null===this.tracks)return;const i=this.queues[t];i.push(e),1!==i.length||s||this.executeNext(t)}appendBlocker(e){return new Promise((t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)}))}prependBlocker(e){return new Promise((t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}}))}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach((e=>{var t;const s=null==(t=e[0])?void 0:t.label;"async-blocker"!==s&&"async-blocker-prepend"!==s||(e[0].execute(),e.splice(0,1))}))}unblockAudio(e){null!==this.queues&&this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(t){var s;if(i.onError(t),null===this.queues||null===this.tracks)return;const r=null==(s=this.tracks[e])?void 0:s.buffer;null!=r&&r.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":`\n${this.list("video")}\n${this.list("audio")}\n${this.list("audiovideo")}}`}list(e){var t,s;return null!=(t=this.queues)&&t[e]||null!=(s=this.tracks)&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=null==(t=this.tracks)?void 0:t[e],i=null==s?void 0:s.buffer;return i?`SourceBuffer${i.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map((e=>e.label)).join(", "))||""}}const Ar=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Er="HlsJsTrackRemovedError";class Sr extends Error{constructor(e){super(e),this.name=Er}}function Cr(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach((t=>{e.removeChild(t)}))}function wr(e){return"audio"===e?1:0}class kr{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(l.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(l.BUFFER_CODECS,this.onBufferCodecs,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(l.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(l.BUFFER_CODECS,this.onBufferCodecs,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&i(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter(((t,s)=>this.isLevelAllowed(t)&&s<=e));return this.clientRect=null,kr.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,t.width||t.height||(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static getMaxLevelByMediaSize(e,t,s){if(null==e||!e.length)return-1;let i=e.length-1;const r=Math.max(t,s);for(let t=0;t<e.length;t+=1){const s=e[t];if((s.width>=r||s.height>=r)&&(n=s,!(a=e[t+1])||n.width!==a.width||n.height!==a.height)){i=t;break}}var n,a;return i}}const Lr="m",Ir="a",Pr="v",Rr="av",xr="i",Dr="tt",Or="h",Mr="CMCD-Request",Nr={["CMCD-Object"]:["br","d","ot","tb"],[Mr]:["bl","dl","mtp","nor","nrr","su"],["CMCD-Session"]:["cid","pr","sf","sid","st","v"],["CMCD-Status"]:["bs","rtp"]};class Fr{constructor(e,t){Array.isArray(e)&&(e=e.map((e=>e instanceof Fr?e:new Fr(e)))),this.value=e,this.params=t}}const Br="Dict";function jr(e,t,s){return function(e,t,s,i){return new Error(`failed to ${e} "${r=t,Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":"object"==typeof r?JSON.stringify(r):String(r)}" as ${s}`,{cause:i});var r}("serialize",e,t,s)}class Ur{constructor(e){this.description=e}}const $r="Bare Item",Hr="Boolean",Vr="Byte Sequence";const Gr="Integer";function Wr(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw jr(e,Gr);return e.toString()}const zr="Decimal";function Kr(e){const t=li(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw jr(e,zr);const s=t.toString();return s.includes(".")?s:`${s}.0`}const qr="String",Yr=/[\x00-\x1f\x7f]+/,Xr="Token";function Qr(e){const t=(s=e).description||s.toString().slice(7,-1);var s;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw jr(t,Xr);return t}function Zr(e){switch(typeof e){case"number":if(!i(e))throw jr(e,$r);return Number.isInteger(e)?Wr(e):Kr(e);case"string":return function(e){if(Yr.test(e))throw jr(e,qr);return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return Qr(e);case"boolean":return function(e){if("boolean"!=typeof e)throw jr(e,Hr);return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return`@${Wr(e.getTime()/1e3)}`}(e);if(e instanceof Uint8Array)return function(e){if(!1===ArrayBuffer.isView(e))throw jr(e,Vr);return`:${t=e,btoa(String.fromCharCode(...t))}:`;var t}(e);if(e instanceof Ur)return Qr(e);default:throw jr(e,$r)}}const Jr="Key";function en(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw jr(e,Jr);return e}function tn(e){return null==e?"":Object.entries(e).map((([e,t])=>!0===t?`;${en(e)}`:`;${en(e)}=${Zr(t)}`)).join("")}function sn(e){return e instanceof Fr?`${Zr(e.value)}${tn(e.params)}`:Zr(e)}const rn=e=>Math.round(e),nn=e=>100*rn(e/100),an={br:rn,d:rn,bl:nn,dl:nn,mtp:nn,nor:(e,t)=>((null==t?void 0:t.baseUrl)&&(e=function(e,t){const s=new URL(e),i=new URL(t);if(s.origin!==i.origin)return e;const r=s.pathname.split("/").slice(1),n=i.pathname.split("/").slice(1,-1);for(;r[0]===n[0];)r.shift(),n.shift();for(;n.length;)n.shift(),r.unshift("..");return r.join("/")}(e,t.baseUrl)),encodeURIComponent(e)),rtp:nn,tb:rn};function on(e,t={}){return e?function(e,t){return function(e,t={whitespace:!0}){if("object"!=typeof e)throw jr(e,Br);const s=e instanceof Map?e.entries():Object.entries(e),i=(null==t?void 0:t.whitespace)?" ":"";return Array.from(s).map((([e,t])=>{t instanceof Fr==0&&(t=new Fr(t));let s=en(e);var i;return!0===t.value?s+=tn(t.params):(s+="=",Array.isArray(t.value)?s+=`(${(i=t).value.map(sn).join(" ")})${tn(i.params)}`:s+=sn(t)),s})).join(`,${i}`)}(e,t)}(function(e,t){const s={};if(null==e||"object"!=typeof e)return s;const r=Object.keys(e).sort(),n=_({},an,null==t?void 0:t.formatters),a=null==t?void 0:t.filter;return r.forEach((r=>{if(null==a?void 0:a(r))return;let o=e[r];const l=n[r];l&&(o=l(o,t)),"v"===r&&1===o||"pr"==r&&1===o||function(e){return"number"==typeof e?i(e):null!=e&&""!==e&&!1!==e}(o)&&(function(e){return"ot"===e||"sf"===e||"st"===e}(r)&&"string"==typeof o&&(o=new Ur(o)),s[r]=o)})),s}(e,t),_({whitespace:!1},t)):""}const ln=/CMCD=[^&#]+/;function hn(e,t,s,i){e&&Object.keys(t).forEach((r=>{const n=e.filter((e=>e.groupId===r)).map((e=>{const n=_({},e);return n.details=void 0,n.attrs=new Bt(n.attrs),n.url=n.attrs.URI=cn(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",s),n.groupId=n.attrs["GROUP-ID"]=t[r],n.attrs["PATHWAY-ID"]=i,n}));e.push(...n)}))}function cn(e,t,s,i){const{HOST:r,PARAMS:n,[s]:a}=i;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return r&&!o&&(l.host=r),n&&Object.keys(n).sort().forEach((e=>{e&&l.searchParams.set(e,n[e])})),l.href}class dn extends A{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=dn.CDMCleanupPromise?[dn.CDMCleanupPromise]:[],this.onMediaEncrypted=e=>{const{initDataType:t,initData:s}=e,i=`"${e.type}" event: init data type: "${t}"`;if(this.debug(i),null!==s){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=ts(this.config));const t=e.map(es).filter((e=>!!e));this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then((r=>{const n=Zt(r);let a,o;if("sinf"===t){if(n!==Kt.FAIRPLAY)return void this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${n}`);const r=Y(new Uint8Array(s));try{const e=he(Gt(JSON.parse(r).sinf));if(!e)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(e.subarray(8,24)),o=Kt.FAIRPLAY}catch(e){return void this.warn(`${i} Failed to parse sinf: ${e}`)}}else{if(n!==Kt.WIDEVINE&&n!==Kt.PLAYREADY)return void this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${n}`);const r=function(e){const t=[];if(e instanceof ArrayBuffer){const s=e.byteLength;let i=0;for(;i+32<s;){const s=ye(new DataView(e,i));t.push(s),i+=s.size}}return t}(s),l=r.filter((e=>!!e.systemId&&Jt(e.systemId)===n));l.length>1&&this.warn(`${i} Using first of ${l.length} pssh found for selected key-system ${n}`);const h=l[0];if(!h)return void(0===r.length||r.some((e=>!e.systemId))?this.warn(`${i} contains incomplete or invalid pssh data`):this.log(`ignoring ${i} for ${r.map((e=>Jt(e.systemId))).join(",")} pssh data in favor of playlist keys`));if(o=Jt(h.systemId),0===h.version&&h.data)if(o===Kt.WIDEVINE){const e=h.data.length-22;a=new Uint8Array(h.data.subarray(e,e+16))}else o===Kt.PLAYREADY&&(a=rs(h.data))}if(!o||!a)return;const l=x(a),{keyIdToKeySessionPromise:h,mediaKeySessions:c}=this;let d=h[l];for(let e=0;e<c.length;e++){const i=c[e],r=i.decryptdata;if(!r.keyId)continue;const n=x(r.keyId);if(l===n||-1!==r.uri.replace(/-/g,"").indexOf(l)){if(d=h[n],r.pssh)break;delete h[n],r.pssh=new Uint8Array(s),r.keyId=a,d=h[l]=d.then((()=>this.generateRequestWithPreferredKeySession(i,t,s,"encrypted-event-key-match"))),d.catch((e=>this.handleError(e)));break}}if(!d){if(o!==n)return void this.log(`Ignoring "${e.type}" event with ${o} init data for selected key-system ${n}`);d=h[l]=this.getKeySystemSelectionPromise([o]).then((({keySystem:e,mediaKeys:i})=>{var r;this.throwIfDestroyed();const n=new as("ISO-23001-7",l,null!=(r=es(e))?r:"");return n.pssh=new Uint8Array(s),n.keyId=a,this.attemptSetMediaKeys(e,i).then((()=>{this.throwIfDestroyed();const r=this.createMediaKeySessionContext({decryptdata:n,keySystem:e,mediaKeys:i});return this.generateRequestWithPreferredKeySession(r,t,s,"encrypted-event-no-match")}))})),d.catch((e=>this.handleError(e)))}}))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){const e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(l.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(l.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(l.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(l.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(l.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(l.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,i=t[e];return i?i.licenseUrl:e===Kt.WIDEVINE&&s?s:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(e,t,s)=>!!e&&s.indexOf(e)===t,i=t.map((e=>e.audioCodec)).filter(s),r=t.map((e=>e.videoCodec)).filter(s);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise(((t,s)=>{const n=e=>{const l=e.shift();this.getMediaKeysPromise(l,i,r).then((e=>t({keySystem:l,mediaKeys:e}))).catch((t=>{e.length?n(e):s(t instanceof un?t:new un({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};n(e)}))}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if("function"!=typeof s){let e=`Configured requestMediaKeySystemAccess is not a function ${s}`;return null===ss&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return s(e,t)}getMediaKeysPromise(e,t,s){const i=function(e,t,s,i){let r;switch(e){case Kt.FAIRPLAY:r=["cenc","sinf"];break;case Kt.WIDEVINE:case Kt.PLAYREADY:r=["cenc"];break;case Kt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,s,i){return[{initDataTypes:e,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map((e=>({contentType:`audio/mp4; codecs=${e}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null}))),videoCapabilities:s.map((e=>({contentType:`video/mp4; codecs=${e}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null})))}]}(r,t,s,i)}(e,t,s,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let n=null==r?void 0:r.keySystemAccess;if(!n){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ge(i)}`),n=this.requestMediaKeySystemAccess(e,i);const t=this.keySystemAccessPromises[e]={keySystemAccess:n};return n.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),n.then((s=>{this.log(`Access for key-system "${s.keySystem}" obtained`);const i=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=s.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),i.then((s=>s?this.setMediaKeysServerCertificate(t,e,s):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return n.then((()=>r.mediaKeys))}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${x(e.keyId||[])}`);const i=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return x(e.keyId)}updateKeySession(e,t){var s;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${x((null==(s=e.decryptdata)?void 0:s.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise(((t,s)=>{const i=ts(this.config),r=e.map(Zt).filter((e=>!!e&&-1!==i.indexOf(e)));return this.getKeySystemSelectionPromise(r).then((({keySystem:e})=>{const i=es(e);i?t(i):s(new Error(`Unable to find format for key-system "${e}"`))})).catch(s)}))}loadKey(e){const t=e.keyInfo.decryptdata,s=this.getKeyIdString(t),i=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let r=this.keyIdToKeySessionPromise[s];return r||(r=this.getKeySystemForKeyPromise(t).then((({keySystem:s,mediaKeys:r})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(s,r).then((()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:s,mediaKeys:r,decryptdata:t}))))))),(this.keyIdToKeySessionPromise[s]=r.then((e=>{const s=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",s,"playlist-key")}))).catch((e=>this.handleError(e)))),r}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof un?this.hls.trigger(l.ERROR,e.data):this.hls.trigger(l.ERROR,{type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),s=this.keyIdToKeySessionPromise[t];if(!s){const t=Zt(e.keyFormat),s=t?[t]:ts(this.config);return this.attemptKeySystemAccess(s)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=ts(this.config)),0===e.length)throw new un({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ge({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(s).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(i),i.then((()=>{this.log(`Media-keys set for "${e}"`),s.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===s.indexOf(e)))}))}generateRequestWithPreferredKeySession(e,t,s,i){var r,n;const l=null==(r=this.config.drmSystems)||null==(n=r[e.keySystem])?void 0:n.generateRequest;if(l)try{const i=l.call(this.hls,t,s,e);if(!i)throw new Error("Invalid response from configured generateRequest filter");t=i.initDataType,s=i.initData?i.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(e){var h;if(this.warn(e.message),null!=(h=this.hls)&&h.config.debug)throw e}if(null===s)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const c=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${c} (init data type: ${t} length: ${s?s.byteLength:null})`);const d=new zs,u=e._onmessage=t=>{const s=e.mediaKeysSession;if(!s)return void d.emit("error",new Error("invalid state"));const{messageType:i,message:r}=t;this.log(`"${i}" message event for session "${s.sessionId}" message size: ${r.byteLength}`),"license-request"===i||"license-renewal"===i?this.renewLicense(e,r).catch((e=>{d.eventNames().length?d.emit("error",e):this.handleError(e)})):"license-release"===i?e.keySystem===Kt.FAIRPLAY&&(this.updateKeySession(e,Wt("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${i}"`)},p=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void d.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const s=e.keyStatus;d.emit("keyStatus",s),"expired"===s&&(this.warn(`${e.keySystem} expired for key ${c}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",u),e.mediaKeysSession.addEventListener("keystatuseschange",p);const f=new Promise(((e,t)=>{d.on("error",t),d.on("keyStatus",(s=>{s.startsWith("usable")?e():"output-restricted"===s?t(new un({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===s?t(new un({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${s}"`)):"expired"===s?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${s}"`)}))}));return e.mediaKeysSession.generateRequest(t,s).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${c}`)})).catch((e=>{throw new un({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)})).then((()=>f)).catch((t=>{throw d.removeAllListeners(),this.removeSession(e),t})).then((()=>(d.removeAllListeners(),e)))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach(((t,s)=>{if("string"==typeof s&&"object"==typeof t){const e=s;s=t,t=e}this.log(`key status change "${t}" for keyStatuses keyId: ${x("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))} session keyId: ${x(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}fetchServerCertificate(e){const t=this.config,s=new(0,t.loader)(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise(((r,n)=>{const l={responseType:"arraybuffer",url:i},h=t.certLoadPolicy.default,c={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(e,t,s,i)=>{r(e.data)},onError:(t,s,r,h)=>{n(new un({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:T({url:l.url,data:void 0},t)},`"${e}" certificate request failed (${i}). Status: ${t.code} (${t.text})`))},onTimeout:(t,s,r)=>{n(new un({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(e,t,s)=>{n(new Error("aborted"))}};s.load(l,c,d)}))):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise(((i,r)=>{e.setServerCertificate(s).then((r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${null==s?void 0:s.byteLength}) on "${t}"`),i(e)})).catch((e=>{r(new un({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new un({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=(new DOMParser).parseFromString(s,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let t;for(let s=0,i=r.length;s<i;s++){var n,a;t=r[s];const i=null==(n=t.querySelector("name"))?void 0:n.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;i&&o&&e.setRequestHeader(i,o)}}const o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return Wt(atob(l))}setupLicenseXHR(e,t,s,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then((()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,i)})).catch((n=>{if(!s.decryptdata)throw n;return e.open("POST",t,!0),r.call(this.hls,e,t,s,i)})).then((s=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:s||i}))):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise(((i,r)=>{const n=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${n}`);const l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===l.readyState)if(200===l.status){this._requestLicenseFailureCount=0;let t=l.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const s=this.config.licenseResponseCallback;if(s)try{t=s.call(this.hls,l,n,e)}catch(e){this.error(e)}i(t)}else{const h=s.errorRetry,c=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||l.status>=400&&l.status<500)r(new un({type:a.KEY_SYSTEM_ERROR,details:o.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:l,response:{url:n,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${n}). Status: ${l.status} (${l.statusText})`));else{const s=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${s} attempts left`),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=l,this.setupLicenseXHR(l,n,e,t).then((({xhr:t,licenseChallenge:s})=>{e.keySystem==Kt.PLAYREADY&&(s=this.unpackPlayReadyKeyMessage(t,s)),t.send(s)}))}))}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,s.removeEventListener("encrypted",this.onMediaEncrypted),s.removeEventListener("waitingforkey",this.onWaitingForKey),s.addEventListener("encrypted",this.onMediaEncrypted),s.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(e){var t;const s=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},as.clearKeyUriToKeyIdMap();const i=s.length;dn.CDMCleanupPromise=Promise.all(s.map((e=>this.removeSession(e))).concat(null==e||null==(t=e.setMediaKeys(null))?void 0:t.catch((e=>{var t;this.log(`Could not clear media keys: ${e}`),null==(t=this.hls)||t.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${e}`)})})))).then((()=>{i&&(this.log("finished closing key sessions and clearing media keys"),s.length=0)})).catch((e=>{var t;this.log(`Could not close sessions and clear media keys: ${e}`),null==(t=this.hls)||t.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${e}`)})}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{drmSystemOptions:r}=this.config,n=function(e){var t;return"persistent-license"===e.sessionType||!(null==(t=e.sessionTypes)||!t.some((e=>"persistent-license"===e)))}(r)?new Promise(((e,s)=>{self.setTimeout((()=>s(new Error("MediaKeySession.remove() timeout"))),8e3),t.remove().then(e)})):Promise.resolve();return n.catch((e=>{var t;this.log(`Could not remove session: ${e}`),null==(t=this.hls)||t.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${e}`)})})).then((()=>t.close())).catch((e=>{var t;this.log(`Could not close session: ${e}`),null==(t=this.hls)||t.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${e}`)})}))}}}dn.CDMCleanupPromise=void 0;class un extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function pn(e,t){let s;try{s=new Event("addtrack")}catch(e){s=document.createEvent("Event"),s.initEvent("addtrack",!1,!1)}s.track=e,t.dispatchEvent(s)}function fn(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(s){L.debug(`[texttrack-utils]: ${s}`);try{const s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,e.addCue(s)}catch(e){L.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===s&&(e.mode=s)}function gn(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues)for(let s=e.cues.length;s--;)t&&e.cues[s].removeEventListener("enter",t),e.removeCue(e.cues[s]);"disabled"===s&&(e.mode=s)}function mn(e,t,s,i){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=function(e,t,s){const i=[],r=function(e,t){if(t<=e[0].startTime)return 0;const s=e.length-1;if(t>e[s].endTime)return-1;let i,r=0,n=s;for(;r<=n;)if(i=Math.floor((n+r)/2),t<e[i].startTime)n=i-1;else{if(!(t>e[i].startTime&&r<s))return i;r=i+1}return e[r].startTime-t<t-e[n].startTime?r:n}(e,t);if(r>-1)for(let n=r,a=e.length;n<a;n++){const r=e[n];if(r.startTime>=t&&r.endTime<=s)i.push(r);else if(r.startTime>s)return i}return i}(e.cues,t,s);for(let t=0;t<r.length;t++)i&&!i(r[t])||e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}function yn(e){const t=[];for(let s=0;s<e.length;s++){const i=e[s];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[s])}return t}function vn(e){let t=5381,s=e.length;for(;s;)t=33*t^e.charCodeAt(--s);return(t>>>0).toString()}const _n=.025;let bn=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function Tn(e,t,s){return`${e.identifier}-${s+1}-${vn(t)}`}class An{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){if(e>=this.assetList.length)return!0;const t=this.playoutLimit;return!(e<=0||isNaN(t))&&this.assetList[e].startOffset>t}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return En(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-En(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=i(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return En(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<_n))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?bn.Range:bn.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return`["${(e=this).identifier}" ${e.cue.pre?"<pre>":e.cue.post?"<post>":""}${e.timelineStart.toFixed(2)}-${e.resumeTime.toFixed(2)}]`;var e}}function En(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<_n)?t.start:t.start+t.duration}function Sn(e,t,s){const i=new self.URL(e,s);return"data:"!==i.protocol&&i.searchParams.set("_HLS_primary_id",t),i}function Cn(e){const t=e.timelineStart,s=e.duration||0;return`["${e.identifier}" ${t.toFixed(2)}-${(t+s).toFixed(2)}]`}class wn{constructor(e,t,s,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const e=this.interstitial.playoutLimit,t=this.currentTime;this.startOffset+t>=e&&this.hls.trigger(l.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=i;let n=i.uri;try{n=Sn(n,r.sessionId).href}catch(e){}r.loadSource(n);const a=()=>{this.hasDetails=!0};r.once(l.LEVEL_LOADED,a),r.once(l.AUDIO_TRACK_LOADED,a),r.once(l.SUBTITLE_TRACK_LOADED,a),r.on(l.MEDIA_ATTACHING,((e,{media:t})=>{this.removeMediaListeners(),this.mediaAttached=t,this.interstitial.playoutLimit&&t.addEventListener("timeupdate",this.checkPlayout)}))}bufferedInPlaceToEnd(e){var t;if(!this.interstitial.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const s=this.timelineOffset,i=Pt.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=this._bufferedEosTime-.02}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Pt.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){return this.assetItem.duration||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(e,t,s){this.hls.on(e,t)}once(e,t,s){this.hls.once(e,t)}off(e,t,s){this.hls.off(e,t)}toString(){var e,t;return`HlsAssetPlayer: ${Cn(this.assetItem)} ${null==(e=this.hls)?void 0:e.sessionId} ${null!=(t=this.interstitial)&&t.appendInPlace?"append-in-place":""}`}}class kn extends A{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach((e=>e.reset())),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce(((s,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,s+1):s),0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[s]||(void 0===t&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&null!=(r=i[s])&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let i=0;i<s.length;i++){let r=s[i];if(t&&"primary"!==t&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let i=e;i<=t&&s[i];i++){const e=s[i].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var s;if((null==(s=t[i].event)?void 0:s.identifier)===e)return i}return-1}findAssetIndex(e,t){const s=e.assetList,i=s.length;if(i>1)for(let e=0;e<i;e++){const i=s[e];if(!i.error){const s=i.timelineStart;if(t===s||t>s&&t<s+(i.duration||0))return e}}return 0}get assetIdAtEnd(){var e,t;const s=null==(e=this.items)||null==(t=e[this.length-1])?void 0:t.event;if(s){const e=s.assetList,t=e[e.length-1];if(t)return t.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:i}=s,r=this.events,n=this.parseDateRanges(i,{url:s.url},t),a=Object.keys(i),o=r?r.filter((e=>!a.includes(e.identifier))):[];n.length&&n.sort(((e,t)=>{const s=e.cue.pre,i=e.cue.post,r=t.cue.pre,n=t.cue.post;if(s&&!r)return-1;if(r&&!s)return 1;if(i&&!n)return 1;if(n&&!i)return-1;if(!(s||r||i||n)){const s=e.startTime,i=t.startTime;if(s!==i)return s-i}return e.dateRange.tagOrder-t.dateRange.tagOrder})),this.events=n,o.forEach((e=>{this.removeEvent(e)})),this.updateSchedule(e,o)}updateSchedule(e,t=[]){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,r=this.parseSchedule(s,e);(t.length||(null==i?void 0:i.length)!==r.length||r.some(((e,t)=>Math.abs(e.playout.start-i[t].playout.start)>.005||Math.abs(e.playout.end-i[t].playout.end)>.005)))&&(this.items=r,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,s){const i=[],r=Object.keys(e);for(let n=0;n<r.length;n++){const a=r[n],o=e[a];if(o.isInterstitial){let e=this.eventMap[a];e?e.setDateRange(o):(e=new An(o,t),this.eventMap[a]=e,!1===s&&(e.appendInPlace=s)),i.push(e)}}return i}parseSchedule(e,t){const s=[],i=t.main.details,r=i.live?1/0:i.edge;let n=0;if((e=e.filter((e=>!(e.error||e.cue.once&&e.hasPlayed)))).length){this.resolveOffsets(e,t);let i=0,o=0;if(e.forEach(((t,a)=>{const l=t.cue.pre,h=t.cue.post,c=e[a-1]||null,d=t.appendInPlace,u=h?r:t.startOffset,p=t.duration,f=t.timelineOccupancy===bn.Range?p:0,g=t.resumptionOffset,m=(null==c?void 0:c.startTime)===u,y=u+t.cumulativeDuration;let v=d?y+p:u+g;if(l||!h&&u<=0){const e=o;o+=f,t.timelineStart=y;const i=n;n+=p,s.push({event:t,start:y,end:v,playout:{start:i,end:n},integrated:{start:e,end:o}})}else{if(!(u<=r))return;{if(!m){const r=u-i;if(r>.033){const l=i,h=o;o+=r;const c=n;n+=r;const d={previousEvent:e[a-1]||null,nextEvent:t,start:l,end:l+r,playout:{start:c,end:n},integrated:{start:h,end:o}};s.push(d)}else r>0&&c&&(c.cumulativeDuration+=r,s[s.length-1].end=u)}h&&(v=y),t.timelineStart=y;const r=o;o+=f;const l=n;n+=p,s.push({event:t,start:y,end:v,playout:{start:l,end:n},integrated:{start:r,end:o}})}}const _=t.resumeTime;i=h||_>r?r:_})),i<r){var a;const e=i,t=o,l=r-i;o+=l;const h=n;n+=l,s.push({previousEvent:(null==(a=s[s.length-1])?void 0:a.event)||null,nextEvent:null,start:i,end:e+l,playout:{start:h,end:n},integrated:{start:t,end:o}})}this.setDurations(r,n,o)}else{const e=0;s.push({previousEvent:null,nextEvent:null,start:e,end:r,playout:{start:e,end:r},integrated:{start:e,end:r}}),this.setDurations(r,r,r)}return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,r=s.live?1/0:s.edge;let n=0,a=-1;e.forEach(((o,l)=>{const h=o.cue.pre,c=o.cue.post,d=h?0:c?r:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=n:(n=0,a=d),!c&&o.snapOptions.in&&(o.resumeAnchor=et(null,s.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<.033&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const u=i(o.resumeOffset)?o.resumeOffset:o.duration;n+=u}))}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(s-i)>_n?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${i}`),!1):t?!Object.keys(t).some((i=>{const r=t[i].details,n=r.edge;if(s>=n)return this.log(`"${e.identifier}" resumption ${s} past ${i} playlist end ${n}`),!1;const a=et(null,r.fragments,s);if(!a)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${i} playlist (${r.fragStart}-${r.fragmentEnd})`),!0;const o="audio"===i?.175:0;return!(Math.abs(a.start-s)<_n+o||Math.abs(a.end-s)<_n+o||(this.log(`"${e.identifier}" resumption ${s} not aligned with ${i} fragment bounds (${a.start}-${a.end} sn: ${a.sn} cc: ${a.cc})`),0))})):(this.log(`"${e.identifier}" resumption ${s} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,i=!1,r=!1;e.assetList.forEach(((e,n)=>{const a=t+s;e.startOffset=s,e.timelineStart=a,i||(i=null===e.duration),r||(r=!!e.error);const o=e.error?0:e.duration||0;s+=o})),e.duration=i&&!r?Math.max(s,e.duration):s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ln(e){return`[${e.event?'"'+e.event.identifier+'"':"primary"}: ${e.start.toFixed(2)}-${e.end.toFixed(2)}]`}class In{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let i;try{i=Sn(s,this.hls.sessionId,e.baseUrl)}catch(t){const i=this.assignAssetListError(e,o.ASSET_LIST_LOAD_ERROR,t,s);return void this.hls.trigger(l.ERROR,i)}t&&"data:"!==i.protocol&&i.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,n=new(0,r.loader)(r),a={responseType:"json",url:i.href},h=r.interstitialAssetListLoadPolicy.default,c={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(t,s,i,r)=>{const n=t.data,a=null==n?void 0:n.ASSETS;if(Array.isArray(a))e.assetListResponse=n,this.hls.trigger(l.ASSET_LIST_LOADED,{event:e,assetListResponse:n,networkDetails:r});else{const t=this.assignAssetListError(e,o.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),i.url,s,r);this.hls.trigger(l.ERROR,t)}},onError:(t,s,i,r)=>{const n=this.assignAssetListError(e,o.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${t.code} ${t.text} (${s.url})`),s.url,r,i);this.hls.trigger(l.ERROR,n)},onTimeout:(t,s,i)=>{const r=this.assignAssetListError(e,o.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${s.url})`),s.url,t,i);this.hls.trigger(l.ERROR,r)}};return n.load(a,c,d),this.hls.trigger(l.ASSET_LIST_LOADING,{event:e}),n}assignAssetListError(e,t,s,i,r,n){return e.error=s,{type:a.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:s,networkDetails:n,stats:r}}}function Pn(e,t,s){Rn(e,t,s),e.addEventListener(t,s)}function Rn(e,t,s){e.removeEventListener(t,s)}function xn(e){null==e||e.play().catch((()=>{}))}class Dn{constructor(e){this.buffered=void 0;const t=(t,s,i)=>{if((s>>>=0)>i-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][t]};this.buffered={get length(){return e.length},end:s=>t("end",s,e.length),start:s=>t("start",s,e.length)}}}const On={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Mn=e=>String.fromCharCode(On[e]||e),Nn=15,Fn=100,Bn={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},jn={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Un={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},$n={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Hn=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Vn{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s="function"==typeof t?t():t;L.log(`${this.time} [${e}] ${s}`)}}}const Gn=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class Wn{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const i=t[s];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class zn{constructor(){this.uchar=" ",this.penState=new Wn}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Kn{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Wn,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<Fn;e++)this.chars.push(new zn);this.logger=e}equals(e){for(let t=0;t<Fn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Fn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Fn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Fn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Fn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Mn(e);this.pos>=Fn?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Fn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<Fn;s++){const i=this.chars[s].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class qn{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Nn;t++)this.rows.push(new Kn(e));this.logger=e}reset(){for(let e=0;e<Nn;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let s=0;s<Nn;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Nn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Nn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,(()=>"pacData = "+Ge(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<Nn;e++)this.rows[e].clear();const e=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){const i=s.rows[e].cueStartTime,r=this.logger.time;if(null!==i&&null!==r&&i<r)for(let i=0;i<this.nrRollUpRows;i++)this.rows[t-this.nrRollUpRows+i+1].copy(s.rows[e+i])}}this.currRow=t;const s=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,i=Math.max(t-1,0);s.setCursor(e.indent),e.color=s.chars[i].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,(()=>"bkgData = "+Ge(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",i=-1;for(let s=0;s<Nn;s++){const r=this.rows[s].getTextString();r&&(i=s+1,e?t.push("Row "+i+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(s=e?"["+t.join(" | ")+"]":t.join("\n")),s}getTextAndFormat(){return this.rows}}class Yn{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new qn(s),this.nonDisplayedMemory=new qn(s),this.lastOutputScreen=new qn(s),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[s]}this.logger.log(2,"MIDROW: "+Ge(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Xn{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const i=this.logger=new Vn;this.channels=[null,new Yn(e,t,i),new Yn(e+1,s,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let e=0;e<t.length;e+=2){const s=127&t[e],i=127&t[e+1];let r=!1,n=null;if(0===s&&0===i)continue;this.logger.log(3,(()=>"["+Gn([t[e],t[e+1]])+"] -> ("+Gn([s,i])+")"));const a=this.cmdHistory;if(s>=16&&s<=31){if(Zn(s,i,a)){Qn(null,null,a),this.logger.log(3,(()=>"Repeated command ("+Gn([s,i])+") is dropped"));continue}Qn(s,i,this.cmdHistory),r=this.parseCmd(s,i),r||(r=this.parseMidrow(s,i)),r||(r=this.parsePAC(s,i)),r||(r=this.parseBackgroundAttributes(s,i))}else Qn(null,null,a);if(!r&&(n=this.parseChars(s,i),n)){const e=this.currentChannel;e&&e>0?this.channels[e].insertChars(n):this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||n||this.logger.log(2,(()=>"Couldn't parse cleaned data "+Gn([s,i])+" orig: "+Gn([t[e],t[e+1]])))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;const s=20===e||21===e||23===e?1:2,i=this.channels[s];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let s=0;if((17===e||25===e)&&t>=32&&t<=47){if(s=17===e?1:2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[s];return!!i&&(i.ccMIDROW(t),this.logger.log(3,(()=>"MIDROW ("+Gn([e,t])+")")),!0)}return!1}parsePAC(e,t){let s;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;const i=e<=23?1:2;s=t>=64&&t<=95?1===i?Bn[e]:Un[e]:1===i?jn[e]:$n[e];const r=this.channels[i];return!!r&&(r.setPAC(this.interpretPAC(s,t)),this.currentChannel=i,!0)}interpretPAC(e,t){let s;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return s=t>95?t-96:t-64,i.underline=!(1&~s),s<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((s-16)/2),i}parseChars(e,t){let s,i=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,(()=>"Special char '"+Mn(e)+"' in channel "+s)),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);return i&&this.logger.log(3,(()=>"Char codes =  "+Gn(i).join(","))),i}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;let s;const i={};16===e||24===e?(s=Math.floor((t-32)/2),i.background=Hn[s],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0));const r=e<=23?1:2;return this.channels[r].setBkgData(i),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Qn(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function Qn(e,t,s){s.a=e,s.b=t}function Zn(e,t,s){return s.a===e&&s.b===t}var Jn=function(){if(null!=zt&&zt.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function s(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const s=t.toLowerCase();return!!~e.indexOf(s)&&s}function i(e){return s(t,e)}function r(e,...t){let s=1;for(;s<arguments.length;s++){const t=arguments[s];for(const s in t)e[s]=t[s]}return e}function n(t,n,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let h="",c=!1,d=t,u=n,p=a,f=null,g="",m=!0,y="auto",v="start",_=50,b="middle",T=50,A="middle";Object.defineProperty(o,"id",r({},l,{get:function(){return h},set:function(e){h=""+e}})),Object.defineProperty(o,"pauseOnExit",r({},l,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(o,"startTime",r({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},l,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},l,{get:function(){return p},set:function(e){p=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},l,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},l,{get:function(){return g},set:function(t){const i=function(t){return s(e,t)}(t);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");g=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},l,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},l,{get:function(){return v},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},l,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},l,{get:function(){return b},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},l,{get:function(){return T},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},l,{get:function(){return A},set:function(e){const t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");A=t,this.hasBeenReset=!0}})),o.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();class ea{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ta(e){function t(e,t,s,i){return 3600*(0|e)+60*(0|t)+(0|s)+parseFloat(i||0)}const s=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return s?parseFloat(s[2])>59?t(s[2],s[3],0,s[4]):t(s[1],s[2],s[3],s[4]):null}class sa{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let i=0;i<s.length;++i)if(t===s[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function ia(e,t,s,i){const r=i?e.split(i):[e];for(const e in r){if("string"!=typeof r[e])continue;const i=r[e].split(s);2===i.length&&t(i[0],i[1])}}const ra=new Jn(0,0,""),na="middle"===ra.align?"middle":"center";function aa(e,t,s){const i=e;function r(){const t=ta(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function n(){e=e.replace(/^\s+/,"")}if(n(),t.startTime=r(),n(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),n(),t.endTime=r(),n(),function(e,t){const i=new sa;ia(e,(function(e,t){let r;switch(e){case"region":for(let r=s.length-1;r>=0;r--)if(s[r].id===t){i.set(e,s[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),i.integer(e,r[0]),i.percent(e,r[0])&&i.set("snapToLines",!1),i.alt(e,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",na,"end"]);break;case"position":r=t.split(","),i.percent(e,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",na,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",na,"end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let r=i.get("line","auto");"auto"===r&&-1===ra.line&&(r=-1),t.line=r,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",na);let n=i.get("position","auto");"auto"===n&&50===ra.position&&(n="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=n}(e,t)}function oa(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class la{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new ea,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function s(){let e=t.buffer,s=0;for(e=oa(e);s<e.length&&"\r"!==e[s]&&"\n"!==e[s];)++s;const i=e.slice(0,s);return"\r"===e[s]&&++s,"\n"===e[s]&&++s,t.buffer=e.slice(s),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=s();const i=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let i=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(i?i=!1:e=s(),t.state){case"HEADER":/:/.test(e)?ia(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new Jn(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{aa(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const s=-1!==e.indexOf("--\x3e");if(!e||s&&(i=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const ha=/\r\n|\n\r|\n|\r/g,ca=function(e,t,s=0){return e.slice(s,s+t.length)===t};function da(e,t,s){return vn(e.toString())+vn(t.toString())+vn(s)}const ua="stpp.ttml.im1t",pa=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,fa=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,ga={left:"start",center:"center",right:"end",start:"start",end:"end"};function ma(e,t,s,i){const r=te(new Uint8Array(e),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const n=r.map((e=>R(e))),a=function(e,t,s=1,i=!1){return Zi(e,t,1/s,i)}(t.baseTime,1,t.timescale);try{n.forEach((e=>s(function(e,t){const s=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},r=Object.keys(i).reduce(((e,t)=>(e[t]=s.getAttribute(`ttp:${t}`)||i[t],e)),{}),n="preserve"!==s.getAttribute("xml:space"),a=va(ya(s,"styling","style")),o=va(ya(s,"layout","region")),l=ya(s,"body","[begin]");return[].map.call(l,(e=>{const s=_a(e,n);if(!s||!e.hasAttribute("begin"))return null;const i=Aa(e.getAttribute("begin"),r),l=Aa(e.getAttribute("dur"),r);let h=Aa(e.getAttribute("end"),r);if(null===i)throw Ta(e);if(null===h){if(null===l)throw Ta(e);h=i+l}const c=new Jn(i-t,h-t,s);c.id=da(c.startTime,c.endTime,c.text);const d=function(e,t,s){const i="http://www.w3.org/ns/ttml#styling";let r=null;const n=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return n&&s.hasOwnProperty(n)&&(r=s[n]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(((s,n)=>{const a=ba(t,i,n)||ba(e,i,n)||ba(r,i,n);return a&&(s[n]=a),s}),{})}(o[e.getAttribute("region")],a[e.getAttribute("style")],a),{textAlign:u}=d;if(u){const e=ga[u];e&&(c.lineAlign=e),c.align=u}return _(c,d),c})).filter((e=>null!==e))}(e,a))))}catch(e){i(e)}}function ya(e,t,s){const i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(s)):[]}function va(e){return e.reduce(((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e}),{})}function _a(e,t){return[].slice.call(e.childNodes).reduce(((e,s,i)=>{var r;return"br"===s.nodeName&&i?e+"\n":null!=(r=s.childNodes)&&r.length?_a(s,t):t?e+s.textContent.trim().replace(/\s+/g," "):e+s.textContent}),"")}function ba(e,t,s){return e&&e.hasAttributeNS(t,s)?e.getAttributeNS(t,s):null}function Ta(e){return new Error(`Could not parse ttml timestamp ${e}`)}function Aa(e,t){if(!e)return null;let s=ta(e);return null===s&&(pa.test(e)?s=function(e,t){const s=pa.exec(e),i=(0|s[4])+(0|s[5])/t.subFrameRate;return 3600*(0|s[1])+60*(0|s[2])+(0|s[3])+i/t.frameRate}(e,t):fa.test(e)&&(s=function(e,t){const s=fa.exec(e),i=Number(s[1]);switch(s[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),s}class Ea{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function Sa(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function Ca(e,t){return!!e&&e.kind===Sa(t)&&br(t,e)}const wa=/\s/,ka={newCue(e,t,s,i){const r=[];let n,a,o,l,h;const c=self.VTTCue||self.TextTrackCue;for(let u=0;u<i.rows.length;u++)if(n=i.rows[u],o=!0,l=0,h="",!n.isEmpty()){var d;for(let e=0;e<n.chars.length;e++)wa.test(n.chars[e].uchar)&&o?l++:(h+=n.chars[e].uchar,o=!1);n.cueStartTime=t,t===s&&(s+=1e-4),l>=16?l--:l++;const i=oa(h.trim()),p=da(t,s,i);null!=e&&null!=(d=e.cues)&&d.getCueById(p)||(a=new c(t,s,i),a.id=p,a.line=u+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(a))}return e&&r.length&&(r.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),r.forEach((t=>fn(e,t)))),r}},La=/(\d+)-(\d+)\/(\d+)/;class Ia{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Pa,this.controller=new self.AbortController,this.stats=new F}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const n=function(e,t){const s={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(_({},e.headers))};return e.rangeEnd&&s.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),s}(e,this.controller.signal),a="arraybuffer"===e.responseType,o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:h}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=l&&i(l)?l:h,this.requestTimeout=self.setTimeout((()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))}),t.timeout),(ur(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then((s=>{var n;this.response=this.loader=s;const o=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=h,this.requestTimeout=self.setTimeout((()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))}),h-(o-r.loading.start)),!s.ok){const{status:e,statusText:t}=s;throw new Ra(t||"fetch, bad network response",e,s)}r.loading.first=o,r.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=La.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(i(e))return e}const s=e.get("Content-Length");if(s)return parseInt(s)}(s.headers)||r.total;const l=null==(n=this.callbacks)?void 0:n.onProgress;return l&&i(t.highWaterMark)?this.loadProgressively(s,r,e,t.highWaterMark,l):a?s.arrayBuffer():"json"===e.responseType?s.json():s.text()})).then((s=>{var n,a;const l=this.response;if(!l)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const h=s[o];h&&(r.loaded=r.total=h);const c={url:l.url,data:s,code:l.status},d=null==(n=this.callbacks)?void 0:n.onProgress;d&&!i(t.highWaterMark)&&d(r,e,s,l),null==(a=this.callbacks)||a.onSuccess(c,r,e,l)})).catch((t=>{var s;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const i=t&&t.code||0,n=t?t.message:null;null==(s=this.callbacks)||s.onError({code:i,text:n},e,t?t.details:null,r)}))}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,i=0,r){const n=new Hs,a=e.body.getReader(),o=()=>a.read().then((a=>{if(a.done)return n.dataLength&&r(t,s,n.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=a.value,h=l.length;return t.loaded+=h,h<i||n.dataLength?(n.push(l),n.dataLength>=i&&r(t,s,n.flush().buffer,e)):r(t,s,l.buffer,e),o()})).catch((()=>Promise.reject()));return o()}}function Pa(e,t){return new self.Request(e.url,t)}class Ra extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const xa=/^age:\s*[\d.]+\s*$/im;class Da{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new F,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then((()=>{if(this.loader===s&&!this.stats.aborted)return r(s,t.url)})).catch((e=>{if(this.loader===s&&!this.stats.aborted)return s.open("GET",t.url,!0),r(s,t.url)})).then((()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)})).catch((e=>{var r;null==(r=this.callbacks)||r.onError({code:s.status,text:e.message},t,s,i)})):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:a}=s.loadPolicy;if(r)for(const t in r)e.setRequestHeader(t,r[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=n&&i(n)?n:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!s.aborted&&i>=2&&(0===s.loading.first&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const i=t.status,l="text"===t.responseType?t.responseText:null;if(i>=200&&i<300){const r=null!=l?l:t.response;if(null!=r){var n,a;s.loading.end=Math.max(self.performance.now(),s.loading.first);const o="arraybuffer"===t.responseType?r.byteLength:r.length;s.loaded=s.total=o,s.bwEstimate=8e3*s.total/(s.loading.end-s.loading.first);const l=null==(n=this.callbacks)?void 0:n.onProgress;l&&l(s,e,r,t);const h={url:t.responseURL,data:r,code:i};return void(null==(a=this.callbacks)||a.onSuccess(h,s,e,t))}}const h=r.loadPolicy.errorRetry;var o;lt(h,s.retry,!1,{url:e.url,data:void 0,code:i})?this.retry(h):(L.error(`${i} while loading ${e.url}`),null==(o=this.callbacks)||o.onError({code:i,text:t.statusText},e,t,s))}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(lt(e,this.stats.retry,!0))this.retry(e);else{var t;L.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=at(e,s.retry),s.retry++,L.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&xa.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Oa=T(T({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Da,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends A{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:s,partCurrent:r,hls:n}=this,{autoLevelEnabled:a,media:o}=n;if(!s||!o)return;const h=performance.now(),c=r?r.stats:s.stats,d=r?r.duration:s.duration,u=h-c.loading.start,p=n.minAutoLevel,f=s.level,g=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||f<=p)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!a)return;const m=g>-1&&g!==f,y=!!e||m;if(!y&&(o.paused||!o.playbackRate||!o.readyState))return;const v=n.mainForwardBufferInfo;if(!y&&null===v)return;const _=this.bwEstimator.getEstimateTTFB(),b=Math.abs(o.playbackRate);if(u<=Math.max(_,d/(2*b)*1e3))return;const T=v?v.len/b:0,A=c.loading.first?c.loading.first-c.loading.start:-1,E=c.loaded&&A>-1,S=this.getBwEstimate(),C=n.levels,w=C[f],k=Math.max(c.loaded,Math.round(d*(s.bitrate||w.averageBitrate)/8));let L=E?u-A:u;L<1&&E&&(L=Math.min(u,8*c.loaded/S));const I=E?1e3*c.loaded/L:0,P=_/1e3,R=I?(k-c.loaded)/I:8*k/S+P;if(R<=T)return;const x=I?8*I:S,D=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),O=this.hls.config.abrBandWidthUpFactor;let M,N=Number.POSITIVE_INFINITY;for(M=f-1;M>p;M--){const e=C[M].maxBitrate,t=!C[M].details||D;if(N=this.getTimeToLoadFrag(P,x,d*e,t),N<Math.min(T,d+P))break}if(N>=R)return;if(N>10*d)return;E?this.bwEstimator.sample(u-Math.min(_,A),c.loaded):this.bwEstimator.sampleTTFB(u);const F=C[M].maxBitrate;this.getBwEstimate()*O>F&&this.resetEstimator(F);const B=this.findBestLevel(F,p,M,0,T,1,1);B>-1&&(M=B),this.warn(`Fragment ${s.sn}${r?" part "+r.index:""} of level ${f} is loading too slowly;\n      Fragment duration: ${s.duration.toFixed(3)}\n      Time to underbuffer: ${T.toFixed(3)} s\n      Estimated load time for current fragment: ${R.toFixed(3)} s\n      Estimated load time for down switch fragment: ${N.toFixed(3)} s\n      TTFB estimate: ${0|A} ms\n      Current BW estimate: ${i(S)?0|S:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${M} @ ${0|F} bps`),n.nextLoadLevel=n.nextAutoLevel=M,this.clearTimer();const j=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===M&&M>0){const e=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${M>0?"and switching down":""}\n      Fragment duration: ${s.duration.toFixed(3)} s\n      Time to underbuffer: ${e.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,M>p){let t=this.findBestLevel(this.hls.levels[p].bitrate,p,M,0,e,1,1);-1===t&&(t=p),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};m||R>2*N?j():this.timer=self.setInterval(j,1e3*N),n.trigger(l.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:r,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new y(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.FRAG_LOADING,this.onFragLoading,this),e.on(l.FRAG_LOADED,this.onFragLoaded,this),e.on(l.FRAG_BUFFERED,this.onFragBuffered,this),e.on(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(l.LEVEL_LOADED,this.onLevelLoaded,this),e.on(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(l.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.FRAG_LOADING,this.onFragLoading,this),e.off(l.FRAG_LOADED,this.onFragLoaded,this),e.off(l.FRAG_BUFFERED,this.onFragBuffered,this),e.off(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(l.LEVEL_LOADED,this.onLevelLoaded,this),e.off(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(l.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(l.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;var i;this.ignoreFragment(s)||(s.bitrateTest||(this.fragCurrent=s,this.partCurrent=null!=(i=t.part)?i:null),this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100))}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case o.BUFFER_ADD_CODEC_ERROR:case o.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case o.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:s,partCurrent:i}=this;if(e&&s&&e.sn===s.sn&&e.level===s.level){const t=performance.now(),s=i?i.stats:e.stats,r=t-s.loading.start,n=s.loading.first?s.loading.first-s.loading.start:-1;if(s.loaded&&n>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(e,n),s.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}getTimeToLoadFrag(e,t,s,i){return e+s/t+(i?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const s=this.hls.config,{loading:r}=t.stats,n=r.end-r.first;i(n)&&(this.lastLevelLoadSec=n/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const i=s?s.stats:t.stats;if(t.type===p&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=s?s.duration:t.duration,r=this.hls.levels[t.level],n=(r.loaded?r.loaded.bytes:0)+i.loaded,a=(r.loaded?r.loaded.duration:0)+e;r.loaded={bytes:n,duration:a},r.realBitrate=Math.round(8*n/a)}if(t.bitrateTest){const e={stats:i,frag:t,part:s,id:t.type};this.onFragBuffered(l.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:i}=t,r=null!=i&&i.stats.loaded?i.stats:s.stats;if(r.aborted)return;if(this.ignoreFragment(s))return;const n=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==p||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,i,1,1);if(r>-1)return r;const n=this.hls.firstLevel,a=Math.min(Math.max(n,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${n} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&s&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const i=t&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:n}=s,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let h=r.abrBandWidthFactor,c=r.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,n,i,l,0,h,c);if(e>=0)return this.rebufferNotice=-1,e}let d=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;e&&(d=(a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay)-e,this.info(`bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*d)} ms`),h=c=1)}const u=this.findBestLevel(o,n,i,l,d,h,c);if(this.rebufferNotice!==u&&(this.rebufferNotice=u,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${u}`)),u>-1)return u;const p=s.levels[n],f=s.loadLevelObj;return f&&(null==p?void 0:p.bitrate)<f.bitrate?n:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,r,n,a,o){var l;const h=r+n,c=this.lastLoadedFragLevel,d=-1===c?this.hls.firstLevel:c,{fragCurrent:u,partCurrent:p}=this,{levels:f,allAudioTracks:g,loadLevel:m,config:y}=this.hls;if(1===f.length)return 0;const v=f[d],_=!(null==(l=this.hls.latestLevelDetails)||!l.live),b=-1===m||-1===c;let T,A="SDR",E=(null==v?void 0:v.frameRate)||0;const{audioPreference:S,videoPreference:C}=y,w=this.audioTracksByGroup||(this.audioTracksByGroup=ze(g));let k=-1;if(b){if(-1!==this.firstSelection)return this.firstSelection;const r=this.codecTiers||(this.codecTiers=function(e,t,s,i){return e.slice(s,i+1).reduce(((e,s,i)=>{if(!s.codecSet)return e;const r=s.audioGroups;let n=e[s.codecSet];n||(e[s.codecSet]=n={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),n.minBitrate=Math.min(n.minBitrate,s.bitrate);const a=Math.min(s.height,s.width);return n.minHeight=Math.min(n.minHeight,a),n.minFramerate=Math.min(n.minFramerate,s.frameRate),n.minIndex=Math.min(n.minIndex,i),n.maxScore=Math.max(n.maxScore,s.score),n.fragmentError+=s.fragmentError,n.videoRanges[s.videoRange]=(n.videoRanges[s.videoRange]||0)+1,r&&r.forEach((e=>{if(!e)return;const s=t.groups[e];s&&(n.hasDefaultAudio=n.hasDefaultAudio||t.hasDefaultAudio?s.hasDefault:s.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(s.channels).forEach((e=>{n.channels[e]=(n.channels[e]||0)+s.channels[e]})))})),e}),{})}(f,w,t,s)),n=function(e,t,s,r,n){const a=Object.keys(e),o=null==r?void 0:r.channels,l=null==r?void 0:r.audioCodec,h=null==n?void 0:n.videoCodec,c=o&&2===parseInt(o);let d=!1,u=!1,p=1/0,f=1/0,g=1/0,m=1/0,y=0,v=[];const{preferHDR:_,allowedVideoRanges:b}=function(e,t){let s=!1,i=[];if(e&&(s="SDR"!==e,i=[e]),t){i=t.allowedVideoRanges||je.slice(0);const e="SDR"!==i.join("")&&!t.videoCodec;s=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),s||(i=["SDR"])}return{preferHDR:s,allowedVideoRanges:i}}(t,n);for(let t=a.length;t--;){const s=e[a[t]];d||(d=s.channels[2]>0),p=Math.min(p,s.minHeight),f=Math.min(f,s.minFramerate),g=Math.min(g,s.minBitrate),b.filter((e=>s.videoRanges[e]>0)).length>0&&(u=!0)}p=i(p)?p:0,f=i(f)?f:0;const T=Math.max(1080,p),A=Math.max(30,f);g=i(g)?g:s,s=Math.max(g,s),u||(t=void 0);const E=a.length>1;return{codecSet:a.reduce(((t,i)=>{const r=e[i];if(i===t)return t;if(v=u?b.filter((e=>r.videoRanges[e]>0)):[],E){if(r.minBitrate>s)return We(i,`min bitrate of ${r.minBitrate} > current estimate of ${s}`),t;if(!r.hasDefaultAudio)return We(i,"no renditions with default or auto-select sound found"),t;if(l&&i.indexOf(l.substring(0,4))%5!=0)return We(i,`audio codec preference "${l}" not found`),t;if(o&&!c){if(!r.channels[o])return We(i,`no renditions with ${o} channel sound found (channels options: ${Object.keys(r.channels)})`),t}else if((!l||c)&&d&&0===r.channels[2])return We(i,"no renditions with stereo sound found"),t;if(r.minHeight>T)return We(i,`min resolution of ${r.minHeight} > maximum of ${T}`),t;if(r.minFramerate>A)return We(i,`min framerate of ${r.minFramerate} > maximum of ${A}`),t;if(!v.some((e=>r.videoRanges[e]>0)))return We(i,`no variants with VIDEO-RANGE of ${Ge(v)} found`),t;if(h&&i.indexOf(h.substring(0,4))%5!=0)return We(i,`video codec preference "${h}" not found`),t;if(r.maxScore<y)return We(i,`max score of ${r.maxScore} < selected max of ${y}`),t}return t&&(Ce(i)>=Ce(t)||r.fragmentError>e[t].fragmentError)?t:(m=r.minIndex,y=r.maxScore,i)}),void 0),videoRanges:v,preferHDR:_,minFramerate:f,minBitrate:g,minIndex:m}}(r,A,e,S,C),{codecSet:a,videoRanges:o,minFramerate:l,minBitrate:h,minIndex:c,preferHDR:d}=n;k=c,T=a,A=d?o[o.length-1]:o[0],E=l,e=Math.max(e,h),this.log(`picked start tier ${Ge(n)}`)}else T=null==v?void 0:v.codecSet,A=null==v?void 0:v.videoRange;const L=p?p.duration:u?u.duration:0,I=this.bwEstimator.getEstimateTTFB()/1e3,P=[];for(let l=s;l>=t;l--){var R;const t=f[l],u=l>d;if(!t)continue;if(y.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const s=navigator.mediaCapabilities;"function"==typeof(null==s?void 0:s.decodingInfo)&&(Ne(t,w,A,E,e,S)||pe(t.videoCodec))?(t.supportedPromise=Fe(t,w,s),t.supportedPromise.then((e=>{if(!this.hls)return;t.supportedResult=e;const s=this.hls.levels,i=s.indexOf(t);e.error?this.warn(`MediaCapabilities decodingInfo error: "${e.error}" for level ${i} ${Ge(e)}`):e.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${i} ${Ge(e)}`),i>-1&&s.length>1&&(this.log(`Removing unsupported level ${i}`),this.hls.removeLevel(i),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}))):t.supportedResult=De}if((T&&t.codecSet!==T||A&&t.videoRange!==A||u&&E>t.frameRate||!u&&E>0&&E<t.frameRate||t.supportedResult&&(null==(R=t.supportedResult.decodingInfoResults)||!R[0].smooth))&&(!b||l!==k)){P.push(l);continue}const g=t.details,v=(p?null==g?void 0:g.partTarget:null==g?void 0:g.averagetargetduration)||L;let C;C=u?o*e:a*e;const x=L&&r>=2*L&&0===n?t.averageBitrate:t.maxBitrate,D=this.getTimeToLoadFrag(I,C,x*v,void 0===g);if(C>=x&&(l===c||0===t.loadError&&0===t.fragmentError)&&(D<=I||!i(D)||_&&!this.bitrateTestDelay||D<h)){const e=this.forcedAutoLevel;return l===m||-1!==e&&e===m||(P.length&&this.trace(`Skipped level(s) ${P.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${f[P[0]].codecs}" ${f[P[0]].videoRange}; not compatible with "${T}" ${A}`),this.info(`switch candidate:${d}->${l} adjustedbw(${Math.round(C)})-bitrate=${Math.round(C-x)} ttfb:${I.toFixed(1)} avgDuration:${v.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${D.toFixed(1)} firstSelection:${b} codecSet:${t.codecSet} videoRange:${t.videoRange} hls.loadLevel:${m}`)),b&&(this.firstSelection=l),l}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}},bufferController:class extends A{constructor(e,t){var s;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:s}=this;e&&this.log("Media source opened"),t&&s&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(l.MEDIA_ATTACHED,{media:t,mediaSource:s}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=(s=I(e.config.preferManagedMediaSource),"undefined"!=typeof self&&s===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.BUFFER_RESET,this.onBufferReset,this),e.on(l.BUFFER_APPENDING,this.onBufferAppending,this),e.on(l.BUFFER_CODECS,this.onBufferCodecs,this),e.on(l.BUFFER_EOS,this.onBufferEos,this),e.on(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(l.FRAG_PARSED,this.onFragParsed,this),e.on(l.FRAG_CHANGED,this.onFragChanged,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.BUFFER_RESET,this.onBufferReset,this),e.off(l.BUFFER_APPENDING,this.onBufferAppending,this),e.off(l.BUFFER_CODECS,this.onBufferCodecs,this),e.off(l.BUFFER_EOS,this.onBufferEos,this),e.off(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(l.FRAG_PARSED,this.onFragParsed,this),e.off(l.FRAG_CHANGED,this.onFragChanged,this),e.off(l.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn(`Transfering MediaSource with${t?" operations in queue":""}${e?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?_(s,i.tracks):this.sourceBuffers.forEach((e=>{const[t]=e;t&&(s[t]=_({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null})),{media:e,mediaSource:t,tracks:s}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),null!=(s=this.transferData)&&s.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media,i=I(this.appendSource);if(this.transferData=this.overrides=void 0,s&&i){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const r=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(r),e)this._objectUrl=s.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(r);if(this.appendSource)try{s.removeAttribute("src");const t=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||t&&r instanceof t,Cr(s),function(e,t){const s=self.document.createElement("source");s.type="video/mp4",s.src=t,e.appendChild(s)}(s,e),s.load()}catch(t){s.src=e}else s.src=e}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${(null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${null==(s=e.constructor)?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,i=t.tracks,r=i?Object.keys(i):null,n=r?r.length:0,a=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(i&&r&&n){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})\nrequired tracks: ${Ge(s,((e,t)=>"initSegment"===e?void 0:t))};\ntransfer tracks: ${Ge(i,((e,t)=>"initSegment"===e?void 0:t))}}`),!P(i,s)){t.mediaSource=null,t.tracks=void 0;const r=e.currentTime,n=this.details,a=Math.max(r,(null==n?void 0:n.fragments[0].start)||0);return a-r>1?void this.log(`attachTransferred: waiting for playback to reach new tracks start time ${r} -> ${a}`):(this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(s)}") start time: ${a} currentTime: ${r}`),this.onMediaDetaching(l.MEDIA_DETACHING,{}),this.onMediaAttaching(l.MEDIA_ATTACHING,t),void(e.currentTime=a))}this.transferData=void 0,r.forEach((e=>{const t=e,s=i[t];if(s){const e=s.buffer;if(e){const i=this.fragmentTracker,r=s.id;if(i.hasFragments(r)||i.hasParts(r)){const s=Pt.getBuffered(e);i.detectEvictedFragments(t,s,r,null,!0)}const n=wr(t),a=[t,e];this.sourceBuffers[n]=a,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,s)}}})),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:n}=this;if(r){if(this.log("media source "+(s?"transferring":"detaching")),s)this.sourceBuffers.forEach((([e])=>{e&&this.removeBuffer(e)})),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===r.readyState;try{const t=r.sourceBuffers;for(let s=t.length;s--;)e&&t[s].abort(),r.removeSourceBuffer(t[s]);e&&r.endOfStream()}catch(e){this.warn(`onMediaDetaching: ${e.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),s||(n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(i.removeAttribute("src"),this.appendSource&&Cr(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(l.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach((([e])=>{e&&this.resetBuffer(e)})),this.initTracks()}resetBuffer(e){var t;const s=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),s)try{var i;null!=(i=this.mediaSource)&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(t){this.warn(`onBufferReset ${e}`,t)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[wr(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Tr(this.tracks)}onBufferCodecs(e,t){const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const r="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),n=!r&&this.sourceBufferCount&&this.media&&i.some((e=>!s[e]));r||n?this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`):(i.forEach((e=>{var i,r,n;const a=t[e],{id:o,codec:l,levelCodec:h,container:c,metadata:d,supplemental:u}=a;let p=s[e];const f=null==(i=this.transferData)||null==(r=i.tracks)?void 0:r[e],g=null!=f&&f.buffer?f:p,m=(null==g?void 0:g.pendingCodec)||(null==g?void 0:g.codec),y=null==g?void 0:g.levelCodec;p||(p=s[e]={buffer:void 0,listeners:[],codec:l,supplemental:u,container:c,levelCodec:h,metadata:d,id:o});const v=Ie(m,y),_=null==v?void 0:v.replace(Ar,"$1");let b=Ie(l,h);const T=null==(n=b)?void 0:n.replace(Ar,"$1");b&&v&&_!==T&&("audio"===e.slice(0,5)&&(b=Le(b,this.appendSource)),this.log(`switching codec ${m} to ${b}`),b!==(p.pendingCodec||p.codec)&&(p.pendingCodec=b),p.container=c,this.appendChangeType(e,c,b))})),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce(((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e}),{})}appendChangeType(e,t,s){const i=`${t};codecs=${s}`,r={label:`change-type=${i}`,execute:()=>{const r=this.tracks[e];if(r){const n=r.buffer;null!=n&&n.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),n.changeType(i),r.codec=s,r.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,i=s+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(s,p))?void 0:t.gap))return;const r={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>i||null!=t&&t.buffer&&Pt.isBuffered(t.buffer,i)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(i,p))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:r,frag:e},this.append(r,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:i,type:r,parent:n,frag:h,part:c,chunkMeta:d}=t,u=d.buffering[r],p=h.sn,f=self.performance.now();u.start=f;const g=h.stats.buffering,m=c?c.stats.buffering:null;0===g.start&&(g.start=f),m&&0===m.start&&(m.start=f);const y=s.audio;let v=!1;"audio"===r&&"audio/mpeg"===(null==y?void 0:y.container)&&(v=!this.lastMpegAudioChunk||1===d.id||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const _=this.tracks.video,b=null==_?void 0:_.buffer;if(b&&"initSegment"!==p){const e=c||h,t=this.blockedAudioAppend;if("audio"!==r||"main"===n||this.blockedAudioAppend){if("video"===r){const s=e.end;if(t){const e=t.frag.start;(s>e||s<this.lastVideoAppendEnd||Pt.isBuffered(b,e))&&this.unblockAudio()}this.lastVideoAppendEnd=s}}else{const t=e.start+.05*e.duration,s=b.buffered,i=this.currentOp("video");s.length||i?!i&&!Pt.isBuffered(b,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const T=(c||h).start,A={label:`append-${r}`,execute:()=>{if(u.executeStart=self.performance.now(),v){const e=this.tracks[r];if(e){const t=e.buffer;if(t){const e=T-t.timestampOffset;Math.abs(e)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${T} (delta: ${e}) sn: ${p})`),t.timestampOffset=T)}}}this.appendExecutor(i,r)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();u.executeEnd=u.end=e,0===g.first&&(g.first=e),m&&0===m.first&&(m.first=e);const t={};this.sourceBuffers.forEach((([e,s])=>{e&&(t[e]=Pt.getBuffered(s))})),this.appendErrors[r]=0,"audio"===r||"video"===r?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(l.BUFFER_APPENDED,{type:r,frag:h,part:c,chunkMeta:d,parent:h.type,timeRanges:t})},onError:e=>{var t;const s={type:a.MEDIA_ERROR,parent:h.type,details:o.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:h,part:c,chunkMeta:d,error:e,err:e,fatal:!1},i=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR)s.details=o.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!i)s.errorAction=ht(!0);else if(e.name===Er&&0===this.sourceBufferCount)s.errorAction=ht(!0);else{const e=++this.appendErrors[r];this.warn(`Failed ${e}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${i||"no media error"})`),(e>=this.hls.config.appendErrorMaxRetry||i)&&(s.fatal=!0)}this.hls.trigger(l.ERROR,s)}};this.append(A,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(l.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:s,startOffset:i,endOffset:r}=t;s?this.append(this.getFlushOp(s,i,r),s):this.sourceBuffers.forEach((([e])=>{e&&this.append(this.getFlushOp(e,i,r),e)}))}onFragParsed(e,t){const{frag:s,part:i}=t,r=[],n=i?i.elementaryStreams:s.elementaryStreams;n[U]?r.push("audiovideo"):(n[B]&&r.push("audio"),n[j]&&r.push("video")),0===r.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers((()=>{const e=self.performance.now();s.stats.buffering.end=e,i&&(i.stats.buffering.end=e);const t=i?i.stats:s.stats;this.hls.trigger(l.FRAG_BUFFERED,{frag:s,part:i,stats:t,id:s.type})}),r).catch((e=>{this.warn(`Fragment buffered callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)}))}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some((([e])=>{var t,s;return e&&(!(null!=(t=this.tracks[e])&&t.ended)||(null==(s=this.tracks[e])?void 0:s.ending))}))}onBufferEos(e,t){var s;this.sourceBuffers.forEach((([e])=>{if(e){const s=this.tracks[e];t.type&&t.type!==e||(s.ending=!0,s.ended||(s.ended=!0,this.log(`${e} buffer reached EOS`)))}}));const i=!1!==(null==(s=this.overrides)?void 0:s.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some((([e])=>{var t;return e&&!(null!=(t=this.tracks[e])&&t.ended)}))&&(i?(this.log("Queueing EOS"),this.blockUntilOpen((()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(l.BUFFERED_TO_END,void 0)):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)}))):(this.tracksEnded(),this.hls.trigger(l.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach((([e])=>{if(null!==e){const t=this.tracks[e];t&&(t.ending=!1)}}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen((()=>this.updateMediaSource(e)))}onError(e,t){if(t.details===o.BUFFER_APPEND_ERROR&&t.frag){var s;const e=null==(s=t.errorAction)?void 0:s.nextAutoLevel;i(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||null===t)return;if(!this.sourceBufferCount)return;const r=e.config,n=s.currentTime,a=t.levelTargetDuration,o=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(i(o)&&o>=0){const e=Math.max(o,a),t=Math.floor(n/a)*a-e;this.flushBackBuffer(n,a,t)}if(i(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){const e=Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),t=Math.max(e,a),s=Math.floor(n/a)*a+t;this.flushFrontBuffer(n,a,s)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach((([e,t])=>{if(t){const r=Pt.getBuffered(t);if(r.length>0&&s>r.start(0)){var i;this.hls.trigger(l.BACK_BUFFER_REACHED,{bufferEnd:s});const t=this.tracks[e];if(null!=(i=this.details)&&i.live)this.hls.trigger(l.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(null!=t&&t.ended)return void this.log(`Cannot flush ${e} back buffer while SourceBuffer is in ended state`);this.hls.trigger(l.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:e})}}}))}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach((([t,i])=>{if(i){const r=Pt.getBuffered(i),n=r.length;if(n<2)return;const a=r.start(n-1),o=r.end(n-1);if(s>a||e>=a&&e<=o)return;this.hls.trigger(l.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:t})}}))}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||"open"!==(null==s?void 0:s.readyState))return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&s.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,r)}}return{duration:1/0}}const n=null==(e=this.overrides)?void 0:e.duration;if(n)return i(n)?{duration:n}:null;const a=this.media.duration;return r>(i(s.duration)?s.duration:0)&&r>a||!i(a)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:s}){const r=this.mediaSource;this.media&&r&&"open"===r.readyState&&(r.duration!==e&&(i(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),void 0!==t&&void 0!==s&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${s}.`),r.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ge(s)}`),this.tracksReady){var i;const e=null==(i=this.transferData)?void 0:i.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach((([t,s])=>{if(t){const i=this.tracks[t];e[t]={buffer:s,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}})),this.hls.trigger(l.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach((([e])=>{this.executeNext(e)}))}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const n=r,h=e[n];if(this.isPending(h)){const e=this.getTrackCodec(h,n),r=`${h.container};codecs=${e}`;h.codec=e,this.log(`creating sourceBuffer(${r})${this.currentOp(n)?" Queued":""} ${Ge(h)}`);try{const e=s.addSourceBuffer(r),i=wr(n),a=[n,e];t[i]=a,h.buffer=e}catch(e){var i;return this.error(`error while trying to add sourceBuffer: ${e.message}`),this.shiftAndExecuteNext(n),null==(i=this.operationQueue)||i.removeBlockers(),delete this.tracks[n],void this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:n,mimeType:r,parent:h.id})}this.trackSourceBuffer(n,h)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let i=e.codec;s&&("video"===t||"audiovideo"===t)&&Te(s,"video")&&(i=function(e,t){const s=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)be(t[e],"video")||s.push(t[e])}return t&&s.push(t),s.join(",")}(i,s));const r=Ie(i,e.levelCodec);return r?"audio"===t.slice(0,5)?Le(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",((e,t)=>{const s=t.removedRanges;null!=s&&s.length&&this.hls.trigger(l.BUFFER_FLUSHED,{type:e})}))}get mediaSrc(){var e,t;const s=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==s?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(s=this.mediaSource)?void 0:s.readyState}`);this.error(`${i}`,t),this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.currentOp(e);r&&r.onError(i)}removeExecutor(e,t,s){const{media:r,mediaSource:n}=this,a=this.tracks[e],o=null==a?void 0:a.buffer;if(!r||!n||!o)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void this.shiftAndExecuteNext(e);const l=i(r.duration)?r.duration:1/0,h=i(n.duration)?n.duration:1/0,c=Math.max(0,t),d=Math.min(s,l,h);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],i=null==s?void 0:s.buffer;if(!i)throw new Sr(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch((e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)}));else try{e()}catch(e){this.warn(`Callback run without blocking ${this.operationQueue} ${e}`)}}isUpdating(){return this.sourceBuffers.some((([e,t])=>e&&t.updating))}isQueued(){return this.sourceBuffers.some((([e])=>e&&!!this.currentOp(e)))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,i=t.map((e=>this.appendBlocker(e)));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then((t=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))}))}stepOperationQueue(e){e.forEach((e=>{var t;const s=null==(t=this.tracks[e])?void 0:t.buffer;s&&!s.updating&&this.shiftAndExecuteNext(e)}))}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce(((e,t)=>e+(this.isPending(this.tracks[t])?1:0)),0)}get sourceBufferCount(){return this.sourceBuffers.reduce(((e,[t])=>e+(t?1:0)),0)}get sourceBufferTypes(){return this.sourceBuffers.map((([e])=>e)).filter((e=>!!e))}addBufferListener(e,t,s){const i=this.tracks[e];if(!i)return;const r=i.buffer;if(!r)return;const n=s.bind(this,e);i.listeners.push({event:t,listener:n}),r.addEventListener(t,n)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach((e=>{s.removeEventListener(e.event,e.listener)})),t.listeners.length=0)}},capLevelController:kr,errorController:class extends A{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(l.ERROR,this.onError,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(l.ERROR,this.onError,this),e.off(l.ERROR,this.onErrorOut,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===p?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const i=this.hls,r=t.context;switch(t.details){case o.FRAG_LOAD_ERROR:case o.FRAG_LOAD_TIMEOUT:case o.KEY_LOAD_ERROR:case o.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case o.FRAG_PARSING_ERROR:if(null!=(s=t.frag)&&s.gap)return void(t.errorAction=ht());case o.FRAG_GAP:case o.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=2);case o.LEVEL_EMPTY_ERROR:case o.LEVEL_PARSING_ERROR:{var n,l;const e=t.parent===p?t.level:i.loadLevel;t.details===o.LEVEL_EMPTY_ERROR&&null!=(n=t.context)&&null!=(l=n.levelDetails)&&l.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case o.LEVEL_LOAD_ERROR:case o.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==r?void 0:r.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level)));case o.AUDIO_TRACK_LOAD_ERROR:case o.AUDIO_TRACK_LOAD_TIMEOUT:case o.SUBTITLE_LOAD_ERROR:case o.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const e=i.loadLevelObj;if(e&&(r.type===d&&e.hasAudioGroup(r.groupId)||r.type===u&&e.hasSubtitleGroup(r.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=2,void(t.errorAction.flags=1)}return;case o.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=i.loadLevelObj,s=null==e?void 0:e.attrs["HDCP-LEVEL"];s?t.errorAction={action:2,flags:2,hdcpLevel:s}:this.keySystemError(t)}return;case o.BUFFER_ADD_CODEC_ERROR:case o.REMUX_ALLOC_ERROR:case o.BUFFER_APPEND_ERROR:var h;return void(t.errorAction||(t.errorAction=this.getLevelSwitchAction(t,null!=(h=t.level)?h:i.loadLevel)));case o.INTERNAL_EXCEPTION:case o.BUFFER_APPENDING_ERROR:case o.BUFFER_FULL_ERROR:case o.LEVEL_SWITCH_ERROR:case o.BUFFER_STALLED_ERROR:case o.BUFFER_SEEK_OVER_HOLE:case o.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=ht())}t.type===a.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const s=nt(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++;if(lt(s,i,rt(e),e.response))return{action:5,flags:0,retryConfig:s,retryCount:i};const r=this.getLevelSwitchAction(e,t);return s&&(r.retryConfig=s,r.retryCount=i),r}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),i=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:n}=t.config,a=nt(e.details.startsWith("key")?n:r,e),l=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(i&&(e.details!==o.FRAG_GAP&&i.fragmentError++,lt(a,l,rt(e),e.response)))return{action:5,flags:0,retryConfig:a,retryCount:l};const h=this.getLevelSwitchAction(e,s);return a&&(h.retryConfig=a,h.retryCount=l),h}getLevelSwitchAction(e,t){const s=this.hls;null==t&&(t=s.loadLevel);const i=this.hls.levels[t];if(i){var r,n;const t=e.details;i.loadError++,t===o.BUFFER_APPEND_ERROR&&i.fragmentError++;let h=-1;const{levels:c,loadLevel:m,minAutoLevel:y,maxAutoLevel:v}=s;s.autoLevelEnabled||(s.loadLevel=-1);const _=null==(r=e.frag)?void 0:r.type,b=(_===f&&t===o.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===o.BUFFER_ADD_CODEC_ERROR||t===o.BUFFER_APPEND_ERROR))&&c.some((({audioCodec:e})=>i.audioCodec!==e)),T="video"===e.sourceBufferName&&(t===o.BUFFER_ADD_CODEC_ERROR||t===o.BUFFER_APPEND_ERROR)&&c.some((({codecSet:e,audioCodec:t})=>i.codecSet!==e&&i.audioCodec===t)),{type:A,groupId:E}=null!=(n=e.context)?n:{};for(let s=c.length;s--;){const r=(s+m)%c.length;if(r!==m&&r>=y&&r<=v&&0===c[r].loadError){var a,l;const s=c[r];if(t===o.FRAG_GAP&&_===p&&e.frag){const t=c[r].details;if(t){const s=et(e.frag,t.fragments,e.frag.start);if(null!=s&&s.gap)continue}}else{if(A===d&&s.hasAudioGroup(E)||A===u&&s.hasSubtitleGroup(E))continue;if(_===f&&null!=(a=i.audioGroups)&&a.some((e=>s.hasAudioGroup(e)))||_===g&&null!=(l=i.subtitleGroups)&&l.some((e=>s.hasSubtitleGroup(e)))||b&&i.audioCodec===s.audioCodec||!b&&i.audioCodec!==s.audioCodec||T&&i.codecSet===s.codecSet)continue}h=r;break}}if(h>-1&&s.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:2,flags:0,nextAutoLevel:h}}return{action:2,flags:1}}onErrorOut(e,t){var s;switch(null==(s=t.errorAction)?void 0:s.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===o.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:i,hdcpLevel:r,nextAutoLevel:n}=s;switch(i){case 0:this.switchLevel(e,n);break;case 2:r&&(t.maxHdcpLevel=Be[Be.indexOf(r)-1],s.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}s.resolved||this.switchLevel(e,n)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===o.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=xe(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===t&&this.hls.removeLevel(i)}}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(l.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(l.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const i=performance.now();if(t){if(this.lastTime){const e=i-this.lastTime,r=s-this.lastDroppedFrames,n=t-this.lastDecodedFrames,a=1e3*r/e,o=this.hls;if(o.trigger(l.FPS_DROP,{currentDropped:r,currentDecoded:n,totalDroppedFrames:s}),a>0&&r>o.config.fpsDroppedMonitoringThreshold*n){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(l.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ss,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:ka,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends Us{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",g),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(l.LEVEL_LOADED,this.onLevelLoaded,this),e.on(l.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(l.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(l.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(l.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(l.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(l.LEVEL_LOADED,this.onLevelLoaded,this),e.off(l.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(l.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(l.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(l.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(l.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=js.IDLE,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:i}=t;if(H(s)&&(this.fragPrevious=s),this.state=js.IDLE,!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let n;const a=s.start;for(let e=0;e<r.length;e++)if(a>=r[e].start&&a<=r[e].end){n=r[e];break}const o=s.start+s.duration;n?n.end=o:(n={start:a,end:o},r.push(n)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:i}=t;if(0===s&&i!==Number.POSITIVE_INFINITY){const e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach((t=>{for(let s=0;s<t.length;)if(t[s].end<=e)t.shift();else{if(!(t[s].start<e))break;t[s].start=e,s++}})),this.fragmentTracker.removeFragmentsInRange(s,e,g)}}onError(e,t){const s=t.frag;(null==s?void 0:s.type)===g&&(t.details===o.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==js.STOPPED&&(this.state=js.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&vr(this.levels,t)?this.levels=t.map((e=>new He(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new He(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,g),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,null==(s=this.levels)||!s.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==js.STOPPED&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:i,levels:r}=this,{details:n,id:a}=t;if(!r)return void this.warn(`Subtitle tracks were reset while loading level ${a}`);const o=r[a];if(a>=r.length||!o)return;this.log(`Subtitle track ${a} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(n.live||null!=(s=o.details)&&s.live){const e=this.mainDetails;if(n.deltaUpdateFailed||!e)return;const t=e.fragments[0];var c;o.details?(h=this.alignPlaylists(n,o.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===h&&t&&(h=t.start,Ls(n,h))):n.hasProgramDateTime&&e.hasProgramDateTime?(Bs(n,e),h=n.fragmentStart):t&&(h=t.start,Ls(n,h))}o.details=n,this.levelLastLoaded=o,a===i&&(this.hls.trigger(l.SUBTITLE_TRACK_UPDATED,{details:n,id:a,groupId:t.groupId}),this.tick(),n.live&&!this.fragCurrent&&this.media&&this.state===js.IDLE)&&(et(null,n.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&null!=i&&i.key&&i.iv&&Ht(i.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(s),i.key.buffer,i.iv.buffer,Vt(i.method)).catch((e=>{throw r.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((s=>{const i=performance.now();r.trigger(l.FRAG_DECRYPTED,{frag:t,payload:s,stats:{tstart:e,tdecrypt:i}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=js.IDLE}))}}doTick(){if(this.media){if(this.state===js.IDLE){const{currentTrackId:e,levels:t}=this,s=null==t?void 0:t[e];if(!s||!t.length||!s.details)return;if(this.waitForLive(s))return;const{config:i}=this,r=this.getLoadPosition(),n=Pt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:a,len:o}=n,l=s.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const h=l.fragments,c=h.length,d=l.edge;let u=null;const p=this.fragPrevious;if(a<d){const e=i.maxFragLookUpTolerance,t=a>d-e?0:e;u=et(p,h,Math.max(h[0].start,a),t),!u&&p&&p.start<h[0].start&&(u=h[0])}else u=h[c-1];if(u=this.filterReplacedPrimary(u,s.details),!u)return;const f=h[u.sn-l.startSN-1];if(f&&f.cc===u.cc&&this.fragmentTracker.getState(f)===ct&&(u=f),this.fragmentTracker.getState(u)===ct){const e=this.mapToInitFragWhenRequired(u);e&&this.loadFragment(e,s,a)}}}else this.state=js.IDLE}loadFragment(e,t,s){H(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Dn(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends yr{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=yn(this.media.textTracks);for(let s=0;s<t.length;s++)if("hidden"===t[s].mode)e=t[s];else if("showing"===t[s].mode){e=t[s];break}const s=this.findTrackForTextTrack(e);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.LEVEL_LOADING,this.onLevelLoading,this),e.on(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(l.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.LEVEL_LOADING,this.onLevelLoading,this),e.off(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(l.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(l.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const i=!!t.transferMedia;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i||yn(s.textTracks).forEach((e=>{gn(e)}))}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,n=this.tracksInGroup[s];if(!n||n.groupId!==i)return void this.warn(`Subtitle track with id:${s} and group:${i} not found in active group ${null==n?void 0:n.groupId}`);const a=n.details;n.details=t.details,this.log(`Subtitle track ${s} "${n.name}" lang:${n.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||null!=s&&s.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!s||-1!==s.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!r&&t){this.selectDefaultTrack=!1;const s=qe(t,e);if(s>-1)r=e[s];else{const e=qe(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const n={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==s?void 0:s.join(",")}" group-id`),this.hls.trigger(l.SUBTITLE_TRACKS_UPDATED,n),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if((!s||r.default)&&(s||e)&&(!e||Ye(r,e)))return i}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(_r(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(_r(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++)if(br(t[s],e))return s}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==u||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Ye(e,s))return s;const i=qe(e,this.tracksInGroup);if(i>-1){const e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(s)return null;{const s=qe(e,t);if(s>-1)return t[s]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),n=e.details,a=null==n?void 0:n.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${a&&n.live?" age "+a.toFixed(1)+(n.type?" "+n.type||0:""):""} ${r}`),this.hls.trigger(l.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=yn(e.textTracks),s=this.currentTrack;let i;if(s&&(i=t.filter((e=>br(s,e)))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach((e=>{"disabled"!==e.mode&&e!==i&&(e.mode="disabled")})),i){const e=this.subtitleDisplay?"showing":"hidden";i.mode!==e&&(i.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!i(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r)return void this.hls.trigger(l.SUBTITLE_TRACK_SWITCH,{id:e});const n=!!r.details&&!r.details.live;if(e===this.trackId&&r===s&&n)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:a,groupId:o="",name:h,type:c,url:d}=r;this.hls.trigger(l.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:h,type:c,url:d});const u=this.switchParams(r.url,null==s?void 0:s.details,r.details);this.loadPlaylist(u)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(l.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(l.FRAG_LOADING,this.onFragLoading,this),e.on(l.FRAG_LOADED,this.onFragLoaded,this),e.on(l.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(l.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(l.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(l.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(l.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(l.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(l.FRAG_LOADING,this.onFragLoading,this),e.off(l.FRAG_LOADED,this.onFragLoaded,this),e.off(l.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(l.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(l.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(l.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(l.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Ea(this,"textTrack1"),t=new Ea(this,"textTrack2"),s=new Ea(this,"textTrack3"),i=new Ea(this,"textTrack4");this.cea608Parser1=new Xn(1,e,t),this.cea608Parser2=new Xn(3,s,i)}addCues(e,t,s,i,r){let n=!1;for(let e=r.length;e--;){const i=r[e],l=(a=i[0],o=i[1],h=t,c=s,Math.min(o,c)-Math.max(a,h));if(l>=0&&(i[0]=Math.min(i[0],t),i[1]=Math.max(i[1],s),n=!0,l/(s-t)>.5))return}var a,o,h,c;if(n||r.push([t,s]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,s,i)}else{const r=this.Cues.newCue(null,t,s,i);this.hls.trigger(l.CUES_PARSED,{type:"captions",cues:r,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r}){const{unparsedVttFrags:n}=this;s===p&&(this.initPTS[t.cc]={baseTime:i,timescale:r}),n.length&&(this.unparsedVttFrags=[],n.forEach((e=>{this.onFragLoaded(l.FRAG_LOADED,e)})))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let i=0;i<s.textTracks.length;i++){const r=s.textTracks[i];if(Ca(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:i}=this,{label:r,languageCode:n}=t[e],a=this.getExistingTrack(r,n);if(a)s[e]=a,gn(s[e]),pn(s[e],i);else{const t=this.createTextTrack("captions",r,n);t&&(t[e]=!0,s[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(l.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,s){const i=this.media;if(i)return i.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:i}=this;Object.keys(i).forEach((e=>{gn(i[e]),delete i[e]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let e=0;e<t.length;e++)gn(t[e])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],i=s.some((e=>e.textCodec===ua));if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(vr(this.tracks,s))return void(this.tracks=s);if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const e=this.media,t=e?yn(e.textTracks):null;if(this.tracks.forEach(((e,s)=>{let i;if(t){let s=null;for(let i=0;i<t.length;i++)if(t[i]&&Ca(t[i],e)){s=t[i],t[i]=null;break}s&&(i=s)}if(i)gn(i);else{const t=Sa(e);i=this.createTextTrack(t,e.name,e.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)})),null!=t&&t.length){const e=t.filter((e=>null!==e)).map((e=>e.label));e.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map((e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e})));this.hls.trigger(l.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const s=`textTrack${t[1]}`,i=this.captionsProperties[s];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}))}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===p){var s,i;const{cea608Parser1:e,cea608Parser2:r,lastSn:n}=this,{cc:a,sn:o}=t.frag,l=null!=(s=null==(i=t.part)?void 0:i.index)?s:-1;e&&r&&(o!==n+1||o===n&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),r.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:s,payload:i}=t;if(s.type===g)if(i.byteLength){const e=s.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[s.level],r=this.vttCCs;r[s.cc]||(r[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),e&&e.textCodec===ua?this._parseIMSC1(s,i):this._parseVTTs(t)}}else this.hls.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;ma(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),s.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{s.logger.log(`Failed to parse IMSC1: ${t}`),s.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_parseVTTs(e){var t;const{frag:s,payload:r}=e,{initPTS:n,unparsedVttFrags:a}=this,o=n.length-1;if(!n[s.cc]&&-1===o)return void a.push(e);const h=this.hls;!function(e,t,s,r,n,a,o){const l=new la,h=R(new Uint8Array(e)).trim().replace(ha,"\n").split("\n"),c=[],d=t?function(e,t=1){return Zi(e,9e4,1/t)}(t.baseTime,t.timescale):0;let u,p="00:00.000",f=0,g=0,m=!0;l.oncue=function(e){const i=s[r];let a=s.ccOffset;const o=(f-d)/9e4;if(null!=i&&i.new&&(void 0!==g?a=s.ccOffset=i.start:function(e,t,s){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(n=r)&&n.new;){var n;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=s}(s,r,o)),o){if(!t)return void(u=new Error("Missing initPTS for VTT MPEGTS"));a=o-s.presentationOffset}const l=e.endTime-e.startTime,h=nr(9e4*(e.startTime+a-g),9e4*n)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const p=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(p)),e.id||(e.id=da(e.startTime,e.endTime,p)),e.endTime>0&&c.push(e)},l.onparsingerror=function(e){u=e},l.onflush=function(){u?o(u):a(c)},h.forEach((e=>{if(m){if(ca(e,"X-TIMESTAMP-MAP=")){m=!1,e.slice(16).split(",").forEach((e=>{ca(e,"LOCAL:")?p=e.slice(6):ca(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{g=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(i(t)&&i(s)&&i(r)&&i(n)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=6e4*r,t+=36e5*n,t}(p)/1e3}catch(e){u=e}return}""===e&&(m=!1)}l.parse(e+"\n")})),l.flush()}(null!=(t=s.initSegment)&&t.data?de(s.initSegment.data,new Uint8Array(r)).buffer:r,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,(e=>{this._appendCues(e,s.level),h.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})}),(t=>{const i="Missing initPTS for VTT MPEGTS"===t.message;i?a.push(e):this._fallbackToIMSC1(s,r),h.logger.log(`Failed to parse VTT cue: ${t}`),i&&o>s.cc||h.trigger(l.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:t})}))}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||ma(t,this.initPTS[e.cc],(()=>{s.textCodec=ua,this._parseIMSC1(e,t)}),(()=>{s.textCodec="wvtt"}))}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||"disabled"===s.mode)return;e.forEach((e=>fn(s,e)))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;s.trigger(l.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===g&&this.onFragLoaded(l.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:i}=t;if(s.type!==p||"NONE"!==this.closedCaptionsForLevel(s))for(let e=0;e<i.length;e++){const t=i[e].bytes;if(t){this.cea608Parser1||this.initCea608Parsers();const s=this.extractCea608Data(t);this.cea608Parser1.addData(i[e].pts,s[0]),this.cea608Parser2.addData(i[e].pts,s[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:i,type:r}){const{media:n}=this;if(n&&!(n.currentTime<s)){if(!r||"video"===r){const{captionsTracks:e}=this;Object.keys(e).forEach((i=>mn(e[i],t,s)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){const{textTracks:e}=this;Object.keys(e).forEach((s=>mn(e[s],t,i)))}}}extractCea608Data(e){const t=[[],[]],s=31&e[0];let i=2;for(let r=0;r<s;r++){const s=e[i++],r=127&e[i++],n=127&e[i++];if((0!==r||0!==n)&&4&s){const e=3&s;0!==e&&1!==e||(t[e].push(r),t[e].push(n))}}return t}},audioStreamController:class extends Us{constructor(e,t,s){super(e,t,s,"audio-stream-controller",f),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(l.LEVEL_LOADED,this.onLevelLoaded,this),e.on(l.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(l.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(l.BUFFER_RESET,this.onBufferReset,this),e.on(l.BUFFER_CREATED,this.onBufferCreated,this),e.on(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(l.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(l.FRAG_LOADING,this.onFragLoading,this),e.on(l.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(l.LEVEL_LOADED,this.onLevelLoaded,this),e.off(l.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(l.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(l.BUFFER_RESET,this.onBufferReset,this),e.off(l.BUFFER_CREATED,this.onBufferCreated,this),e.off(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(l.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(l.FRAG_LOADING,this.onFragLoading,this),e.off(l.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r}){if(s===p){const e=t.cc,s=this.fragCurrent;if(this.initPTS[e]={baseTime:i,timescale:r},this.log(`InitPTS for cc: ${e} found from main: ${i}/${r}`),this.mainAnchor=t,this.state===js.WAITING_INIT_PTS){const s=this.waitingData;(!s&&!this.loadingParts||s&&s.frag.cc!==e)&&(this.nextLoadPosition=this.findSyncFrag(t).start),this.tick()}else!this.hls.hasEnoughToStart&&s&&s.cc!==e?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(t).start,s.abortRequests(),this.resetLoadingState()):this.state===js.IDLE&&this.tick()}}findSyncFrag(e){const t=this.getLevelDetails(),s=e.cc;return function(e,t,s){if(e&&e.startCC<=t&&e.endCC>=t){const i=s.start,r=s.end;let n=e.fragments;if(!s.relurl){const{fragmentHint:t}=e;t&&(n=n.concat(t))}return Je(n,(e=>e.cc<t||e.end<=i?1:e.cc>t||e.start>=r?-1:0))}return null}(t,s,e)||t&&it(t.fragments,s)||e}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=js.STOPPED);const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),s>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=js.IDLE):this.state=js.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case js.IDLE:this.doTickIdle();break;case js.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=null==e?void 0:e[t],i=null==s?void 0:s.details;if(i&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(i))break;this.state=js.WAITING_INIT_PTS}break}case js.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),s=this.retryDate;if(!s||t>=s||null!=(e=this.media)&&e.seeking){const{levels:e,trackId:t}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==e?void 0:e[t])||null),this.state=js.IDLE}break}case js.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:i,complete:r}=e,n=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=js.FRAG_LOADING;const e={frag:t,part:s,payload:i.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),r&&super._handleFragmentLoadComplete(e)}else n&&n.cc!==e.frag.cc&&(this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${n.cc}`),this.nextLoadPosition=this.findSyncFrag(n).start,this.clearWaitingFragment())}else this.state=js.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==js.STOPPED&&(this.state=js.IDLE))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:i,trackId:r}=this,n=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!n.startFragPrefetch)||null==s||!s[r])return;const a=s[r],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=js.WAITING_TRACK,void(this.startFragRequested=!1);const h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,B,f));const c=this.getFwdBufferInfo(h,f);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,o))return t.trigger(l.BUFFER_EOS,{type:"audio"}),void(this.state=js.ENDED);const d=c.len,u=t.maxBufferLength,g=o.fragments,m=g[0].start,y=this.getLoadPosition(),v=this.flushing?y:c.end;if(this.switchingTrack&&i){const e=y;o.PTSKnown&&e<m&&(c.end>m||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=m+.05)}if(d>=u&&!this.switchingTrack&&v<g[g.length-1].start)return;let _=this.getNextFragment(v,o);if(_&&this.isLoopLoading(_,v)&&(_=this.getNextFragmentLoopLoading(_,o,c,p,u)),!_)return void(this.bufferFlushed=!0);let b=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&b&&H(_)&&!_.endList&&(!o.live||!this.loadingParts&&v<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(b)===pt&&(this.mainFragLoading=b=null),b&&H(b))){if(_.start>b.end){const e=this.fragmentTracker.getFragAtPos(v,p);e&&e.end>b.end&&(b=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(_.start>b.end)return}this.loadFragment(_,a,v)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map((e=>new He(e)))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==js.STOPPED&&(this.setInterval(100),this.state=js.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(l.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:i}=this,{details:r,id:n,groupId:a,track:o}=t;if(!i)return void this.warn(`Audio tracks reset while loading track ${n} "${o.name}" of "${a}"`);const h=this.mainDetails;if(!h||r.endCC>h.endCC||h.expired)return this.cachedTrackLoadedData=t,void(this.state!==js.STOPPED&&(this.state=js.WAITING_TRACK));this.cachedTrackLoadedData=null,this.log(`Audio track ${n} "${o.name}" of "${a}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const c=i[n];let d=0;if(r.live||null!=(s=c.details)&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;var u;c.details&&(d=this.alignPlaylists(r,c.details,null==(u=this.levelLastLoaded)?void 0:u.details)),r.alignedSliding||(Fs(r,h),r.alignedSliding||Bs(r,h),d=r.fragmentStart)}c.details=r,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(h,d),this.hls.trigger(l.AUDIO_TRACK_UPDATED,{details:r,id:n,groupId:t.groupId}),this.state!==js.WAITING_TRACK||this.waitForCdnTuneIn(r)||(this.state=js.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{config:n,trackId:a,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const h=l.details;if(!h)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(s.start);const c=n.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new mr(this.hls,f,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const u=this.initPTS[s.cc],p=null==(t=s.initSegment)?void 0:t.data;if(void 0!==u){const e=!1,t=i?i.index:-1,n=-1!==t,a=new Lt(s.level,s.sn,s.stats.chunkCount,r.byteLength,t,n);d.push(r,p,c,"",s,i,h.totalduration,e,a,u)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${h.startSN} ,${h.endSN}],track ${a}`);const{cache:e}=this.waitingData=this.waitingData||{frag:s,part:i,cache:new Hs,complete:!1};e.push(new Uint8Array(r)),this.state!==js.STOPPED&&(this.state=js.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===p&&H(t.frag)&&(this.mainFragLoading=t,this.state===js.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:i}=t;if(s.type===f)if(this.fragContextChanged(s))this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if(H(s)){this.fragPrevious=s;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(l.AUDIO_TRACK_SWITCHED,T({},e)))}this.fragBufferedComplete(s,i),this.media&&this.tick()}else this.audioOnly||s.type!==p||s.elementaryStreams.video||s.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var s;if(t.fatal)this.state=js.ERROR;else switch(t.details){case o.FRAG_GAP:case o.FRAG_PARSING_ERROR:case o.FRAG_DECRYPT_ERROR:case o.FRAG_LOAD_ERROR:case o.FRAG_LOAD_TIMEOUT:case o.KEY_LOAD_ERROR:case o.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(f,t);break;case o.AUDIO_TRACK_LOAD_ERROR:case o.AUDIO_TRACK_LOAD_TIMEOUT:case o.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==js.WAITING_TRACK||(null==(s=t.context)?void 0:s.type)!==d||(this.state=js.IDLE);break;case o.BUFFER_ADD_CODEC_ERROR:case o.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.resetLoadingState();break;case o.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case o.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==j&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==j){this.flushing=!1,this.bufferFlushed=!0,this.state===js.ENDED&&(this.state=js.IDLE);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,f),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:i}=this,{remuxResult:r,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a)return void this.resetWhenMissingContext(n);const{frag:o,part:h,level:c}=a,{details:d}=c,{audio:u,text:p,id3:f,initSegment:g}=r;if(!this.fragContextChanged(o)&&d){if(this.state=js.PARSING,this.switchingTrack&&u&&this.completeAudioSwitch(this.switchingTrack),null!=g&&g.tracks){const e=o.initSegment||o;this._bufferInitSegment(c,g.tracks,e,n),i.trigger(l.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:s,tracks:g.tracks})}if(u){const{startPTS:e,endPTS:t,startDTS:s,endDTS:i}=u;h&&(h.elementaryStreams[B]={startPTS:e,endPTS:t,startDTS:s,endDTS:i}),o.setElementaryStreamInfo(B,e,t,s,i),this.bufferFragmentData(u,o,h,n)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=_({id:s,frag:o,details:d},f);i.trigger(l.FRAG_PARSING_METADATA,e)}if(p){const e=_({id:s,frag:o,details:d},p);i.trigger(l.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,s,i){if(this.state!==js.PARSING)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const r=t.audio;r.id=f;const n=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${n}/${r.codec}]`),n&&1===n.split(",").length&&(r.levelCodec=n),this.hls.trigger(l.BUFFER_CODECS,t);const a=r.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:s,part:null,chunkMeta:i,parent:s.type,data:a};this.hls.trigger(l.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);var r;if(this.switchingTrack||i===ct||i===ut)if(H(e))if(null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=js.WAITING_INIT_PTS;const s=this.mainDetails;s&&s.fragmentStart!==t.details.fragmentStart&&Bs(t.details,s)}else super.loadFragment(e,t,s);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:i,characteristics:r,audioCodec:n,channels:a}=this.bufferedTrack;Ye({name:t,lang:s,assocLang:i,characteristics:r,audioCodec:n,channels:a},e,Xe)||(Ze(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(l.AUDIO_TRACK_SWITCHED,T({},e))}},audioTrackController:class extends yr{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.LEVEL_LOADING,this.onLevelLoading,this),e.on(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(l.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.LEVEL_LOADING,this.onLevelLoading,this),e.off(l.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(l.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(l.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,n=this.tracksInGroup[s];if(!n||n.groupId!==i)return void this.warn(`Audio track with id:${s} and group:${i} not found in active group ${null==n?void 0:n.groupId}`);const a=n.details;n.details=t.details,this.log(`Audio track ${s} "${n.name}" lang:${n.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||null!=s&&s.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!s||-1!==s.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!r&&t){const s=qe(t,e,Xe);if(s>-1)r=e[s];else{const e=qe(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const h={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==s?void 0:s.join(",")}`),this.hls.trigger(l.AUDIO_TRACKS_UPDATED,h);const c=this.trackId;if(-1!==i&&-1===c)this.setAudioTrack(i);else if(e.length&&-1===c){var n;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(n=this.groupIds)?void 0:n.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==d||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const i=this.currentTrack;if(i&&Ye(e,i,Xe))return i;const r=qe(e,this.tracksInGroup,Xe);if(r>-1){const e=this.tracksInGroup[r];return this.setAudioTrack(r),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);const r=function(e,t,s,i,r){const n=t[i],a=t.reduce(((e,t,s)=>{const i=t.uri;return(e[i]||(e[i]=[])).push(s),e}),{})[n.uri];a.length>1&&(i=Math.max.apply(Math,a));const o=n.videoRange,l=n.frameRate,h=n.codecSet.substring(0,4),c=Qe(t,i,(t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==h)return!1;const i=t.audioGroups,n=s.filter((e=>!i||-1!==i.indexOf(e.groupId)));return qe(e,n,r)>-1}));return c>-1?c:Qe(t,i,(t=>{const i=t.audioGroups,n=s.filter((e=>!i||-1!==i.indexOf(e.groupId)));return qe(e,n,r)>-1}))}(e,t.levels,s,i,Xe);if(-1===r)return null;t.nextLoadLevel=r}if(e.channels||e.audioCodec){const t=qe(e,s);if(t>-1)return s[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;if(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(l.AUDIO_TRACK_SWITCHING,T({},i)),r)return;const n=this.switchParams(i.url,null==s?void 0:s.details,i.details);this.loadPlaylist(n)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if((!this.selectDefaultTrack||i.default)&&(!e||Ye(e,i,Xe)))return s}if(e){const{name:s,lang:i,assocLang:r,characteristics:n,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++)if(Ye({name:s,lang:i,assocLang:r,characteristics:n,audioCodec:a,channels:o},t[e],Xe))return e;for(let s=0;s<t.length;s++){const i=t[s];if(_r(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(_r(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Ze(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),n=e.details,a=null==n?void 0:n.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${a&&n.live?" age "+a.toFixed(1)+(n.type?" "+n.type||0:""):""} ${r}`),this.hls.trigger(l.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}},emeController:dn,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:Lr,su:!this.initialized})}catch(e){this.hls.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{const{frag:t,part:s}=e,i=this.hls.levels[t.level],r=this.getObjectType(t),n={d:1e3*(s||t).duration,ot:r};r!==Pr&&r!==Ir&&r!=Rr||(n.br=i.bitrate/1e3,n.tb=this.getTopBandwidth(r)/1e3,n.bl=this.getBufferLength(r));const a=s?this.getNextPart(s):this.getNextFrag(t);null!=a&&a.url&&a.url!==t.url&&(n.nor=a.url),this.apply(e,n)}catch(e){this.hls.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;null!=s&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=!0===s.useHeaders,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHED,this.onMediaDetached,this),e.on(l.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHED,this.onMediaDetached,this),e.off(l.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,i;this.audioBuffer=null==(s=t.tracks.audio)?void 0:s.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:Or,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){_(t,this.createData());const s=t.ot===xr||t.ot===Pr||t.ot===Rr;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce(((e,s)=>(i.includes(s)&&(e[s]=t[s]),e)),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),function(e,t,s){_(e,function(e,t={}){const s={};if(!e)return s;const i=Object.entries(e),r=Object.entries(Nr).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{})),n=i.reduce(((e,t)=>{var s,i;const[n,a]=t,o=(null===(s=r.find((e=>e[1].includes(n))))||void 0===s?void 0:s[0])||Mr;return null!==(i=e[o])&&void 0!==i||(e[o]={}),e[o][n]=a,e}),{});return Object.entries(n).reduce(((e,[s,i])=>(e[s]=on(i,t),e)),s)}(t,s))}(e.headers,t,r)):e.url=function(e,t,s){const i=function(e,t={}){if(!e)return"";const s=on(e,t);return`CMCD=${encodeURIComponent(s)}`}(t,s);if(!i)return e;if(ln.test(e))return e.replace(ln,i);const r=e.includes("?")?"&":"?";return`${e}${r}${i}`}(e.url,t,r)}getNextFrag(e){var t;const s=null==(t=this.hls.levels[e.level])?void 0:t.details;if(s){const t=e.sn-s.startSN;return s.fragments[t+1]}}getNextPart(e){var t,s;const{index:i,fragment:r}=e,n=null==(t=this.hls.levels[r.level])||null==(s=t.details)?void 0:s.partList;if(n){const{sn:e}=r;for(let t=n.length-1;t>=0;t--){const s=n[t];if(s.index===i&&s.fragment.sn===e)return n[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?Dr:"initSegment"===e.sn?xr:"audio"===t?Ir:"main"===t?this.hls.audioTracks.length?Pr:Rr:void 0}getTopBandwidth(e){let t,s=0;const i=this.hls;if(e===Ir)t=i.audioTracks;else{const e=i.maxAutoLevel,s=e>-1?e+1:i.levels.length;t=i.levels.slice(0,s)}for(const e of t)e.bitrate>s&&(s=e.bitrate);return s>0?s:NaN}getBufferLength(e){const t=this.media,s=e===Ir?this.audioBuffer:this.videoBuffer;return s&&t?1e3*Pt.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new s(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,s,i){t(e),this.loader.load(e,s,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new s(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,s,i){t(e),this.loader.load(e,s,i)}}}},contentSteeringController:class extends A{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;null!==s&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(2===(null==s?void 0:s.action)&&1===s.flags){const e=this.levels;let i=this._pathwayPriority,r=this.pathwayId;if(t.context){const{groupId:s,pathwayId:i,type:n}=t.context;s&&e?r=this.getPathwayForGroupId(s,n,r):i&&(r=i)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!i&&e&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),s.resolved=this.pathwayId!==r),s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${r} levels: ${e?e.length:e} priorities: ${Ge(i)} penalized: ${Ge(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}updatePathwayPriority(e){let t;this._pathwayPriority=e;const s=this.penalizedPathways,i=performance.now();Object.keys(s).forEach((e=>{i-s[e]>3e5&&delete s[e]}));for(let i=0;i<e.length;i++){const r=e[i];if(r in s)continue;if(r===this.pathwayId)return;const n=this.hls.nextLoadLevel,a=this.hls.levels[n];if(t=this.getLevelsForPathway(r),t.length>0){this.log(`Setting Pathway to "${r}"`),this.pathwayId=r,Ds(t),this.hls.trigger(l.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[n];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=n);break}}}getPathwayForGroupId(e,t,s){const i=this.getLevelsForPathway(s).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===d&&i[s].hasAudioGroup(e)||t===u&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},i={};e.forEach((e=>{const{ID:r,"BASE-ID":n,"URI-REPLACEMENT":a}=e;if(t.some((e=>e.pathwayId===r)))return;const o=this.getLevelsForPathway(n).map((e=>{const t=new Bt(e.attrs);t["PATHWAY-ID"]=r;const n=t.AUDIO&&`${t.AUDIO}_clone_${r}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${r}`;n&&(s[t.AUDIO]=n,t.AUDIO=n),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);const l=cn(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),h=new He({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let t=1;t<e.audioGroups.length;t++)h.addGroupId("audio",`${e.audioGroups[t]}_clone_${r}`);if(e.subtitleGroups)for(let t=1;t<e.subtitleGroups.length;t++)h.addGroupId("text",`${e.subtitleGroups[t]}_clone_${r}`);return h}));t.push(...o),hn(this.audioTracks,s,a,r),hn(this.subtitleTracks,i,a,r)}))}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new s(t);try{i=new self.URL(e)}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==i.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+e)}const r={responseType:"json",url:i.href},n=t.steeringManifestLoadPolicy.default,a=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},h={onSuccess:(e,t,s,r)=>{this.log(`Loaded steering manifest: "${i}"`);const n=e.data;if(1!==(null==n?void 0:n.VERSION))return void this.log(`Steering VERSION ${n.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=n.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":h}=n;if(a)try{this.uri=new self.URL(a,i).href}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||s.url),o&&this.clonePathways(o);const c={steeringManifest:n,url:i.toString()};this.hls.trigger(l.STEERING_MANIFEST_LOADED,c),h&&this.updatePathwayPriority(h)},onError:(e,t,s,i)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let r=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,r);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,s)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,o,h)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout((()=>{var t;const s=null==(t=this.hls)?void 0:t.media;!s||s.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)}),t)}},interstitialsController:class extends A{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const s=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const i=this.playingItem;if(!i)return void this.checkBuffer();if(s&&this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule(),this.checkBuffer(),s&&e<i.start||e>=i.end){var r;const e=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(i)&&null!=(r=this.media)&&r.paused&&(this.shouldPlay=!1),!s){const t=this.findItemIndex(i);if(e>t){const s=this.schedule.findJumpRestrictedIndex(t+1,e);if(s>t)return void this.setSchedulePosition(s)}}return void this.setSchedulePosition(e)}const n=this.playingAsset;if(!n){if(this.playingLastItem&&this.isInterstitial(i)){const t=i.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const a=n.timelineStart,o=n.duration||0;(s&&e<a||e>=a+o)&&this.setScheduleToAssetAtTime(e,n)},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const s=this.playingAsset;s&&e>=s.timelineStart+(s.duration||0)&&this.setScheduleToAssetAtTime(e,s)},this.onScheduleUpdate=(e,t)=>{const s=this.schedule,i=this.playingItem,r=s.events||[],n=s.items||[],a=s.durations,o=e.map((e=>e.identifier)),h=!(!r.length&&!o.length);if(h&&this.log(`INTERSTITIALS_UPDATED (${r.length}): ${r}\nSchedule: ${n.map((e=>Ln(e)))}`),o.length&&this.log(`Removed events ${o}`),this.playerQueue.forEach((e=>{if(e.interstitial.appendInPlace){const t=e.assetItem.timelineStart,s=e.timelineOffset-t;if(s)try{e.timelineOffset=t}catch(i){Math.abs(s)>_n&&this.warn(`${i} ("${e.assetId}" ${e.timelineOffset}->${t})`)}}})),i){const e=this.updateItem(i,this.timelinePos);this.itemsMatch(i,e)&&(this.playingItem=e,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const c=this.bufferingItem;if(c){const e=this.updateItem(c,this.bufferedPos);this.itemsMatch(c,e)?this.bufferingItem=e:c.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(c.event,null))}if(e.forEach((e=>{e.assetList.forEach((e=>{this.clearAssetPlayer(e.identifier,null)}))})),h||t){if(this.hls.trigger(l.INTERSTITIALS_UPDATED,{events:r.slice(0),schedule:n.slice(0),durations:a,removedIds:o}),this.isInterstitial(i)&&o.includes(i.event.identifier))return this.warn(`Interstitial "${i.event.identifier}" removed while playing`),void this.primaryFallback(i.event);this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new In(e),this.schedule=new kn(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(l.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(l.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(l.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(l.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(l.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(l.BUFFER_APPENDED,this.onBufferAppended,this),e.on(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(l.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(l.MEDIA_ENDED,this.onMediaEnded,this),e.on(l.ERROR,this.onError,this),e.on(l.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(l.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(l.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(l.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(l.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(l.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(l.BUFFER_CODECS,this.onBufferCodecs,this),e.off(l.BUFFER_APPENDED,this.onBufferAppended,this),e.off(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(l.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(l.MEDIA_ENDED,this.onMediaEnded,this),e.off(l.ERROR,this.onError,this),e.off(l.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Rn(e,"play",this.onPlay),Rn(e,"pause",this.onPause),Rn(e,"seeking",this.onSeeking),Rn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Pn(s,"seeking",this.onSeeking),Pn(s,"timeupdate",this.onTimeupdate),Pn(s,"play",this.onPlay),Pn(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,null===s)this.checkStart();else if(!i){this.clearScheduleState();const e=this.findItemIndex(s);this.setSchedulePosition(e)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(this.media=null,!s&&(i&&this.removeMediaListeners(i),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=t=>t?e.getAssetPlayer(t.identifier):t,i=(t,i,r,a,o)=>{if(t){let l=t[i].start;const h=t.event;if(h){if("playout"===i||h.timelineOccupancy!==bn.Point){const e=s(r);(null==e?void 0:e.interstitial)===h&&(l+=e.assetItem.startOffset+e[o])}}else l+=("bufferedPos"===a?n():e[a])-t.start;return l}return 0},r=(t,s)=>{if(0!==t&&"primary"!==s&&e.schedule.length){var i;const r=e.schedule.findItemIndexAtTime(t),n=null==(i=e.schedule.items)?void 0:i[r];if(n)return t+(n[s].start-n.start)}return t},n=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?a("primary"):Math.max(t,0)},a=t=>{var s;return null!=(s=e.primaryDetails)&&s.live?e.primaryDetails.edge:e.schedule.durations[t]},o=(t,r)=>{var n,a;const o=e.effectivePlayingItem;if(null!=o&&null!=(n=o.event)&&n.restrictions.skip)return;e.log(`seek to ${t} "${r}"`);const l=e.effectivePlayingItem,h=e.schedule.findItemIndexAtTime(t,r),c=null==(a=e.schedule.items)?void 0:a[h],d=e.getBufferingPlayer(),u=null==d?void 0:d.interstitial,p=null==u?void 0:u.appendInPlace,f=l&&e.itemsMatch(l,c);if(l&&(p||f)){const n=s(e.playingAsset),a=(null==n?void 0:n.media)||e.primaryMedia;if(a){const s="primary"===r?a.currentTime:i(l,r,e.playingAsset,"timelinePos","currentTime"),o=t-s,h=(p?s:a.currentTime)+o;if(h>=0&&(!n||p||h<=n.duration))return void(a.currentTime=h)}}if(c){let s=t;if("primary"!==r){const e=t-c[r].start;s=c.start+e}const i=!e.isInterstitial(c);if(e.isInterstitial(l)&&!l.event.appendInPlace||!i&&!c.event.appendInPlace){if(l){const n=e.findItemIndex(l);if(h>n){const t=e.schedule.findJumpRestrictedIndex(n+1,h);if(t>n)return void e.setSchedulePosition(t)}let a=0;if(i)e.timelinePos=s,e.checkBuffer();else{var g;const e=null==c||null==(g=c.event)?void 0:g.assetList;if(e){const s=t-(c[r]||c).start;for(let t=e.length;t--;){const i=e[t];if(i.duration&&s>=i.startOffset&&s<i.startOffset+i.duration){a=t;break}}}}e.setSchedulePosition(h,a)}}else{const t=e.media||(p?null==d?void 0:d.media:null);t&&(t.currentTime=s)}}},l=()=>{const s=e.effectivePlayingItem;if(e.isInterstitial(s))return s;const i=t();return e.isInterstitial(i)?i:null},h={get currentTime(){const t=l(),s=e.effectivePlayingItem;return s&&s===t?i(s,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-s.playout.start:0},set currentTime(t){const s=l(),i=e.effectivePlayingItem;i&&i===s&&o(t+i.playout.start,"playout")},get duration(){const e=l();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const s=null==(t=l())?void 0:t.event.assetList;return s?s.map((t=>e.getAssetPlayer(t.identifier))):[]},get playingIndex(){var t;const s=null==(t=l())?void 0:t.event;return s&&e.effectivePlayingAsset?s.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return l()}};this.manager={get events(){var t,s;return(null==(t=e.schedule)||null==(s=t.events)?void 0:s.slice(0))||[]},get schedule(){var t,s;return(null==(t=e.schedule)||null==(s=t.items)?void 0:s.slice(0))||[]},get interstitialPlayer(){return l()?h:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const s=t();return e.findItemIndex(s)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return n()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){o(e,"primary")},get duration(){return a("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){o(e,"integrated")},get duration(){return a("integrated")},get seekableStart(){var t;return r((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,s=null==t?void 0:t.event;if(s&&!s.restrictions.skip){const i=e.findItemIndex(t);if(s.appendInPlace){const e=t.playout.start+t.event.duration;o(e+.001,"playout")}else e.advanceAfterAssetEnded(s,i,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&s)&&this.findItemIndex(t)===s.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t,s;if(null===this.mediaSelection)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let n=this.media;!n&&null!=(e=this.bufferingItem)&&null!=(t=e.event)&&t.appendInPlace&&(n=this.primaryMedia);const a=null==(s=n)?void 0:s.currentTime;return void 0!==a&&i(a)?a:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,i=e.media;if(s&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i)return void(this.detachedData={media:i});const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ge(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var s,i;if(e.media===t)return;let r=null;const n=this.hls,a=e!==n,o=a&&e.interstitial.appendInPlace,l=null==(s=this.detachedData)?void 0:s.mediaSource;let h;if(n.media)o&&(r=n.transferMedia(),this.detachedData=r),h="Primary";else if(l){const e=this.getBufferingPlayer();e?(r=e.transferMedia(),h=`${e}`):h="detached MediaSource"}else h="detached media";if(!r)if(l)r=this.detachedData,this.log(`using detachedData: MediaSource ${Ge(r)}`);else if(!this.detachedData||n.media===t){const e=this.playerQueue;e.length>1&&e.forEach((e=>{if(a&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${t}`)}})),this.hls.detachMedia(),this.detachedData={media:t}}const c=r&&"mediaSource"in r&&"closed"!==(null==(i=r.mediaSource)?void 0:i.readyState),d=c&&r?r:t;if(this.log(`${c?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${h}`),d===r){const t=a&&e.assetId===this.schedule.assetIdAtEnd;d.overrides={duration:this.schedule.duration,endOfStream:!a||t,cueRemoval:!a}}e.attachMedia(d)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const s=this.timelinePos,i=this.effectivePlayingItem;if(-1===s){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const s=e.findEventIndex(t[0].identifier);this.setSchedulePosition(s)}else if(s>=0||!this.primaryLive){const t=this.timelinePos=s>0?s:0,i=e.findItemIndexAtTime(t);this.setSchedulePosition(i)}}else if(i&&!this.playingItem){const t=e.findItemIndex(i);this.setSchedulePosition(t)}}advanceAfterAssetEnded(e,t,s){const i=s+1;if(e.isAssetPastPlayoutLimit(i)||e.assetList[i].error){const s=this.schedule.items;if(s){const i=t+1;if(i>=s.length)return void this.setSchedulePosition(-1);const r=e.resumeTime;this.timelinePos<r&&(this.timelinePos=r,this.checkBuffer()),this.setSchedulePosition(i)}}else this.setSchedulePosition(t,i)}setScheduleToAssetAtTime(e,t){const s=this.schedule,i=t.parentIdentifier,r=s.getEvent(i);if(r){const t=s.findEventIndex(i),n=s.findAssetIndex(r,e);this.setSchedulePosition(t,n)}}setSchedulePosition(e,t){const s=this.schedule.items;if(!s||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const i=e>=0?s[e]:null,r=this.playingItem,n=this.playingLastItem;if(this.isInterstitial(r)){var a;const h=r.event,c=this.playingAsset,d=null==c?void 0:c.identifier,u=d?this.getAssetPlayer(d):null;if(u&&d&&(!this.eventItemsMatch(r,i)||void 0!==t&&d!==(null==(a=h.assetList)?void 0:a[t].identifier))){var o;const t=h.findAssetIndex(c);this.log(`INTERSTITIAL_ASSET_ENDED ${t+1}/${h.assetList.length} ${Cn(c)}`),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(l.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:t,event:h,schedule:s.slice(0),scheduleIndex:e,player:u}),this.retreiveMediaSource(d,i),!u.media||null!=(o=this.detachedData)&&o.mediaSource||u.detachMedia()}if(!this.eventItemsMatch(r,i)&&(this.endedItem=r,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${Ln(r)}`),h.hasPlayed=!0,this.hls.trigger(l.INTERSTITIAL_ENDED,{event:h,schedule:s.slice(0),scheduleIndex:e}),h.cue.once)){this.updateSchedule();const e=this.schedule.items;if(i&&e){const s=this.schedule.findItemIndex(i);this.advanceSchedule(s,e,t,r,n)}return}}this.advanceSchedule(e,s,t,r,n)}advanceSchedule(e,t,s,i,r){const n=e>=0?t[e]:null,a=this.primaryMedia,o=this.playerQueue;if(o.length&&o.forEach((t=>{const s=t.interstitial,i=this.schedule.findEventIndex(s.identifier);(i<e||i>e+1)&&this.clearInterstitial(s,n)})),this.isInterstitial(n)){this.timelinePos=Math.min(Math.max(this.timelinePos,n.start),n.end);const r=n.event;void 0===s&&(s=this.schedule.findAssetIndex(r,this.timelinePos));const o=this.waitingItem;this.assetsBuffered(n,a)||this.setBufferingItem(n);let h=this.preloadAssets(r,s);if(this.eventItemsMatch(n,o||i)||(this.waitingItem=n,this.log(`INTERSTITIAL_STARTED ${Ln(n)} ${r.appendInPlace?"append in place":""}`),this.hls.trigger(l.INTERSTITIAL_STARTED,{event:r,schedule:t.slice(0),scheduleIndex:e})),!r.assetListLoaded)return void this.log(`Waiting for ASSET-LIST to complete loading ${r}`);if(r.assetListLoader&&(r.assetListLoader.destroy(),r.assetListLoader=void 0),!a)return void this.log(`Waiting for attachMedia to start Interstitial ${r}`);this.waitingItem=this.endedItem=null,this.playingItem=n;const c=r.assetList[s];if(!c){const i=t[e+1],n=this.media;return i&&n&&!this.isInterstitial(i)&&n.currentTime<i.start&&(n.currentTime=this.timelinePos=i.start),void this.advanceAfterAssetEnded(r,e,s||0)}if(h||(h=this.getAssetPlayer(c.identifier)),null===h||h.destroyed){const e=r.assetList.length;this.warn(`asset ${s+1}/${e} player destroyed ${r}`),h=this.createAssetPlayer(r,c,s)}if(!this.eventItemsMatch(n,this.bufferingItem)&&r.appendInPlace&&this.isAssetBuffered(c))return;this.startAssetPlayer(h,s,t,e,a),this.shouldPlay&&xn(h.media)}else null!==n?(this.resumePrimary(n,e,i),this.shouldPlay&&xn(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e,t;return null==(e=this.mediaSelection)||null==(t=e.main)?void 0:t.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,s){var i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ln(e)}`),null==(i=this.detachedData)||!i.mediaSource){let s=this.timelinePos;(s<e.start||s>=e.end)&&(s=this.getPrimaryResumption(e,t),this.timelinePos=s),this.attachPrimary(s,e)}if(!s)return;const r=this.schedule.items;r&&(this.log(`resumed ${Ln(e)}`),this.hls.trigger(l.INTERSTITIALS_PRIMARY_RESUMED,{schedule:r.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(s<e.fragmentStart||s>e.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return null!=t&&t.hls?t.hls.bufferedToEnd:Pt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),s&&this.startLoadingPrimaryAt(e,s)),s||(this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs(((null==(s=i.mainForwardBufferInfo)?void 0:s.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(l.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(l.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level)return;const s=this.hls.levels[t.level],i=T(T({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=T(T({},this.altSelection),{},{audio:s}));const r=T(T({},i),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i)return void(this.altSelection=T(T({},this.altSelection),{},{subtitles:s}));const r=T(T({},i),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=Ke(t);this.playerQueue.forEach((e=>e.hls.setAudioOption(t)||e.hls.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=Ke(t);this.playerQueue.forEach((e=>e.hls.setSubtitleOption(t)||-1!==t.id&&e.hls.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const i=t[e];if(i.cue.post){var s;const e=this.schedule.findEventIndex(i.identifier),t=null==(s=this.schedule.items)?void 0:s[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){const s=this.schedule.items;return e&&s&&s[this.findItemIndex(e,t)]||null}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===(null==(s=t.event)?void 0:s.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const s=Pt.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,t,e)}updateBufferedPos(e,t,s){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e)return;if(1===t.length&&this.itemsMatch(t[0],r))return void(this.bufferedPos=e);const n=this.playingItem,a=this.findItemIndex(n);let o=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l,h;const s=this.findItemIndex(r),i=Math.min(s+1,t.length-1),n=t[i];if((-1===o&&r&&e>=r.end||null!=(l=n.event)&&l.appendInPlace&&e+.01>=n.start)&&(o=i),i-a>1&&!1===(null==r||null==(h=r.event)?void 0:h.appendInPlace))return;if(this.bufferedPos=e,o>s&&o>a)this.bufferedToItem(n);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&n.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(n)&&this.preloadAssets(n.event,0)}}else s&&n&&!this.itemsMatch(n,r)&&(o===a?this.bufferedToItem(n):o===a+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some((e=>{const s=this.getAssetPlayer(e.identifier);return!(null!=s&&s.bufferedInPlaceToEnd(t))}))}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:i,events:r}=s;if(!i||!r)return t;const n=this.isInterstitial(e),a=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){const s=a?a.remaining:t?t.end-this.timelinePos:0;this.log(`buffered to boundary ${Ln(e)}`+(t?` (${s.toFixed(2)} remaining)`:"")),n?e.event.assetList.forEach((e=>{const t=this.getAssetPlayer(e.identifier);t&&t.resumeBuffering()})):(this.hls.resumeBuffering(),this.playerQueue.forEach((e=>e.pauseBuffering())))}this.hls.trigger(l.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==s){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,i=0===s.assetList.length&&!s.assetListLoader,r=s.cue.once;if(i||!r){const e=this.preloadAssets(s,t);if(null!=e&&e.interstitial.appendInPlace){const i=s.assetList[t],r=this.primaryMedia;i&&r&&this.bufferAssetPlayer(e,r)}}}preloadAssets(e,t){const s=e.assetUrl,i=e.assetList.length,r=0===i&&!e.assetListLoader,n=e.cue.once;if(r){const r=e.timelineStart;if(e.appendInPlace){var a;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(a=t.nextEvent)?void 0:a.identifier)!==e.identifier||this.flushFrontBuffer(r+.25)}let n,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-r;e>0&&(n=Math.round(1e3*e)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:i} ${e}${n?` live-start: ${o} start-offset: ${n}`:""}`),s)return this.createAsset(e,0,0,r,e.duration,s);const l=this.assetListLoader.loadAssetList(e,n);l&&(e.assetListLoader=l)}else if(!n&&i){for(let s=t;s<i;s++){const t=e.assetList[s],i=this.getAssetPlayerQueueIndex(t.identifier);-1!==i&&!this.playerQueue[i].destroyed||t.error||this.createAssetPlayer(e,t,s)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;t&&(this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach((t=>{this.hls.trigger(l.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})})))}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s];return null}createAsset(e,t,s,i,r,n){const a={parentIdentifier:e.identifier,identifier:Tn(e,n,t),duration:r,startOffset:s,timelineStart:i,uri:n};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,s){this.log(`create HLSAssetPlayer for ${Cn(t)}`);const i=this.hls,r=i.userConfig;let n=r.videoPreference;const h=i.loadLevelObj||i.levels[i.currentLevel];(n||h)&&(n=_({},n),h.videoCodec&&(n.videoCodec=h.videoCodec),h.videoRange&&(n.allowedVideoRanges=[h.videoRange]));const c=i.audioTracks[i.audioTrack],d=i.subtitleTracks[i.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const s=t.duration;s&&e<s&&(u=e)}}const p=t.identifier,f=T(T({},r),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:n,audioPreference:c||r.audioPreference,subtitlePreference:d||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const g=f.cmcd;null!=g&&g.sessionId&&g.contentId&&(f.cmcd=_({},g,{contentId:vn(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const m=new wn(this.HlsPlayerClass,f,e,t);this.playerQueue.push(m),e.assetList[s]=t;const y=i=>{if(i.live){const t=new Error(`Interstitials MUST be VOD assets ${e}`),i={fatal:!0,type:a.OTHER_ERROR,details:o.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};return void this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,t.message)}const r=i.edge-i.fragmentStart,n=t.duration;(null===n||r>n)&&(this.log(`Interstitial asset "${p}" duration change ${n} > ${r}`),t.duration=r,this.updateSchedule())};m.on(l.LEVEL_UPDATED,((e,{details:t})=>y(t))),m.on(l.LEVEL_PTS_UPDATED,((e,{details:t})=>y(t)));const v=(e,t)=>{const s=this.getAssetPlayer(p);if(s&&t.tracks){s.off(l.BUFFER_CODECS,v),s.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===s.assetItem&&e&&!s.media&&this.bufferAssetPlayer(s,e)}};m.on(l.BUFFER_CODECS,v);const b=()=>{var s;const i=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${i}`),!i)return;const r=this.schedule.findEventIndex(e.identifier),n=e.findAssetIndex(t),a=n+1,o=null==(s=this.schedule.items)?void 0:s[r];if(this.isInterstitial(o))if(-1===n||e.isAssetPastPlayoutLimit(a)||e.assetList[a].error){var l;const e=null==(l=this.schedule.items)?void 0:l[r+1];e&&this.bufferedToItem(e)}else this.bufferedToItem(o,a)};m.on(l.BUFFERED_TO_END,b);const A=t=>()=>{if(!this.getAssetPlayer(p))return;this.shouldPlay=!0;const s=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,s,t)};return m.once(l.MEDIA_ENDED,A(s)),m.once(l.PLAYOUT_LIMIT_REACHED,A(1/0)),m.on(l.ERROR,((t,i)=>{const r=this.getAssetPlayer(p);if(i.details!==o.BUFFER_STALLED_ERROR)this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${i.error} ${e}`);else if(null!=r&&r.media){const t=r.currentTime,s=r.duration-t;t&&e.appendInPlace&&s/r.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${p} ${e} at ${r.media.currentTime}`),b()):(this.warn(`Stalled at ${t} of ${t+s} in asset ${p} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}})),m.on(l.DESTROYING,(()=>{if(!this.getAssetPlayer(p))return;const t=new Error(`Asset player destroyed unexpectedly ${p}`),i={fatal:!0,type:a.OTHER_ERROR,details:o.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),s,t.message)})),this.hls.trigger(l.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:m}),m}clearInterstitial(e,t){e.assetList.forEach((e=>{this.clearAssetPlayer(e.identifier,t)})),e.reset()}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(-1!==s){this.log(`clearAssetPlayer "${e}" toSegment: ${t?Ln(t):t}`);const i=this.playerQueue[s];this.transferMediaFromPlayer(i,t),this.playerQueue.splice(s,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,i,r){const{interstitial:n,assetItem:a,assetId:o}=e,h=n.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,c&&c.identifier===o||(c&&(this.clearAssetPlayer(c.identifier,s[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${h} ${e}`),this.hls.trigger(l.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:n,schedule:s.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,i;const{interstitial:r,assetItem:n,assetId:l}=e,h=this.schedule.findEventIndex(r.identifier),c=null==(s=this.schedule.items)?void 0:s[h];if(!c)return;this.setBufferingItem(c),this.bufferingAsset=n;const d=this.getBufferingPlayer();if(d===e)return;const u=r.appendInPlace;if(u&&!1===(null==d?void 0:d.interstitial.appendInPlace))return;const p=(null==d?void 0:d.tracks)||(null==(i=this.detachedData)?void 0:i.tracks)||this.requiredTracks;if(u&&n!==this.playingAsset){if(!e.tracks)return;if(p&&!P(p,e.tracks)){const t=new Error(`Asset "${l}" SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),s={fatal:!0,type:a.OTHER_ERROR,details:o.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=r.findAssetIndex(n);return void this.handleAssetItemError(s,r,h,i,t.message)}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,s,i,r){if(e.details===o.BUFFER_STALLED_ERROR)return;const n=t.assetList[i]||null;let a=null;if(n){const e=this.getAssetPlayerQueueIndex(n.identifier);a=this.playerQueue[e]||null}const h=this.schedule.items,c=_({},e,{fatal:!1,errorAction:ht(!0),asset:n,assetListIndex:i,event:t,schedule:h,scheduleIndex:s,player:a});if(this.warn(`Asset item error: ${e.error}`),this.hls.trigger(l.INTERSTITIAL_ASSET_ERROR,c),!e.fatal)return;const d=new Error(r);n&&(this.playingAsset!==n&&this.clearAssetPlayer(n.identifier,null),n.error=d),t.assetList.some((e=>!e.error))?t.appendInPlace&&(t.error=d):t.error=d,this.primaryFallback(t)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;if(this.updateSchedule(),s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${s?Ln(s):"<none>"} error: ${e.error}`),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let i=this.timelinePos;-1===i&&(i=this.hls.startPosition);const r=this.updateItem(s,i);if(this.itemsMatch(s,r))this.clearInterstitial(e,null);else{const e=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(e)}}else this.checkStart()}onAssetListLoaded(e,t){var s;const i=t.event,r=i.identifier,n=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(r))return;const a=i.timelineStart,o=i.duration;let l=0;n.forEach(((e,t)=>{const s=parseFloat(e.DURATION);this.createAsset(i,t,l,a+l,s,e.URI),l+=s})),i.duration=l,this.log(`Loaded asset-list with duration: ${l} (was: ${o}) ${i}`);const h=this.waitingItem,c=(null==h?void 0:h.event.identifier)===r;this.updateSchedule();const d=null==(s=this.bufferingItem)?void 0:s.event;if(c){var u;const e=this.schedule.findEventIndex(r),t=null==(u=this.schedule.items)?void 0:u[e];if(t){if(!this.playingItem&&this.timelinePos>t.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),void this.primaryFallback(i);this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==d?void 0:d.identifier)===r&&d.appendInPlace){const e=i.assetList[0],t=this.getAssetPlayer(e.identifier),s=this.primaryMedia;e&&t&&s&&this.bufferAssetPlayer(t,s)}}onError(e,t){switch(t.details){case o.ASSET_LIST_PARSING_ERROR:case o.ASSET_LIST_LOAD_ERROR:case o.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&this.primaryFallback(e);break}case o.BUFFER_STALLED_ERROR:this.onTimeupdate(),this.checkBuffer(!0)}}}});function Ma(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(Ma):Object.keys(e).reduce(((t,s)=>(t[s]=Ma(e[s]),t)),{}):e}class Na extends kt{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(l.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const s=this.media=t.media;Pn(s,"playing",this.onMediaPlaying),Pn(s,"waiting",this.onMediaWaiting),Pn(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(Rn(s,"playing",this.onMediaPlaying),Rn(s,"waiting",this.onMediaWaiting),Rn(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,i;const r=null==(s=this.hls)?void 0:s.config;if(!r)return;const{media:n,stalled:a}=this;if(!n)return;const{seeking:o}=n,h=this.seeking&&!o,c=!this.seeking&&o,d=n.paused&&!o||n.ended||0===n.playbackRate;if(this.seeking=o,e!==t)return t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(c||h)return void(h&&this.stallResolved(e));if(d)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&n.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(l.MEDIA_ENDED,{stalled:!1})));if(!Pt.getBuffered(n).length)return void(this.nudgeRetry=0);const u=Pt.bufferInfo(n,e,0),p=u.nextStart||0,f=this.fragmentTracker;if(o&&f&&this.hls){const t=Fa(this.hls.inFlightFragments,e),s=u.len>2,i=!p||t||p-e>2&&!f.getPartialFragment(e);if(s||i)return;this.moved=!1}const g=null==(i=this.hls)?void 0:i.latestLevelDetails;if(!this.moved&&null!==this.stalled&&f){if(!(u.len>0||p))return;const t=Math.max(p,u.start||0)-e,s=null!=g&&g.live?2*g.targetduration:2,i=f.getPartialFragment(e);if(t>0&&(t<=s||i))return void(n.paused||this._trySkipBufferHole(i))}const m=r.detectStallWithCurrentTimeMs,y=self.performance.now(),v=this.waiting;if(null===a)return void(this.stalled=v>0&&y-v<m?v:y);const _=y-a;if(!o&&(_>=m||v)&&this.hls){var b;if("ended"===(null==(b=this.mediaSource)?void 0:b.readyState)&&(null==g||!g.live)&&Math.abs(e-((null==g?void 0:g.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(l.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(u),!this.media||!this.hls)return}const T=Pt.bufferInfo(n,e,r.maxBufferHole);this._tryFixBufferStall(T,_)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(l.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(s=this.buffered.audio)&&s.length&&i&&i.length>1&&e>i.end(0)){const s=Pt.bufferedInfo(Pt.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const s=Pt.timeRangesToArray(i),r=Pt.bufferedInfo(s,t,0).bufferedIndex;if(r>-1&&r<s.length-1){const t=Pt.bufferedInfo(s,e,0).bufferedIndex,i=s[r].end,n=s[r+1].start;if((-1===t||t>r)&&n-i<1&&e-i<2){const s=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${i} -> ${n} buffered index: ${t}`);this.warn(s.message),this.media.currentTime+=1e-6;const r=this.fragmentTracker.getPartialFragment(e)||void 0,h=Pt.bufferInfo(this.media,e,0);this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:s,reason:s.message,frag:r,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,t){var s,i;const{fragmentTracker:r,media:n}=this,a=null==(s=this.hls)?void 0:s.config;if(!n||!r||!a)return;const o=n.currentTime,l=null==(i=this.hls)?void 0:i.latestLevelDetails,h=r.getPartialFragment(o);if((h||null!=l&&l.live&&o<l.fragmentStart)&&(this._trySkipBufferHole(h)||!this.media))return;const c=e.buffered;(c&&c.length>1&&e.len>a.maxBufferHole||e.nextStart&&e.nextStart-o<a.maxBufferHole)&&(t>1e3*a.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}_reportStall(e){const{hls:t,media:s,stallReported:i,stalled:r}=this;if(!i&&null!==r&&s&&t){this.stallReported=!0;const i=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Ge(e)})`);this.warn(i.message),t.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:i}=this,r=null==(t=this.hls)?void 0:t.config;if(!i||!s||!r)return 0;const n=i.currentTime,h=Pt.bufferInfo(i,n,0),c=n<h.start?h.start:h.nextStart;if(c&&this.hls){const t=h.len<=r.maxBufferHole,u=h.len>0&&h.len<1&&i.readyState<3,f=c-n;if(f>0&&(t||u)){if(f>r.maxBufferHole){let t=!1;if(0===n){const e=s.getAppendedFrag(0,p);e&&c<e.end&&(t=!0)}if(!t){const t=e||s.getAppendedFrag(n,p);if(t){var d;if(null==(d=this.hls.loadLevelObj)||!d.details)return 0;if(Fa(this.hls.inFlightFragments,c))return 0;let e=!1,i=t.end;for(;i<c;){const t=s.getPartialFragment(i);if(!t){e=!0;break}i+=t.duration}if(e)return 0}}}const t=Math.max(c+.05,n+.1);if(this.warn(`skipping hole, adjusting currentTime from ${n} to ${t}`),this.moved=!0,i.currentTime=t,null==e||!e.gap){const s=new Error(`fragment loaded with buffer holes, seeking from ${n} to ${t}`);this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:s,reason:s.message,frag:e||void 0,buffer:h.len,bufferInfo:h})}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:i}=this,r=null==t?void 0:t.config;if(!s||!r)return 0;const n=s.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const h=n+(i+1)*r.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${n} to ${h}`);this.warn(c.message),s.currentTime=h,t.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1,buffer:e.len,bufferInfo:e})}else{const s=new Error(`Playhead still not moving while enough data buffered @${n} after ${r.nudgeMaxRetry} nudges`);this.error(s.message),t.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.BUFFER_STALLED_ERROR,error:s,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Fa(e,t){const s=Ba(e.main);if(s&&s.start<=t)return s;const i=Ba(e.audio);return i&&i.start<=t?i:null}function Ba(e){if(!e)return null;switch(e.state){case js.IDLE:case js.STOPPED:case js.ENDED:case js.ERROR:return null}return e.frag}function ja(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function Ua(e,t,s,i,r){let n=new e(t,s,"");try{n.value=i,r&&(n.type=r)}catch(a){n=new e(t,s,Ge(r?T({type:r},i):i))}return n}const $a=(()=>{const e=ja();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Ha{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(l.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(l.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(l.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(l.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(l.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var s;this.media=t.media,!1===(null==(s=t.overrides)?void 0:s.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,t.transferMedia||(this.id3Track&&(this.removeCues&&gn(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if("metadata"===s.kind&&"id3"===s.label)return pn(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:s,enableID3MetadataCues:i}}}=this;if(!s&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const n=ja();if(n)for(let e=0;e<r.length;e++){const t=r[e].type;if(t===vi.emsg&&!s||!i)continue;const a=fi(r[e].data);if(a){const s=r[e].pts;let i=s+r[e].duration;i>$a&&(i=$a),i-s<=0&&(i=s+.25);for(let e=0;e<a.length;e++){const r=a[e];if(!gi(r)){this.updateId3CueEnds(s,t);const e=Ua(n,s,i,r,t);e&&this.id3Track.addCue(e)}}}}}updateId3CueEnds(e,t){var s;const i=null==(s=this.id3Track)?void 0:s.cues;if(i)for(let s=i.length;s--;){const r=i[s];r.type===t&&r.startTime<e&&r.endTime===$a&&(r.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:i}){const{id3Track:r,hls:n}=this;if(!n)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:o}}=n;if(r&&(a||o)){let e;e="audio"===i?e=>e.type===vi.audioId3&&o:"video"===i?e=>e.type===vi.emsg&&a:e=>e.type===vi.audioId3&&o||e.type===vi.emsg&&a,mn(r,t,s,e)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:s}=this,{dateRanges:r}=e,n=Object.keys(r);let a=this.dateRangeCuesAppended;var o;if(s&&t)if(null!=(o=s.cues)&&o.length){const e=Object.keys(a).filter((e=>!n.includes(e)));for(let t=e.length;t--;){const i=e[t],r=a[i].cues;delete a[i],Object.keys(r).forEach((e=>{try{const t=r[e];t.removeEventListener("enter",this.onEventCueEnter),s.removeCue(t)}catch(e){}}))}}else a=this.dateRangeCuesAppended={};const l=e.fragments[e.fragments.length-1];if(0===n.length||!i(null==l?void 0:l.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const h=ja();for(let e=0;e<n.length;e++){const t=n[e],s=r[t],i=s.startTime,o=a[t],l=(null==o?void 0:o.cues)||{};let u=(null==o?void 0:o.durationKnown)||!1,p=$a;const{duration:f,endDate:g}=s;if(g&&null!==f)p=i+f,u=!0;else if(s.endOnNext&&!u){const e=n.reduce(((e,t)=>{if(t!==s.id){const i=r[t];if(i.class===s.class&&i.startDate>s.startDate&&(!e||s.startDate<e.startDate))return i}return e}),null);e&&(p=e.startTime,u=!0)}const m=Object.keys(s.attr);for(let e=0;e<m.length;e++){const r=m[e];if("ID"===(d=r)||"CLASS"===d||"CUE"===d||"START-DATE"===d||"DURATION"===d||"END-DATE"===d||"END-ON-NEXT"===d)continue;const n=l[r];if(n)u&&!o.durationKnown?n.endTime=p:Math.abs(n.startTime-i)>.01&&(n.startTime=i,n.endTime=p);else if(h){let e=s.attr[r];jt(r)&&(c=e,e=Uint8Array.from(c.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);const n=Ua(h,i,p,{key:r,data:e},vi.dateRange);n&&(n.id=t,this.id3Track.addCue(n),l[r]=n,this.hls.config.interstitialsController&&("X-ASSET-LIST"!==r&&"X-ASSET-URL"!==r||n.addEventListener("enter",this.onEventCueEnter)))}}a[t]={cues:l,dateRange:s,durationKnown:u}}var c,d}}class Va{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const s=this.computeLatency();if(null===s)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:r}=this.config;if(!i||1===r||!t.live)return;const n=this.targetLatency;if(null===n)return;const a=s-n;if(a<Math.min(this.maxLatency,n+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),s=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,i=Math.min(t,Math.max(1,s));this.changeMediaPlaybackRate(e,i)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:s,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:n,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&s||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:n*i);const h=i;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,h)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const s=this.levelDetails;if(null===s)return null;const i=s.edge,r=e-t-this.edgeStalled,n=i-s.totalduration,a=i-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(n,r),a)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(l.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(l.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(l.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(l.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===o.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(s=this.levelDetails)&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,i;e.playbackRate!==t&&(null==(s=this.hls)||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${null==(i=this.targetLatency)?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class Ga extends yr{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(l.LEVEL_LOADED,this.onLevelLoaded,this),e.on(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(l.FRAG_BUFFERED,this.onFragBuffered,this),e.on(l.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(l.LEVEL_LOADED,this.onLevelLoaded,this),e.off(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(l.FRAG_BUFFERED,this.onFragBuffered,this),e.off(l.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,i=[],r={},n={};let a=!1,o=!1,l=!1;t.levels.forEach((e=>{var t;const h=e.attrs;let{audioCodec:c,videoCodec:d}=e;c&&(e.audioCodec=c=Le(c,s)||void 0),0===(null==(t=d)?void 0:t.indexOf("avc1"))&&(d=e.videoCodec=function(e){const t=e.split(",");for(let e=0;e<t.length;e++){const s=t[e].split(".");if(s.length>2){let i=s.shift()+".";i+=parseInt(s.shift()).toString(16),i+=("000"+parseInt(s.shift()).toString(16)).slice(-4),t[e]=i}}return t.join(",")}(d));const{width:u,height:p,unknownCodecs:f}=e;let g=f?f.length:0;if(f)for(let t=g;t--;){const s=f[t];this.isAudioSupported(s)?(e.audioCodec=c=c?`${c},${s}`:s,g--,_e.audio[c.substring(0,4)]=2):this.isVideoSupported(s)&&(e.videoCodec=d=d?`${d},${s}`:s,g--,_e.video[d.substring(0,4)]=2)}if(a||(a=!(!u||!p)),o||(o=!!d),l||(l=!!c),g||c&&!this.isAudioSupported(c)||d&&!this.isVideoSupported(d))return void this.log(`Some or all CODECS not supported "${h.CODECS}"`);const{CODECS:m,"FRAME-RATE":y,"HDCP-LEVEL":v,"PATHWAY-ID":_,RESOLUTION:b,"VIDEO-RANGE":T}=h,A=`${_||"."}-${e.bitrate}-${b}-${y}-${m}-${T}-${v}`;if(r[A])if(r[A].uri===e.url||e.attrs["PATHWAY-ID"])r[A].addGroupId("audio",h.AUDIO),r[A].addGroupId("text",h.SUBTITLES);else{const t=n[A]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const s=this.createLevel(e);r[A]=s,i.push(s)}else{const t=this.createLevel(e);r[A]=t,n[A]=1,i.push(t)}})),this.filterAndSortMediaOptions(i,t,a,o,l)}createLevel(e){const t=new He(e),s=e.supplemental;if(null!=s&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const e=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(e.message),t.supportedResult=Oe(e,[])}return t}isAudioSupported(e){return Te(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Te(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,i,r){let n=[],h=[],c=e;if((s||i)&&r&&(c=c.filter((({videoCodec:e,videoRange:t,width:s,height:i})=>{return(!!e||!(!s||!i))&&!!(r=t)&&je.indexOf(r)>-1;var r}))),0===c.length)return void Promise.resolve().then((()=>{if(this.hls){let e="no level with compatible codecs found in manifest",s=e;t.levels.length&&(s=`one or more CODECS in variant not supported: ${Ge(t.levels.map((e=>e.attrs.CODECS)).filter(((e,t,s)=>s.indexOf(e)===t)))}`,this.warn(s),e+=` (${s})`);const i=new Error(e);this.hls.trigger(l.ERROR,{type:a.MEDIA_ERROR,details:o.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:i,reason:s})}}));t.audioTracks&&(n=t.audioTracks.filter((e=>!e.audioCodec||this.isAudioSupported(e.audioCodec))),Wa(n)),t.subtitles&&(h=t.subtitles,Wa(h));const d=c.slice(0);c.sort(((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return je.indexOf(e.videoRange)-je.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const s=Se(e.videoCodec),i=Se(t.videoCodec);if(s!==i)return i-s}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const s=Ce(e.codecSet),i=Ce(t.codecSet);if(s!==i)return i-s}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0}));let u=d[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==d.length))for(let e=0;e<d.length;e++)if(d[e].pathwayId===c[0].pathwayId){u=d[e];break}this._levels=c;for(let e=0;e<c.length;e++)if(c[e]===u){var p;this._firstLevel=e;const t=u.bitrate,s=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${t}`),void 0===(null==(p=this.hls.userConfig)?void 0:p.abrEwmaDefaultEstimate)){const e=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);e>s&&s===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=e)}break}const f=r&&!i,g=this.hls.config,m=!(!g.audioStreamController||!g.audioTrackController),y={levels:c,audioTracks:n,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:m&&!f&&n.some((e=>!!e.url))};this.hls.trigger(l.MANIFEST_PARSED,y)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const s=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:s,reason:s.message}),i)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,n=t[e],h=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=n,s===e&&i&&r===h)return;this.log(`Switching to level ${e} (${n.height?n.height+"p ":""}${n.videoRange?n.videoRange+" ":""}${n.codecSet?n.codecSet+" ":""}@${n.bitrate})${h?" with Pathway "+h:""} from level ${s}${r?" with Pathway "+r:""}`);const c={level:e,attrs:n.attrs,details:n.details,bitrate:n.bitrate,averageBitrate:n.averageBitrate,maxBitrate:n.maxBitrate,realBitrate:n.realBitrate,width:n.width,height:n.height,codecSet:n.codecSet,audioCodec:n.audioCodec,videoCodec:n.videoCodec,audioGroups:n.audioGroups,subtitleGroups:n.subtitleGroups,loaded:n.loaded,loadError:n.loadError,fragmentError:n.fragmentError,name:n.name,id:n.id,uri:n.uri,url:n.url,urlId:0,audioGroupIds:n.audioGroupIds,textGroupIds:n.textGroupIds};this.hls.trigger(l.LEVEL_SWITCHING,c);const d=n.details;if(!d||d.live){const e=this.switchParams(n.uri,null==i?void 0:i.details,d);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter((e=>-1!==t.indexOf(e)));if(e.length<1)return void this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);this.steering.pathwayPriority=s}}onError(e,t){!t.fatal&&t.context&&t.context.type===c&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===p){const e=t.elementaryStreams;if(!Object.keys(e).some((t=>!!e[t])))return;const s=this._levels[t.level];null!=s&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var s;const{level:i,details:r}=t,n=t.levelInfo;var a;if(!n)return this.warn(`Invalid level index ${i}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(r.deltaUpdateFailed=!0));if(n===this.currentLevel||t.withoutMultiVariant){0===n.fragmentError&&(n.loadError=0);let e=n.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(i,t,e)}else null!=(s=t.deliveryDirectives)&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],n=e.details,a=null==n?void 0:n.age;this.log(`Loading level index ${i}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${a&&n.live?" age "+a.toFixed(1)+(n.type?" "+n.type||0:""):""} ${s}`),this.hls.trigger(l.LEVEL_LOADING,{url:s,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const s=this._levels.filter(((t,s)=>s!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach((e=>e.level=-1))),!1)));Ds(s),this._levels=s,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=s.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(l.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(l.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function Wa(e){const t={};e.forEach((e=>{const s=e.groupId||"";e.id=t[s]=t[s]||0,t[s]++}))}function za(){return self.SourceBuffer||self.WebKitSourceBuffer}function Ka(){if(!I())return!1;const e=za();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class qa extends Us{constructor(e,t,s){super(e,t,s,"stream-controller",p),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!i(t))return;if(this.log(`Media seeked to ${t.toFixed(3)}`),!this.getBufferedFrag(t))return;const s=this.getFwdBufferInfoAtPos(e,t,p,0);null!==s&&0!==s.len?this.tick():this.warn(`Main forward buffer length at ${t} on "seeked" event ${s?s.len:"empty"})`)},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(l.MANIFEST_PARSED,this.onManifestParsed,this),e.on(l.LEVEL_LOADING,this.onLevelLoading,this),e.on(l.LEVEL_LOADED,this.onLevelLoaded,this),e.on(l.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(l.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(l.BUFFER_CREATED,this.onBufferCreated,this),e.on(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(l.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(l.MANIFEST_PARSED,this.onManifestParsed,this),e.off(l.LEVEL_LOADED,this.onLevelLoaded,this),e.off(l.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(l.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(l.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(l.BUFFER_CREATED,this.onBufferCreated,this),e.off(l.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(l.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(l.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.firstAutoLevel),i.nextLoadLevel=e,this.level=i.loadLevel,this._hasEnoughToStart=!!t}s>0&&-1===e&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=js.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=js.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case js.WAITING_LEVEL:{const{levels:e,level:t}=this,s=null==e?void 0:e[t],i=null==s?void 0:s.details;if(i&&(!i.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(i))break;this.state=js.IDLE;break}if(this.hls.nextLoadLevel!==this.level){this.state=js.IDLE;break}break}case js.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),s=this.retryDate;if(!s||t>=s||null!=(e=this.media)&&e.seeking){const{levels:e,level:t}=this,s=null==e?void 0:e[t];this.resetStartWhenNotLoaded(s||null),this.state=js.IDLE}}}this.state===js.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:i}=this;if(null===t||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==s||!s[r])return;const n=s[r],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(l.BUFFER_EOS,e),void(this.state=js.ENDED)}if(!this.buffering)return;e.loadLevel!==r&&-1===e.manualLevel&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const h=n.details;if(!h||this.state===js.WAITING_LEVEL||this.waitForLive(n))return this.level=r,this.state=js.WAITING_LEVEL,void(this.startFragRequested=!1);const c=a.len,d=this.getMaxBufferLength(n.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const u=this.backtrackFragment?this.backtrackFragment.start:a.end;let f=this.getNextFragment(u,h);if(this.couldBacktrack&&!this.fragPrevious&&f&&H(f)&&this.fragmentTracker.getState(f)!==pt){var g;const e=(null!=(g=this.backtrackFragment)?g:f).sn-h.startSN,t=h.fragments[e-1];t&&f.cc===t.cc&&(f=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,u)){if(!f.gap){const e=this.audioOnly&&!this.altAudio?B:j,t=(e===j?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,p)}f=this.getNextFragmentLoopLoading(f,h,a,p,d)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,n,u))}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);i===ct||i===ut?H(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,p)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let s;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],i=this.fragLastKbps;s=i&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*i)+1:0}else s=0;const n=this.getBufferedFrag(t.currentTime+s);if(n){const e=this.followingBufferedFrag(n);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,s=e.duration,i=Math.max(n.end,t+Math.min(Math.max(s-this.config.maxFragLookUpTolerance,s*(this.couldBacktrack?.5:.125)),s*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case js.KEY_LOADING:case js.FRAG_LOADING:case js.FRAG_LOADING_WAITING_RETRY:case js.PARSING:case js.PARSED:this.state=js.IDLE}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Pn(s,"playing",this.onMediaPlaying),Pn(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(Rn(s,"playing",this.onMediaPlaying),Rn(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(l.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,i=!1;t.levels.forEach((e=>{const t=e.audioCodec;t&&(s=s||-1!==t.indexOf("mp4a.40.2"),i=i||-1!==t.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=s&&i&&!function(){var e;const t=za();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==js.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=js.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:i,startFragRequested:r}=this,n=t.level,a=t.details,o=a.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${n}`);this.log(`Level ${n} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${o}`);const h=t.levelInfo,c=this.fragCurrent;!c||this.state!==js.FRAG_LOADING&&this.state!==js.FRAG_LOADING_WAITING_RETRY||c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(a.live||null!=(s=h.details)&&s.live){var u;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,h.details,null==(u=this.levelLastLoaded)?void 0:u.details)}if(h.details=a,this.levelLastLoaded=h,r||this.setStartPosition(a,d),this.hls.trigger(l.LEVEL_UPDATED,{details:a,level:n}),this.state===js.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=js.IDLE}r&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),n=e.fragmentStart,a=e.edge,o=r>=n-t.maxFragLookUpTolerance&&r<=a;if(null!==i&&s.duration>i&&(r<i||!o)){const n=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&s.readyState<4||r<a-n)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),s.readyState&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),s.currentTime=i))}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{levels:n}=this;if(!n)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);const a=n[s.level];if(!a)return void this.warn(`Level ${s.level} not found on progress`);const o=a.details;if(!o)return this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),void this.fragmentTracker.removeFragment(s);const l=a.videoCodec,h=o.PTSKnown||!o.live,c=null==(t=s.initSegment)?void 0:t.data,d=this._getAudioCodec(a),u=this.transmuxer=this.transmuxer||new mr(this.hls,p,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,g=-1!==f,m=new Lt(s.level,s.sn,s.stats.chunkCount,r.byteLength,f,g),y=this.initPTS[s.cc];u.push(r,c,d,l,s,i,o.totalduration,h,m,y)}onAudioTrackSwitching(e,t){const s=this.hls,i=2===this.altAudio;if(Ze(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i)return this.fragmentTracker.removeAllFragments(),s.once(l.BUFFER_FLUSHED,(()=>{var e;null==(e=this.hls)||e.trigger(l.AUDIO_TRACK_SWITCHED,t)})),void s.trigger(l.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});s.trigger(l.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Ze(t.url,this.hls);if(s){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let i,r,n=!1;for(const e in s){const t=s[e];if("main"===t.id){if(r=e,i=t,"video"===e){const t=s[e];t&&(this.videoBuffer=t.buffer)}}else n=!0}n&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:i}=t,r=s.type===p;if(r){if(this.fragContextChanged(s))return this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===js.PARSED&&(this.state=js.IDLE));const e=i?i.stats:s.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),H(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,i)}const n=this.media;n&&(!this._hasEnoughToStart&&Pt.getBuffered(n).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal)this.state=js.ERROR;else switch(t.details){case o.FRAG_GAP:case o.FRAG_PARSING_ERROR:case o.FRAG_DECRYPT_ERROR:case o.FRAG_LOAD_ERROR:case o.FRAG_LOAD_TIMEOUT:case o.KEY_LOAD_ERROR:case o.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(p,t);break;case o.LEVEL_LOAD_ERROR:case o.LEVEL_LOAD_TIMEOUT:case o.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==js.WAITING_LEVEL||(null==(s=t.context)?void 0:s.type)!==c||(this.state=js.IDLE);break;case o.BUFFER_ADD_CODEC_ERROR:case o.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.resetLoadingState();break;case o.BUFFER_FULL_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case o.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=js.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==B||!this.altAudio){const e=(t===j?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,t,p),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking)return void this.log(`could not seek to ${s}, already seeking at ${t}`);const i=this.timelineOffset;i&&s&&(s+=i);const r=this.getLevelDetails(),n=Pt.getBuffered(e),a=n.length?n.start(0):0,o=a-s,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);o>0&&(o<l||this.loadingParts&&o<2*((null==r?void 0:r.partTarget)||0))&&(this.log(`adjusting start position by ${o} to match buffer start`),s+=o,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${a}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((e=>{const{hls:s}=this,i=null==e?void 0:e.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=js.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const r=i.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),s.trigger(l.FRAG_LOADED,e),i.bitrateTest=!1}))}_handleTransmuxComplete(e){var t;const s=this.playlistType,{hls:r}=this,{remuxResult:n,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o)return void this.resetWhenMissingContext(a);const{frag:h,part:c,level:d}=o,{video:u,text:p,id3:f,initSegment:g}=n,{details:m}=d,y=this.altAudio?void 0:n.audio;if(this.fragContextChanged(h))this.fragmentTracker.removeFragment(h);else{if(this.state=js.PARSING,g){if(null!=g&&g.tracks){const e=h.initSegment||h;this._bufferInitSegment(d,g.tracks,e,a),r.trigger(l.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:s,tracks:g.tracks})}const e=g.initPTS,t=g.timescale;i(e)&&(this.initPTS[h.cc]={baseTime:e,timescale:t},r.trigger(l.INIT_PTS_FOUND,{frag:h,id:s,initPTS:e,timescale:t}))}if(u&&m){y&&"audiovideo"===u.type&&this.logMuxedErr(h);const e=m.fragments[h.sn-1-m.startSN],t=h.sn===m.startSN,s=!e||h.cc>e.cc;if(!1!==n.independent){const{startPTS:e,endPTS:i,startDTS:r,endDTS:n}=u;if(c)c.elementaryStreams[u.type]={startPTS:e,endPTS:i,startDTS:r,endDTS:n};else if(u.firstKeyFrame&&u.independent&&1===a.id&&!s&&(this.couldBacktrack=!0),u.dropped&&u.independent){const r=this.getMainFwdBufferInfo(),a=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,o=u.firstKeyFramePTS?u.firstKeyFramePTS:e;if(!t&&a<o-this.config.maxBufferHole&&!s)return void this.backtrack(h);s&&(h.gap=!0),h.setElementaryStreamInfo(u.type,h.start,i,h.start,n,!0)}else t&&e-(m.appliedTimelineOffset||0)>2&&(h.gap=!0);h.setElementaryStreamInfo(u.type,e,i,r,n),this.backtrackFragment&&(this.backtrackFragment=h),this.bufferFragmentData(u,h,c,a,t||s)}else{if(!t&&!s)return void this.backtrack(h);h.gap=!0}}if(y){const{startPTS:e,endPTS:t,startDTS:s,endDTS:i}=y;c&&(c.elementaryStreams[B]={startPTS:e,endPTS:t,startDTS:s,endDTS:i}),h.setElementaryStreamInfo(B,e,t,s,i),this.bufferFragmentData(y,h,c,a)}if(m&&null!=f&&null!=(t=f.samples)&&t.length){const e={id:s,frag:h,details:m,samples:f.samples};r.trigger(l.FRAG_PARSING_METADATA,e)}if(m&&p){const e={id:s,frag:h,details:m,samples:p.samples};r.trigger(l.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn(`${H(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,i){if(this.state!==js.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:n,audiovideo:a}=t;if(r){let s=Ie(r.codec,e.audioCodec);"mp4a"===s&&(s="mp4a.40.5");const i=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){s&&(s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=r.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===i.indexOf("firefox")&&(s="mp4a.40.5")}s&&-1!==s.indexOf("mp4a.40.5")&&-1!==i.indexOf("android")&&"audio/mpeg"!==r.container&&(s="mp4a.40.2",this.log(`Android: force audio codec to ${s}`)),e.audioCodec&&e.audioCodec!==s&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${s}"`),r.levelCodec=s,r.id=p,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${s||""}/${e.audioCodec||""}/${r.codec}]`),delete t.audiovideo}if(n){n.levelCodec=e.videoCodec,n.id=p;const s=n.codec;if(4===(null==s?void 0:s.length))switch(s){case"hvc1":case"hev1":n.codec="hvc1.1.6.L120.90";break;case"av01":n.codec="av01.0.04M.08";break;case"avc1":n.codec="avc1.42e01e"}this.log(`Init video buffer, container:${n.container}, codecs[level/parsed]=[${e.videoCodec||""}/${s}]${n.codec!==s?" parsed-corrected="+n.codec:""}${n.supplemental?" supplemental="+n.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(l.BUFFER_CODECS,t),!this.hls)return;o.forEach((e=>{const r=t[e].initSegment;null!=r&&r.byteLength&&this.hls.trigger(l.BUFFER_APPENDING,{type:e,data:r,frag:s,part:null,chunkMeta:i,parent:s.type})}))}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,p)}get maxBufferLength(){const{levels:e,level:t}=this,s=null==e?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=js.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const s=e.currentTime;if(Pt.isBuffered(e,s)?t=this.getAppendedFrag(s):Pt.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,s=t.level;e&&t.sn===e.sn&&e.level===s||(this.fragPlaying=t,this.hls.trigger(l.FRAG_CHANGED,{frag:t}),e&&e.level===s||this.hls.trigger(l.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return i(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(i(t)){const e=this.getLevelDetails(),s=this.currentFrag||(e?et(null,e.fragments,t):null);if(s){const e=s.programDateTime;if(null!==e){const i=e+1e3*(t-s.start);return new Date(i)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Ya{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[s].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=o.KEY_LOAD_ERROR,s,i,r){return new wt({type:a.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:s,cc:i}=e;for(let e=0;e<t.length;e++){const r=t[e];if(i<=r.cc&&("initSegment"===s||"initSegment"===r.sn||s<r.sn)){this.emeController.selectKeySystemFormat(r).then((e=>{r.setKeyFormat(e)}));break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}loadInternal(e,t){var s,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const s=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,o.KEY_LOAD_ERROR,s))}const n=r.uri;if(!n)return Promise.reject(this.createKeyLoadError(e,o.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${n}"`)));let a=this.keyUriToKeyInfo[n];if(null!=(s=a)&&s.decryptdata.key)return r.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});var l;if(null!=(i=a)&&i.keyLoadPromise)switch(null==(l=a.mediaKeySessionContext)?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then((t=>(r.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:a})))}switch(a=this.keyUriToKeyInfo[n]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,o.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(s);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,s)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,i=new(0,s.loader)(s);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise(((r,n)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=s.keyLoadPolicy.default,h={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,s,i)=>{const{frag:a,keyInfo:l,url:h}=s;if(!a.decryptdata||l!==this.keyUriToKeyInfo[h])return n(this.createKeyLoadError(a,o.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));l.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,l.loader=null,r({frag:a,keyInfo:l})},onError:(e,s,i,r)=>{this.resetLoader(s),n(this.createKeyLoadError(t,o.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),i,T({url:a.url,data:void 0},e)))},onTimeout:(e,s,i)=>{this.resetLoader(s),n(this.createKeyLoadError(t,o.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:(e,s,i)=>{this.resetLoader(s),n(this.createKeyLoadError(t,o.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(a,h,c)}))}resetLoader(e){const{frag:t,keyInfo:s,url:i}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null),delete this.keyUriToKeyInfo[i],r&&r.destroy()}}function Xa(e){const{type:t}=e;switch(t){case d:return f;case u:return g;default:return p}}function Qa(e,t){let s=e.url;return void 0!==s&&0!==s.indexOf("data:")||(s=t.url),s}class Za{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(l.MANIFEST_LOADING,this.onManifestLoading,this),e.on(l.LEVEL_LOADING,this.onLevelLoading,this),e.on(l.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(l.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(l.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(l.MANIFEST_LOADING,this.onManifestLoading,this),e.off(l.LEVEL_LOADING,this.onLevelLoading,this),e.off(l.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(l.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(l.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,i=t.loader,r=new(s||i)(t);return this.loaders[e.type]=r,r}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:h,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:i,pathwayId:r,url:n,deliveryDirectives:a,levelInfo:o}=t;this.load({id:s,level:i,pathwayId:r,responseType:"text",type:c,url:n,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:n,track:a}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:d,url:r,deliveryDirectives:n,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:n,track:a}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:u,url:r,deliveryDirectives:n,levelOrTrack:a})}onLevelsUpdated(e,t){const s=this.loaders[c];if(s){const e=s.context;e&&!t.levels.some((t=>t===e.levelOrTrack))&&(s.abort(),delete this.loaders[c])}}load(e){var t;const s=this.hls.config;let r,n=this.getInternalLoader(e);if(n){const t=this.hls.logger,s=n.context;if(s&&s.levelOrTrack===e.levelOrTrack&&(s.url===e.url||s.deliveryDirectives&&!e.deliveryDirectives))return void(s.url===e.url?t.log(`[playlist-loader]: ignore ${e.url} ongoing request`):t.log(`[playlist-loader]: ignore ${e.url} in favor of ${s.url}`));t.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}if(r=e.type===h?s.manifestLoadPolicy.default:_({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),i(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===c&&null!==e.level?t=this.hls.levels[e.level].details:e.type===d&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===u&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,s=t.targetduration;if(e&&s){const t=1e3*Math.max(3*e,.8*s);r=_({},r,{maxTimeToFirstByteMs:Math.min(t,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,r.maxTimeToFirstByteMs)})}}}const a=r.errorRetry||r.timeoutRetry||{},o={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,s,i)=>{const r=this.getInternalLoader(s);this.resetInternalLoader(s.type);const n=e.data;0===n.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),us.isMediaPlaylist(n)||s.type!==h?this.handleTrackOrLevelPlaylist(e,t,s,i||null,r):this.handleMasterPlaylist(e,t,s,i)):this.handleManifestParsingError(e,s,new Error("no EXTM3U delimiter"),i||null,t)},onError:(e,t,s,i)=>{this.handleNetworkError(t,s,!1,e,i)},onTimeout:(e,t,s)=>{this.handleNetworkError(t,s,!0,void 0,e)}};n.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,i){const r=this.hls,n=e.data,a=Qa(e,s),o=us.parseMasterPlaylist(n,a);if(o.playlistParsingError)return void this.handleManifestParsingError(e,s,o.playlistParsingError,i,t);const{contentSteering:h,levels:c,sessionData:d,sessionKeys:u,startTimeOffset:p,variableList:f}=o;this.variableList=f;const{AUDIO:g=[],SUBTITLES:m,"CLOSED-CAPTIONS":y}=us.parseMasterPlaylistMedia(n,a,o);g.length&&(g.some((e=>!e.url))||!c[0].audioCodec||c[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Bt({}),bitrate:0,url:""}))),r.trigger(l.MANIFEST_LOADED,{levels:c,audioTracks:g,subtitles:m,captions:y,contentSteering:h,url:a,stats:t,networkDetails:i,sessionData:d,sessionKeys:u,startTimeOffset:p,variableList:f})}handleTrackOrLevelPlaylist(e,t,s,r,n){const a=this.hls,{id:o,level:c,type:d}=s,u=Qa(e,s),p=i(c)?c:i(o)?o:0,f=Xa(s),g=us.parseLevelPlaylist(e.data,u,p,f,0,this.variableList);if(d===h){const e={attrs:new Bt({}),bitrate:0,details:g,name:"",url:u};g.requestScheduled=t.loading.start+Is(g,0),a.trigger(l.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:u,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=g,this.handlePlaylistLoaded(g,e,t,s,r,n)}handleManifestParsingError(e,t,s,i,r){this.hls.trigger(l.ERROR,{type:a.NETWORK_ERROR,details:o.MANIFEST_PARSING_ERROR,fatal:t.type===h,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t,s=!1,i,r){let n=`A network ${s?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===c?n+=`: ${e.level} id: ${e.id}`:e.type!==d&&e.type!==u||(n+=` id: ${e.id} group-id: "${e.groupId}"`);const p=new Error(n);this.hls.logger.warn(`[playlist-loader]: ${n}`);let f=o.UNKNOWN,g=!1;const m=this.getInternalLoader(e);switch(e.type){case h:f=s?o.MANIFEST_LOAD_TIMEOUT:o.MANIFEST_LOAD_ERROR,g=!0;break;case c:f=s?o.LEVEL_LOAD_TIMEOUT:o.LEVEL_LOAD_ERROR,g=!1;break;case d:f=s?o.AUDIO_TRACK_LOAD_TIMEOUT:o.AUDIO_TRACK_LOAD_ERROR,g=!1;break;case u:f=s?o.SUBTITLE_TRACK_LOAD_TIMEOUT:o.SUBTITLE_LOAD_ERROR,g=!1}m&&this.resetInternalLoader(e.type);const y={type:a.NETWORK_ERROR,details:f,fatal:g,url:e.url,loader:m,context:e,error:p,networkDetails:t,stats:r};if(i){const s=(null==t?void 0:t.url)||e.url;y.response=T({url:s,data:void 0},i)}this.hls.trigger(l.ERROR,y)}handlePlaylistLoaded(e,t,s,i,r,n){const f=this.hls,{type:g,level:m,id:y,groupId:v,deliveryDirectives:_}=i,b=Qa(t,i),T=Xa(i),A="number"==typeof i.level&&T===p?m:void 0;if(!e.fragments.length){const n=e.playlistParsingError=new Error("No Segments found in Playlist");return void f.trigger(l.ERROR,{type:a.NETWORK_ERROR,details:o.LEVEL_EMPTY_ERROR,fatal:!1,url:b,error:n,reason:n.message,response:t,context:i,level:A,parent:T,networkDetails:r,stats:s})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const E=e.playlistParsingError;if(E){if(this.hls.logger.warn(E),!f.config.ignorePlaylistParsingErrors)return void f.trigger(l.ERROR,{type:a.NETWORK_ERROR,details:o.LEVEL_PARSING_ERROR,fatal:!1,url:b,error:E,reason:E.message,response:t,context:i,level:A,parent:T,networkDetails:r,stats:s});e.playlistParsingError=null}switch(e.live&&n&&(n.getCacheAge&&(e.ageHeader=n.getCacheAge()||0),n.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),g){case h:case c:f.trigger(l.LEVEL_LOADED,{details:e,levelInfo:i.levelOrTrack||f.levels[0],level:A||0,id:y||0,stats:s,networkDetails:r,deliveryDirectives:_,withoutMultiVariant:g===h});break;case d:f.trigger(l.AUDIO_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:y||0,groupId:v||"",stats:s,networkDetails:r,deliveryDirectives:_});break;case u:f.trigger(l.SUBTITLE_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:y||0,groupId:v||"",stats:s,networkDetails:r,deliveryDirectives:_})}}}class Ja{static get version(){return Ks}static isMSESupported(){return Ka()}static isSupported(){return function(){if(!Ka())return!1;const e=I();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((t=>e.isTypeSupported(Ee(t,"video"))))||["mp4a.40.2","fLaC"].some((t=>e.isTypeSupported(Ee(t,"audio")))))}()}static getMediaSource(){return I()}static get Events(){return l}static get MetadataSchema(){return vi}static get ErrorTypes(){return a}static get ErrorDetails(){return o}static get DefaultConfig(){return Ja.defaultConfig?Ja.defaultConfig:Oa}static set DefaultConfig(e){Ja.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new zs,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,s){const i=C();if("object"==typeof console&&!0===e||"object"==typeof e){const t=["debug","log","info","warn","error"];t.forEach((t=>{i[t]=w(t,e,s)}));try{i.log('Debug logs enabled for "Hls instance" in hls.js version 1.6.2')}catch(e){return C()}t.forEach((t=>{k[t]=w(t,e)}))}else _(k,i);return i}(e.debug||!1,0,e.assetPlayerId),s=this.config=function(e,t,s){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Ma(e),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const n=`${"level"===e?"playlist":e}LoadPolicy`,a=void 0===t[n],o=[];r.forEach((s=>{const r=`${e}Loading${s}`,l=t[r];if(void 0!==l&&a){o.push(r);const e=i[n].default;switch(t[n]={default:e},s){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),o.length&&s.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${n}": ${Ge(t[n])}`)})),T(T({},i),t)}(Ja.DefaultConfig,e,t);this.userConfig=e,s.progressive&&function(e,t){const s=e.loader;s!==Ia&&s!==Da?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}()&&(e.loader=Ia,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}(s,t);const{abrController:i,bufferController:r,capLevelController:n,errorController:a,fpsController:o}=s,h=new a(this),c=this.abrController=new i(this),d=new ft(this),u=s.interstitialsController,p=u?this.interstitialsController=new u(this,Ja):null,f=this.bufferController=new r(this,d),g=this.capLevelController=new n(this),m=new o(this),y=new Za(this),v=s.contentSteeringController,b=v?new v(this):null,A=this.levelController=new Ga(this,b),E=new Ha(this),S=new Ya(this.config),L=this.streamController=new qa(this,d,S),I=this.gapController=new Na(this,d);g.setStreamController(L),m.setStreamController(L);const P=[y,A,L];p&&P.splice(1,0,p),b&&P.splice(1,0,b),this.networkControllers=P;const R=[c,f,I,g,m,E,d];this.audioTrackController=this.createController(s.audioTrackController,P);const x=s.audioStreamController;x&&P.push(this.audioStreamController=new x(this,d,S)),this.subtitleTrackController=this.createController(s.subtitleTrackController,P);const D=s.subtitleStreamController;D&&P.push(this.subtititleStreamController=new D(this,d,S)),this.createController(s.timelineController,R),S.emeController=this.emeController=this.createController(s.emeController,R),this.cmcdController=this.createController(s.cmcdController,R),this.latencyController=this.createController(Va,R),this.coreComponents=R,P.push(h);const O=h.onErrorOut;"function"==typeof O&&this.on(l.ERROR,O,h),this.on(l.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,i){this._emitter.off(e,t,s,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;const s=e===l.ERROR;this.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.INTERNAL_EXCEPTION,fatal:s,event:e,error:t}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(l.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error(`attachMedia failed: invalid argument (${e})`);return void this.trigger(l.ERROR,{type:a.OTHER_ERROR,details:o.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,i=t?e:{media:s};this._media=s,this.trigger(l.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(l.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(l.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,i=this._url=N.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&s&&(s!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(l.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),this.started&&this.networkControllers);s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach((e=>{e.resumeBuffering&&e.resumeBuffering()})))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach((e=>{e.pauseBuffering&&e.pauseBuffering()})))}get inFlightFragments(){const e={[p]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[f]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[g]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?s:3&s|8).toString(16)}))}}}()),e}get levels(){return this.levelController.levels||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return Be.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let i=0;i<s;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let i;if(i=-1===t&&null!=e&&e.length?e.length-1:t,s)for(let t=i;t--;){const i=e[t].attrs["HDCP-LEVEL"];if(i&&i<=s)return t}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){return Fe(e,ze(t),navigator.mediaCapabilities)}}Ja.defaultConfig=void 0,s(7884);var eo=s(6673),to=s.n(eo);const so=to().getComponent("MenuItem"),io=to().dom||to();class ro extends so{constructor(e,t={}){const s=t.selected;t.selected=t.active,super(e,t);const i=e.qualityLevels();this.levels_=t.levels,this.selected_=s,this.handleQualityChange=this.handleQualityChange.bind(this),this.controlText(t.controlText),this.on(i,"change",this.handleQualityChange),this.on("dispose",(()=>{this.off(i,"change",this.handleQualityChange)}))}createEl(e,t,s){const i=super.createEl(e,t,s),r=io.createEl("span",{className:"vjs-quality-menu-item-sub-label",innerHTML:this.localize(this.options_.subLabel||"")});return this.subLabel_=r,i&&i.appendChild(r),i}handleClick(){this.updateSiblings_();const e=this.player().qualityLevels(),t=e.selectedIndex;for(let s=0,i=e.length;s<i;s++)s!==t&&(e[s].enabled=!1);for(let t=0,s=this.levels_.length;t<s;t++)e[this.levels_[t]].enabled=!0;-1!==t&&-1===this.levels_.indexOf(t)&&(e[t].enabled=!1)}handleQualityChange(){const e=this.player().qualityLevels(),t=this.levels_.indexOf(e.selectedIndex)>-1;this.selected(t)}selected(e){if(this.selectable)if(this.selected_){const t=this.options_.subLabel;this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(this.localize(t?"selected,":"selected"));const s=this.player().controlBar.getChild("QualityMenuButton");e?s.removeClass("vjs-quality-menu-button-waiting"):s.addClass("vjs-quality-menu-button-waiting")}else this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(this.options_.controlText)}updateSiblings_(){const e=this.player().qualityLevels(),t=this.player().controlBar.getChild("QualityMenuButton").items;for(let s=0,i=t.length;s<i;s++){const i=t[s],r=i.levels_.indexOf(e.selectedIndex)>-1;i.selected_=i===this,i.selected(r)}}}const no=to().getComponent("MenuButton"),ao=function(e){return Array.from(e).some((e=>e.height))},oo=function(e){return e>=2160?"4K":e>=720?"HD":""};to().registerComponent("QualityMenuButton",class extends no{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-label",this.localize("Quality Levels")),this.controlText("Quality Levels"),e.options().experimentalSvgIcons||this.$(".vjs-icon-placeholder").classList.add("vjs-icon-cog"),this.setIcon("cog"),this.qualityLevels_=e.qualityLevels(),this.update=this.update.bind(this),this.hide=this.hide.bind(this),this.handleQualityChange_=this.handleQualityChange_.bind(this),this.firstChangeHandler_=this.firstChangeHandler_.bind(this),this.enableDefaultResolution_=this.enableDefaultResolution_.bind(this),this.on(this.qualityLevels_,"addqualitylevel",this.update),this.on(this.qualityLevels_,"removequalitylevel",this.update),this.on(this.qualityLevels_,"change",this.handleQualityChange_),this.one(this.qualityLevels_,"change",this.firstChangeHandler_),e.on("adstart",this.hide),e.on(["adend","adtimeout"],this.update),this.update(),this.on("dispose",(()=>{this.off(this.qualityLevels_,"addqualitylevel",this.update),this.off(this.qualityLevels_,"removequalitylevel",this.update),this.off(this.qualityLevels_,"change",this.handleQualityChange_),this.off(this.qualityLevels_,"change",this.firstChangeHandler_),e.off("adstart",this.hide),e.off(["adend","adtimeout"],this.update),e.off("loadedmetadata",this.enableDefaultResolution_)}))}buildWrapperCSSClass(){return`vjs-quality-menu-wrapper ${super.buildWrapperCSSClass()}`}buildCSSClass(){return`vjs-quality-menu-button ${super.buildCSSClass()}`}createItems(){const e=[];if(!this.qualityLevels_||!this.qualityLevels_.length)return e;let t;if(this.options_.useResolutionLabels&&ao(this.qualityLevels_)?(t=this.groupByResolution_(),this.addClass("vjs-quality-menu-button-use-resolution")):(t=this.groupByBitrate_(),this.removeClass("vjs-quality-menu-button-use-resolution")),t.length<=1)return[];t.forEach((t=>{t.levels.length&&(t.selectable=!0,e.push(new ro(this.player(),t)))}));const s=new ro(this.player(),{levels:Array.prototype.map.call(this.qualityLevels_,((e,t)=>t)),label:this.localize("Auto"),controlText:"",active:!0,selected:!0,selectable:!0});return this.autoMenuItem_=s,e.push(s),e}groupByResolution_(){const e={},t=[];for(let s=0,i=this.qualityLevels_.length;s<i;s++){const i=this.qualityLevels_[s],r=this.qualityLevels_.selectedIndex===s,n=i.height;if(!n)continue;let a;if(a=this.options_.resolutionLabelBitrates?`${n}p @ ${Math.round(i.bitrate/1e3)} kbps`:n+"p",!e[a]){const s=oo(n);e[a]={levels:[],label:a,controlText:"",subLabel:s},t.push({label:a,lines:n})}r&&(e[a].active=!0),e[a].levels.push(s)}t.sort(((e,t)=>t.lines-e.lines));const s=[];return t.forEach((t=>{s.push(e[t.label])})),s}groupByBitrate_(){const e=[{levels:[],label:"HD",controlText:"High Definition"},{levels:[],label:"SD",controlText:"Standard Definition"}];for(let t=0,s=this.qualityLevels_.length;t<s;t++){const s=this.qualityLevels_[t],i=this.qualityLevels_.selectedIndex===t;let r;r=s.bitrate<this.options_.sdBitrateLimit?e[1]:e[0],i&&(r.active=!0),r.levels.push(t)}return e[0].levels.length&&e[1].levels.length?e:[]}handleQualityChange_(){const e=this.qualityLevels_[this.qualityLevels_.selectedIndex],t=this.options_.useResolutionLabels&&ao(this.qualityLevels_);let s="";e&&(t?s=oo(e.height):e.bitrate>=this.options_.sdBitrateLimit&&(s="HD")),"HD"===s?(this.addClass("vjs-quality-menu-button-HD-flag"),this.removeClass("vjs-quality-menu-button-4K-flag")):"4K"===s?(this.removeClass("vjs-quality-menu-button-HD-flag"),this.addClass("vjs-quality-menu-button-4K-flag")):(this.removeClass("vjs-quality-menu-button-HD-flag"),this.removeClass("vjs-quality-menu-button-4K-flag")),this.autoMenuItem_&&(this.autoMenuItem_.manuallySelected_&&e?this.autoMenuItem_.subLabel_.innerHTML=this.localize(s):this.autoMenuItem_.subLabel_.innerHTML="")}enableDefaultResolution_(){const e=this.options_.defaultResolution;for(let t=0;t<this.items.length;t++)-1!==this.items[t].options_.label.indexOf(e)&&this.items[t].handleClick()}firstChangeHandler_(){this.player_.readyState()<1&&"none"!==this.player_.preload()?this.player_.one("loadedmetadata",this.enableDefaultResolution_):this.enableDefaultResolution_()}});var lo="1.0.4";const ho={sdBitrateLimit:2e6,useResolutionLabels:!0,resolutionLabelBitrates:!1,defaultResolution:"none"},co=(e,t)=>{e.addClass("vjs-quality-menu");const s=e.getChild("controlBar"),i=s.addChild("QualityMenuButton",t,s.children_.length-2);return function(){e.removeClass("vjs-quality-menu"),s.removeChild(i),i.dispose()}},uo=function(e){!function(e,t){if(void 0!==e.qualityLevels){e.qualityLevels();let s=()=>{};e.ready((()=>{s=co(e,t),e.on("loadstart",(()=>{s(),s=co(e,t)}))})),e.qualityMenu=()=>{},e.qualityMenu.VERSION=lo}}(this,to().obj.merge(ho,e))};function po(e,t){var s=t.options_,i=t.el(),r=null,n=this.hls=new Ja(s.hlsjsConfig);function a(){var e=null,t=null;return function(){var s=Date.now();!e||s-e>2e3?(e=s,n.recoverMediaError()):!t||s-t>2e3?(t=s,n.swapAudioCodec(),n.recoverMediaError()):console.error("Error loading media: File could not be played")}}var o=a(),l=a();i.addEventListener("error",(function(e){var t=e.currentTarget.error;t.code===t.MEDIA_ERR_DECODE?l():console.error("Error loading media: File could not be played")})),this.dispose=function(){n.destroy()},this.duration=function(){return r||i.duration||0},n.on(Ja.Events.LEVEL_LOADED,(function(e,t){r=t.details.live?1/0:t.details.totalduration})),n.on(Ja.Events.ERROR,(function(e,t){if(t.fatal)switch(t.type){case Ja.ErrorTypes.NETWORK_ERROR:n.startLoad();break;case Ja.ErrorTypes.MEDIA_ERROR:o();break;default:console.error("Error loading media: File could not be played")}})),Object.keys(Ja.Events).forEach((function(e){var s=Ja.Events[e];n.on(s,(function(e,i){t.trigger(s,i)}))})),t.featuresNativeTextTracks||(Object.defineProperty(i,"textTracks",{get:function(){try{return"function"==typeof t.textTracks?t.textTracks():t.textTracks}catch{return[]}}}),i.addTextTrack=function(){return t.addTextTrack.apply(t,arguments)}),n.attachMedia(i),n.loadSource(e.src)}to().registerPlugin("qualityMenu",uo),uo.VERSION=lo;var fo=/^application\/(x-mpegURL|vnd\.apple\.mpegURL)$/i,go=/\.m3u8/i,mo={canHandleSource:function(e){return e.skipContribHlsJs?"":fo.test(e.type)?"probably":go.test(e.src)?"maybe":""},handleSource:function(e,t){return new po(e,t)},canPlayType:function(e){return fo.test(e)?"probably":""}};if(Ja.isSupported()){var yo=window.videojs;if(yo=yo&&yo.default||yo){var vo=yo.getTech&&yo.getTech("Html5");(vo=vo||yo.getComponent&&yo.getComponent("Html5"))&&vo.registerSourceHandler(mo,0)}else console.warn("videojs-contrib-hls.js: Couldn't find find window.videojs nor require('video.js')")}const _o=(e,t)=>{const s=t=>{let s=Array.isArray(t.url)&&t.url.length>1?t.url[t.urlId]:t.url;return{id:s,width:t.width,height:t.height,bandwidth:t.bitrate,frameRate:0,enabled:t=>{var i=e.tech({IWillNotUseThisInPlugins:!0});if(void 0!==i.sourceHandler_&&void 0!==i.sourceHandler_.hls&&null!=i.sourceHandler_.hls){const e=i.sourceHandler_.hls,r=e.levels.findIndex((e=>(Array.isArray(e.url)&&e.url.length>1?e.url[e.urlId]:e.url)===s));r>=0&&t&&(e.currentLevel=r)}return t}}},i=t=>({id:t.id,width:t.width,height:t.height,bandwidth:t.bandwidth,enabled:s=>{const i=e.dash;if(i&&i.mediaPlayer&&s){i.mediaPlayer.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!1,audio:!1}}}});const e=n(t.width,t.height);e>=0&&(i.mediaPlayer.setQualityFor("video",e),i.audioMapper&&void 0!==i.audioMapper[e]&&i.mediaPlayer.setQualityFor("audio",i.audioMapper[e]))}return s}}),r=()=>{var t=e.dash;if(void 0!==t&&null!=t&&void 0!==t.mediaPlayer&&null!=t.mediaPlayer){var s=t.mediaPlayer.getActiveStream().getStreamInfo(),i=t.mediaPlayer.getDashAdapter();if(i&&s){const e=s.index;var r=i.getAdaptationForType(e,"video",s)}return r.Representation_asArray}return[]},n=(t,s)=>{var i=e.dash;if(i&&i.mediaPlayer){const e=i.mediaPlayer.getBitrateInfoListFor("video").find((e=>e.width===t&&e.height===s));return e?e.qualityIndex:-1}return-1},a=(t,r)=>{(()=>{let t=e.qualityLevels;"function"==typeof t&&(t=e.qualityLevels(),t.dispose(),c("Quality levels cleaned up for new source"));const s=e.audioTracks();if(s&&s.length>0){for(let e=s.length-1;e>=0;e--)s.removeTrack(s[e]);c("Audio tracks cleaned up for new source")}const i=e.dash;i&&i.audioMapper&&(delete i.audioMapper,c("DASH audio mapper cleaned up for new source")),o=null})();let n=e.qualityLevels;if("function"==typeof n)switch(n=e.qualityLevels(),c("QualityLevels",n),r){case"hls":for(let e=0;e<t.length;e++){let i=t[e],r=s(i);n.addQualityLevel(r)}break;case"dash":{const s=e.dash;if(!s)break;const r=t,a=s.mediaPlayer.getBitrateInfoListFor("audio")||[],o=r.length>0?r[r.length-1].bandwidth:1;s.audioMapper=r.map((e=>Math.round(e.bandwidth/o*(a.length-1))));for(let e=0;e<t.length;e++){let s=t[e],r=i(s);n.addQualityLevel(r)}break}default:return}else console.warn("QualityLevels not supported")};let o=null;const l=t=>{let s=e.qualityLevels;if("function"==typeof s){if(s=e.qualityLevels(),0==s.length){console.warn("ERROR - no quality levels found! Patching populate levels first");var i=e.tech({IWillNotUseThisInPlugins:!0});if(void 0!==i.sourceHandler_&&void 0!==i.sourceHandler_.hls&&null!=i.sourceHandler_.hls){const e=i.sourceHandler_.hls;a(e.levels,"hls")}}s.selectedIndex_=t,s.trigger({type:"change",selectedIndex:t})}},h=t=>{if(t<0)return;let s=e.qualityLevels,i=null;if("function"==typeof s)s=e.qualityLevels(),i=s.levels_[t],c("Custom qualitychanged","using videojs-contrib-quality-levels");else{var n=e.tech({IWillNotUseThisInPlugins:!0});if(void 0!==n.sourceHandler_&&void 0!==n.sourceHandler_.hls&&null!=n.sourceHandler_.hls){const e=n.sourceHandler_.hls;i=e.levels[t],c("Custom qualitychanged","using hls.js directly"),t!==e.currentLevel&&c("ERROR - new level differs from hls.js")}else{var a=e.dash;void 0!==a&&null!=a&&void 0!==a.mediaPlayer&&null!=a.mediaPlayer&&(i=r()[t],c("Custom qualitychanged","using dash.js directly"))}}if(!i)return void c("Warning: Level is undefined in populateQualityChangedEvent",{currentLevel:t});let l={width:i.width,height:i.height};if(o!==l){let t={from:o,to:l};e.trigger({type:"qualitychanged",eventData:t})}o=l,c("Current Rendition",{index:t,resolution:`${i.width}x${i.height}`,bitrate:`${Math.round(i.bitrate/1e3)} kbps`,url:Array.isArray(i.url)?i.url[i.urlId]:i.url,details:i})},c=(e,s)=>{t.debug&&console.log(`%c ${e}`,"background: #3498db; color: white; padding: 2px 4px; border-radius: 2px;",s)},d=()=>{var t=e.tech({IWillNotUseThisInPlugins:!0});if(void 0!==t.sourceHandler_&&void 0!==t.sourceHandler_.hls&&null!=t.sourceHandler_.hls){const e=t.sourceHandler_.hls,s=e.audioTrack,i=e.audioTracks.length;for(let t=0;t<i;t++)c(s===t?`audio track [${t}] ${e.audioTracks[t].name} - enabled`:`audio track [${t}] ${e.audioTracks[t].name} - disabled`,e.audioTracks[t])}},u=()=>{try{const t=e.currentTime(),s=.5,i=Math.min(t+s,e.duration()-.1);e.currentTime(i),e.currentTime(t)}catch(e){c("Error while flushing buffered audio",e)}},p=t=>{var s=e.tech({IWillNotUseThisInPlugins:!0});if(void 0!==s.sourceHandler_&&void 0!==s.sourceHandler_.hls&&null!=s.sourceHandler_.hls){const e=s.sourceHandler_.hls;if(e.audioTrack===t)return;if(e.audioTrack=t,e.media)try{e.stopLoad(),e.startLoad(0)}catch(e){c("Error while reloading after audioTrack switch",e)}d(),e.once(Ja.Events.AUDIO_TRACK_SWITCHED,(()=>{u()}))}},f=(t,s)=>{const i=new(to().AudioTrack)({id:`${t.type}-id_${t.id}-groupId_${t.groupId}-${t.name}`,kind:"translation",label:t.name,language:t.lang,enabled:s.audioTrack===s.audioTracks.indexOf(t),default:t.default});e.audioTracks().addTrack(i)};return{init:()=>{var t=e.tech({IWillNotUseThisInPlugins:!0});if(void 0===t&&console.warn("ERROR - tech not found!"),void 0!==t.sourceHandler_&&void 0!==t.sourceHandler_.hls&&null!=t.sourceHandler_.hls){const s=t.sourceHandler_.hls,i=(t,r)=>{c(`HLS event: ${t}`,r),a(s.levels,"hls"),(()=>{var t=e.tech({IWillNotUseThisInPlugins:!0});if(void 0!==t.sourceHandler_&&void 0!==t.sourceHandler_.hls&&null!=t.sourceHandler_.hls){const e=t.sourceHandler_.hls,s=e.audioTracks.length;for(let t=0;t<s;t++)f(e.audioTracks[t],e)}var s=e.audioTracks();s.addEventListener("change",(function(){var t=e.tech({IWillNotUseThisInPlugins:!0});if(void 0!==t.sourceHandler_&&void 0!==t.sourceHandler_.hls&&null!=t.sourceHandler_.hls)for(var i=0;i<s.length;i++)if(s[i].enabled)return void p(i)}))})(),s.off(Ja.Events.MANIFEST_LOADED,i)};s.levels&&s.levels.length>0?i("MANUAL_MANIFEST_LOADED",{}):s.on(Ja.Events.MANIFEST_LOADED,i),s.on(Ja.Events.LEVEL_SWITCHED,((e,t)=>{c(`HLS event: ${e}`,t),l(t.level),h(t.level)})),s.on(Ja.Events.AUDIO_TRACK_SWITCHED,((t,s)=>{c(`HLS event: ${t}`,s),void 0!==s.id&&(t=>{const s=e.audioTracks();if(s){for(let e=0;e<s.length;e++)s[e].enabled=e===t;d()}})(s.id),u()})),s.on(Ja.Events.ERROR,((t,s)=>{c(`HLS event: ${t}`,s),s.fatal&&e.error({code:4,...s})}))}else{var s=e.dash;if(void 0!==s&&null!=s&&void 0!==s.mediaPlayer&&null!=s.mediaPlayer){let e=r();a(e,"dash"),s.mediaPlayer.on("qualityChangeRendered",(t=>{const i=s.mediaPlayer.getQualityFor("video"),r=s.mediaPlayer.getBitrateInfoListFor("video")[i],a=n(r.width,r.height);a>=0?(c(`DASH event: ${t.type}`,t,e[a]),l(a),h(a)):console.warn("Could not find matching rendition for DASH quality change")}))}}}}};var bo=s(8592);async function To(e,t){const s={...bo.$n[t.strategy],videoPreference:bo.Lp?{preferHDR:!0}:void 0};t.withCredentials&&(s.xhrSetup=function(e){e.withCredentials=!0}),e.tech_.options_.hlsjsConfig=s,e.on("loadstart",(()=>_o(e,t).init())),e.qualityMenu(),e.adaptiveStreamingLoaded=!0}},7707:(e,t,s)=>{async function i(e){const t=this;try{e.isDash&&!window.dashjs&&await s.e(367).then(s.bind(s,6604));const{default:i}=await s.e(26).then(s.bind(s,833));i(t,e)}catch(e){console.error("Failed to load plugin:",e)}}s.r(t),s.d(t,{default:()=>i})},9234:(e,t,s)=>{s.d(t,{default:()=>l});var i=s(6673),r=s.n(i),n=s(8033),a=s(2415);const o=function(){function e(e,t){return this.player=e,this.options=t,this.player.one("loadedmetadata",this.initializeChapters.bind(this)),this}return e.prototype.src=function(e){this.resetPlugin(),this.options=e,this.player.one("loadedmetadata",this.initializeChapters.bind(this))},e.prototype.detach=function(){this.resetPlugin()},e.prototype.resetPlugin=function(){this.chaptersTrack&&(this.player.$(".vjs-control-bar-chapter-display").remove(),this.player.$(".vjs-chapter-display").remove(),this.player.$$(".vjs-chapter-marker").forEach((e=>e.remove())),this.player.removeRemoteTextTrack(this.chaptersTrack),delete this.chaptersTrack)},e.prototype.getChaptersFileUrlByName=function(){const e=this.player.cloudinary.currentPublicId();if(!e)return null;const{type:t}=this.player.cloudinary.source().resourceConfig();return`${(0,n.k$)(this.player.cloudinary.cloudinaryConfig())}/_applet_/video_service/chapters/${t}/${(0,a.G)(e)}.vtt?t=${Date.now()}`},e.prototype.initializeChapters=async function(){const e=!0===this.options?this.getChaptersFileUrlByName():this.options.url;if(e){const t={kind:"chapters",src:e,default:!0},s=this.player.addRemoteTextTrack(t);s.addEventListener("load",(()=>{this.chaptersTrack=s.track,this.setupChaptersDisplays()}))}else if(Object.entries(this.options).length){const e=this.player.addRemoteTextTrack({kind:"chapters",default:!0}),t=this.player.duration();Object.entries(this.options).forEach(((s,i,r)=>{const n=new VTTCue(parseFloat(s[0]),parseFloat(r[i+1]?r[i+1][0]:t),s[1]);e.track.addCue(n)})),this.chaptersTrack=e.track,this.setupChaptersDisplays(),this.player.controlBar.chaptersButton&&this.player.controlBar.chaptersButton.update()}},e.prototype.setupChaptersDisplays=function(){this.setupProgressBarMarkers(),this.setupProgressBarChapter(),this.setupControlBarChapter()},e.prototype.setupControlBarChapter=function(){const e=this.player.$(".vjs-control-bar-chapter-display")||document.createElement("div");e.setAttribute("class","vjs-control-bar-chapter-display");const t=this.player.$(".vjs-control-bar .vjs-spacer");t.innerHTML="",t.classList.add("vjs-control-bar-chapter-wrapper"),t.appendChild(e),this.chaptersTrack.addEventListener("cuechange",(()=>{const t=Array.from(this.chaptersTrack.activeCues);e.innerText=t.length>0?t[0].text:""}))},e.prototype.setupProgressBarMarkers=function(){const e=this.player.duration(),{seekBar:t}=this.player.controlBar.progressControl;Array.from(this.chaptersTrack.cues).forEach((s=>{if(0!==s.startTime){const i=s.startTime/e*100+"%",n=r().dom.createEl("div",void 0,{class:"vjs-chapter-marker",style:`left: ${i}`});t.el().append(n)}}))},e.prototype.setupProgressBarChapter=function(){const e=r().dom.createEl("div",void 0,{class:"vjs-chapter-display",style:`max-width: ${this.player.$(".vjs-vtt-thumbnail-display")?this.player.$(".vjs-vtt-thumbnail-display").style.width:"160px"}`}),t=this.player.getDescendant(["controlBar","progressControl","seekBar","mouseTimeDisplay"]),s=t.getDescendant(["timeTooltip"]);s.el().parentElement.prepend(e);const i=e=>{const t=e*this.player.duration(),s=Array.from(this.chaptersTrack?.cues||[]).find((e=>t>=e.startTime&&t<=e.endTime));return s?s.text:""};s.update=function(t,s,r){Object.getPrototypeOf(this).update.call(this,t,s,r),e.innerText=i(s)},"object"!=typeof this.player.vttThumbnails&&(t.update=function(t,i){const n=i*this.player_.duration(),a=t.width,o=e.clientWidth/2;s.updateTime(t,i,n,(()=>{t.width*i<o?this.el_.style.left=`${o}px`:t.width*i+o>a?this.el_.style.left=t.width-o+"px":this.el_.style.left=t.width*i+"px"})),s.write(r().time.formatTime(n))})},e}(),l=function(e,t){t.addClass("vjs-chapters"),t.chapters=new o(t,e)}},8033:(e,t,s)=>{s.d(t,{bo:()=>_s,dC:()=>Ts,ww:()=>bs,lP:()=>gs,KA:()=>ms,k$:()=>ys,iT:()=>ps,Nl:()=>fs,N7:()=>vs,a5:()=>us,M6:()=>As});var i=s(6673),r=s.n(i),n=s(4319),a=s.n(n),o=s(5871),l=s(8953),h=s.n(l),c=s(7571),d=s.n(c),u=s(5226);function p(e){return"object"==typeof e&&null!==e}function f(e){let t="";return t="undefined"!=typeof window?btoa(encodeURI(decodeURI(e))):global.Buffer.from(e).toString("base64"),t.replace(/\+/g,"-").replace(/\//g,"_")}const g={"=":"eq","!=":"ne","<":"lt",">":"gt","<=":"lte",">=":"gte","&&":"and","||":"or","*":"mul","/":"div","+":"add","-":"sub","^":"pow"},m="cloudinary-a.akamaihd.net",y="res.cloudinary.com",v={aspect_ratio:"ar",aspectRatio:"ar",current_page:"cp",currentPage:"cp",duration:"du",face_count:"fc",faceCount:"fc",height:"h",initial_aspect_ratio:"iar",initial_height:"ih",initial_width:"iw",initialAspectRatio:"iar",initialHeight:"ih",initialWidth:"iw",initial_duration:"idu",initialDuration:"idu",page_count:"pc",page_x:"px",page_y:"py",pageCount:"pc",pageX:"px",pageY:"py",tags:"tags",width:"w"},_="(([0-9]*)\\.([0-9]+)|([0-9]+))([%pP])?",b=RegExp(`^${_}$`),T=RegExp(`(${_})\\.\\.(${_})`),A={font_weight:"normal",font_style:"normal",text_decoration:"none",text_align:"",stroke:"none"};function E(e,t=/([^a-zA-Z0-9_.\-\/:]+)/g){return e.replace(t,(function(e){return e.split("").map((function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})).join("")}))}const S=e=>e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`));class C{constructor(e){this.options={},null!=e&&["resourceType","type","publicId","format"].forEach((t=>{var s;return this.options[t]=null!=(s=e[t])?s:e[S(t)]}))}resourceType(e){return this.options.resourceType=e,this}type(e){return this.options.type=e,this}publicId(e){return this.options.publicId=e,this}getPublicId(){var e;return null!=(e=this.options.publicId)?e.replace(/\//g,":"):void 0}getFullPublicId(){return null!=this.options.format?this.getPublicId()+"."+this.options.format:this.getPublicId()}format(e){return this.options.format=e,this}toString(){let e=[];if(null==this.options.publicId)throw"Must supply publicId";return"image"!==this.options.resourceType&&e.push(this.options.resourceType),"upload"!==this.options.type&&e.push(this.options.type),e.push(this.getFullPublicId()),e.filter((e=>!!e)).join(":")}clone(){return new C(this.options)}}const w=C;function k(e){return null==e||"object"==typeof e&&0===Object.keys(e).length||"string"==typeof e&&0===e.trim().length}const L=function(e){return null!=e&&!isNaN(parseFloat(e))},I=class extends w{constructor(e){let t;super(e),t=["resourceType","resourceType","fontFamily","fontSize","fontWeight","fontStyle","textDecoration","textAlign","stroke","letterSpacing","lineSpacing","fontHinting","fontAntialiasing","text"],null!=e&&t.forEach((t=>{var s;return this.options[t]=null!=(s=e[t])?s:e[S(t)]})),this.options.resourceType="text"}resourceType(e){throw"Cannot modify resourceType for text layers"}type(e){throw"Cannot modify type for text layers"}format(e){throw"Cannot modify format for text layers"}fontFamily(e){return this.options.fontFamily=e,this}fontSize(e){return this.options.fontSize=e,this}fontWeight(e){return this.options.fontWeight=e,this}fontStyle(e){return this.options.fontStyle=e,this}textDecoration(e){return this.options.textDecoration=e,this}textAlign(e){return this.options.textAlign=e,this}stroke(e){return this.options.stroke=e,this}letterSpacing(e){return this.options.letterSpacing=e,this}lineSpacing(e){return this.options.lineSpacing=e,this}fontHinting(e){return this.options.fontHinting=e,this}fontAntialiasing(e){return this.options.fontAntialiasing=e,this}text(e){return this.options.text=e,this}toString(){var e,t,s,i,r,n,a,o,l;if(a=this.textStyleIdentifier(),null!=this.options.publicId&&(s=this.getFullPublicId()),null!=this.options.text){if(e=!k(s),t=!k(a),e&&t||!e&&!t)throw"Must supply either style parameters or a public_id when providing text parameter in a text overlay/underlay, but not both!";for(i=/\$\([a-zA-Z]\w*\)/g,n=0,l=E(this.options.text,/[,\/]/g),o="";r=i.exec(l);)o+=E(l.slice(n,r.index)),o+=r[0],n=r.index+r[0].length;o+=E(l.slice(n))}return[this.options.resourceType,a,s,o].filter((e=>!!e)).join(":")}textStyleIdentifier(){var e;if(e=[],"normal"!==this.options.fontWeight&&e.push(this.options.fontWeight),"normal"!==this.options.fontStyle&&e.push(this.options.fontStyle),"none"!==this.options.textDecoration&&e.push(this.options.textDecoration),e.push(this.options.textAlign),"none"!==this.options.stroke&&e.push(this.options.stroke),k(this.options.letterSpacing)&&!L(this.options.letterSpacing)||e.push("letter_spacing_"+this.options.letterSpacing),k(this.options.lineSpacing)&&!L(this.options.lineSpacing)||e.push("line_spacing_"+this.options.lineSpacing),k(this.options.fontAntialiasing)||e.push("antialias_"+this.options.fontAntialiasing),k(this.options.fontHinting)||e.push("hinting_"+this.options.fontHinting),!k(e.filter((e=>!!e)))){if(k(this.options.fontFamily))throw`Must supply fontFamily. ${e}`;if(k(this.options.fontSize)&&!L(this.options.fontSize))throw"Must supply fontSize."}return e.unshift(this.options.fontFamily,this.options.fontSize),e.filter((e=>!!e)).join("_")}};function P(e){const t=[];let s="";if(Object.keys(A).forEach((s=>{let i=A[s],r=e[s]||i;r!==i&&t.push(r)})),Object.keys(e).forEach((s=>{"letter_spacing"!==s&&"line_spacing"!==s||t.push(`${s}_${e[s]}`),"font_hinting"===s&&t.push(`${s.split("_").pop()}_${e[s]}`),"font_antialiasing"===s&&t.push(`antialias_${e[s]}`)})),e.hasOwnProperty("font_size")||!t||0===t.length){if(!e.font_size)throw"Must supply font_size for text in overlay/underlay";if(!e.font_family)throw"Must supply font_family for text in overlay/underlay";t.unshift(e.font_size),t.unshift(e.font_family),s=t.filter((e=>e)).join("_")}return s}function R(e){if(e instanceof I||e instanceof w)return e.toString();let t="";if(p(e))if("fetch"===e.resource_type||null!=e.url)t=`fetch:${f(e.url)}`;else{let s=e.public_id,i=e.format,r=e.resource_type||"image",n=e.type||"upload",a=e.text,o=null,l=[];const h=!s||0===s.length;if(h||(s=s.replace(new RegExp("/","g"),":"),null!=i&&(s=`${s}.${i}`)),a&&0!==a.length||"text"===r){if(r="text",n=null,o=P(e),a&&a.length>=0){const e=!o;if(!h&&!e||h&&e)throw"Must supply either style parameters or a public_id when providing text parameter in a text overlay/underlay";let t=/\$\([a-zA-Z]\w*\)/g,s=0,i=E(decodeURIComponent(a),/[,\/]/g);a="";for(let e=t.exec(i);e;e=t.exec(i))a+=E(i.slice(s,e.index)),a+=e[0],s=e.index+e[0].length;a+=encodeURIComponent(i.slice(s))}}else{if(h)throw"Must supply public_id for resource_type layer_parameter";"subtitles"===r&&(o=P(e))}"image"!==r&&l.push(r),"upload"!==n&&l.push(n),l.push(o),l.push(s),l.push(a),t=l.filter((e=>e)).join(":")}else t=/^fetch:.+/.test(e)?`fetch:${f(e.substr(6))}`:e;return t}function x(e){if("string"!=typeof e||0===e.length||e.match(/^!.+!$/))return e?e.toString():e;e=String(e);const t=new RegExp("((\\|\\||>=|<=|&&|!=|>|=|<|/|-|\\+|\\*|\\^)(?=[ _]))","g");e=e.replace(t,(e=>g[e]));const s="("+Object.keys(v).join("|")+")",i=new RegExp(`(\\$_*[^_ ]+)|${s}`,"g");return(e=e.replace(i,(e=>v[e]||e))).replace(/[ _]+/g,"_")}function D(e){switch(!0){case null==e:return[];case Array.isArray(e):return e;default:return[e]}}function O(e){if(!p(e))return e;if("remote"===e.function_type){const t=f(e.source).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");return[e.function_type,t].join(":")}return[e.function_type,e.source].join(":")}function M(e){switch(e&&e.constructor){case String:return T.test(e)?e.split(".."):e;case Array:return[[e],e[e.length-1]];default:return[null,null]}}function N(e){const t=String(e).match(b);if(t){const e=t[5]?"p":"";return`${t[1]||t[4]}${e}`}return e}function F(e){switch(e&&e.constructor){case Object:{let t="";return"codec"in e&&(t=e.codec,"profile"in e&&(t+=":"+e.profile,"level"in e&&(t+=":"+e.level))),t}case String:return e;default:return null}}class B{constructor(e){this.expressions=[],null!=e&&this.expressions.push(B.normalize(e))}static new(e){return new this(e)}static normalize(e){var t,s,i;return null==e?e:(e=String(e),t=new RegExp("((\\|\\||>=|<=|&&|!=|>|=|<|/|-|\\+|\\*|\\^)(?=[ _]))","g"),e=e.replace(t,(e=>j[e])),s="("+Object.keys(U).join("|")+")",i=new RegExp(s,"g"),(e=e.replace(i,((t,s,i)=>"$"===e[i-1]?t:U[t]))).replace(/[ _]+/g,"_"))}serialize(){return B.normalize(this.expressions.join("_"))}toString(){return this.serialize()}getParent(){return this.parent}setParent(e){return this.parent=e,this}predicate(e,t,s){return null!=j[t]&&(t=j[t]),this.expressions.push(`${e}_${t}_${s}`),this}and(){return this.expressions.push("and"),this}or(){return this.expressions.push("or"),this}then(){return this.getParent().if(this.toString())}height(e,t){return this.predicate("h",e,t)}width(e,t){return this.predicate("w",e,t)}aspectRatio(e,t){return this.predicate("ar",e,t)}pageCount(e,t){return this.predicate("pc",e,t)}faceCount(e,t){return this.predicate("fc",e,t)}value(e){return this.expressions.push(e),this}static variable(e,t){return new this(e).value(t)}static width(){return new this("width")}static height(){return new this("height")}static initialWidth(){return new this("initialWidth")}static initialHeight(){return new this("initialHeight")}static aspectRatio(){return new this("aspectRatio")}static initialAspectRatio(){return new this("initialAspectRatio")}static pageCount(){return new this("pageCount")}static faceCount(){return new this("faceCount")}static currentPage(){return new this("currentPage")}static tags(){return new this("tags")}static pageX(){return new this("pageX")}static pageY(){return new this("pageY")}}const j={"=":"eq","!=":"ne","<":"lt",">":"gt","<=":"lte",">=":"gte","&&":"and","||":"or","*":"mul","/":"div","+":"add","-":"sub","^":"pow"},U={aspect_ratio:"ar",aspectRatio:"ar",current_page:"cp",currentPage:"cp","preview:duration":"preview:duration",duration:"du",face_count:"fc",faceCount:"fc",height:"h",initial_aspect_ratio:"iar",initial_duration:"idu",initial_height:"ih",initial_width:"iw",initialAspectRatio:"iar",initialDuration:"idu",initialHeight:"ih",initialWidth:"iw",page_count:"pc",page_x:"px",page_y:"py",pageCount:"pc",pageX:"px",pageY:"py",tags:"tags",width:"w"},$=B,H=class extends ${constructor(e){super(e)}height(e,t){return this.predicate("h",e,t)}width(e,t){return this.predicate("w",e,t)}aspectRatio(e,t){return this.predicate("ar",e,t)}pageCount(e,t){return this.predicate("pc",e,t)}faceCount(e,t){return this.predicate("fc",e,t)}duration(e,t){return this.predicate("du",e,t)}initialDuration(e,t){return this.predicate("idu",e,t)}};"undefined"!=typeof window&&null!==window&&window.location&&window.location.protocol;var V="__lodash_hash_undefined__",G=9007199254740991,W="[object Arguments]",z="[object Boolean]",K="[object Date]",q="[object Function]",Y="[object GeneratorFunction]",X="[object Map]",Q="[object Number]",Z="[object Object]",J="[object Promise]",ee="[object RegExp]",te="[object Set]",se="[object String]",ie="[object Symbol]",re="[object WeakMap]",ne="[object ArrayBuffer]",ae="[object DataView]",oe="[object Float32Array]",le="[object Float64Array]",he="[object Int8Array]",ce="[object Int16Array]",de="[object Int32Array]",ue="[object Uint8Array]",pe="[object Uint8ClampedArray]",fe="[object Uint16Array]",ge="[object Uint32Array]",me=/\w*$/,ye=/^\[object .+?Constructor\]$/,ve=/^(?:0|[1-9]\d*)$/,_e={};_e[W]=_e["[object Array]"]=_e[ne]=_e[ae]=_e[z]=_e[K]=_e[oe]=_e[le]=_e[he]=_e[ce]=_e[de]=_e[X]=_e[Q]=_e[Z]=_e[ee]=_e[te]=_e[se]=_e[ie]=_e[ue]=_e[pe]=_e[fe]=_e[ge]=!0,_e["[object Error]"]=_e[q]=_e[re]=!1;var be="object"==typeof global&&global&&global.Object===Object&&global,Te="object"==typeof self&&self&&self.Object===Object&&self,Ae=be||Te||Function("return this")(),Ee="object"==typeof exports&&exports&&!exports.nodeType&&exports,Se=Ee&&"object"==typeof module&&module&&!module.nodeType&&module,Ce=Se&&Se.exports===Ee;function we(e,t){return e.set(t[0],t[1]),e}function ke(e,t){return e.add(t),e}function Le(e,t,s,i){var r=-1,n=e?e.length:0;for(i&&n&&(s=e[++r]);++r<n;)s=t(s,e[r],r,e);return s}function Ie(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!`${e}`}catch(e){}return t}function Pe(e){var t=-1,s=Array(e.size);return e.forEach((function(e,i){s[++t]=[i,e]})),s}function Re(e,t){return function(s){return e(t(s))}}function xe(e){var t=-1,s=Array(e.size);return e.forEach((function(e){s[++t]=e})),s}var De,Oe=Array.prototype,Me=Function.prototype,Ne=Object.prototype,Fe=Ae["__core-js_shared__"],Be=(De=/[^.]+$/.exec(Fe&&Fe.keys&&Fe.keys.IE_PROTO||""))?`Symbol(src)_1.${De}`:"",je=Me.toString,Ue=Ne.hasOwnProperty,$e=Ne.toString,He=RegExp(`^${je.call(Ue).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")}$`),Ve=Ce?Ae.Buffer:void 0,Ge=Ae.Symbol,We=Ae.Uint8Array,ze=Re(Object.getPrototypeOf,Object),Ke=Object.create,qe=Ne.propertyIsEnumerable,Ye=Oe.splice,Xe=Object.getOwnPropertySymbols,Qe=Ve?Ve.isBuffer:void 0,Ze=Re(Object.keys,Object),Je=At(Ae,"DataView"),et=At(Ae,"Map"),tt=At(Ae,"Promise"),st=At(Ae,"Set"),it=At(Ae,"WeakMap"),rt=At(Object,"create"),nt=kt(Je),at=kt(et),ot=kt(tt),lt=kt(st),ht=kt(it),ct=Ge?Ge.prototype:void 0,dt=ct?ct.valueOf:void 0;function ut(e){var t=-1,s=e?e.length:0;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}function pt(e){var t=-1,s=e?e.length:0;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}function ft(e){var t=-1,s=e?e.length:0;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}function gt(e){this.__data__=new pt(e)}function mt(e,t,s){var i=e[t];Ue.call(e,t)&&It(i,s)&&(void 0!==s||t in e)||(e[t]=s)}function yt(e,t){for(var s=e.length;s--;)if(It(e[s][0],t))return s;return-1}function vt(e,t,s,i,r,n,a){var o;if(i&&(o=n?i(e,r,n,a):i(e)),void 0!==o)return o;if(!Ot(e))return e;var l=Pt(e);if(l){if(o=function(e){var t=e.length,s=e.constructor(t);return t&&"string"==typeof e[0]&&Ue.call(e,"index")&&(s.index=e.index,s.input=e.input),s}(e),!t)return function(e,t){var s=-1,i=e.length;for(t||(t=Array(i));++s<i;)t[s]=e[s];return t}(e,o)}else{var h=St(e),c=h==q||h==Y;if(xt(e))return function(e,t){if(t)return e.slice();var s=new e.constructor(e.length);return e.copy(s),s}(e,t);if(h==Z||h==W||c&&!n){if(Ie(e))return n?e:{};if(o=function(e){return"function"!=typeof e.constructor||wt(e)?{}:Ot(t=ze(e))?Ke(t):{};var t}(c?{}:e),!t)return function(e,t){return bt(e,Et(e),t)}(e,function(e,t){return e&&bt(t,Mt(t),e)}(o,e))}else{if(!_e[h])return n?e:{};o=function(e,t,s,i){var r,n=e.constructor;switch(t){case ne:return _t(e);case z:case K:return new n(+e);case ae:return function(e,t){var s=t?_t(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}(e,i);case oe:case le:case he:case ce:case de:case ue:case pe:case fe:case ge:return function(e,t){var s=t?_t(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}(e,i);case X:return function(e,t,s){return Le(t?s(Pe(e),!0):Pe(e),we,new e.constructor)}(e,i,s);case Q:case se:return new n(e);case ee:return function(e){var t=new e.constructor(e.source,me.exec(e));return t.lastIndex=e.lastIndex,t}(e);case te:return function(e,t,s){return Le(t?s(xe(e),!0):xe(e),ke,new e.constructor)}(e,i,s);case ie:return r=e,dt?Object(dt.call(r)):{}}}(e,h,vt,t)}}a||(a=new gt);var d=a.get(e);if(d)return d;if(a.set(e,o),!l)var u=s?function(e){return function(e,t,s){var i=t(e);return Pt(e)?i:function(e,t){for(var s=-1,i=t.length,r=e.length;++s<i;)e[r+s]=t[s];return e}(i,s(e))}(e,Mt,Et)}(e):Mt(e);return function(e,t){for(var s=-1,i=e?e.length:0;++s<i&&!1!==t(e[s],s););}(u||e,(function(r,n){u&&(r=e[n=r]),mt(o,n,vt(r,t,s,i,n,e,a))})),o}function _t(e){var t=new e.constructor(e.byteLength);return new We(t).set(new We(e)),t}function bt(e,t,s,i){s||(s={});for(var r=-1,n=t.length;++r<n;){var a=t[r],o=i?i(s[a],e[a],a,s,e):void 0;mt(s,a,void 0===o?e[a]:o)}return s}function Tt(e,t){var s,i,r=e.__data__;return("string"==(i=typeof(s=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==s:null===s)?r["string"==typeof t?"string":"hash"]:r.map}function At(e,t){var s=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!Ot(e)||(t=e,Be&&Be in t))&&(Dt(e)||Ie(e)?He:ye).test(kt(e));var t}(s)?s:void 0}ut.prototype.clear=function(){this.__data__=rt?rt(null):{}},ut.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ut.prototype.get=function(e){var t=this.__data__;if(rt){var s=t[e];return s===V?void 0:s}return Ue.call(t,e)?t[e]:void 0},ut.prototype.has=function(e){var t=this.__data__;return rt?void 0!==t[e]:Ue.call(t,e)},ut.prototype.set=function(e,t){return this.__data__[e]=rt&&void 0===t?V:t,this},pt.prototype.clear=function(){this.__data__=[]},pt.prototype.delete=function(e){var t=this.__data__,s=yt(t,e);return!(s<0||(s==t.length-1?t.pop():Ye.call(t,s,1),0))},pt.prototype.get=function(e){var t=this.__data__,s=yt(t,e);return s<0?void 0:t[s][1]},pt.prototype.has=function(e){return yt(this.__data__,e)>-1},pt.prototype.set=function(e,t){var s=this.__data__,i=yt(s,e);return i<0?s.push([e,t]):s[i][1]=t,this},ft.prototype.clear=function(){this.__data__={hash:new ut,map:new(et||pt),string:new ut}},ft.prototype.delete=function(e){return Tt(this,e).delete(e)},ft.prototype.get=function(e){return Tt(this,e).get(e)},ft.prototype.has=function(e){return Tt(this,e).has(e)},ft.prototype.set=function(e,t){return Tt(this,e).set(e,t),this},gt.prototype.clear=function(){this.__data__=new pt},gt.prototype.delete=function(e){return this.__data__.delete(e)},gt.prototype.get=function(e){return this.__data__.get(e)},gt.prototype.has=function(e){return this.__data__.has(e)},gt.prototype.set=function(e,t){var s=this.__data__;if(s instanceof pt){var i=s.__data__;if(!et||i.length<199)return i.push([e,t]),this;s=this.__data__=new ft(i)}return s.set(e,t),this};var Et=Xe?Re(Xe,Object):function(){return[]},St=function(e){return $e.call(e)};function Ct(e,t){return!!(t=null==t?G:t)&&("number"==typeof e||ve.test(e))&&e>-1&&e%1==0&&e<t}function wt(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ne)}function kt(e){if(null!=e){try{return je.call(e)}catch(e){}try{return`${e}`}catch(e){}}return""}function Lt(e){return vt(e,!0,!0)}function It(e,t){return e===t||e!=e&&t!=t}(Je&&St(new Je(new ArrayBuffer(1)))!=ae||et&&St(new et)!=X||tt&&St(tt.resolve())!=J||st&&St(new st)!=te||it&&St(new it)!=re)&&(St=function(e){var t=$e.call(e),s=t==Z?e.constructor:void 0,i=s?kt(s):void 0;if(i)switch(i){case nt:return ae;case at:return X;case ot:return J;case lt:return te;case ht:return re}return t});var Pt=Array.isArray;function Rt(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=G}(e.length)&&!Dt(e)}var xt=Qe||function(){return!1};function Dt(e){var t=Ot(e)?$e.call(e):"";return t==q||t==Y}function Ot(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Mt(e){return Rt(e)?function(e,t){var s=Pt(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Rt(e)}(e)&&Ue.call(e,"callee")&&(!qe.call(e,"callee")||$e.call(e)==W)}(e)?function(e,t){for(var s=-1,i=Array(e);++s<e;)i[s]=t(s);return i}(e.length,String):[],i=s.length,r=!!i;for(var n in e)!t&&!Ue.call(e,n)||r&&("length"==n||Ct(n,i))||s.push(n);return s}(e):function(e){if(!wt(e))return Ze(e);var t=[];for(var s in Object(e))Ue.call(e,s)&&"constructor"!=s&&t.push(s);return t}(e)}const Nt=function(e){let t=e.match(jt);return t=t.map((e=>e.charAt(0).toLocaleUpperCase()+e.slice(1).toLocaleLowerCase())),t[0]=t[0].toLocaleLowerCase(),t.join("")};var Ft,Bt,jt=(Bt="[A-Z]",Ft="[a-z]+",RegExp(Bt+"+(?="+Bt+Ft+")|"+Bt+"?"+Ft+"|"+Bt+"+|[0-9]+","g"));function Ut(e){return e}function $t(e,t){for(let s=0;s<e.length;s++)if(e[s]===t)return!0;return!1}const Ht=class extends I{constructor(e){super(e),this.options.resourceType="subtitles"}};function Vt(e){return"string"==typeof e||e instanceof String}const Gt=class extends w{constructor(e){super(e),Vt(e)?this.options.url=e:(null!=e?e.url:void 0)&&(this.options.url=e.url)}url(e){return this.options.url=e,this}toString(){return`fetch:${f(this.options.url)}`}};function Wt(e){return e instanceof Function}const zt=["accessibility","api_secret","auth_token","cdn_subdomain","cloud_name","cname","format","placeholder","private_cdn","resource_type","secure","secure_cdn_subdomain","secure_distribution","shorten","sign_url","signature","ssl_detected","type","url_suffix","use_root_path","version"];function Kt(e,...t){return t.forEach((t=>{Object.keys(t).forEach((s=>{null!=t[s]&&(e[s]=t[s])}))})),e}class qt{constructor(e,t,s=Ut){this.name=e,this.shortName=t,this.process=s}set(e){return this.origValue=e,this}serialize(){var e,t;return e=this.value(),t=Array.isArray(e)||p(e)||Vt(e)?!k(e):null!=e,null!=this.shortName&&t?`${this.shortName}_${e}`:""}value(){return this.process(this.origValue)}static norm_color(e){return null!=e?e.replace(/^#/,"rgb:"):void 0}static build_array(e){return null==e?[]:Array.isArray(e)?e:[e]}static process_video_params(e){var t;switch(e.constructor){case Object:return t="","codec"in e&&(t=e.codec,"profile"in e&&(t+=":"+e.profile,"level"in e&&(t+=":"+e.level))),t;case String:return e;default:return null}}}class Yt extends qt{constructor(e,t,s=".",i=void 0){super(e,t,i),this.sep=s}serialize(){if(null!=this.shortName){let e=this.value();if(k(e))return"";if(Vt(e))return`${this.shortName}_${e}`;{let t=e.map((e=>Wt(e.serialize)?e.serialize():e)).join(this.sep);return`${this.shortName}_${t}`}}return""}value(){return Array.isArray(this.origValue)?this.origValue.map((e=>this.process(e))):this.process(this.origValue)}set(e){return null==e||Array.isArray(e)?super.set(e):super.set([e])}}class Xt extends qt{constructor(e,t="t",s=".",i=void 0){super(e,t,i),this.sep=s}serialize(){let e="";const t=this.value();if(k(t))return e;if((s=t).length&&s.every(Vt)){const s=t.join(this.sep);k(s)||(e=`${this.shortName}_${s}`)}else e=t.map((e=>Vt(e)&&!k(e)?`${this.shortName}_${e}`:Wt(e.serialize)?e.serialize():p(e)&&!k(e)?new as(e).serialize():void 0)).filter((e=>e));var s;return e}set(e){return this.origValue=e,Array.isArray(this.origValue)?super.set(this.origValue):super.set([this.origValue])}}class Qt extends qt{constructor(e,t,s=Qt.norm_range_value){super(e,t,s)}static norm_range_value(e){let t=String(e).match(new RegExp("^(([0-9]*)\\.([0-9]+)|([0-9]+))([%pP])?$"));if(t){let s=null!=t[5]?"p":"";e=(t[1]||t[4])+s}return e}}class Zt extends qt{constructor(e,t,s=Ut){super(e,t,s)}serialize(){return this.value()}}class Jt extends qt{value(){if(null==this.origValue)return"";let e;if(this.origValue instanceof w)e=this.origValue;else if(p(this.origValue)){let t=function(e,t){var s,i;s={};for(let r in e)i=e[r],t&&(r=t(r)),k(r)||(s[r]=i);return s}(this.origValue,Nt);e="text"===t.resourceType||null!=t.text?new I(t):"subtitles"===t.resourceType?new Ht(t):"fetch"===t.resourceType||null!=t.url?new Gt(t):new w(t)}else e=Vt(this.origValue)?/^fetch:.+/.test(this.origValue)?new Gt(this.origValue.substr(6)):this.origValue:"";return e.toString()}static textStyle(e){return new I(e).textStyleIdentifier()}}class es{constructor(e){let t,s;t=void 0,s={},this.toOptions=e=>{let t={};if(null==e&&(e=!0),Object.keys(s).forEach((e=>t[e]=s[e].origValue)),Kt(t,this.otherOptions),e&&!k(this.chained)){let e=this.chained.map((e=>e.toOptions()));e.push(t),t={},Kt(t,this.otherOptions),t.transformation=e}return t},this.setParent=e=>(t=e,null!=e&&this.fromOptions("function"==typeof e.toOptions?e.toOptions():void 0),this),this.getParent=()=>t,this.param=(e,t,i,r,n)=>(null==n&&(n=Wt(r)?r:Ut),s[t]=new qt(t,i,n).set(e),this),this.rawParam=function(e,t,i,r,n){return n=rs(arguments),s[t]=new Zt(t,i,n).set(e),this},this.rangeParam=function(e,t,i,r,n){return n=rs(arguments),s[t]=new Qt(t,i,n).set(e),this},this.arrayParam=function(e,t,i,r=":",n=[],a=void 0){return a=rs(arguments),s[t]=new Yt(t,i,r,a).set(e),this},this.transformationParam=function(e,t,i,r=".",n=void 0,a=void 0){return a=rs(arguments),s[t]=new Xt(t,i,r,a).set(e),this},this.layerParam=function(e,t,i){return s[t]=new Jt(t,i).set(e),this},this.getValue=function(e){let t=s[e]&&s[e].value();return null!=t?t:this.otherOptions[e]},this.get=function(e){return s[e]},this.remove=function(e){var t;switch(!1){case null==s[e]:return t=s[e],delete s[e],t.origValue;case null==this.otherOptions[e]:return t=this.otherOptions[e],delete this.otherOptions[e],t;default:return null}},this.keys=function(){var e;return function(){var t;for(e in t=[],s)null!=e&&t.push(e.match(ts)?e:S(e));return t}().sort()},this.toPlainObject=function(){var e,t,i;for(t in e={},s)e[t]=s[t].value(),p(e[t])&&(e[t]=Lt(e[t]));return k(this.chained)||((i=this.chained.map((e=>e.toPlainObject()))).push(e),e={transformation:i}),e},this.chain=function(){var e;return 0!==Object.getOwnPropertyNames(s).length&&(e=new this.constructor(this.toOptions(!1)),this.resetTransformations(),this.chained.push(e)),this},this.resetTransformations=function(){return s={},this},this.otherOptions={},this.chained=[],this.fromOptions(e)}fromOptions(e={}){if(e instanceof es)this.fromTransformation(e);else{(Vt(e)||Array.isArray(e))&&(e={transformation:e}),(e=Lt(e)).if&&(this.set("if",e.if),delete e.if);for(let t in e){let s=e[t];null!=s&&(t.match(ts)?"$attr"!==t&&this.set("variable",t,s):this.set(t,s))}}return this}fromTransformation(e){return e instanceof es&&e.keys().forEach((t=>this.set(t,e.get(t).origValue))),this}set(e,...t){let s;return s=Nt(e),$t(os,s)?this[s].apply(this,t):this.otherOptions[e]=t[0],this}hasLayer(){return this.getValue("overlay")||this.getValue("underlay")}serialize(){var e,t,s,i,r,n,a,o,l,h,c,d,u,p,f,g,m,y;for(h=this.chained.map((e=>e.serialize())),i=this.keys(),p=null!=(r=this.get("transformation"))?r.serialize():void 0,e=null!=(n=this.get("if"))?n.serialize():void 0,g=function(e){var t,s,i,r,n;if(Array.isArray(e)){for(r=[],t=0,s=e.length;t<s;t++)[i,n]=e[t],r.push(`${i}_${$.normalize(n)}`);return r}return e}(null!=(a=this.get("variables"))?a.value():void 0),y=["transformation","if","variables"],i=i.filter((e=>!y.includes(e))),m=[],d=[],t=0,s=i.length;t<s;t++)(c=i[t]).match(ts)?m.push(c+"_"+$.normalize(null!=(o=this.get(c))?o.value():void 0)):d.push(null!=(l=this.get(c))?l.serialize():void 0);switch(!1){case!Vt(p):d.push(p);break;case!Array.isArray(p):h=h.concat(p)}return d=function(){var e,t,s;for(s=[],e=0,t=d.length;e<t;e++)f=d[e],(Array.isArray(f)&&!k(f)||!Array.isArray(f)&&f)&&s.push(f);return s}(),d=m.sort().concat(g).concat(d.sort()),"if_end"===e?d.push(e):k(e)||d.unshift(e),k(u=d.filter((e=>!!e)).join(is))||h.push(u),h.filter((e=>!!e)).join(ss)}static listNames(){return os}toHtmlAttributes(){let e,t,s,i,r,n,a,o;return s={},Object.keys(this.otherOptions).forEach((t=>{n=this.otherOptions[t],o=S(t),$t(ls,o)||$t(zt,o)||(e=/^html_/.test(t)?t.slice(5):t,s[e]=n)})),this.keys().forEach((e=>{/^html_/.test(e)&&(s[Nt(e.slice(5))]=this.getValue(e))})),this.hasLayer()||this.getValue("angle")||$t(["fit","limit","lfill"],this.getValue("crop"))||(a=null!=(i=this.get("width"))?i.origValue:void 0,t=null!=(r=this.get("height"))?r.origValue:void 0,parseFloat(a)>=1&&null==s.width&&(s.width=a),parseFloat(t)>=1&&null==s.height&&(s.height=t)),s}static isValidParamName(e){return os.indexOf(Nt(e))>=0}toHtml(){var e;return null!=(e=this.getParent())&&"function"==typeof e.toHtml?e.toHtml():void 0}toString(){return this.serialize()}clone(){return new es(this.toOptions(!0))}}const ts=/^\$[a-zA-Z0-9]+$/,ss="/",is=",";function rs(e){var t;return Wt(t=null!=e?e[e.length-1]:void 0)?t:void 0}function ns({function_type:e,source:t}){return"remote"===e?[e,btoa(t)].join(":"):"wasm"===e?[e,t].join(":"):void 0}class as extends es{constructor(e){super(e)}static new(e){return new as(e)}angle(e){return this.arrayParam(e,"angle","a",".",$.normalize),this}audioCodec(e){return this.param(e,"audio_codec","ac"),this}audioFrequency(e){return this.param(e,"audio_frequency","af"),this}aspectRatio(e){return this.param(e,"aspect_ratio","ar",$.normalize),this}background(e){return this.param(e,"background","b",qt.norm_color),this}bitRate(e){return this.param(e,"bit_rate","br"),this}border(e){return this.param(e,"border","bo",(e=>p(e)?`${(e=Object.assign({},{color:"black",width:2},e)).width}px_solid_${qt.norm_color(e.color)}`:e))}color(e){return this.param(e,"color","co",qt.norm_color),this}colorSpace(e){return this.param(e,"color_space","cs"),this}crop(e){return this.param(e,"crop","c"),this}customFunction(e){return this.param(e,"custom_function","fn",(()=>ns(e)))}customPreFunction(e){if(!this.get("custom_function"))return this.rawParam(e,"custom_function","",(()=>(e=ns(e))?`fn_pre:${e}`:e))}defaultImage(e){return this.param(e,"default_image","d"),this}delay(e){return this.param(e,"delay","dl"),this}density(e){return this.param(e,"density","dn"),this}duration(e){return this.rangeParam(e,"duration","du"),this}dpr(e){return this.param(e,"dpr","dpr",(e=>(null!=(e=e.toString())?e.match(/^\d+$/):void 0)?e+".0":$.normalize(e)))}effect(e){return this.arrayParam(e,"effect","e",":",$.normalize),this}else(){return this.if("else")}endIf(){return this.if("end")}endOffset(e){return this.rangeParam(e,"end_offset","eo"),this}fallbackContent(e){return this.param(e,"fallback_content"),this}fetchFormat(e){return this.param(e,"fetch_format","f"),this}format(e){return this.param(e,"format"),this}flags(e){return this.arrayParam(e,"flags","fl","."),this}gravity(e){return this.param(e,"gravity","g"),this}fps(e){return this.param(e,"fps","fps",(e=>Vt(e)?e:Array.isArray(e)?e.join("-"):e))}height(e){return this.param(e,"height","h",(()=>this.getValue("crop")||this.getValue("overlay")||this.getValue("underlay")?$.normalize(e):null))}htmlHeight(e){return this.param(e,"html_height"),this}htmlWidth(e){return this.param(e,"html_width"),this}if(e=""){var t,s,i,r,n;switch(e){case"else":return this.chain(),this.param(e,"if","if");case"end":for(this.chain(),t=i=this.chained.length-1;i>=0&&"end"!==(s=this.chained[t].getValue("if"))&&(null==s||(r=as.new().if(s),this.chained[t].remove("if"),n=this.chained[t],this.chained[t]=as.new().transformation([r,n]),"else"===s));t=i+=-1);return this.param(e,"if","if");case"":return H.new().setParent(this);default:return this.param(e,"if","if",(e=>H.new(e).toString()))}}keyframeInterval(e){return this.param(e,"keyframe_interval","ki"),this}ocr(e){return this.param(e,"ocr","ocr"),this}offset(e){var t,s;if([s,t]=Wt(null!=e?e.split:void 0)?e.split(".."):Array.isArray(e)?e:[null,null],null!=s&&this.startOffset(s),null!=t)return this.endOffset(t)}opacity(e){return this.param(e,"opacity","o",$.normalize),this}overlay(e){return this.layerParam(e,"overlay","l"),this}page(e){return this.param(e,"page","pg"),this}poster(e){return this.param(e,"poster"),this}prefix(e){return this.param(e,"prefix","p"),this}quality(e){return this.param(e,"quality","q",$.normalize),this}radius(e){return this.arrayParam(e,"radius","r",":",$.normalize),this}rawTransformation(e){return this.rawParam(e,"raw_transformation"),this}size(e){let t,s;if(Wt(null!=e?e.split:void 0))return[s,t]=e.split("x"),this.width(s),this.height(t)}sourceTypes(e){return this.param(e,"source_types"),this}sourceTransformation(e){return this.param(e,"source_transformation")}startOffset(e){return this.rangeParam(e,"start_offset","so"),this}streamingProfile(e){return this.param(e,"streaming_profile","sp"),this}transformation(e){return this.transformationParam(e,"transformation","t"),this}underlay(e){return this.layerParam(e,"underlay","u"),this}variable(e,t){return this.param(t,e,e),this}variables(e){return this.arrayParam(e,"variables"),this}videoCodec(e){return this.param(e,"video_codec","vc",qt.process_video_params),this}videoSampling(e){return this.param(e,"video_sampling","vs"),this}width(e){return this.param(e,"width","w",(()=>this.getValue("crop")||this.getValue("overlay")||this.getValue("underlay")?$.normalize(e):null)),this}x(e){return this.param(e,"x","x",$.normalize),this}y(e){return this.param(e,"y","y",$.normalize),this}zoom(e){return this.param(e,"zoom","z",$.normalize),this}}const os=["angle","audioCodec","audioFrequency","aspectRatio","background","bitRate","border","color","colorSpace","crop","customFunction","customPreFunction","defaultImage","delay","density","duration","dpr","effect","else","endIf","endOffset","fallbackContent","fetchFormat","format","flags","gravity","fps","height","htmlHeight","htmlWidth","if","keyframeInterval","ocr","offset","opacity","overlay","page","poster","prefix","quality","radius","rawTransformation","size","sourceTypes","sourceTransformation","startOffset","streamingProfile","transformation","underlay","variable","variables","videoCodec","videoSampling","width","x","y","zoom"],ls=os.map(S).concat(["api_key","api_secret","callback","cdn_subdomain","cloud_name","cname","private_cdn","protocol","resource_type","responsive","responsive_class","responsive_use_breakpoints","responsive_width","round_dpr","secure","secure_cdn_subdomain","secure_distribution","shorten","type","upload_preset","url_suffix","use_root_path","version","externalLibraries","max_timeout_ms"]),hs=as;function cs(e){if("string"==typeof e)return e;if(e instanceof hs)return e.toString();if(Array.isArray(e))return e.map((e=>cs(e))).filter((e=>e)).join("/");let t,s;const i=e.size,r=e.overlay||e.underlay,n=e.crop,a=D(e.angle).join("."),o=(e.background||"").replace(/^#/,"rgb:"),l=(e.color||"").replace(/^#/,"rgb:"),h=D(e.flags||[]).join("."),c=void 0===e.dpr?e.dpr:function(e){let t=e.toString();return(null!=t?t.match(/^\d+$/):void 0)?t+".0":$.normalize(t)}(e.dpr),d=R(e.overlay),u=function(e){let t=e;if(!t)return t;if(Array.isArray(t)||(t=[t]),0===t.length||t.length>4)throw new Error("Radius array should contain between 1 and 4 values");if(t.findIndex((e=>null===e))>=0)throw new Error("Corner: Cannot be null");return t.map(x).join(":")}(e.radius),f=R(e.underlay),g=function(e){return e?"if_"+x(e):e}(e.if),m=O(e.custom_function),y=function(e){const t=O(e);return"string"==typeof t?`pre:${t}`:null}(e.custom_pre_function);let v=e.fps,_=[],b=D(e.transformation||[]),T=e.effect;const A=r||a||"fit"===n||"limit"===n;if(i){const[e,r]=i.split("x");t=e,s=r}else t=e.width,s=e.height;t&&(0===t.toString().indexOf("auto")||A||parseFloat(t.toString())<1)&&delete e.width,s&&(A||parseFloat(s.toString())<1)&&delete e.height;const E=b.some((e=>"object"==typeof e));E?b=b.map((e=>p(e)?cs(e):cs({transformation:e}))).filter((e=>e)):(_=b.join("."),b=[]),Array.isArray(T)?T=T.join(":"):p(T)&&(T=Object.entries(T).map((([e,t])=>`${e}:${t}`)));let S=e.border;p(S)?S=`${null!=S.width?S.width:2}px_solid_${(null!=S.color?S.color:"black").replace(/^#/,"rgb:")}`:/^\d+$/.exec(S)&&(e.border=S,S=void 0),Array.isArray(v)&&(v=v.join("-"));const C={a:x(a),ar:x(e.aspect_ratio),b:o,bo:S,c:n,co:l,dpr:x(c),e:x(T),fl:h,fn:m||y,fps:v,h:x(s),ki:x(e.keyframe_interval),l:d,o:x(e.opacity),q:x(e.quality),r:u,t:_,u:f,w:x(t),x:x(e.x),y:x(e.y),z:x(e.zoom),ac:e.audio_codec,af:e.audio_frequency,br:e.bit_rate,cs:e.color_space,d:e.default_image,dl:e.delay,dn:e.density,du:N(e.duration),eo:N(e.end_offset||L(e.end_offset)?e.end_offset:M(e.offset)[1]),f:e.fetch_format,g:e.gravity,pg:e.page,p:e.prefix,so:N(e.start_offset||L(e.start_offset)?e.start_offset:M(e.offset)[0]),sp:e.streaming_profile,vc:F(e.video_codec),vs:e.video_sampling},w=[g,Object.entries(e).filter((([e,t])=>e.startsWith("$"))).map((([e,t])=>`${e}_${x(t)}`)).sort().concat((e.variables||[]).map((([e,t])=>`${e}_${x(t)}`))).join(","),Object.entries(C).filter((([e,t])=>!(null==t||"string"==typeof t&&0===t.length||Array.isArray(t)&&0===t.length))).map((([e,t])=>`${e}_${t}`)).sort().join(","),e.raw_transformation].filter((e=>e)).join(",");return w&&b.push(w),b.join("/")}function ds(e,t,s,i,r,n,a,o){let l;if(0===t.indexOf("/"))return"/res"+t;let h=!s;return a?(null!=o&&o!==m||(o=s?t+"-res.cloudinary.com":y),null==h&&(h=o===y),l="https://"+o):l=n?"http://"+n:"http://"+[s?t+"-":"","res",".cloudinary.com"].join(""),h&&(l+="/"+t),l}const us=function(e,t){let{tolerateMissingId:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(h()(e)){const i=Object.assign({},e);if(e=(0,o.sliceAndUnsetProperties)(i,"publicId").publicId,!d()(e)&&!s)throw new Error("Source is missing 'publicId'.");t&&(t=Object.assign({},i,t))}return{publicId:e,options:t}},ps=e=>u.P8.test(e),fs=(e,t)=>{let s=e,i=t;return"object"==typeof e&&(s=e.src),"object"==typeof t&&(i=t.src),/^\/\//.test(s)&&(i=i.slice(i.indexOf("//"))),/^\/\//.test(i)&&(s=s.slice(s.indexOf("//"))),s===i},gs=(e,t)=>Object.assign(e,t),ms=(e,t)=>function(e,t){let s;"fetch"===t.type&&null==t.fetch_format&&(t.fetch_format=t.format);let i=t.type,r=t.resource_type||"image",n=t.version;const a="boolean"!=typeof t.force_version||t.force_version,o=(t.long_url_signature,t.format),l=t.cloud_name;if(!l)throw"cloud_name must be provided in the configuration";const h=t.private_cdn,c=t.secure_distribution,d=t.secure,u=(t.cdn_subdomain,t.secure_cdn_subdomain,t.cname),p=t.shorten,f=t.sign_url,g=(t.api_secret,t.url_suffix),m=t.use_root_path,y=t.auth_token,v=/^(image|raw)\/([a-z0-9_]+)\/v(\d+)\/([^#]+)$/.exec(e);v&&(r=v[1],i=v[2],n=v[3],e=v[4]);const _=e;if(null==e)return _;if(e=e.toString(),null===i&&e.match(/^https?:\//i))return _;[r,i]=function(e,t,s,i,r){if(null==t&&(t="upload"),null!=s)if("image"===e&&"upload"===t)e="images",t=null;else if("image"===e&&"private"===t)e="private_images",t=null;else if("image"===e&&"authenticated"===t)e="authenticated_images",t=null;else if("raw"===e&&"upload"===t)e="files",t=null;else{if("video"!==e||"upload"!==t)throw new Error("URL Suffix only supported for image/upload, image/private, image/authenticated, video/upload and raw/upload");e="videos",t=null}if(i){if(!("image"===e&&"upload"===t||"images"===e&&null==t))throw new Error("Root path only supported for image/upload");e=null,t=null}return r&&"image"===e&&"upload"===t&&(e="iu",t=null),[e,t]}(r,i,g,m,p),[e,s]=function(e,t,s){let i;if((e=e.replace(/([^:])\/\//g,"$1/")).match(/^https?:\//i))i=e=E(e);else{if(i=e=encodeURIComponent(decodeURIComponent(e)).replace(/%3A/g,":").replace(/%2F/g,"/"),s){if(s.match(/[\.\/]/))throw new Error("url_suffix should not include . or /");e=e+"/"+s}null!=t&&(e=e+"."+t,i=i+"."+t)}return[e,i]}(e,o,g),null==n&&a&&s.indexOf("/")>=0&&!s.match(/^v[0-9]+/)&&!s.match(/^https?:\//)&&(n=1),n=null!=n?`v${n}`:null;const b=cs(Lt(t)).replace(/([^:])\/\//g,"$1/");if(f&&!y){let e=[b,s].filter((function(e){return null!=e&&""!==e})).join("/");try{for(let t=0;e!==decodeURIComponent(e)&&t<10;t++)e=decodeURIComponent(e)}catch(e){}}return[ds(0,l,h,0,0,u,d,c),r,i,b,n,e].filter((function(e){return null!=e&&""!==e})).join("/").replace(" ","%20")}(e,a()(t,["chainTarget"])),ys=e=>ds(0,e.cloud_name,e.private_cdn,e.cdn_subdomain,e.secure_cdn_subdomain,e.cname,e.secure??!0,e.secure_distribution),vs=(e,t)=>{const s=(e=>"Transformation"===e.constructor.name&&e.toOptions)(e)?e.toOptions():e;return new hs(s).fromOptions(t).toOptions()},_s={NO_SUPPORTED_MEDIA:6,CUSTOM:10,UNKNOWN_CUSTOMER:11,RESOURCE_NOT_FOUND:12,PRIVATE_RESOURCE:13,UNAUTHENTICATED:14},bs=e=>{let{errorMsg:t,publicId:s,cloudName:i,statusCode:r}=e;const n="Video cannot be played";let a={code:_s.CUSTOM,message:`${n}${t?"- "+t:""}`,statusCode:r},o=t.toLowerCase();return o.startsWith("unknown customer")&&(a.code=_s.UNKNOWN_CUSTOMER,a.message=`${n} Unknown cloud-name ${i}`),o.startsWith("resource not found")&&(a.code=_s.RESOURCE_NOT_FOUND,a.message=`${n} Public ID ${s} not found`),o.startsWith("private resource")&&(a.code=_s.PRIVATE_RESOURCE,a.message=`${n} Private video`),o.startsWith("unauthenticated access")&&(a.message=`${n} Requires authentication`,a.code=_s.UNAUTHENTICATED),a},Ts={AV1:"av1",VP9:"vp9",HEV1:"hev1",H265:"h265",H264:"h264"},As=()=>{r().use("video/auto",(()=>({async setSource(e,t){const{headers:s}=await fetch(e.src,{method:"HEAD",credentials:e.withCredentials?"include":"omit"}),i=s.get("content-type").split(";")[0];return t(null,{src:e.src,type:i})}})))}},6770:(e,t,s)=>{s.d(t,{A:()=>a});var i=s(8033),r=s(5871),n=s(7311);const a=class{_transformation=null;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{publicId:s,options:n}=(0,i.a5)(e,t),{cloudinaryConfig:a}=(0,r.sliceAndUnsetProperties)(n,"cloudinaryConfig"),{transformation:o}=(0,r.sliceAndUnsetProperties)(n,"transformation"),{queryParams:l}=(0,r.sliceAndUnsetProperties)(n,"queryParams");if(!a)throw new Error('Source is missing "cloudinaryConfig".');this.publicId=()=>s,this.cloudinaryConfig=()=>a,this.resourceConfig=()=>n,this.queryParams=()=>l,this.getType=()=>this._type,this.transformation(o)}transformation(e){return e&&(this._transformation=e),this._transformation}config(){const e=this.cloudinaryConfig();return{cloud_name:e.cloudName,url:(t,s)=>{if((0,i.iT)(t))return t;const r=(0,i.N7)(this.resourceConfig(),s);return(0,i.KA)(t,{...e,...r})}}}url(){let{transformation:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return`${this.config().url(this.publicId(),{transformation:e||this.transformation()})}${this.queryParams()?(0,n.y)(this.queryParams()):""}`}}},4650:(e,t,s)=>{s.d(t,{A:()=>l});var i=s(6770),r=s(8033);const n=RegExp(`\\.(${["jpg","png","gif","webp"].join("|")})$$`),a={resource_type:"image",type:"upload",transformation:[]};class o extends i.A{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};({publicId:e,options:t}=(0,r.a5)(e,t)),e=e.replace(n,""),t=Object.assign({},a,t),super(e,t),this._type="ImageSource"}}const l=o},5226:(e,t,s)=>{s.d(t,{IH:()=>h,P8:()=>a,Tf:()=>r,XY:()=>o,cE:()=>n,uf:()=>l,vD:()=>i});const i={format:"jpg",resource_type:"video"},r={resource_type:"video",type:"upload",transformation:[],sourceTransformation:{},sourceTypes:["auto"],recommendations:null,info:{},interactionAreas:{},chapters:{}},n=RegExp(`\\.(${["3g2","3gp","avi","flv","m3u8","ts","m2ts","mts","mov","mkv","mp4","mpeg","mpd","mxf","ogv","webm","wmv"].join("|")})$$`),a=RegExp("https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&/=]*)"),o={hls:"application/x-mpegURL",dash:"application/dash+xml",opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},l=["hls","dash","mpd","m3u8"],h={hls:"m3u8",dash:"mpd"}},5381:(e,t,s)=>{s.d(t,{A:()=>v});var i=s(7311),r=s(2160),n=s.n(r),a=s(1104),o=s(608),l=s(5226),h=s(8033),c=s(7571),d=s.n(c),u=s(5004);const p=e=>{return!!e&&(d()(e)?(t=e)&&Object.values(h.dC).some((e=>t.includes(e))):!!(e=>["video_codec","streaming_profile"].some((t=>(0,u.isKeyInTransformation)(e,t))))(e)||!!e.some?.((e=>p(e))));var t};var f=s(6770),g=s(4650);let m=0;class y extends f.A{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=(0,h.iT)(e);let{publicId:i,options:r}=(0,h.a5)(e,t);s||(i=i.replace(l.cE,"")),r=Object.assign({},l.Tf,r),r.poster||(r.poster=Object.assign({publicId:i},l.vD)),super(i,r),this._type=a.x.VIDEO,this.isRawUrl=s,this.isLiveStream="live"===r.type,this.withCredentials=!!r.withCredentials,this.getInitOptions=()=>t;const n=["poster","withCredentials","publicId","cloudinaryConfig","transformation","queryParams","type","info"],c=o.LU.filter((e=>!n.includes(e)));this._createGetterSetters(c),c.forEach((e=>{void 0!==r[e]&&this[e](r[e])})),this.poster(r.poster),this.objectId=m++}_createGetterSetters(e){e.forEach((e=>{const t=`_${e}`;this[e]=function(s){return void 0===s?"sourceTypes"===e&&void 0===this[t]?["auto"]:"sourceTransformation"===e&&void 0===this[t]?{}:this[t]:(this[t]=s,this)}}))}poster(e){let t={type:this.getInitOptions().type};return e?e instanceof g.A?(this._poster=e,this):(({publicId:e,options:t}=(0,h.a5)(e,t,{tolerateMissingId:!0})),!e&&this.isRawUrl||this.isLiveStream?null:(e||(e=this.publicId(),t=Object.assign({},t,l.vD)),t.cloudinaryConfig=t.cloudinaryConfig||this.cloudinaryConfig(),this._poster=new g.A(e,t),this)):this._poster}contains(e){return this.generateSources().some((t=>(0,h.Nl)(t,e)))}generateSources(){if(this.isRawUrl){const e="auto"===this.sourceTypes()[0]?null:this.sourceTypes()[0];return[this.generateRawSource(this.publicId(),e)]}return this.sourceTypes().map((e=>{const t=this.sourceTransformation()[e]||this.transformation(),s=function(e){e=e.toLowerCase().split("/").shift();let t=l.IH[e];return t||(t=e.split("/").shift()),t}(e),r=l.uf.includes(s),a={};t&&(a.transformation=n()(t)),Object.assign(a,{resource_type:"video",format:s});const[o,c]=function(e){const[t,s]=e.toLowerCase().split("/"),i=l.XY[t]||`video/${t}`;let r=[i];return s&&(r=[i,{video_codec:s}]),r}(e);!c||p(a.transformation)||p(this.rawTransformation())||(a.transformation=(0,h.N7)(a.transformation,c)),"auto"===a.format&&(delete a.format,a.transformation=(0,h.N7)(a.transformation,{fetch_format:"auto:video"})),r&&(JSON.stringify(a.transformation||{}).includes('"streaming_profile":')||this.isLiveStream||(a.transformation=(0,h.N7)(a.transformation,{streaming_profile:"auto"})));const d=this.queryParams()?(0,i.y)(this.queryParams()):"",u=this.config().url(this.publicId(),a),f=u.indexOf("?")>-1?d.replace("?","&"):d;return{type:o,src:u+f,cldSrc:this,isAdaptive:r,withCredentials:this.withCredentials}}))}generateRawSource(e,t){t=t||e.split(".").pop();const s=l.uf.includes(t);return{type:t=l.XY[t]?l.XY[t]:t?`video/${t}`:null,src:e,cldSrc:this,isAdaptive:s,withCredentials:this.withCredentials}}info(e){if(void 0!==e)return this._info=e,this;const t=this._info||this.getInitOptions().info;return{title:this.title()||t?.title||"",subtitle:this.description()||t?.subtitle||"",description:this.description()||t?.subtitle||""}}}const v=y},9454:(e,t,s)=>{s.d(t,{default:()=>a,w:()=>n});var i=s(8838);const r={colorsDark:{base:"#000000",accent:"#0D9AFF",text:"#FFFFFF"},colorsLight:{base:"#FFFFFF",accent:"#0D9AFF",text:"#000000"}},n=e=>(0,i.T4)(e)?r.colorsLight:r.colorsDark,a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=n(e.options_);t.colors=Object.assign({},s,t.colors);const i=e.el();return t.colors.base&&i.style.setProperty("--color-base",t.colors.base),t.colors.accent&&i.style.setProperty("--color-accent",t.colors.accent),t.colors.text&&i.style.setProperty("--color-text",t.colors.text),{updateColors:e=>{const s=Object.assign({},t.colors,e);s.base&&i.style.setProperty("--color-base",s.base),s.accent&&i.style.setProperty("--color-accent",s.accent),s.text&&i.style.setProperty("--color-text",s.text),t.colors=s},getColors:()=>t.colors}}},2650:(e,t,s)=>{var i=s(6673),r=s.n(i),n=s(5204),a=s.n(n),o=s(7509),l=s.n(o),h="7.5.2",c=function(e,t){t.isImmediatePropagationStopped=function(){return!0},t.cancelBubble=!0,t.isPropagationStopped=function(){return!0}},d=function(e,t,s){c(0,s),e.trigger({type:t+s.type,originalEvent:s})};function u(e){"playing"===e.type?function(e,t){e.ads.isInAdMode()&&(e.ads.isContentResuming()?e.ads._contentEnding&&d(e,"content",t):d(e,"ad",t))}(this,e):"ended"===e.type?function(e,t){e.ads.isInAdMode()?e.ads.isContentResuming()?(c(0,t),e.trigger("resumeended")):d(e,"ad",t):e.ads._contentHasEnded||e.ads.stitchedAds()||(d(e,"content",t),e.trigger("readyforpostroll"))}(this,e):"loadstart"===e.type||"loadeddata"===e.type||"loadedmetadata"===e.type?function(e,t){if(!("loadstart"===t.type&&!e.ads._hasThereBeenALoadStartDuringPlayerLife||"loadeddata"===t.type&&!e.ads._hasThereBeenALoadedData||"loadedmetadata"===t.type&&!e.ads._hasThereBeenALoadedMetaData))if(e.ads.inAdBreak())d(e,"ad",t);else{if(e.currentSrc()!==e.ads.contentSrc)return;d(e,"content",t)}}(this,e):"play"===e.type?function(e,t){e.ads.inAdBreak()?d(e,"ad",t):e.ads.isContentResuming()&&d(e,"content",t)}(this,e):this.ads.isInAdMode()&&(this.ads.isContentResuming()?d(this,"content",e):d(this,"ad",e))}function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},p.apply(this,arguments)}function f(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,g(e,t)}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}var m={},y=function(){!function(e){if(r().dom.isInFrame()&&"function"!=typeof a().__tcfapi){for(var t,s=a(),i={};s;){try{if(s.frames.__tcfapiLocator){t=s;break}}catch(e){}if(s===a().top)break;s=s.parent}if(!t)return;a().__tcfapi=function(e,s,r,n){var a=Math.random()+"",o={__tcfapiCall:{command:e,parameter:n,version:s,callId:a}};i[a]=r,t.postMessage(o,"*")},a().addEventListener("message",(function(e){var t={};try{t="string"==typeof e.data?JSON.parse(e.data):e.data}catch(e){}var s=t.__tcfapiReturn;s&&"function"==typeof i[s.callId]&&(i[s.callId](s.returnValue,s.success),i[s.callId]=null)}),!1)}}(),"function"==typeof a().__tcfapi&&a().__tcfapi("addEventListener",2,(function(e,t){t&&(m=e)}))},v="",_=function(e,t){if(void 0===t&&(t=a()),t.__uspapi)t.__uspapi("getUSPData",1,(function(t,s){var i=s?t.uspString:null;v=i,e(i)}));else{var s=function(e){for(var t=e.parent;t!==e.top;){try{if(t.frames&&t.frames.__uspapiLocator)return t}catch(e){}t=t.parent}try{if(e.top.frames&&e.top.frames.__uspapiLocator)return e.top}catch(e){}return null}(t);if(!s)return void e(null);var i=Math.random().toString(36).substring(2),r={__uspapiCall:{command:"getUSPData",version:1,callId:i}};t.addEventListener("message",(function s(r){if(r&&r.data&&r.data.__uspapiReturn&&r.data.__uspapiReturn.callId===i){t.removeEventListener("message",s,!1);var n=r.data.__uspapiReturn,a=n.returnValue,o=n.success?a.uspString:null;v=o,e(o)}}),!1),s.postMessage(r,"*")}},b={AdsBeforePrerollError:"ads-before-preroll-error",AdsPrerollError:"ads-preroll-error",AdsMidrollError:"ads-midroll-error",AdsPostrollError:"ads-postroll-error",AdsMacroReplacementFailed:"ads-macro-replacement-failed",AdsResumeContentFailed:"ads-resume-content-failed"},T=function(e,t){return t?encodeURIComponent(e):e},A=function(e,t,s,i,n){for(var a in void 0===i&&(i={}),t){var o=i.hasOwnProperty(a)?i[a]:a;if(o.startsWith("r:"))try{var l=new RegExp(o.slice(2),"g");e=e.replace(l,T(t[a],s))}catch(e){n.ads.error({errorType:b.AdsMacroReplacementFailed,macro:a,error:e}),r().log.warn('Unable to replace macro with regex "'+o+'". The provided regex may be invalid.')}else e=e.split(o).join(T(t[a],s))}return e};function E(e,t,s){void 0===t&&(t=!1),void 0===s&&(s={});var i=s.disableDefaultMacros||!1,n=s.macroNameOverrides||{};delete s.disableDefaultMacros,delete s.macroNameOverrides;var o=s;if(i)return A(e,o,t,n);var h,c,d,u=function(e){var t={},s=e.replace(/{([^}=]+)=([^}]*)}/g,(function(e,s,i){return t["{"+s+"}"]=i,"{"+s+"}"}));return{defaults:t,modifiedString:s}}(e),f=u.defaults,g=u.modifiedString;for(var y in e=g,p(o,{"{player.id}":(d=this).options_["data-player"]||d.id_,"{player.height}":d.currentHeight(),"{player.width}":d.currentWidth(),"{player.heightInt}":Math.round(d.currentHeight()),"{player.widthInt}":Math.round(d.currentWidth()),"{player.autoplay}":d.autoplay()?1:0,"{player.muted}":d.muted()?1:0,"{player.language}":d.language()||"","{mediainfo.id}":d.mediainfo?d.mediainfo.id:"","{mediainfo.name}":d.mediainfo?d.mediainfo.name:"","{mediainfo.duration}":d.mediainfo?d.mediainfo.duration:"","{player.duration}":d.duration(),"{player.durationInt}":Math.round(d.duration()),"{player.live}":d.duration()===1/0?1:0,"{player.pageUrl}":r().dom.isInFrame()?l().referrer:a().location.href,"{playlistinfo.id}":d.playlistinfo?d.playlistinfo.id:"","{playlistinfo.name}":d.playlistinfo?d.playlistinfo.name:"","{timestamp}":(new Date).getTime(),"{document.referrer}":l().referrer,"{window.location.href}":a().location.href,"{random}":Math.floor(1e12*Math.random())},function(e,t){var s={};return["description","tags","reference_id","ad_keys"].forEach((function(i){e&&e[i]?s["{mediainfo."+i+"}"]=e[i]:t["{mediainfo."+i+"}"]?s["{mediainfo."+i+"}"]=t["{mediainfo."+i+"}"]:s["{mediainfo."+i+"}"]=""})),["custom_fields","customFields"].forEach((function(t){!function(e,t,s){if(e&&e[s])for(var i=e[s],r=Object.keys(i),n=0;n<r.length;n++)t["{mediainfo."+s+"."+r[n]+"}"]=i[r[n]]}(e,s,t)})),s}(this.mediainfo,f),(h=m,c={},Object.keys(h).forEach((function(e){c["{tcf."+e+"}"]=h[e]})),c["{tcf.gdprAppliesInt}"]=h.gdprApplies?1:0,c),{"{usp.uspString}":v},function(e,t,s){var i=new RegExp("{pageVariable\\.([^}]+)}","g"),n={},o=(e.match(i)||[]).concat(Object.keys(s).filter((function(t){return i.test(t)&&e.includes(s[t])})));if(o)return o.forEach((function(e){for(var s,i=e,o=e.slice(14,-1),l=o.split("."),h=a(),c=0;c<l.length;c++)if(c===l.length-1)s=h[l[c]];else if(void 0===(h=h[l[c]]))break;var d=typeof s;null===s?n[i]="null":void 0===s?t[i]?n[i]=t[i]:(r().log.warn('Page variable "'+o+'" not found'),n[i]=""):"string"!==d&&"number"!==d&&"boolean"!==d?(r().log.warn('Page variable "'+o+'" is not a supported type'),n[i]=""):n[i]=s})),n}(e,f,n)),e=A(e,o,t,n,this),f)e=e.replace(y,f[y]);return e}var S={processMetadataTracks:function(e,t){for(var s=e.textTracks(),i=function(s){"metadata"===s.kind&&(e.ads.cueTextTracks.setMetadataTrackMode(s),t(e,s))},r=0;r<s.length;r++)i(s[r]);s.addEventListener("addtrack",(function(e){i(e.track)}))},setMetadataTrackMode:function(e){},getSupportedAdCue:function(e,t){return t},isSupportedAdCue:function(e,t){return!0},getCueId:function(e,t){return t.id}},C=function(e,t){return void 0!==t&&e.ads.includedCues[t]},w=function(e,t){void 0!==t&&""!==t&&(e.ads.includedCues[t]=!0)};function k(){!1!==this.ads._shouldBlockPlay&&(this.paused()||(this.ads.debug("Playback was canceled by cancelContentPlay"),this.pause()),this.ads._cancelledPlay=!0)}S.processAdTrack=function(e,t,s,i){e.ads.includedCues={};for(var n=0;n<t.length;n++){var a=t[n],o=this.getSupportedAdCue(e,a);if(!this.isSupportedAdCue(e,a))return void r().log.warn("Skipping as this is not a supported ad cue.",a);var l=this.getCueId(e,a),h=a.startTime;if(C(e,l))return void r().log("Skipping ad already seen with ID "+l);i&&i(e,o,l,h),s(e,o,l,h),w(e,l)}};var L={},I=r();L.isMiddlewareMediatorSupported=function(){return!I.browser.IS_IOS&&!I.browser.IS_ANDROID&&!!(I.use&&I.middleware&&I.middleware.TERMINATOR)},L.playMiddleware=function(e){return{setSource:function(e,t){t(null,e)},callPlay:function(){if(e.ads&&!0===e.ads._shouldBlockPlay)return e.ads.debug("Using playMiddleware to block content playback"),e.ads._playBlocked=!0,I.middleware.TERMINATOR},play:function(t,s){e.ads&&e.ads._playBlocked&&t?(e.ads.debug("Play call to Tech was terminated."),e.trigger("play"),e.addClass("vjs-has-started"),e.ads._playBlocked=!1):s&&s.catch&&s.catch((function(t){"NotAllowedError"!==t.name||r().browser.IS_SAFARI||e.trigger("pause")}))}}},L.testHook=function(e){I=e};var P=L.playMiddleware,R=L.isMiddlewareMediatorSupported,x={src:"data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAxJtZGF03ABMYXZjNjEuMy4xMDAAQiAIwRg4AAACrgYF//+q3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2NCByMzEwOCAzMWUxOWY5IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTcgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAAn//71sXwKaunqigzoMi7hlyTJrrYi4m0AwABFxzcqWKGahTaoBcQAAMWK4AlcFlIICBeldSEQBGCMHAAABVNtb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAAIgABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACQXRyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAABQAAAAPAAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAbltZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAADwAAAACAFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFkbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABJHN0YmwAAADAc3RzZAAAAAAAAAABAAAAsGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABQADwAEgAAABIAAAAAAAAAAEUTGF2YzYxLjMuMTAwIGxpYngyNjQAAAAAAAAAAAAAAAAY//8AAAA2YXZjQwFkAA3/4QAZZ2QADazZQUH7ARAAAAMAEAAAAwPA8UKZYAEABmjr48siwP34+AAAAAAQcGFzcAAAAAEAAAABAAAAFGJ0cnQAAAAAAALAEAACwBAAAAAYc3R0cwAAAAAAAAABAAAAAQAAAgAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAC7wAAAAEAAAAUc3RjbwAAAAAAAAABAAAARQAAAj10cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAABgAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAXAAAEAAABAAAAAAG1bWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAACsRAAACABVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABYG1pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABJHN0YmwAAAB+c3RzZAAAAAAAAAABAAAAbm1wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAACsRAAAAAAANmVzZHMAAAAAA4CAgCUAAgAEgICAF0AVAAAAAAH0AAAAEisFgICABRIQVuUABoCAgAECAAAAFGJ0cnQAAAAAAAH0AAAAEisAAAAYc3R0cwAAAAAAAAABAAAAAgAABAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAHHN0c3oAAAAAAAAAAAAAAAIAAAAVAAAABgAAABhzdGNvAAAAAAAAAAIAAAAwAAADNAAAABpzZ3BkAQAAAHJvbGwAAAACAAAAAf//AAAAHHNiZ3AAAAAAcm9sbAAAAAEAAAACAAAAAQAAAGF1ZHRhAAAAWW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALGlsc3QAAAAkqXRvbwAAABxkYXRhAAAAAQAAAABMYXZmNjEuMS4xMDA=",type:"video/mp4"},D=function(){function e(){}return e.getState=function(t){if(t)return e.states_&&e.states_[t]?e.states_[t]:void 0},e.registerState=function(t,s){if("string"!=typeof t||!t)throw new Error('Illegal state name, "'+t+'"; must be a non-empty string.');return e.states_||(e.states_={}),e.states_[t]=s,s},e}(),O=function(){function e(e){this.player=e}e._getName=function(){return"Anonymous State"};var t=e.prototype;return t.transitionTo=function(e){var t=this.player;this.cleanup(t);var s=new e(t);t.ads._state=s,t.ads.debug(this.constructor._getName()+" -> "+s.constructor._getName());for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];s.init.apply(s,[t].concat(r))},t.init=function(){},t.cleanup=function(){},t.onPlay=function(){},t.onPlaying=function(){},t.onEnded=function(){},t.onAdEnded=function(){},t.onAdsReady=function(){r().log.warn("Unexpected adsready event")},t.onAdsError=function(){},t.onAdsCanceled=function(){},t.onAdTimeout=function(){},t.onAdStarted=function(){},t.onAdSkipped=function(){},t.onContentChanged=function(){},t.onContentResumed=function(){},t.onReadyForPostroll=function(){r().log.warn("Unexpected readyforpostroll event")},t.onNoPreroll=function(){},t.onNoPostroll=function(){},t.startLinearAdMode=function(){r().log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.endLinearAdMode=function(){r().log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.skipLinearAdMode=function(){r().log.warn("Unexpected skipLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.isAdState=function(){throw new Error("isAdState unimplemented for "+this.constructor._getName())},t.isWaitingForAdBreak=function(){return!1},t.isContentResuming=function(){return!1},t.inAdBreak=function(){return!1},t.handleEvent=function(e){var t=this.player;"play"===e?this.onPlay(t):"adsready"===e?this.onAdsReady(t):"adserror"===e?this.onAdsError(t):"adscanceled"===e?this.onAdsCanceled(t):"adtimeout"===e?this.onAdTimeout(t):"ads-ad-started"===e?this.onAdStarted(t):"ads-ad-skipped"===e?this.onAdSkipped(t):"contentchanged"===e?this.onContentChanged(t):"contentresumed"===e?this.onContentResumed(t):"readyforpostroll"===e?this.onReadyForPostroll(t):"playing"===e?this.onPlaying(t):"ended"===e?this.onEnded(t):"nopreroll"===e?this.onNoPreroll(t):"nopostroll"===e?this.onNoPostroll(t):"adended"===e&&this.onAdEnded(t)},e}();D.registerState("State",O);var M=function(e){function t(t){var s;return(s=e.call(this,t)||this).contentResuming=!1,s.waitingForAdBreak=!1,s}f(t,e);var s=t.prototype;return s.isAdState=function(){return!0},s.onPlaying=function(){var e=D.getState("ContentPlayback");this.contentResuming&&this.transitionTo(e)},s.onContentResumed=function(){var e=D.getState("ContentPlayback");this.contentResuming&&this.transitionTo(e)},s.isWaitingForAdBreak=function(){return this.waitingForAdBreak},s.isContentResuming=function(){return this.contentResuming},s.inAdBreak=function(){return!0===this.player.ads._inLinearAdMode},t}(O);D.registerState("AdState",M);var N=function(e){function t(){return e.apply(this,arguments)||this}f(t,e);var s=t.prototype;return s.isAdState=function(){return!1},s.onContentChanged=function(e){var t=D.getState("BeforePreroll"),s=D.getState("Preroll");e.ads.debug("Received contentchanged event (ContentState)"),e.paused()?this.transitionTo(t):(this.transitionTo(s,!1),e.pause(),e.ads._pausedOnContentupdate=!0)},t}(O);D.registerState("ContentState",N);var F,B=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"AdsDone"};var s=t.prototype;return s.init=function(e){e.ads._contentHasEnded=!0,e.trigger("ended")},s.startLinearAdMode=function(){r().log.warn("Unexpected startLinearAdMode invocation (AdsDone)")},t}(D.getState("ContentState"));D.registerState("AdsDone",B);var j=function(e){e.ads.debug("Starting ad break"),e.ads._inLinearAdMode=!0,e.trigger("adstart"),e.ads.shouldTakeSnapshots()&&(e.ads.snapshot=function(e){var t;t=r().browser.IS_IOS&&e.ads.isLive(e)&&e.seekable().length>0?e.currentTime()-e.seekable().end(0):e.currentTime();var s=e.$(".vjs-tech"),i=e.textTracks?e.textTracks():[],n=[],a={ended:e.ended(),currentSrc:e.currentSrc(),sources:e.currentSources(),src:e.tech_.src(),currentTime:t,type:e.currentType()};s&&(a.style=s.getAttribute("style"));for(var o=0;o<i.length;o++){var l=i[o];n.push({track:l,mode:l.mode}),l.mode="disabled"}return a.suppressedTracks=n,a}(e)),e.ads.shouldPlayContentBehindAd(e)&&!e.ads.settings.stitchedAds&&(e.ads.preAdVolume_=e.volume(),e.volume(0)),e.addClass("vjs-ad-playing"),e.hasClass("vjs-live")&&e.removeClass("vjs-live"),e.ads.removeNativePoster(),e.ads.preAdPlaybackRate_=e.playbackRate(),e.playbackRate(1),e.controlBar&&e.controlBar.playbackRateMenuButton&&e.controlBar.playbackRateMenuButton.playbackRateSupported&&!e.controlBar.playbackRateMenuButton.hasClass("vjs-hidden")?(e.controlBar.playbackRateMenuButton.hide(),e.ads.showPlaybackMenuOnAdEnd_=!0):e.ads.showPlaybackMenuOnAdEnd_=!1},U=function(e,t){e.ads.debug("Ending ad break"),void 0===t&&(t=function(){}),e.ads.adType=null,e.ads._inLinearAdMode=!1,e.trigger("adend"),e.removeClass("vjs-ad-playing"),e.ads.isLive(e)&&e.addClass("vjs-live"),e.ads.shouldTakeSnapshots()?function(e,t){var s=e.ads.snapshot;if(void 0===t&&(t=function(){}),!0===e.ads.disableNextSnapshotRestore)return e.ads.disableNextSnapshotRestore=!1,delete e.ads.snapshot,void t();var i,n=e.$(".vjs-tech"),a=20,o=s.suppressedTracks,l=function(){for(var e=0;e<o.length;e++)(i=o[e]).track.mode=i.mode},h=function(){var t;if(r().browser.IS_IOS&&e.ads.isLive(e)){if(s.currentTime<0&&(t=e.seekable().length>0?e.seekable().end(0)+s.currentTime:e.currentTime(),e.currentTime(t)),e.paused()){var i=e.play();i&&i.catch&&i.catch((function(e){r().log.warn("Play promise rejected in IOS snapshot resume",e)}))}}else if(s.ended)e.currentTime(e.duration());else{e.currentTime(s.currentTime);var n=e.play();n&&n.catch&&n.catch((function(e){r().log.warn("Play promise rejected in snapshot resume",e)}))}e.ads.shouldRemoveAutoplay_&&(e.autoplay(!1),e.ads.shouldRemoveAutoplay_=!1)},c=function t(){if(e.off("contentcanplay",t),F&&e.clearTimeout(F),(n=e.el().querySelector(".vjs-tech")).readyState>1)return h();if(void 0===n.seekable)return h();if(n.seekable.length>0)return h();if(a--)e.setTimeout(t,50);else try{h()}catch(t){e.ads.error({errorType:b.AdsResumeContentFailed,error:t}),r().log.warn("Failed to resume the content after an advertisement",t)}};if("style"in s&&n.setAttribute("style",s.style||""),e.ads.videoElementRecycled())e.one("resumeended",(function(){delete e.ads.snapshot,t()})),e.one("contentloadedmetadata",l),r().browser.IS_IOS&&!e.autoplay()&&"function"==typeof e.techCall_&&(e.techCall_("setAutoplay",!0),e.ads.shouldRemoveAutoplay_=!0),e.src(s.sources),e.one("contentcanplay",c),F=e.setTimeout(c,2e3);else{if(l(),!e.ended()){var d=e.play();d&&d.catch&&d.catch((function(e){r().log.warn("Play promise rejected in snapshot restore",e)}))}delete e.ads.snapshot,t()}}(e,t):(e.ads.preAdVolume_&&e.volume(e.ads.preAdVolume_),t()),e.playbackRate(e.ads.preAdPlaybackRate_),e.ads.showPlaybackMenuOnAdEnd_&&e.controlBar.playbackRateMenuButton.show()},$=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"Preroll"};var s=t.prototype;return s.init=function(e,t,s){if(this.waitingForAdBreak=!0,e.addClass("vjs-ad-loading"),s||e.ads.nopreroll_)return this.resumeAfterNoPreroll(e);var i=e.ads.settings.timeout;"number"==typeof e.ads.settings.prerollTimeout&&(i=e.ads.settings.prerollTimeout),this._timeout=e.setTimeout((function(){e.trigger("adtimeout")}),i),t?this.handleAdsReady():this.adsReady=!1},s.onAdsReady=function(e){e.ads.inAdBreak()?r().log.warn("Unexpected adsready event (Preroll)"):(e.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},s.handleAdsReady=function(){this.adsReady=!0,this.readyForPreroll()},s.afterLoadStart=function(e){var t=this.player;t.ads._hasThereBeenALoadStartDuringPlayerLife?e():(t.ads.debug("Waiting for loadstart..."),t.one("loadstart",(function(){t.ads.debug("Received loadstart event"),e()})))},s.noPreroll=function(){var e=this;this.afterLoadStart((function(){e.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)"),e.resumeAfterNoPreroll(e.player)}))},s.readyForPreroll=function(){var e=this.player;this.afterLoadStart((function(){e.ads.debug("Triggered readyforpreroll event (Preroll)"),e.trigger("readyforpreroll")}))},s.onAdsCanceled=function(e){var t=this;e.ads.debug("adscanceled (Preroll)"),this.afterLoadStart((function(){t.resumeAfterNoPreroll(e)}))},s.onAdsError=function(e){var t=this;r().log("adserror (Preroll)"),e.ads.error({errorType:b.AdsPrerollError}),this.inAdBreak()?e.ads.endLinearAdMode():this.afterLoadStart((function(){t.resumeAfterNoPreroll(e)}))},s.startLinearAdMode=function(){var e=this.player;!this.adsReady||e.ads.inAdBreak()||this.isContentResuming()?r().log.warn("Unexpected startLinearAdMode invocation (Preroll)"):(this.clearTimeout(e),e.ads.adType="preroll",this.waitingForAdBreak=!1,j(e),e.ads._shouldBlockPlay=!1)},s.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},s.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(e.removeClass("vjs-ad-loading"),e.addClass("vjs-ad-content-resuming"),this.contentResuming=!0,U(e))},s.skipLinearAdMode=function(){var e=this,t=this.player;t.ads.inAdBreak()||this.isContentResuming()?r().log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart((function(){t.trigger("adskip"),t.ads.debug("skipLinearAdMode (Preroll)"),e.resumeAfterNoPreroll(t)}))},s.onAdTimeout=function(e){var t=this;this.afterLoadStart((function(){e.ads.debug("adtimeout (Preroll)"),t.resumeAfterNoPreroll(e)}))},s.onNoPreroll=function(e){e.ads.inAdBreak()||this.isContentResuming()?r().log.warn("Unexpected nopreroll event (Preroll)"):this.noPreroll()},s.resumeAfterNoPreroll=function(e){if(this.contentResuming=!0,e.ads._shouldBlockPlay=!1,this.cleanupPartial(e),e.ads._playRequested||e.ads._pausedOnContentupdate)if(e.paused()){e.ads.debug("resumeAfterNoPreroll: attempting to resume playback (Preroll)");var t=e.play();t&&t.then&&t.then(null,(function(e){}))}else e.ads.debug("resumeAfterNoPreroll: already playing (Preroll)"),e.trigger("play"),e.trigger("playing")},s.cleanup=function(e){e.ads._hasThereBeenALoadStartDuringPlayerLife||r().log.warn("Leaving Preroll state before loadstart event can cause issues."),this.cleanupPartial(e)},s.cleanupPartial=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming"),this.clearTimeout(e)},s.clearTimeout=function(e){e.clearTimeout(this._timeout),this._timeout=null},t}(D.getState("AdState"));D.registerState("Preroll",$);var H=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"BeforePreroll"};var s=t.prototype;return s.init=function(e){this.adsReady=!1,this.shouldResumeToContent=!1,e.ads._shouldBlockPlay=!e.ads.settings.allowVjsAutoplay||!e.autoplay()},s.onAdsReady=function(e){e.ads.debug("Received adsready event (BeforePreroll)"),this.adsReady=!0},s.onPlay=function(e){var t=D.getState("Preroll");e.ads.debug("Received play event (BeforePreroll)"),this.transitionTo(t,this.adsReady,this.shouldResumeToContent)},s.onAdsCanceled=function(e){e.ads.debug("adscanceled (BeforePreroll)"),this.shouldResumeToContent=!0},s.onAdsError=function(){this.player.ads.debug("adserror (BeforePreroll)"),this.player.ads.error({errorType:b.AdsBeforePrerollError}),this.shouldResumeToContent=!0},s.onNoPreroll=function(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)"),this.shouldResumeToContent=!0},s.skipLinearAdMode=function(){var e=this.player;e.trigger("adskip"),e.ads.debug("skipLinearAdMode (BeforePreroll)"),this.shouldResumeToContent=!0},s.onContentChanged=function(){this.init(this.player)},t}(D.getState("ContentState"));D.registerState("BeforePreroll",H);var V=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"Midroll"};var s=t.prototype;return s.init=function(e){e.ads.adType="midroll",j(e),e.addClass("vjs-ad-loading")},s.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},s.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(this.contentResuming=!0,e.addClass("vjs-ad-content-resuming"),e.removeClass("vjs-ad-loading"),U(e))},s.onAdsError=function(e){e.ads.error({errorType:b.AdsMidrollError}),this.inAdBreak()&&e.ads.endLinearAdMode()},s.cleanup=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming")},t}(D.getState("AdState"));D.registerState("Midroll",V);var G=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"Postroll"};var s=t.prototype;return s.init=function(e){if(this.waitingForAdBreak=!0,e.ads._contentEnding=!0,e.ads.nopostroll_){this.resumeContent(e);var t=D.getState("AdsDone");this.transitionTo(t)}else{e.addClass("vjs-ad-loading");var s=e.ads.settings.timeout;"number"==typeof e.ads.settings.postrollTimeout&&(s=e.ads.settings.postrollTimeout),this._postrollTimeout=e.setTimeout((function(){e.trigger("adtimeout")}),s)}},s.startLinearAdMode=function(){var e=this.player;e.ads.inAdBreak()||this.isContentResuming()?r().log.warn("Unexpected startLinearAdMode invocation (Postroll)"):(e.ads.adType="postroll",e.clearTimeout(this._postrollTimeout),this.waitingForAdBreak=!1,j(e))},s.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},s.endLinearAdMode=function(){var e=this,t=this.player,s=D.getState("AdsDone");this.inAdBreak()&&(t.removeClass("vjs-ad-loading"),this.resumeContent(t),U(t,(function(){e.transitionTo(s)})))},s.skipLinearAdMode=function(){var e=this.player;e.ads.inAdBreak()||this.isContentResuming()?r().log.warn("Unexpected skipLinearAdMode invocation"):(e.ads.debug("Postroll abort (skipLinearAdMode)"),e.trigger("adskip"),this.abort(e))},s.onAdTimeout=function(e){e.ads.debug("Postroll abort (adtimeout)"),this.abort(e)},s.onAdsError=function(e){e.ads.debug("Postroll abort (adserror)"),e.ads.error({errorType:b.AdsPostrollError}),e.ads.inAdBreak()?e.ads.endLinearAdMode():this.abort(e)},s.onContentChanged=function(e){if(this.isContentResuming()){var t=D.getState("BeforePreroll");this.transitionTo(t)}else if(!this.inAdBreak()){var s=D.getState("Preroll");this.transitionTo(s)}},s.onNoPostroll=function(e){this.isContentResuming()||this.inAdBreak()?r().log.warn("Unexpected nopostroll event (Postroll)"):this.abort(e)},s.resumeContent=function(e){this.contentResuming=!0,e.addClass("vjs-ad-content-resuming")},s.abort=function(e){var t=D.getState("AdsDone");this.resumeContent(e),e.removeClass("vjs-ad-loading"),this.transitionTo(t)},s.cleanup=function(e){e.removeClass("vjs-ad-content-resuming"),e.clearTimeout(this._postrollTimeout),e.ads._contentEnding=!1},t}(D.getState("AdState"));D.registerState("Postroll",G);var W=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"ContentPlayback"};var s=t.prototype;return s.init=function(e){e.ads._shouldBlockPlay=!1},s.onAdsReady=function(e){e.ads.debug("Received adsready event (ContentPlayback)"),e.ads.nopreroll_||(e.ads.debug("Triggered readyforpreroll event (ContentPlayback)"),e.trigger("readyforpreroll"))},s.onReadyForPostroll=function(e){var t=D.getState("Postroll");e.ads.debug("Received readyforpostroll event"),this.transitionTo(t)},s.startLinearAdMode=function(){var e=D.getState("Midroll");this.transitionTo(e)},t}(D.getState("ContentState"));D.registerState("ContentPlayback",W);var z=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"StitchedContentPlayback"};var s=t.prototype;return s.init=function(){this.player.ads._shouldBlockPlay=!1},s.onContentChanged=function(){this.player.ads.debug("Received contentchanged event ("+this.constructor._getName()+")")},s.startLinearAdMode=function(){var e=D.getState("StitchedAdRoll");this.transitionTo(e)},t}(D.getState("ContentState"));D.registerState("StitchedContentPlayback",z);var K=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"StitchedAdRoll"};var s=t.prototype;return s.init=function(){this.waitingForAdBreak=!1,this.contentResuming=!1,this.player.ads.adType="stitched",j(this.player)},s.onPlaying=function(){},s.onContentResumed=function(){},s.onAdEnded=function(){this.endLinearAdMode(),this.player.trigger("ended")},s.endLinearAdMode=function(){var e=D.getState("StitchedContentPlayback");U(this.player),this.transitionTo(e)},t}(D.getState("AdState"));D.registerState("StitchedAdRoll",K);var q=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"OutstreamPending"};var s=t.prototype;return s.init=function(e){this.adsReady=!1},s.onPlay=function(e){var t=D.getState("OutstreamPlayback");e.ads.debug("Received play event (OutstreamPending)"),this.transitionTo(t,this.adsReady)},s.onAdsReady=function(e){e.ads.debug("Received adsready event (OutstreamPending)"),this.adsReady=!0},s.onAdsError=function(){this.player.ads.debug("adserror (OutstreamPending)"),this.adsReady=!1},t}(D.getState("AdState"));D.registerState("OutstreamPending",q);var Y=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"OutstreamPlayback"};var s=t.prototype;return s.init=function(e,t){e.addClass("vjs-ad-loading"),t?this.handleAdsReady():this.abort(e)},s.onAdsReady=function(e){e.ads.inAdBreak()?r().log.warn("Unexpected adsready event (Preroll)"):(e.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},s.abort=function(e){var t=D.getState("OutstreamDone");e.removeClass("vjs-ad-loading"),this.transitionTo(t)},s.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},s.handleAdsReady=function(){this.adsReady=!0,this.readyForOutstreamPlayback()},s.readyForOutstreamPlayback=function(){var e=this.player;this.afterLoadStart((function(){e.trigger("readyforoutstream")}))},s.startLinearAdMode=function(){var e=this.player;this.adsReady&&!e.ads.inAdBreak()&&j(e)},s.cleanup=function(e){e.ads._hasThereBeenALoadStartDuringPlayerLife||r().log.warn("Leaving OutstreamPlayback state before loadstart event can cause issues."),this.cleanupPartial(e)},s.cleanupPartial=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming"),this.clearTimeout(e)},s.clearTimeout=function(e){e.clearTimeout(this._timeout),this._timeout=null},s.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},s.onAdsError=function(e){var t=this;r().log("adserror (OutstreamPlayback)"),this.inAdBreak()?e.ads.endLinearAdMode():this.afterLoadStart((function(){t.abort(e)}))},s.onAdTimeout=function(e){var t=this;this.afterLoadStart((function(){e.ads.debug("adtimeout (OutstreamPlayback)"),t.abort(e)}))},s.onAdsCanceled=function(e){var t=this;e.ads.debug("adscanceled (OutstreamPlaybac)"),this.afterLoadStart((function(){t.abort(e)}))},s.endLinearAdMode=function(){var e=this;if(this.inAdBreak()){this.player.removeClass("vjs-ad-loading");var t=D.getState("OutstreamDone");U(this.player,(function(){e.transitionTo(t)}))}},s.afterLoadStart=function(e){var t=this.player;t.ads._hasThereBeenALoadStartDuringPlayerLife?e():(t.ads.debug("Waiting for loadstart..."),t.one("loadstart",(function(){t.ads.debug("Received loadstart event"),e()})))},s.skipLinearAdMode=function(){var e=this,t=this.player,s=D.getState("OutstreamDone");this.inAdBreak()?r().log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart((function(){t.trigger("adskip"),t.ads.debug("skipLinearAdMode (OutstreamPlayback)"),e.transitionTo(s)}))},t}(D.getState("AdState"));D.registerState("OutstreamPlayback",Y);var X=function(e){function t(){return e.apply(this,arguments)||this}f(t,e),t._getName=function(){return"OutstreamDone"};var s=t.prototype;return s.init=function(e){e.trigger("ended")},s.startLinearAdMode=function(){r().log.warn("Unexpected startLinearAdMode invocation (OutstreamDone)")},t}(D.getState("AdState"));D.registerState("OutstreamDone",X);var Q=L.isMiddlewareMediatorSupported,Z=r().getTech("Html5").Events,J={timeout:5e3,prerollTimeout:void 0,postrollTimeout:void 0,debug:!1,stitchedAds:!1,contentIsLive:void 0,liveCuePoints:!0,allowVjsAutoplay:r().options.normalizeAutoplay||!1},ee=function(e){var t=this,s=r().obj.merge(J,e),i=[];Z.concat(["firstplay","loadedalldata"]).forEach((function(e){-1===i.indexOf(e)&&i.push(e)})),t.on(i,u),Q()||function(e,t){t&&r().log("Using cancelContentPlay to block content playback"),e.on("play",k)}(t,s.debug),t.setTimeout((function(){t.ads._hasThereBeenALoadStartDuringPlayerLife||""===t.src()||r().log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html")}),5e3),t.on("ended",(function(){t.hasClass("vjs-has-started")||t.addClass("vjs-has-started")})),t.on("contenttimeupdate",(function(){t.removeClass("vjs-waiting")})),t.on(["addurationchange","adcanplay"],(function(){if(!t.ads.settings.stitchedAds&&!t.hasStarted()&&(!t.ads.snapshot||t.currentSrc()!==t.ads.snapshot.currentSrc)&&t.ads.inAdBreak()){var e=t.play();e&&e.catch&&e.catch((function(e){r().log.warn("Play promise rejected when playing ad",e)}))}})),t.on("nopreroll",(function(){t.ads.debug("Received nopreroll event"),t.ads.nopreroll_=!0})),t.on("nopostroll",(function(){t.ads.debug("Received nopostroll event"),t.ads.nopostroll_=!0})),t.on("playing",(function(){t.ads._cancelledPlay=!1,t.ads._pausedOnContentupdate=!1})),t.on("play",(function(){t.ads._playRequested=!0})),t.one("loadstart",(function(){t.ads._hasThereBeenALoadStartDuringPlayerLife=!0})),t.on("loadeddata",(function(){t.ads._hasThereBeenALoadedData=!0})),t.on("loadedmetadata",(function(){t.ads._hasThereBeenALoadedMetaData=!0})),t.ads=function(e){return{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,_error:null,adType:null,VERSION:h,reset:function(){e.ads.disableNextSnapshotRestore=!1,e.ads._contentEnding=!1,e.ads._contentHasEnded=!1,e.ads.snapshot=null,e.ads.adType=null,e.ads._hasThereBeenALoadedData=!1,e.ads._hasThereBeenALoadedMetaData=!1,e.ads._cancelledPlay=!1,e.ads._shouldBlockPlay=!1,e.ads._playBlocked=!1,e.ads.nopreroll_=!1,e.ads.nopostroll_=!1,e.ads._playRequested=!1,e.ads._error=null},startLinearAdMode:function(){e.ads._state.startLinearAdMode()},endLinearAdMode:function(){e.ads._state.endLinearAdMode()},skipLinearAdMode:function(){e.ads._state.skipLinearAdMode()},stitchedAds:function(e){return void 0!==e&&(r().log.warn("Using player.ads.stitchedAds() as a setter is deprecated, it should be set as an option upon initialization of contrib-ads."),this.settings.stitchedAds=!!e),this.settings.stitchedAds},videoElementRecycled:function(){if(e.ads.shouldPlayContentBehindAd(e))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var t=e.tech_.src()!==this.snapshot.src,s=e.currentSrc()!==this.snapshot.currentSrc;return t||s},isLive:function(t){return void 0===t&&(t=e),"boolean"==typeof t.ads.settings.contentIsLive?t.ads.settings.contentIsLive:t.duration()===1/0||"8"===r().browser.IOS_VERSION&&0===t.duration()},shouldPlayContentBehindAd:function(t){if(void 0===t&&(t=e),t)return!!t.ads.settings.liveCuePoints&&!r().browser.IS_IOS&&!r().browser.IS_ANDROID&&t.duration()===1/0;throw new Error("shouldPlayContentBehindAd requires a player as a param")},shouldTakeSnapshots:function(t){return void 0===t&&(t=e),!this.shouldPlayContentBehindAd(t)&&!this.stitchedAds()},isInAdMode:function(){return this._state.isAdState()},isWaitingForAdBreak:function(){return this._state.isWaitingForAdBreak()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:function(){return this._state.inAdBreak()},removeNativePoster:function(){var t=e.$(".vjs-tech");t&&t.removeAttribute("poster")},debug:function(){if(this.settings.debug){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];1===t.length&&"string"==typeof t[0]?r().log("ADS: "+t[0]):r().log.apply(r(),["ADS:"].concat(t))}},error:function(t){if(void 0===t)return this._error||null;null!==t&&t.errorType?(this._error=t,r().log.error("An error with Ads occured. Type: "+t.errorType+"."),e.trigger({type:"vjsadserror",error:this._error})):this._error=null}}}(t),t.ads.settings=s,s.stitchedAds=!!s.stitchedAds,"outstream"===s.playerMode?(t.src(x),t.ads._state=new(D.getState("OutstreamPending"))(t)):s.stitchedAds?t.ads._state=new(D.getState("StitchedContentPlayback"))(t):t.ads._state=new(D.getState("BeforePreroll"))(t),t.ads._state.init(t),t.ads.cueTextTracks=S,t.ads.adMacroReplacement=E.bind(t),function(e){e.ads.contentSrc=e.currentSrc(),e.ads._seenInitialLoadstart=!1,e.on("loadstart",(function(){if(!e.ads.inAdBreak()){var t=e.currentSrc();t!==e.ads.contentSrc&&(e.ads._seenInitialLoadstart&&e.trigger({type:"contentchanged"}),e.trigger({type:"contentupdate",oldValue:e.ads.contentSrc,newValue:t}),e.ads.contentSrc=t),e.ads._seenInitialLoadstart=!0}}))}(t),t.on("contentchanged",t.ads.reset);var n=function(){var e=t.textTracks();if(!t.ads.shouldPlayContentBehindAd(t)&&t.ads.inAdBreak()&&t.tech_.featuresNativeTextTracks&&r().browser.IS_IOS&&!Array.isArray(t.textTracks()))for(var s=0;s<e.length;s++){var i=e[s];"showing"===i.mode&&(i.mode="disabled")}};t.ready((function(){t.textTracks().addEventListener("change",n)})),t.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","ads-ad-skipped","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"],(function(e){t.ads._state.handleEvent(e.type)})),t.on("dispose",(function(){t.ads.reset(),t.textTracks().removeEventListener("change",n)})),y(),_((function(){})),t.ads.listenToTcf=y,t.ads.updateUsPrivacyString=function(e){return _(e)}};function te(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function re(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,te(i.key),i)}}function ne(e,t,s){return t&&re(e.prototype,t),s&&re(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}ee.Error=b,ee.VERSION=h,function(e){!function(){if(r().getPlugin)return Boolean(r().getPlugin("ads"));var e=r().getComponent("Player");return Boolean(e&&e.prototype.ads)}(r())&&((r().registerPlugin||r().plugin)("ads",e),R()&&!r().usingContribAdsMiddleware_&&(r().use("*",P),r().usingContribAdsMiddleware_=!0,r().log.debug("Play middleware has been registered with videojs")))}(ee);var oe=function(e,t,s){this.vjsPlayer=e,this.controller=s,this.contentTrackingTimer=null,this.contentComplete=!1,this.updateTimeIntervalHandle=null,this.updateTimeInterval=1e3,this.seekCheckIntervalHandle=null,this.seekCheckInterval=1e3,this.resizeCheckIntervalHandle=null,this.resizeCheckInterval=250,this.seekThreshold=100,this.contentEndedListeners=[],this.contentSource="",this.contentSourceType="",this.contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0},this.vjsPlayerDimensions={width:this.getPlayerWidth(),height:this.getPlayerHeight()},this.vjsControls=this.vjsPlayer.getChild("controlBar"),this.h5Player=null,this.vjsPlayer.one("play",this.setUpPlayerIntervals.bind(this)),this.boundContentEndedListener=this.localContentEndedListener.bind(this),this.vjsPlayer.on("contentended",this.boundContentEndedListener),this.vjsPlayer.on("dispose",this.playerDisposedListener.bind(this)),this.vjsPlayer.on("readyforpreroll",this.onReadyForPreroll.bind(this)),this.vjsPlayer.on("adtimeout",this.onAdTimeout.bind(this)),this.vjsPlayer.ready(this.onPlayerReady.bind(this)),"onPlay"===this.controller.getSettings().requestMode&&this.vjsPlayer.one("play",this.controller.requestAds.bind(this.controller)),this.vjsPlayer.ads||window.console.warn("You may be using a version of videojs-contrib-ads that is not compatible with your version of video.js."),this.vjsPlayer.ads(t)};oe.prototype.setUpPlayerIntervals=function(){this.updateTimeIntervalHandle&&clearInterval(this.updateTimeIntervalHandle),this.seekCheckIntervalHandle&&clearInterval(this.seekCheckIntervalHandle),this.resizeCheckIntervalHandle&&clearInterval(this.resizeCheckIntervalHandle),this.updateTimeIntervalHandle=setInterval(this.updateCurrentTime.bind(this),this.updateTimeInterval),this.seekCheckIntervalHandle=setInterval(this.checkForSeeking.bind(this),this.seekCheckInterval),this.resizeCheckIntervalHandle=setInterval(this.checkForResize.bind(this),this.resizeCheckInterval)},oe.prototype.updateCurrentTime=function(){this.contentPlayheadTracker.seeking||(this.contentPlayheadTracker.currentTime=this.vjsPlayer.currentTime())},oe.prototype.checkForSeeking=function(){var e=1e3*(this.vjsPlayer.currentTime()-this.contentPlayheadTracker.previousTime);Math.abs(e)>this.seekCheckInterval+this.seekThreshold?this.contentPlayheadTracker.seeking=!0:this.contentPlayheadTracker.seeking=!1,this.contentPlayheadTracker.previousTime=this.vjsPlayer.currentTime()},oe.prototype.checkForResize=function(){var e=this.getPlayerWidth(),t=this.getPlayerHeight();e==this.vjsPlayerDimensions.width&&t==this.vjsPlayerDimensions.height||(this.vjsPlayerDimensions.width=e,this.vjsPlayerDimensions.height=t,this.controller.onPlayerResize(e,t))},oe.prototype.localContentEndedListener=function(){for(var e in this.contentComplete||(this.contentComplete=!0,this.controller.onContentComplete()),this.contentEndedListeners)"function"==typeof this.contentEndedListeners[e]&&this.contentEndedListeners[e]();this.vjsPlayer.el()&&this.vjsPlayer.one("play",this.setUpPlayerIntervals.bind(this))},oe.prototype.onNoPostroll=function(){this.vjsPlayer.trigger("nopostroll")},oe.prototype.playerDisposedListener=function(){this.contentEndedListeners=[],this.controller.onPlayerDisposed(),this.contentComplete=!0,this.vjsPlayer.off("contentended",this.boundContentEndedListener),this.vjsPlayer.ads.adTimeoutTimeout&&clearTimeout(this.vjsPlayer.ads.adTimeoutTimeout);var e=[this.updateTimeIntervalHandle,this.seekCheckIntervalHandle,this.resizeCheckIntervalHandle];for(var t in e)e[t]&&clearInterval(e[t])},oe.prototype.onReadyForPreroll=function(){this.controller.onPlayerReadyForPreroll()},oe.prototype.onAdTimeout=function(){this.controller.onAdTimeout()},oe.prototype.onPlayerReady=function(){this.h5Player=document.getElementById(this.getPlayerId()).getElementsByClassName("vjs-tech")[0],this.h5Player.hasAttribute("autoplay")&&this.controller.setSetting("adWillAutoPlay",!0),this.onVolumeChange(),this.vjsPlayer.on("fullscreenchange",this.onFullscreenChange.bind(this)),this.vjsPlayer.on("volumechange",this.onVolumeChange.bind(this)),this.controller.onPlayerReady()},oe.prototype.onFullscreenChange=function(){this.vjsPlayer.isFullscreen()?this.controller.onPlayerEnterFullscreen():this.controller.onPlayerExitFullscreen()},oe.prototype.onVolumeChange=function(){var e=this.vjsPlayer.muted()?0:this.vjsPlayer.volume();this.controller.onPlayerVolumeChanged(e)},oe.prototype.injectAdContainerDiv=function(e){this.vjsControls.el().parentNode.appendChild(e)},oe.prototype.getContentPlayer=function(){return this.h5Player},oe.prototype.getVolume=function(){return this.vjsPlayer.muted()?0:this.vjsPlayer.volume()},oe.prototype.setVolume=function(e){this.vjsPlayer.volume(e),0==e?this.vjsPlayer.muted(!0):this.vjsPlayer.muted(!1)},oe.prototype.unmute=function(){this.vjsPlayer.muted(!1)},oe.prototype.mute=function(){this.vjsPlayer.muted(!0)},oe.prototype.play=function(){this.vjsPlayer.play()},oe.prototype.togglePlayback=function(){this.vjsPlayer.paused()?this.vjsPlayer.play():this.vjsPlayer.pause()},oe.prototype.getPlayerWidth=function(){var e=(getComputedStyle(this.vjsPlayer.el())||{}).width;return e&&0!==parseFloat(e)||(e=(this.vjsPlayer.el().getBoundingClientRect()||{}).width),parseFloat(e)||this.vjsPlayer.width()},oe.prototype.getPlayerHeight=function(){var e=(getComputedStyle(this.vjsPlayer.el())||{}).height;return e&&0!==parseFloat(e)||(e=(this.vjsPlayer.el().getBoundingClientRect()||{}).height),parseFloat(e)||this.vjsPlayer.height()},oe.prototype.getPlayerOptions=function(){return this.vjsPlayer.options_},oe.prototype.getPlayerId=function(){return this.vjsPlayer.id()},oe.prototype.toggleFullscreen=function(){this.vjsPlayer.isFullscreen()?this.vjsPlayer.exitFullscreen():this.vjsPlayer.requestFullscreen()},oe.prototype.getContentPlayheadTracker=function(){return this.contentPlayheadTracker},oe.prototype.onAdError=function(e){this.vjsControls.show();var t=void 0!==e.getError?e.getError():e.stack;this.vjsPlayer.trigger({type:"adserror",data:{AdError:t,AdErrorEvent:e}})},oe.prototype.onAdLog=function(e){var t=e.getAdData(),s=void 0!==t.adError?t.adError.getMessage():void 0;this.vjsPlayer.trigger({type:"adslog",data:{AdError:s,AdEvent:e}})},oe.prototype.onAdBreakStart=function(){this.contentSource=this.vjsPlayer.currentSrc(),this.contentSourceType=this.vjsPlayer.currentType(),this.vjsPlayer.off("contentended",this.boundContentEndedListener),this.vjsPlayer.ads.startLinearAdMode(),this.vjsControls.hide(),this.vjsPlayer.pause()},oe.prototype.onAdBreakEnd=function(){this.vjsPlayer.on("contentended",this.boundContentEndedListener),this.vjsPlayer.ads.inAdBreak()&&this.vjsPlayer.ads.endLinearAdMode(),this.vjsControls.show()},oe.prototype.onAdStart=function(){this.vjsPlayer.trigger("ads-ad-started")},oe.prototype.onAllAdsCompleted=function(){1==this.contentComplete&&(this.contentSource&&this.vjsPlayer.currentSrc()!=this.contentSource&&this.vjsPlayer.src({src:this.contentSource,type:this.contentSourceType}),this.controller.onContentAndAdsCompleted())},oe.prototype.onAdsReady=function(){this.vjsPlayer.trigger("adsready")},oe.prototype.changeSource=function(e){this.vjsPlayer.currentSrc()&&(this.vjsPlayer.currentTime(0),this.vjsPlayer.pause()),e&&this.vjsPlayer.src(e),this.vjsPlayer.one("loadedmetadata",this.seekContentToZero.bind(this))},oe.prototype.seekContentToZero=function(){this.vjsPlayer.currentTime(0)},oe.prototype.triggerPlayerEvent=function(e,t){this.vjsPlayer.trigger(e,t)},oe.prototype.addContentEndedListener=function(e){this.contentEndedListeners.push(e)},oe.prototype.reset=function(){this.vjsPlayer.off("contentended",this.boundContentEndedListener),this.vjsPlayer.on("contentended",this.boundContentEndedListener),this.vjsControls.show(),this.vjsPlayer.ads.inAdBreak()&&this.vjsPlayer.ads.endLinearAdMode(),this.contentPlayheadTracker.currentTime=0,this.contentComplete=!1};var le=function(e){this.controller=e,this.adContainerDiv=document.createElement("div"),this.controlsDiv=document.createElement("div"),this.countdownDiv=document.createElement("div"),this.seekBarDiv=document.createElement("div"),this.progressDiv=document.createElement("div"),this.playPauseDiv=document.createElement("div"),this.muteDiv=document.createElement("div"),this.sliderDiv=document.createElement("div"),this.sliderLevelDiv=document.createElement("div"),this.fullscreenDiv=document.createElement("div"),this.boundOnMouseUp=this.onMouseUp.bind(this),this.boundOnMouseMove=this.onMouseMove.bind(this),this.adPlayheadTracker={currentTime:0,duration:0,isPod:!1,adPosition:0,totalAds:0},this.controlPrefix=this.controller.getPlayerId()+"_",this.showCountdown=!0,!1===this.controller.getSettings().showCountdown&&(this.showCountdown=!1),this.isAdNonlinear=!1,this.createAdContainer()};le.prototype.createAdContainer=function(){this.assignControlAttributes(this.adContainerDiv,"ima-ad-container"),this.adContainerDiv.style.position="absolute",this.adContainerDiv.style.zIndex=1111,this.adContainerDiv.addEventListener("mouseenter",this.showAdControls.bind(this),!1),this.adContainerDiv.addEventListener("mouseleave",this.hideAdControls.bind(this),!1),this.adContainerDiv.addEventListener("click",this.onAdContainerClick.bind(this),!1),this.createControls(),this.controller.injectAdContainerDiv(this.adContainerDiv)},le.prototype.createControls=function(){this.assignControlAttributes(this.controlsDiv,"ima-controls-div"),this.controlsDiv.style.width="100%",this.controller.getIsMobile()?this.countdownDiv.style.display="none":(this.assignControlAttributes(this.countdownDiv,"ima-countdown-div"),this.countdownDiv.innerHTML=this.controller.getSettings().adLabel,this.countdownDiv.style.display=this.showCountdown?"block":"none"),this.assignControlAttributes(this.seekBarDiv,"ima-seek-bar-div"),this.seekBarDiv.style.width="100%",this.assignControlAttributes(this.progressDiv,"ima-progress-div"),this.assignControlAttributes(this.playPauseDiv,"ima-play-pause-div"),this.addClass(this.playPauseDiv,"ima-playing"),this.playPauseDiv.addEventListener("click",this.onAdPlayPauseClick.bind(this),!1),this.assignControlAttributes(this.muteDiv,"ima-mute-div"),this.addClass(this.muteDiv,"ima-non-muted"),this.muteDiv.addEventListener("click",this.onAdMuteClick.bind(this),!1),this.assignControlAttributes(this.sliderDiv,"ima-slider-div"),this.sliderDiv.addEventListener("mousedown",this.onAdVolumeSliderMouseDown.bind(this),!1),this.controller.getIsIos()&&(this.sliderDiv.style.display="none"),this.assignControlAttributes(this.sliderLevelDiv,"ima-slider-level-div"),this.assignControlAttributes(this.fullscreenDiv,"ima-fullscreen-div"),this.addClass(this.fullscreenDiv,"ima-non-fullscreen"),this.fullscreenDiv.addEventListener("click",this.onAdFullscreenClick.bind(this),!1),this.adContainerDiv.appendChild(this.controlsDiv),this.controlsDiv.appendChild(this.countdownDiv),this.controlsDiv.appendChild(this.seekBarDiv),this.controlsDiv.appendChild(this.playPauseDiv),this.controlsDiv.appendChild(this.muteDiv),this.controlsDiv.appendChild(this.sliderDiv),this.controlsDiv.appendChild(this.fullscreenDiv),this.seekBarDiv.appendChild(this.progressDiv),this.sliderDiv.appendChild(this.sliderLevelDiv)},le.prototype.onAdPlayPauseClick=function(){this.controller.onAdPlayPauseClick()},le.prototype.onAdMuteClick=function(){this.controller.onAdMuteClick()},le.prototype.onAdFullscreenClick=function(){this.controller.toggleFullscreen()},le.prototype.onAdsPaused=function(){this.controller.sdkImpl.adPlaying=!1,this.addClass(this.playPauseDiv,"ima-paused"),this.removeClass(this.playPauseDiv,"ima-playing"),this.showAdControls()},le.prototype.onAdsResumed=function(){this.onAdsPlaying(),this.showAdControls()},le.prototype.onAdsPlaying=function(){this.controller.sdkImpl.adPlaying=!0,this.addClass(this.playPauseDiv,"ima-playing"),this.removeClass(this.playPauseDiv,"ima-paused")},le.prototype.updateAdUi=function(e,t,s,i,r){var n=Math.floor(t/60),a=Math.floor(t%60);a.toString().length<2&&(a="0"+a);var o=": ";r>1&&(o=" ("+i+" "+this.controller.getSettings().adLabelNofN+" "+r+"): "),this.countdownDiv.innerHTML=this.controller.getSettings().adLabel+o+n+":"+a;var l=e/s*100;this.progressDiv.style.width=l+"%"},le.prototype.unmute=function(){this.addClass(this.muteDiv,"ima-non-muted"),this.removeClass(this.muteDiv,"ima-muted"),this.sliderLevelDiv.style.width=100*this.controller.getPlayerVolume()+"%"},le.prototype.mute=function(){this.addClass(this.muteDiv,"ima-muted"),this.removeClass(this.muteDiv,"ima-non-muted"),this.sliderLevelDiv.style.width="0%"},le.prototype.onAdVolumeSliderMouseDown=function(){document.addEventListener("mouseup",this.boundOnMouseUp,!1),document.addEventListener("mousemove",this.boundOnMouseMove,!1)},le.prototype.onMouseMove=function(e){this.changeVolume(e)},le.prototype.onMouseUp=function(e){this.changeVolume(e),document.removeEventListener("mouseup",this.boundOnMouseUp),document.removeEventListener("mousemove",this.boundOnMouseMove)},le.prototype.changeVolume=function(e){var t=(e.clientX-this.sliderDiv.getBoundingClientRect().left)/this.sliderDiv.offsetWidth;t*=100,t=Math.min(Math.max(t,0),100),this.sliderLevelDiv.style.width=t+"%",0==this.percent?(this.addClass(this.muteDiv,"ima-muted"),this.removeClass(this.muteDiv,"ima-non-muted")):(this.addClass(this.muteDiv,"ima-non-muted"),this.removeClass(this.muteDiv,"ima-muted")),this.controller.setVolume(t/100)},le.prototype.showAdContainer=function(){this.adContainerDiv.style.display="block"},le.prototype.hideAdContainer=function(){this.adContainerDiv.style.display="none"},le.prototype.onAdContainerClick=function(){this.isAdNonlinear&&this.controller.togglePlayback()},le.prototype.reset=function(){this.hideAdContainer()},le.prototype.onAdError=function(){this.hideAdContainer()},le.prototype.onAdBreakStart=function(e){this.showAdContainer(),"application/javascript"!==e.getAd().getContentType()||this.controller.getSettings().showControlsForJSAds?this.controlsDiv.style.display="block":this.controlsDiv.style.display="none",this.onAdsPlaying(),this.hideAdControls()},le.prototype.onAdBreakEnd=function(){var e=this.controller.getCurrentAd();(null==e||e.isLinear())&&this.hideAdContainer(),this.controlsDiv.style.display="none",this.countdownDiv.innerHTML=""},le.prototype.onAllAdsCompleted=function(){this.hideAdContainer()},le.prototype.onLinearAdStart=function(){this.removeClass(this.adContainerDiv,"bumpable-ima-ad-container"),this.isAdNonlinear=!1},le.prototype.onNonLinearAdLoad=function(){this.adContainerDiv.style.display="block",this.addClass(this.adContainerDiv,"bumpable-ima-ad-container"),this.isAdNonlinear=!0},le.prototype.onPlayerEnterFullscreen=function(){this.addClass(this.fullscreenDiv,"ima-fullscreen"),this.removeClass(this.fullscreenDiv,"ima-non-fullscreen")},le.prototype.onPlayerExitFullscreen=function(){this.addClass(this.fullscreenDiv,"ima-non-fullscreen"),this.removeClass(this.fullscreenDiv,"ima-fullscreen")},le.prototype.onPlayerVolumeChanged=function(e){0==e?(this.addClass(this.muteDiv,"ima-muted"),this.removeClass(this.muteDiv,"ima-non-muted"),this.sliderLevelDiv.style.width="0%"):(this.addClass(this.muteDiv,"ima-non-muted"),this.removeClass(this.muteDiv,"ima-muted"),this.sliderLevelDiv.style.width=100*e+"%")},le.prototype.showAdControls=function(){this.controller.getSettings().disableAdControls||this.addClass(this.controlsDiv,"ima-controls-div-showing")},le.prototype.hideAdControls=function(){this.removeClass(this.controlsDiv,"ima-controls-div-showing")},le.prototype.assignControlAttributes=function(e,t){e.id=this.controlPrefix+t,e.className=this.controlPrefix+t+" "+t},le.prototype.getClassRegexp=function(e){return new RegExp("(^|[^A-Za-z-])"+e+"((?![A-Za-z-])|$)","gi")},le.prototype.elementHasClass=function(e,t){return this.getClassRegexp(t).test(e.className)},le.prototype.addClass=function(e,t){e.className=e.className.trim()+" "+t},le.prototype.removeClass=function(e,t){var s=this.getClassRegexp(t);e.className=e.className.trim().replace(s,"")},le.prototype.getAdContainerDiv=function(){return this.adContainerDiv},le.prototype.setShowCountdown=function(e){this.showCountdown=e,this.countdownDiv.style.display=this.showCountdown?"block":"none"};var he=function(e){this.controller=e,this.adDisplayContainer=null,this.adDisplayContainerInitialized=!1,this.adsLoader=null,this.adsManager=null,this.adsRenderingSettings=null,this.adsResponse=null,this.currentAd=null,this.adTrackingTimer=null,this.allAdsCompleted=!1,this.adsActive=!1,this.adPlaying=!1,this.adMuted=!1,this.adBreakReadyListener=void 0,this.contentCompleteCalled=!1,this.isAdTimedOut=!1,this.adsManagerDimensions={width:0,height:0},this.autoPlayAdBreaks=!0,!1===this.controller.getSettings().autoPlayAdBreaks&&(this.autoPlayAdBreaks=!1),this.controller.getSettings().locale&&google.ima.settings.setLocale(this.controller.getSettings().locale),this.controller.getSettings().disableFlashAds&&google.ima.settings.setDisableFlashAds(this.controller.getSettings().disableFlashAds),this.controller.getSettings().disableCustomPlaybackForIOS10Plus&&google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.controller.getSettings().disableCustomPlaybackForIOS10Plus),this.controller.getSettings().ppid&&google.ima.settings.setPpid(this.controller.getSettings().ppid),this.controller.getSettings().featureFlags&&google.ima.settings.setFeatureFlags(this.controller.getSettings().featureFlags)};he.prototype.initAdObjects=function(){this.adDisplayContainer=new google.ima.AdDisplayContainer(this.controller.getAdContainerDiv(),this.controller.getContentPlayer()),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),0==this.controller.getSettings().vpaidAllowed&&this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.DISABLED),void 0!==this.controller.getSettings().vpaidMode&&this.adsLoader.getSettings().setVpaidMode(this.controller.getSettings().vpaidMode),this.controller.getSettings().locale&&this.adsLoader.getSettings().setLocale(this.controller.getSettings().locale),this.controller.getSettings().numRedirects&&this.adsLoader.getSettings().setNumRedirects(this.controller.getSettings().numRedirects),this.controller.getSettings().sessionId&&this.adsLoader.getSettings().setSessionId(this.controller.getSettings().sessionId),this.adsLoader.getSettings().setPlayerType("videojs-ima"),this.adsLoader.getSettings().setPlayerVersion("2.3.0"),this.adsLoader.getSettings().setAutoPlayAdBreaks(this.autoPlayAdBreaks),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdsLoaderError.bind(this),!1),this.controller.playerWrapper.vjsPlayer.trigger({type:"ads-loader",adsLoader:this.adsLoader})},he.prototype.requestAds=function(){var e=new google.ima.AdsRequest;if(this.controller.getSettings().adTagUrl?e.adTagUrl=this.controller.getSettings().adTagUrl:e.adsResponse=this.controller.getSettings().adsResponse,this.controller.getSettings().forceNonLinearFullSlot&&(e.forceNonLinearFullSlot=!0),this.controller.getSettings().vastLoadTimeout&&(e.vastLoadTimeout=this.controller.getSettings().vastLoadTimeout),this.controller.getSettings().omidMode&&window.console.warn("The additional setting `omidMode` has been removed. Use `omidVendorAccess` instead."),this.controller.getSettings().omidVendorAccess){e.omidAccessModeRules={};var t=this.controller.getSettings().omidVendorAccess;Object.keys(t).forEach((function(s){e.omidAccessModeRules[s]=t[s]}))}e.linearAdSlotWidth=this.controller.getPlayerWidth(),e.linearAdSlotHeight=this.controller.getPlayerHeight(),e.nonLinearAdSlotWidth=this.controller.getSettings().nonLinearWidth||this.controller.getPlayerWidth(),e.nonLinearAdSlotHeight=this.controller.getSettings().nonLinearHeight||this.controller.getPlayerHeight(),e.setAdWillAutoPlay(this.controller.adsWillAutoplay()),e.setAdWillPlayMuted(this.controller.adsWillPlayMuted());var s=this.controller.getSettings().adsRequest;s&&"object"===se(s)&&Object.keys(s).forEach((function(t){e[t]=s[t]})),this.adsLoader.requestAds(e),this.controller.playerWrapper.vjsPlayer.trigger({type:"ads-request",AdsRequest:e})},he.prototype.onAdsManagerLoaded=function(e){this.createAdsRenderingSettings(),this.adsManager=e.getAdsManager(this.controller.getContentPlayheadTracker(),this.adsRenderingSettings),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,this.onAdBreakReady.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.onAllAdsCompleted.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,this.onAdLoaded.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,this.onAdStarted.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdComplete.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,this.onAdComplete.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOG,this.onAdLog.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.PAUSED,this.onAdPaused.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.RESUMED,this.onAdResumed.bind(this)),this.controller.playerWrapper.vjsPlayer.trigger({type:"ads-manager",adsManager:this.adsManager}),this.autoPlayAdBreaks||this.initAdsManager();var t=this.controller.getSettings().preventLateAdStart;t?t&&!this.isAdTimedOut&&this.controller.onAdsReady():this.controller.onAdsReady(),this.controller.getSettings().adsManagerLoadedCallback&&this.controller.getSettings().adsManagerLoadedCallback()},he.prototype.onAdsLoaderError=function(e){window.console.warn("AdsLoader error: "+e.getError()),this.controller.onErrorLoadingAds(e),this.adsManager&&this.adsManager.destroy()},he.prototype.initAdsManager=function(){try{var e=this.controller.getPlayerWidth(),t=this.controller.getPlayerHeight();this.adsManagerDimensions.width=e,this.adsManagerDimensions.height=t,this.adsManager.init(e,t,google.ima.ViewMode.NORMAL),this.adsManager.setVolume(this.controller.getPlayerVolume()),this.initializeAdDisplayContainer()}catch(e){this.onAdError(e)}},he.prototype.createAdsRenderingSettings=function(){if(this.adsRenderingSettings=new google.ima.AdsRenderingSettings,this.adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.controller.getSettings().adsRenderingSettings)for(var e in this.controller.getSettings().adsRenderingSettings)""!==e&&(this.adsRenderingSettings[e]=this.controller.getSettings().adsRenderingSettings[e])},he.prototype.onAdError=function(e){var t=void 0!==e.getError?e.getError():e.stack;window.console.warn("Ad error: "+t),this.adsManager.destroy(),this.controller.onAdError(e),this.adsActive=!1,this.adPlaying=!1},he.prototype.onAdBreakReady=function(e){this.adBreakReadyListener(e)},he.prototype.onContentPauseRequested=function(e){this.adsActive=!0,this.adPlaying=!0,this.controller.onAdBreakStart(e)},he.prototype.onContentResumeRequested=function(e){this.adsActive=!1,this.adPlaying=!1,this.controller.onAdBreakEnd()},he.prototype.onAllAdsCompleted=function(e){this.allAdsCompleted=!0,this.controller.onAllAdsCompleted()},he.prototype.onAdLoaded=function(e){e.getAd().isLinear()||(this.controller.onNonLinearAdLoad(),this.controller.playContent())},he.prototype.onAdStarted=function(e){this.currentAd=e.getAd(),this.currentAd.isLinear()?(this.adTrackingTimer=setInterval(this.onAdPlayheadTrackerInterval.bind(this),250),this.controller.onLinearAdStart()):this.controller.onNonLinearAdStart()},he.prototype.onAdPaused=function(){this.controller.onAdsPaused()},he.prototype.onAdResumed=function(e){this.controller.onAdsResumed()},he.prototype.onAdComplete=function(){this.currentAd.isLinear()&&clearInterval(this.adTrackingTimer)},he.prototype.onAdLog=function(e){this.controller.onAdLog(e)},he.prototype.onAdPlayheadTrackerInterval=function(){if(null!==this.adsManager){var e=this.adsManager.getRemainingTime(),t=this.currentAd.getDuration(),s=t-e;s=s>0?s:0;var i,r=0;this.currentAd.getAdPodInfo()&&(i=this.currentAd.getAdPodInfo().getAdPosition(),r=this.currentAd.getAdPodInfo().getTotalAds()),this.controller.onAdPlayheadUpdated(s,e,t,i,r)}},he.prototype.onContentComplete=function(){this.adsLoader&&(this.adsLoader.contentComplete(),this.contentCompleteCalled=!0),(this.adsManager&&this.adsManager.getCuePoints()&&!this.adsManager.getCuePoints().includes(-1)||!this.adsManager)&&this.controller.onNoPostroll(),this.allAdsCompleted&&this.controller.onContentAndAdsCompleted()},he.prototype.onPlayerDisposed=function(){this.adTrackingTimer&&clearInterval(this.adTrackingTimer),this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)},he.prototype.onPlayerReadyForPreroll=function(){if(this.autoPlayAdBreaks){this.initAdsManager();try{this.controller.showAdContainer(),this.adsManager.setVolume(this.controller.getPlayerVolume()),this.adsManager.start()}catch(e){this.onAdError(e)}}},he.prototype.onAdTimeout=function(){this.isAdTimedOut=!0},he.prototype.onPlayerReady=function(){this.initAdObjects(),(this.controller.getSettings().adTagUrl||this.controller.getSettings().adsResponse)&&"onLoad"===this.controller.getSettings().requestMode&&this.requestAds()},he.prototype.onPlayerEnterFullscreen=function(){this.adsManager&&this.adsManager.resize(window.screen.width,window.screen.height,google.ima.ViewMode.FULLSCREEN)},he.prototype.onPlayerExitFullscreen=function(){this.adsManager&&this.adsManager.resize(this.controller.getPlayerWidth(),this.controller.getPlayerHeight(),google.ima.ViewMode.NORMAL)},he.prototype.onPlayerVolumeChanged=function(e){this.adsManager&&this.adsManager.setVolume(e),this.adMuted=0==e},he.prototype.onPlayerResize=function(e,t){this.adsManager&&(this.adsManagerDimensions.width=e,this.adsManagerDimensions.height=t,this.adsManager.resize(e,t,google.ima.ViewMode.NORMAL))},he.prototype.getCurrentAd=function(){return this.currentAd},he.prototype.setAdBreakReadyListener=function(e){this.adBreakReadyListener=e},he.prototype.isAdPlaying=function(){return this.adPlaying},he.prototype.isAdMuted=function(){return this.adMuted},he.prototype.pauseAds=function(){this.adsManager.pause(),this.adPlaying=!1},he.prototype.resumeAds=function(){this.adsManager.resume(),this.adPlaying=!0},he.prototype.unmute=function(){this.adsManager.setVolume(1),this.adMuted=!1},he.prototype.mute=function(){this.adsManager.setVolume(0),this.adMuted=!0},he.prototype.setVolume=function(e){this.adsManager.setVolume(e),this.adMuted=0==e},he.prototype.initializeAdDisplayContainer=function(){this.adDisplayContainer&&(this.adDisplayContainerInitialized||(this.adDisplayContainer.initialize(),this.adDisplayContainerInitialized=!0))},he.prototype.playAdBreak=function(){this.autoPlayAdBreaks||(this.controller.showAdContainer(),this.adsManager.setVolume(this.controller.getPlayerVolume()),this.adsManager.start())},he.prototype.addEventListener=function(e,t){this.adsManager&&this.adsManager.addEventListener(e,t)},he.prototype.getAdsManager=function(){return this.adsManager},he.prototype.reset=function(){this.adsActive=!1,this.adPlaying=!1,this.adTrackingTimer&&clearInterval(this.adTrackingTimer),this.adsManager&&(this.adsManager.destroy(),this.adsManager=null),this.adsLoader&&!this.contentCompleteCalled&&this.adsLoader.contentComplete(),this.contentCompleteCalled=!1,this.allAdsCompleted=!1};var ce=function(e,t){this.settings={},this.contentAndAdsEndedListeners=[],this.isMobile=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i),this.isIos=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i),this.initWithSettings(t);var s={debug:this.settings.debug,timeout:this.settings.timeout,prerollTimeout:this.settings.prerollTimeout},i=Object.assign({},s,t.contribAdsSettings||{});this.playerWrapper=new oe(e,i,this),this.adUi=new le(this),this.sdkImpl=new he(this)};ce.IMA_DEFAULTS={adLabel:"Advertisement",adLabelNofN:"of",debug:!1,disableAdControls:!1,prerollTimeout:1e3,preventLateAdStart:!1,requestMode:"onLoad",showControlsForJSAds:!0,timeout:5e3},ce.prototype.initWithSettings=function(e){this.settings=Object.assign({},ce.IMA_DEFAULTS,e||{}),this.warnAboutDeprecatedSettings(),this.showCountdown=!0,!1===this.settings.showCountdown&&(this.showCountdown=!1)},ce.prototype.warnAboutDeprecatedSettings=function(){var e=this;["adWillAutoplay","adsWillAutoplay","adWillPlayMuted","adsWillPlayMuted"].forEach((function(t){void 0!==e.settings[t]&&console.warn("WARNING: videojs.ima setting "+t+" is deprecated")}))},ce.prototype.getSettings=function(){return this.settings},ce.prototype.getIsMobile=function(){return this.isMobile},ce.prototype.getIsIos=function(){return this.isIos},ce.prototype.injectAdContainerDiv=function(e){this.playerWrapper.injectAdContainerDiv(e)},ce.prototype.getAdContainerDiv=function(){return this.adUi.getAdContainerDiv()},ce.prototype.getContentPlayer=function(){return this.playerWrapper.getContentPlayer()},ce.prototype.getContentPlayheadTracker=function(){return this.playerWrapper.getContentPlayheadTracker()},ce.prototype.requestAds=function(){this.sdkImpl.requestAds()},ce.prototype.setSetting=function(e,t){this.settings[e]=t},ce.prototype.onErrorLoadingAds=function(e){this.adUi.onAdError(),this.playerWrapper.onAdError(e)},ce.prototype.onAdPlayPauseClick=function(){this.sdkImpl.isAdPlaying()?(this.adUi.onAdsPaused(),this.sdkImpl.pauseAds()):(this.adUi.onAdsPlaying(),this.sdkImpl.resumeAds())},ce.prototype.onAdMuteClick=function(){this.sdkImpl.isAdMuted()?(this.playerWrapper.unmute(),this.adUi.unmute(),this.sdkImpl.unmute()):(this.playerWrapper.mute(),this.adUi.mute(),this.sdkImpl.mute())},ce.prototype.setVolume=function(e){this.playerWrapper.setVolume(e),this.sdkImpl.setVolume(e)},ce.prototype.getPlayerVolume=function(){return this.playerWrapper.getVolume()},ce.prototype.toggleFullscreen=function(){this.playerWrapper.toggleFullscreen()},ce.prototype.onAdError=function(e){this.adUi.onAdError(),this.playerWrapper.onAdError(e)},ce.prototype.onAdBreakStart=function(e){this.playerWrapper.onAdBreakStart(),this.adUi.onAdBreakStart(e)},ce.prototype.showAdContainer=function(){this.adUi.showAdContainer()},ce.prototype.onAdBreakEnd=function(){this.playerWrapper.onAdBreakEnd(),this.adUi.onAdBreakEnd()},ce.prototype.onAllAdsCompleted=function(){this.adUi.onAllAdsCompleted(),this.playerWrapper.onAllAdsCompleted()},ce.prototype.onAdsPaused=function(){this.adUi.onAdsPaused()},ce.prototype.onAdsResumed=function(){this.adUi.onAdsResumed()},ce.prototype.onAdPlayheadUpdated=function(e,t,s,i,r){this.adUi.updateAdUi(e,t,s,i,r)},ce.prototype.onAdLog=function(e){this.playerWrapper.onAdLog(e)},ce.prototype.getCurrentAd=function(){return this.sdkImpl.getCurrentAd()},ce.prototype.playContent=function(){this.playerWrapper.play()},ce.prototype.onLinearAdStart=function(){this.adUi.onLinearAdStart(),this.playerWrapper.onAdStart()},ce.prototype.onNonLinearAdLoad=function(){this.adUi.onNonLinearAdLoad()},ce.prototype.onNonLinearAdStart=function(){this.adUi.onNonLinearAdLoad(),this.playerWrapper.onAdStart()},ce.prototype.getPlayerWidth=function(){return this.playerWrapper.getPlayerWidth()},ce.prototype.getPlayerHeight=function(){return this.playerWrapper.getPlayerHeight()},ce.prototype.onAdsReady=function(){this.playerWrapper.onAdsReady()},ce.prototype.onPlayerResize=function(e,t){this.sdkImpl.onPlayerResize(e,t)},ce.prototype.onContentComplete=function(){this.sdkImpl.onContentComplete()},ce.prototype.onNoPostroll=function(){this.playerWrapper.onNoPostroll()},ce.prototype.onContentAndAdsCompleted=function(){for(var e in this.contentAndAdsEndedListeners)"function"==typeof this.contentAndAdsEndedListeners[e]&&this.contentAndAdsEndedListeners[e]()},ce.prototype.onPlayerDisposed=function(){this.contentAndAdsEndedListeners=[],this.sdkImpl.onPlayerDisposed()},ce.prototype.onPlayerReadyForPreroll=function(){this.sdkImpl.onPlayerReadyForPreroll()},ce.prototype.onAdTimeout=function(){this.sdkImpl.onAdTimeout()},ce.prototype.onPlayerReady=function(){this.sdkImpl.onPlayerReady()},ce.prototype.onPlayerEnterFullscreen=function(){this.adUi.onPlayerEnterFullscreen(),this.sdkImpl.onPlayerEnterFullscreen()},ce.prototype.onPlayerExitFullscreen=function(){this.adUi.onPlayerExitFullscreen(),this.sdkImpl.onPlayerExitFullscreen()},ce.prototype.onPlayerVolumeChanged=function(e){this.adUi.onPlayerVolumeChanged(e),this.sdkImpl.onPlayerVolumeChanged(e)},ce.prototype.setContentWithAdTag=function(e,t){this.reset(),this.settings.adTagUrl=t||this.settings.adTagUrl,this.playerWrapper.changeSource(e)},ce.prototype.setContentWithAdsResponse=function(e,t){this.reset(),this.settings.adsResponse=t||this.settings.adsResponse,this.playerWrapper.changeSource(e)},ce.prototype.setContentWithAdsRequest=function(e,t){this.reset(),this.settings.adsRequest=t||this.settings.adsRequest,this.playerWrapper.changeSource(e)},ce.prototype.reset=function(){this.sdkImpl.reset(),this.playerWrapper.reset(),this.adUi.reset()},ce.prototype.addContentEndedListener=function(e){this.playerWrapper.addContentEndedListener(e)},ce.prototype.addContentAndAdsEndedListener=function(e){this.contentAndAdsEndedListeners.push(e)},ce.prototype.setAdBreakReadyListener=function(e){this.sdkImpl.setAdBreakReadyListener(e)},ce.prototype.setShowCountdown=function(e){this.adUi.setShowCountdown(e),this.showCountdown=e,this.adUi.countdownDiv.style.display=this.showCountdown?"block":"none"},ce.prototype.initializeAdDisplayContainer=function(){this.sdkImpl.initializeAdDisplayContainer()},ce.prototype.playAdBreak=function(){this.sdkImpl.playAdBreak()},ce.prototype.addEventListener=function(e,t){this.sdkImpl.addEventListener(e,t)},ce.prototype.getAdsManager=function(){return this.sdkImpl.getAdsManager()},ce.prototype.getPlayerId=function(){return this.playerWrapper.getPlayerId()},ce.prototype.changeAdTag=function(e){this.reset(),this.settings.adTagUrl=e},ce.prototype.pauseAd=function(){this.adUi.onAdsPaused(),this.sdkImpl.pauseAds()},ce.prototype.resumeAd=function(){this.adUi.onAdsPlaying(),this.sdkImpl.resumeAds()},ce.prototype.togglePlayback=function(){this.playerWrapper.togglePlayback()},ce.prototype.adsWillAutoplay=function(){return void 0!==this.settings.adsWillAutoplay?this.settings.adsWillAutoplay:void 0!==this.settings.adWillAutoplay?this.settings.adWillAutoplay:!!this.playerWrapper.getPlayerOptions().autoplay},ce.prototype.adsWillPlayMuted=function(){return void 0!==this.settings.adsWillPlayMuted?this.settings.adsWillPlayMuted:void 0!==this.settings.adWillPlayMuted?this.settings.adWillPlayMuted:void 0!==this.playerWrapper.getPlayerOptions().muted?this.playerWrapper.getPlayerOptions().muted:0==this.playerWrapper.getVolume()},ce.prototype.triggerPlayerEvent=function(e,t){this.playerWrapper.triggerPlayerEvent(e,t)};var de=function(e,t,s){this.vjsPlayer=e,this.daiController=s,this.vjsControls=this.vjsPlayer.getChild("controlBar"),this.h5Player=null,this.vjsPlayer.on("dispose",this.playerDisposedListener.bind(this)),this.vjsPlayer.on("pause",this.onPause.bind(this)),this.vjsPlayer.on("play",this.onPlay.bind(this)),this.vjsPlayer.on("seeked",this.onSeekEnd.bind(this)),this.vjsPlayer.ready(this.onPlayerReady.bind(this)),this.vjsPlayer.ads||window.console.warn("You may be using a version of videojs-contrib-ads that is not compatible with your version of video.js."),this.vjsPlayer.ads(t)};de.prototype.playerDisposedListener=function(){this.contentEndedListeners=[],this.daiController.onPlayerDisposed()},de.prototype.onPause=function(){this.daiController.isInAdBreak()&&this.vjsControls.show()},de.prototype.onPlay=function(){this.daiController.isInAdBreak()&&this.vjsControls.hide()},de.prototype.onSeekEnd=function(){this.daiController.onSeekEnd(this.vjsPlayer.currentTime())},de.prototype.onPlayerReady=function(){this.h5Player=document.getElementById(this.getPlayerId()).getElementsByClassName("vjs-tech")[0],this.daiController.onPlayerReady()},de.prototype.getStreamPlayer=function(){return this.h5Player},de.prototype.getVjsPlayer=function(){return this.vjsPlayer},de.prototype.getPlayerOptions=function(){return this.vjsPlayer.options_},de.prototype.getPlayerId=function(){return this.vjsPlayer.id()},de.prototype.onAdError=function(e){this.vjsControls.show();var t=void 0!==e.getError?e.getError():e.stack;this.vjsPlayer.trigger({type:"adserror",data:{AdError:t,AdErrorEvent:e}})},de.prototype.onAdBreakStart=function(){this.vjsControls.hide()},de.prototype.onAdBreakEnd=function(){this.vjsControls.show()},de.prototype.reset=function(){this.vjsControls.show()};var ue=function(e){this.daiController=e,this.streamPlayer=null,this.vjsPlayer=null,this.streamManager=null,this.uiSettings=new google.ima.dai.api.UiSettings,this.isAdBreak=!1,this.isSnapback=!1,this.snapForwardTime=0,this.timedMetadata,this.metadataLoaded={},this.SOURCE_TYPES={hls:"application/x-mpegURL",dash:"application/dash+xml"}};ue.prototype.initImaDai=function(){this.streamPlayer=this.daiController.getStreamPlayer(),this.vjsPlayer=this.daiController.getVjsPlayer(),this.createAdUiDiv(),this.daiController.getSettings().locale&&this.uiSettings.setLocale(this.daiController.getSettings().locale),this.streamManager=new google.ima.dai.api.StreamManager(this.streamPlayer,this.adUiDiv,this.uiSettings),this.streamPlayer.addEventListener("pause",this.onStreamPause),this.streamPlayer.addEventListener("play",this.onStreamPlay),this.streamManager.addEventListener([google.ima.dai.api.StreamEvent.Type.LOADED,google.ima.dai.api.StreamEvent.Type.ERROR,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED],this.onStreamEvent.bind(this),!1),this.vjsPlayer.textTracks().onaddtrack=this.onAddTrack.bind(this),this.vjsPlayer.trigger({type:"stream-manager",StreamManager:this.streamManager}),this.requestStream()},ue.prototype.onAddTrack=function(e){var t=this,s=e.track;"metadata"===s.kind&&(s.mode="hidden",s.addEventListener("cuechange",(function(e){var i,r=function(e,t){var s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!s){if(Array.isArray(e)||(s=function(e,t){if(e){if("string"==typeof e)return ae(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?ae(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){s&&(e=s);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,o=!1;return{s:function(){s=s.call(e)},n:function(){var e=s.next();return a=e.done,e},e:function(e){o=!0,n=e},f:function(){try{a||null==s.return||s.return()}finally{if(o)throw n}}}}(s.activeCues_);try{for(r.s();!(i=r.n()).done;){var n=i.value,a={};a[n.value.key]=n.value.data,t.streamManager.onTimedMetadata(a)}}catch(e){r.e(e)}finally{r.f()}})))},ue.prototype.createAdUiDiv=function(){var e=document.createElement("div");e.id="ad-ui",e.style.height="calc(100% - 3em)",this.streamPlayer.parentNode.appendChild(e),this.adUiDiv=e},ue.prototype.onStreamPause=function(){this.isAdBreak&&(this.adUiDiv.style.display="none")},ue.prototype.onStreamPlay=function(){this.isAdBreak&&(this.adUiDiv.style.display="block")},ue.prototype.onSeekEnd=function(e){if("live"!==this.daiController.getSettings().streamType)if(this.isSnapback)this.isSnapback=!1;else{var t=this.streamManager.previousCuePointForStreamTime(e);t&&!t.played&&(this.isSnapback=!0,this.snapForwardTime=e,this.vjsPlayer.currentTime(t.start))}},ue.prototype.onStreamEvent=function(e){switch(e.type){case google.ima.dai.api.StreamEvent.Type.LOADED:this.loadUrl(e.getStreamData().url);break;case google.ima.dai.api.StreamEvent.Type.ERROR:window.console.warn("Error loading stream, attempting to play backup stream. "+e.getStreamData().errorMessage),this.daiController.onErrorLoadingAds(e),this.daiController.getSettings().fallbackStreamUrl&&this.loadurl(this.daiController.getSettings().fallbackStreamUrl);break;case google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED:this.isAdBreak=!0,this.adUiDiv.style.display="block",this.daiController.onAdBreakStart();break;case google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED:this.isAdBreak=!1,this.adUiDiv.style.display="none",this.daiController.onAdBreakEnd(),this.snapForwardTime&&this.snapForwardTime>this.vjsPlayer.currentTime()&&(this.vjsPlayer.currentTime(this.snapForwardTime),this.snapForwardTime=0)}},ue.prototype.loadUrl=function(e){this.vjsPlayer.ready(function(){var t=this.daiController.getSettings().streamFormat;this.vjsPlayer.src({src:e,type:this.SOURCE_TYPES[t]});var s=this.daiController.getSettings().bookmarkTime;if(s){var i=this.streamManager.streamTimeForContentTime(s);this.isSnapback=!0,this.vjsPlayer.currentTime(i)}}.bind(this))},ue.prototype.requestStream=function(){var e,t=this.daiController.getSettings().streamType;if("vod"===t?((e=new google.ima.dai.api.VODStreamRequest).contentSourceId=this.daiController.getSettings().cmsId,e.videoId=this.daiController.getSettings().videoId):"live"===t?(e=new google.ima.dai.api.LiveStreamRequest).assetKey=this.daiController.getSettings().assetKey:window.console.warn("No valid stream type selected"),e.format=this.daiController.getSettings().streamFormat,this.daiController.getSettings().apiKey&&(e.apiKey=this.daiController.getSettings().apiKey),this.daiController.getSettings().authToken&&(e.authToken=this.daiController.getSettings().authToken),this.daiController.getSettings().adTagParameters&&(e.adTagParameters=this.daiController.getSettings().adTagParameters),this.daiController.getSettings().streamActivityMonitorId&&(e.streamActivityMonitorId=this.daiController.getSettings().streamActivityMonitorId),this.daiController.getSettings().omidMode){e.omidAccessModeRules={};var s=this.daiController.getSettings().omidMode;s.FULL&&(e.omidAccessModeRules[google.ima.OmidAccessMode.FULL]=s.FULL),s.DOMAIN&&(e.omidAccessModeRules[google.ima.OmidAccessMode.DOMAIN]=s.DOMAIN),s.LIMITED&&(e.omidAccessModeRules[google.ima.OmidAccessMode.LIMITED]=s.LIMITED)}this.streamManager.requestStream(e),this.vjsPlayer.trigger({type:"stream-request",StreamRequest:e})},ue.prototype.onPlayerReady=function(){this.initImaDai()},ue.prototype.onPlayerDisposed=function(){this.streamManager&&this.streamManager.reset()},ue.prototype.getStreamManager=function(){return this.StreamManager},ue.prototype.reset=function(){this.StreamManager&&this.StreamManager.reset()};var pe=function(e,t){this.inAdBreak=!1,this.settings={},this.isMobile=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i),this.isIos=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i),this.initWithSettings(t);var s={debug:this.settings.debug,timeout:this.settings.timeout,prerollTimeout:this.settings.prerollTimeout},i=Object.assign({},s,t.contribAdsSettings||{});this.playerWrapper=new de(e,i,this),this.sdkImpl=new ue(this)};pe.IMA_DEFAULTS={adLabel:"Advertisement",adLabelNofN:"of",debug:!1,disableAdControls:!1,showControlsForJSAds:!0},pe.prototype.initWithSettings=function(e){this.settings=Object.assign({},pe.IMA_DEFAULTS,e||{}),this.warnAboutDeprecatedSettings(),this.showCountdown=!0,!1===this.settings.showCountdown&&(this.showCountdown=!1)},pe.prototype.warnAboutDeprecatedSettings=function(){var e=this;[].forEach((function(t){void 0!==e.settings[t]&&console.warn("WARNING: videojs.imaDai setting "+t+" is deprecated")}))},pe.prototype.getSettings=function(){return this.settings},pe.prototype.getIsMobile=function(){return this.isMobile},pe.prototype.getIsIos=function(){return this.isIos},pe.prototype.getStreamPlayer=function(){return this.playerWrapper.getStreamPlayer()},pe.prototype.getVjsPlayer=function(){return this.playerWrapper.getVjsPlayer()},pe.prototype.requestStream=function(){this.sdkImpl.requestStream()},pe.prototype.setSetting=function(e,t){this.settings[e]=t},pe.prototype.onErrorLoadingAds=function(e){this.playerWrapper.onAdError(e)},pe.prototype.onAdError=function(e){this.playerWrapper.onAdError(e)},pe.prototype.onAdBreakStart=function(){this.inAdBreak=!0,this.playerWrapper.onAdBreakStart()},pe.prototype.onAdBreakEnd=function(){this.inAdBreak=!1,this.playerWrapper.onAdBreakEnd()},pe.prototype.onPlayerDisposed=function(){this.contentAndAdsEndedListeners=[],this.sdkImpl.onPlayerDisposed()},pe.prototype.isInAdBreak=function(){return this.inAdBreak},pe.prototype.onSeekEnd=function(e){this.sdkImpl.onSeekEnd(e)},pe.prototype.onPlayerReady=function(){this.sdkImpl.onPlayerReady()},pe.prototype.reset=function(){this.sdkImpl.reset(),this.playerWrapper.reset()},pe.prototype.addEventListener=function(e,t){this.sdkImpl.addEventListener(e,t)},pe.prototype.getStreamManager=function(){return this.sdkImpl.getStreamManager()},pe.prototype.getPlayerId=function(){return this.playerWrapper.getPlayerId()},pe.prototype.streamWillAutoplay=function(){return void 0!==this.settings.streamWillAutoplay?this.settings.streamWillAutoplay:!!this.playerWrapper.getPlayerOptions().autoplay},pe.prototype.triggerPlayerEvent=function(e,t){this.playerWrapper.triggerPlayerEvent(e,t)};var fe=function(e,t){this.controller=new ce(e,t),this.addContentAndAdsEndedListener=function(e){this.controller.addContentAndAdsEndedListener(e)}.bind(this),this.addContentEndedListener=function(e){this.controller.addContentEndedListener(e)}.bind(this),this.addEventListener=function(e,t){this.controller.addEventListener(e,t)}.bind(this),this.changeAdTag=function(e){this.controller.changeAdTag(e)}.bind(this),this.getAdsManager=function(){return this.controller.getAdsManager()}.bind(this),this.initializeAdDisplayContainer=function(){this.controller.initializeAdDisplayContainer()}.bind(this),this.pauseAd=function(){this.controller.pauseAd()}.bind(this),this.playAdBreak=function(){this.controller.playAdBreak()}.bind(this),this.requestAds=function(){this.controller.requestAds()}.bind(this),this.resumeAd=function(){this.controller.resumeAd()}.bind(this),this.setAdBreakReadyListener=function(e){this.controller.setAdBreakReadyListener(e)}.bind(this),this.setContentWithAdTag=function(e,t){this.controller.setContentWithAdTag(e,t)}.bind(this),this.setContentWithAdsResponse=function(e,t){this.controller.setContentWithAdsResponse(e,t)}.bind(this),this.setContentWithAdsRequest=function(e,t){this.controller.setContentWithAdsRequest(e,t)}.bind(this),this.setShowCountdown=function(e){this.controller.setShowCountdown(e)}.bind(this)},ge=function(e,t){this.controller=new pe(e,t),this.streamEndedListener=function(e){this.controller.addStreamEndedListener(e)}.bind(this),this.addEventListener=function(e,t){this.controller.addEventListener(e,t)}.bind(this),this.getStreamManager=function(){return this.controller.getStreamManager()}.bind(this)},me=ne((function e(t,s){ie(this,e),"hls"===(t=t.toLowerCase())||"dash"===t?"dash"!==t?"string"==typeof s?(this.streamFormat=t,this.assetKey=s):window.console.error("assetKey error: value must be string."):window.console.error("streamFormat error: DASH streams are notcurrently supported by this plugin."):window.console.error("VodStream error: incorrect streamFormat.")})),ye=ne((function e(t,s,i){ie(this,e),"hls"===(t=t.toLowerCase())||"dash"===t?"dash"!==t?"string"==typeof s?"string"==typeof i?(this.streamFormat=t,this.cmsId=s,this.videoId=i):window.console.error("videoId error: value must be string."):window.console.error("cmsId error: value must be string."):window.console.error("streamFormat error: DASH streams are notcurrently supported by this plugin."):window.console.error("VodStream error: incorrect streamFormat.")})),ve=r().registerPlugin||r().plugin;ve("ima",(function(e){this.ima=new fe(this,e)})),ve("imaDai",(function(e,t){if(e instanceof me)t.streamType="live",t.assetKey=e.assetKey;else{if(!(e instanceof ye))return void window.console.error("initDai() first parameter must be an instance of LiveStream or VodStream.");t.streamType="vod",t.cmsId=e.cmsId,t.videoId=e.videoId}t.streamFormat=e.streamFormat,this.imaDai=new ge(this,t)}))},9017:(e,t,s)=>{s.d(t,{F0:()=>a,Fg:()=>n,IT:()=>o,T$:()=>h,Vv:()=>c,Yx:()=>l,be:()=>r,q3:()=>d,sb:()=>i});const i="cld-ia-layout-state",r="vp-ia",n="interaction-areas-container",a={PORTRAIT:"portrait",LANDSCAPE:"landscape",All:"all",CENTER:"center"},o={PULSING:"pulsing",SHADOWED:"shadowed"},l={[a.PORTRAIT]:"https://res.cloudinary.com/prod/raw/upload/v1623772481/video-player/vtts/portrait.vtt",[a.LANDSCAPE]:"https://res.cloudinary.com/prod/raw/upload/v1623772303/video-player/vtts/landscape.vtt",[a.All]:"https://res.cloudinary.com/prod/raw/upload/v1623250266/video-player/vtts/all.vtt",[a.CENTER]:"https://res.cloudinary.com/prod/raw/upload/v1623250265/video-player/vtts/center.vtt"},h="https://res.cloudinary.com/prod/image/upload/v1626764643/video-player/interaction-area-hand.svg",c=4500,d=250},1066:(e,t,s)=>{s.d(t,{interactionAreasService:()=>C});var i=s(6673),r=s.n(i),n=s(2832),a=s.n(n),o=s(2858),l=s.n(o),h=s(5114),c=s.n(h),d=s(9017),u=s(7134),p=s(9454);const f=e=>{let{text:t,onClick:s,theme:i="",loadingDelay:r=0}=e;return(0,u.It)({tag:"button",attr:{class:`vp-theme-button theme-${i}`},onClick:s,children:[{tag:"div",attr:{class:"vp-loading-bar"},style:{"animation-duration":`${r}ms`}},{tag:"div",attr:{class:"content"},children:t}]})},g=(e,t)=>e.id||e.type||`id_${t}`,m=(e,t,s,i,r)=>{let{playerOptions:n,videojsOptions:o}=e;const l=(0,p.w)(o),h=n&&n.colors?n.colors.accent:l.accent,c=a()(o,"interactionDisplay.theme.template",d.IT.PULSING);return(0,u.It)({tag:"div",attr:{class:`${d.be}-item theme-${c}`,"data-id":g(t,s)},style:{left:`${t.left}%`,top:`${t.top}%`,width:`${t.width}%`,height:`${t.height}%`,transitionDuration:`${i}ms`},event:{name:"click",callback:r},children:[{tag:"div",attr:{class:`${d.be}-area-marker`},children:[{tag:"div",attr:{class:`${d.be}-marker-shadow`},style:{[c===d.IT.SHADOWED?"backgroundColor":"borderColor"]:h}},{tag:"div",attr:{class:`${d.be}-marker-main`},style:{borderColor:h}}]}]})},y=(e,t)=>e/(100/+t),v=(e,t)=>{const s=T(e);s?s.replaceWith(t):e.el().appendChild(t)},_=(e,t,s)=>e.querySelector(`[data-id=${g(t,s)}]`),b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c();localStorage.setItem(d.sb,JSON.parse(e)),t()},T=e=>e.el().querySelector(`.${d.Fg}`),A=e=>{const t=T(e);t&&t.parentNode.removeChild(t)};var E=s(8838),S=s(1104);const C=(e,t,s)=>{let i=!1,n=null,o=null,h=c();const p=()=>{const e=k();return!(!e||void 0===e.syncOffsetTime)&&e.syncOffsetTime};function C(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=k();return e||t&&t.enable}function w(){o&&e.videojs.removeRemoteTextTrack(o);const t=C(),s=k();if(!t||i)return null;if(Array.isArray(s.template))R(s.template),x();else{const t=s.vttUrl||d.Yx[s.template];t&&(o=(0,E.eo)(e.videojs,t),function(t){if(!t)return;let s=null;t.addEventListener("cuechange",(()=>{const i=t.activeCues&&t.activeCues[0];if(i){const e=Math.max(Math.floor(1e3*(i.endTime-i.startTime)),d.q3),t=JSON.parse(i.text);R(t,s,e),!s&&x(),s=t}else A(e.videojs),s=null}))}(o))}}function k(){const{cldSrc:e}=n;return e&&e.interactionAreas()}function L(){A(e.videojs),w(),e.play()}function I(){if(C())if(t=s.interactionDisplay,a()(t,"layout.enable",!0)&&"true"!==localStorage.getItem(d.sb)){let t=null;const i=a()(s,"interactionDisplay.layout.showAgain",!1);e.pause(),function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;const r=`checkbox_${Math.round(1e4*Math.random())}`,n=(0,u.It)({tag:"div",attr:{class:`${d.Fg} ${d.be}-layout-message ${s?"":"clickable"}`},onClick:s?null:()=>b(i,t),children:[{tag:"img",attr:{class:`${d.be}-layout-icon`,src:d.T$}},{tag:"h3",attr:{class:`${d.be}-layout-message-title`},children:"Tap on dots to zoom for a product."},f({text:"Got it",theme:"transparent-white",loadingDelay:s?0:d.Vv,onClick:s?()=>b(i,t):null}),s&&{tag:"div",attr:{class:`${d.be}-layout-message-do-not-show`},children:[{tag:"input",attr:{type:"checkbox",class:`${d.be}-layout-message-checkbox`,id:r},event:{name:"input",callback:e=>{i=e.target.checked}}},{tag:"label",attr:{class:`${d.be}-layout-message-checkbox-title`,for:r},children:"Don׳t show it again"}]}].filter((e=>e))});v(e,n)}(e.videojs,(()=>{clearTimeout(t),L()}),i),i||(t=setTimeout(L,d.Vv))}else L();var t}function P(t){let{event:s,item:a,index:o}=t;const l=k();l.onClick&&l.onClick({item:a,index:o,event:s,zoom:(t,s)=>{!function(t,s,a){const o=e.currentTime(),l=p(),{cldSrc:c}=n,f=c.getInitOptions(),g=s||{transformation:f.transformation},m=!t&&((e,t)=>{const{videoHeight:s,videoWidth:i}=e,r=y(i,t.left),n=y(s,t.top),a=y(i,t.width),o=y(s,t.height),l=i/s,h=a/o,c=Math.round(h>1||l>1?o*h:a),d=Math.round(c/l),u=Math.round(r-(c-a)/2),p=Math.round(n-(d-o)/2);return{width:c,height:d,x:Math.min(Math.max(u,0),i-c),y:Math.min(Math.max(p,0),s-d),crop:"crop"}})(e.videoElement,a),_=m?r().obj.merge({transformation:m},g):g,b=c.isRawUrl?n.src:{publicId:c.publicId()};e.source(m?{publicId:c.publicId()}:t,_).play(),l&&e.currentTime(o),i=!0,function(){const t=(0,u.n)("div",{class:"go-back-button"});t.addEventListener("click",(()=>{h()}),!1);const s=(0,u.n)("div",{class:d.Fg},t);v(e.videojs,s)}(),h=()=>{if(i){i=!1;const t=e.currentTime(),s=e.duration();e.source(b,f).play(),l&&t<s&&e.currentTime(t),w()}}}(t,s,a)}})}function R(i,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a={playerOptions:t,videojsOptions:s};if(r)((e,t,s,i,r,n)=>{const a=T(e);s.forEach(((e,s)=>{const o=_(a,e,s),l=g(e),h=i.some((e=>g(e)===l));h&&o?(0,u.cu)(o,{left:`${e.left}%`,top:`${e.top}%`,width:`${e.width}%`,height:`${e.height}%`,transitionDuration:`${r}ms`}):h||o||a.appendChild(m(t,e,s,r,(t=>{n({event:t,item:e,index:s})})))})),i.forEach(((e,t)=>{const i=_(a,e,t),r=g(e),n=!s.some((e=>g(e)===r));i&&n&&i.parentNode.removeChild(i)}))})(e.videojs,a,i,r,n,P);else{const t=i.map(((e,t)=>m(a,e,t,n,(s=>{P({event:s,item:e,index:t})}))));v(e.videojs,(0,u.n)("div",{class:d.Fg},t))}}function x(){C()&&((e,t)=>{const s=T(e);if(!s)return;const{videoHeight:i,videoWidth:r}=t,n=r/i,a=n*t.clientHeight;s.style.width=`${t.clientWidth<a?"100%":a}px`,s.style.height=t.clientWidth<a?t.clientWidth/n+"px":"100%"})(e.videojs,e.videoElement)}!function(){if(n=n||e.videojs.currentSource(),C()){e.videojs.el().classList.add("interaction-areas"),e.videojs.one(S.f.PLAY,(()=>{"object"==typeof e.videojs.ima?e.on("adsready",(()=>{e.videojs.ima.addEventListener(window.google.ima.AdEvent.Type.ALL_ADS_COMPLETED,I)})):I()}));const t=l()(x,100);e.videojs.on(S.f.FULL_SCREEN_CHANGE,(()=>{setTimeout(t,100)}));const s=(0,u.q2)(window,"resize",x,!1);e.videojs.on(S.f.DISPOSE,s)}e.videojs.on(S.f.ENDED,(()=>{h()})),e.videojs.on(S.f.ERROR,(()=>{e.pause()}))}()}},5826:(e,t,s)=>{s.d(t,{default:()=>q});var i=s(5871),r=s(1104),n=s(8033),a=s(3686),o=s.n(a),l=s(4679),h=s.n(l);const c=[1,4,5,6,7,10,11],d=["created_at","updated_at"],u=e=>{const t={};return h()(e)?(Object.keys(e).reduce(((t,s)=>{const i=o()(s);return-1!==d.indexOf(s)?t[i]=new Date(function(e){let t=0,s=0,i=0;if(s=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(e)){for(let e,t=0;e=c[t];++t)s[e]=+s[e]||0;s[2]=(+s[2]||1)-1,s[3]=+s[3]||1,"Z"!==s[8]&&void 0!==s[9]&&(i=60*s[10]+s[11],"+"===s[9]&&(i=0-i)),t=Date.UTC(s[1],s[2],s[3],s[4],s[5]+i,s[6],s[7])}else t=NaN;return t}(e[s])):t[i]=u(e[s]),t}),t),t):Array.isArray(e)?e.map((e=>u(e))):e};var p=s(5381),f=s(4466),g=s.n(f),m=s(6673),y=s.n(m);const v=y().dom||y(),_=y().getComponent("Component"),b=y().getComponent("ClickableComponent");class T extends b{static DISABLE_TRANSITION_CLASS="disable-transition";static VJS_UPCOMING_VIDEO_SHOW="vjs-upcoming-video-show";constructor(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];super(e,...s),this._setEvents(e)}_setEvents(e){e.on(r.f.UP_COMING_VIDEO_SHOW,this._show),e.on(r.f.UP_COMING_VIDEO_HIDE,this._hide),e.on(r.f.PLAYLIST_ITEM_CHANGED,this._onPlaylistItemChange)}_hide=()=>{this.removeClass(T.VJS_UPCOMING_VIDEO_SHOW)};_disableTransition(e){this.addClass(T.DISABLE_TRANSITION_CLASS),e(),this.removeClass(T.DISABLE_TRANSITION_CLASS)}_onPlaylistItemChange=(e,t)=>{this._hide(),this._disableTransition((()=>{t.next&&this.setItem(t.next)}))};_show=()=>{const e=this.player().ima,t="object"===e&&e.getAdsManager();t&&t.getCurrentAd()&&!t.getCurrentAd().isLinear()||this.addClass(T.VJS_UPCOMING_VIDEO_SHOW)};setTitle(e){this.getChild("upcomingVideoOverlayContent").getChild("upcomingVideoOverlayBar").getChild("upcomingVideoOverlayTitle").setContent(e.info().title||e.publicId())}setItem(e){this._source=e;const t=parseInt(window.getComputedStyle(this.el(),null).getPropertyValue("max-width"),10),s={crop:"pad",background:"auto:predominant",width:t,height:Math.round(t*(9/16))},i=this.getChild("upcomingVideoOverlayContent");this.setTitle(e),i.el().style.backgroundImage=`url("${this._source.poster().url({transformation:s})}")`}handleClick(){super.handleClick(event),this.player().cloudinary.playlist().playNext()}createEl(){return super.createEl("div",{className:"vjs-upcoming-video"})}}class A extends _{createEl(){return super.createEl("div",{className:"upcoming-video-overlay aspect-ratio-content"})}}class E extends _{createEl(){return super.createEl("div",{className:"vjs-upcoming-video-bar"})}}T.prototype.options_={children:["upcomingVideoOverlayContent"]},y().registerComponent("upcomingVideoOverlay",T),A.prototype.options_={children:["upcomingVideoOverlayBar"]},y().registerComponent("upcomingVideoOverlayContent",A),E.prototype.options_={children:["upcomingVideoOverlayTitle","playlistNextButton"]},y().registerComponent("upcomingVideoOverlayBar",E),y().registerComponent("upcomingVideoOverlayTitle",class extends _{setContent(e){this._contentSpan.innerText=e}createEl(){const e=super.createEl("div",{className:"vjs-control vjs-upcoming-video-title"}),t=v.createEl("div",{className:"vjs-upcoming-video-title-display",innerHTML:'<span class="vjs-control-text">Next up</span>Next up: '});return this._contentSpan=v.createEl("span",{className:"vjs-upcoming-video-title-display-label"}),t.appendChild(this._contentSpan),e.appendChild(t),e}});const S=y().getComponent("ClickableComponent"),C=class extends S{constructor(e,t){super(e,t);const s=t.type;if(!s&&"previous"!==s&&"next"!==s)throw new Error("Type must be either 'previous' or 'next'")}createEl(){const e=this.options_.type,t=`vjs-icon-${e}-item`;return y().dom.createEl("button",{className:`vjs-control vjs-playlist-button vjs-button ${t}`,ariaLabel:`Playlist ${e} item`})}};y().registerComponent("PlaylistNextButton",class extends C{constructor(e){super(e,{type:"next"})}handleClick(e){e.stopPropagation(),super.handleClick(e),this.player().cloudinary.playlist().playNext()}});y().registerComponent("PlaylistPreviousButton",class extends C{constructor(e){super(e,{type:"previous"})}handleClick(e){super.handleClick(e),this.player().cloudinary.playlist().playPrevious()}});const w={fluid:!1,show:!0,direction:"vertical",total:4,selector:!1,renderTo:[]},k=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],{repeat:s=!1,autoAdvance:i=!1,presentUpcoming:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._context=e,this._sources=[],this._defaultRecResolverCache={},this._currentIndex=null,this._recommendationsHandler=null,this._autoAdvance=null,this._presentUpcoming=null,this.addUiComponents(),this.resetState=()=>{this.repeat(s),this.autoAdvance(i),this.presentUpcoming(r)},t.forEach((e=>this.enqueue(e))),this.resetState()}list(){return this._sources}player(){return this._context.player}addUiComponents(){const e=this.player().getChild("ControlBar"),t=e.children();e.addChild("playlistPreviousButton",{},t.findIndex((e=>"PlayToggle"===e.name_))),e.addChild("playlistNextButton",{},t.findIndex((e=>"PlayToggle"===e.name_))+1),this.player().addChild("upcomingVideoOverlay")}presentUpcoming(e){if(this._presentUpcoming=this._presentUpcoming||{},void 0===e)return this._presentUpcoming.delay;if(!0===e)e=10;else if(!1===e)e=!1;else if(!g()(e)||e<0)throw new Error("presentUpcoming 'delay' must be either a boolean or a positive integer.");return this._presentUpcoming.delay=e,this._setupPresentUpcoming(),this._presentUpcoming.delay}autoAdvance(e){if(this._autoAdvance=this._autoAdvance||{},void 0===e)return this._autoAdvance.delay;if(!0===e)e=0;else if(!1===e)e=!1;else if(!g()(e)||e<0)throw new Error("Auto advance 'delay' must be either a boolean or a positive integer.");return this._autoAdvance.delay=e,this._setupAutoAdvance(),this._autoAdvance.delay}_setupAutoAdvance(){this._resetAutoAdvance();const e=this._autoAdvance.delay;!1!==e&&(this._autoAdvance={delay:e,trigger:()=>{this.player().ended()&&(this._autoAdvance.timeout=setTimeout((()=>{this.playNext()}),1e3*e))}},this._context.on("ended",this._autoAdvance.trigger))}dispose(){this._resetAutoAdvance(),this._resetPresentUpcoming(),this._resetRecommendations()}_resetPresentUpcoming(){this.player().trigger("upcomingvideohide"),this._presentUpcoming||(this._presentUpcoming={}),this._presentUpcoming.trigger&&this._context.off("timeupdate",this._presentUpcoming.trigger),this._presentUpcoming.trigger=null,this._presentUpcoming.showTriggered=!1}_setupPresentUpcoming(){this._resetPresentUpcoming(),!1!==this._presentUpcoming.delay&&(this._presentUpcoming.trigger=()=>{const e=this.player().currentTime(),t=this.player().duration()-e;t<1.5?this._presentUpcoming.showTriggered&&(this.player().trigger("upcomingvideohide"),this._presentUpcoming.showTriggered=!1):t<=this._presentUpcoming.delay&&!this._presentUpcoming.showTriggered&&!this.player().loop()?(this.player().trigger("upcomingvideoshow"),this._presentUpcoming.showTriggered=!0):this._presentUpcoming.showTriggered&&(t>this._presentUpcoming.delay||this.player().loop())&&(this.player().trigger("upcomingvideohide"),this._presentUpcoming.showTriggered=!1)},this._context.on("timeupdate",this._presentUpcoming.trigger))}_resetAutoAdvance(){this._autoAdvance||(this._autoAdvance={}),this._autoAdvance.timeout&&clearTimeout(this._autoAdvance.timeout),this._autoAdvance.trigger&&this._context.off("ended",this._autoAdvance.trigger),this._autoAdvance.timeout=null,this._autoAdvance.trigger=null}_resetRecommendations(){this._recommendationsHandler&&this._context.off("ended",this._recommendationsHandler)}_refreshRecommendations(){this._resetRecommendations(),this._recommendationsHandler=()=>{!1===this.autoAdvance()&&this._context.autoShowRecommendations()&&this.player().trigger("recommendationsshow")},this._context.on("ended",this._recommendationsHandler)}_refreshTextTracks(){this.player().trigger("refreshTextTracks",this.currentSource().textTracks())}_recommendationItemBuilder(e){const t=this._defaultRecResolverCache[e.objectId];if(!e.recommendations()||t&&e.recommendations()===t)return e=>({source:e,action:()=>this.playItem(e)})}currentIndex(e){if(void 0===e)return this._currentIndex;if(e>=this.length()||e<0)throw new Error("Invalid playlist index.");this._currentIndex=e;const t=this.currentSource(),s=this._recommendationItemBuilder(t);t.recommendations()||t.recommendations(this._defaultRecommendationsResolver(t));const i=t.getInitOptions?t.getInitOptions():{};this._context.source(t,{...i,recommendationOptions:{disableAutoShow:!0,itemBuilder:s}});const r={playlist:this,current:t,next:this.next()};return this.player().trigger("playlistitemchanged",r),this._refreshRecommendations(),this._refreshTextTracks(),t}_defaultRecommendationsResolver(e){return this._defaultRecResolverCache[e.objectId]||(this._defaultRecResolverCache[e.objectId]=()=>{let t=this.list().indexOf(e);const s=[],i=Math.min(4,this.length()-1);for(;s.length<i&&(t=this.nextIndex(t),-1!==t);){const e=this.list()[t];s.push(e)}return s},this._defaultRecResolverCache[e.objectId])}buildSource(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._context.buildSource(e,t)}enqueue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=e instanceof p.A?e:this.buildSource(e,t);return this._sources.push(s),s}playItem(e){let t=this.list().indexOf(e);if(-1===t)throw new Error("Invalid playlist item.");this.playAtIndex(t)}playAtIndex(e){return this.currentIndex(e),this.player().play(),this.currentSource()}currentSource(){return this.list()[this.currentIndex()]}removeAt(e){if(e>=this.length()||e<0)throw new Error("Invalid playlist index.");return this._sources.splice(e,1),this}repeat(e){return void 0===e||(this._repeat=!!e),this._repeat}first(){return this.list()[0]}last(){return this.list()[this.length()-1]}next(){const e=this.nextIndex();return-1===e?null:this.list()[e]}nextIndex(e){if((e=void 0!==e?e:this.currentIndex())>=this.length()||e<0)throw new Error("Invalid playlist index.");let t=e+1;if(e===this.length()-1){if(!this.repeat())return-1;t=0}return t}previousIndex(){return this.isFirst()?-1:this.currentIndex()-1}playFirst(){return this.playAtIndex(0)}playLast(){const e=this.list().length-1;return this.playAtIndex(e)}isLast(){return this.currentIndex()>=this.length()-1}isFirst(){return 0===this.currentIndex()}length(){return this.list().length}playNext(){let e=this.nextIndex();return-1===e?null:this.playAtIndex(e)}playPrevious(){let e=this.previousIndex();return-1===e?null:this.playAtIndex(e)}playlistByTag=(()=>{var e=this;return function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.player().sourcesByTag(t,s).then((t=>e.player().playlist(t,s)))}})()},L=(e,t)=>(e.parentNode.insertBefore(t,e),t.appendChild(e),t);var I=s(3066);const P=y().dom||y(),R=y().getComponent("Component"),x={wrap:!1};class D extends R{constructor(e,t){const s={...x,...t};super(e,s),this.player_=e;const i=(e,t)=>{this.options_.fluid=t,this.removeCls(),this.setCls()};s.wrap&&(()=>{const e=this.el();this.videoWrap_=P.createEl("div",{className:"cld-plw-col-player"}),this.contentEl_=this.contentEl_=P.createEl("div",{className:"cld-plw-col-list"}),L(this.player().el(),e),e.appendChild(this.videoWrap_),e.appendChild(this.contentEl_),L(this.player().el(),this.videoWrap_)})(),e.on(r.f.FLUID,i),this.addChild(r.f.PLAYLIST_PANEL,this.options_),this.setCls(),this.dispose=()=>{this.removeLayout(),super.dispose(),e.off(r.f.FLUID,i)}}getCls(){let e=["cld-video-player","cld-plw-layout"];return e.push((0,I.skinClassPrefix)(this.player())),e.push((0,I.playerClassPrefix)(this.player())),this.options_.fluid&&e.push("cld-plw-layout-fluid"),e}setCls(){this.removeClass((0,I.skinClassPrefix)(this.player())),this.getCls().forEach((e=>{this.addClass(e)}))}removeCls(){this.getCls().forEach((e=>{this.removeClass(e)}))}update(e,t){this.options(t),this.removeChild("PlaylistPanel"),this.addChild("PlaylistPanel",this.options_),this.trigger("playlistlayoutupdate")}removeLayout(){const e=this.el().parentElement;e&&e.appendChild(this.player().el())}createEl(){const e=super.createEl("div");return e.style.fontFamily=this.player().el().style.fontFamily,e}}y().registerComponent("playlistLayout",D);const O=D,M=class extends O{constructor(e,t){t.wrap=!0,super(e,t)}getCls(){const e=super.getCls();return e.push("cld-plw-horizontal"),e}},N=class extends O{constructor(e,t){t.wrap=!0,super(e,t)}getCls(){const e=super.getCls();return e.push("cld-plw-vertical"),e}},F=class extends O{getCls(){let e=super.getCls();return e.push("cld-plw-custom"),e}createEl(){const e=super.createEl();return this.options_.renderTo.appendChild(e),e}},B=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=((e,t)=>{const s={...w,...t};if(s.show&&"string"==typeof s.selector&&(s.useDefaultLayout=!1,s.useCustomLayout=!0,s.renderTo=document.querySelector(s.selector),s.showAll=!0,0===!s.renderTo.length))throw new Error(`Couldn't find element(s) by selector '${s.selector}' for playlist`);return s.show&&!s.selector&&(s.useDefaultLayout=!0,s.useCustomLayout=!1),s.direction="horizontal"===s.direction.toLowerCase()?"horizontal":"vertical",s.skin=e.options_.skin,s})(e,t),this.options_=t,this.player_=e,this.render();const s=(e,t)=>{this.options_.fluid=t};e.on(r.f.FLUID,s),this.options=t=>t?(this.options_=y().obj.merge(this.options_,t),e.trigger("playlistwidgetoption",this.options_.playlistWidget),this.options_):this.options_,this.dispose=()=>{this.layout_.dispose(),e.off(r.f.FLUID,s)}}render(){this.options_.useDefaultLayout&&("horizontal"===this.options_.direction?this.layout_=new M(this.player_,this.options_):this.layout_=new N(this.player_,this.options_)),this.options_.useCustomLayout&&(this.layout_=new F(this.player_,this.options_))}getLayout(){return this.layout_}update(e,t){this.options(t),"direction"===e?(this.layout_.removeLayout(),this.layout_.dispose(),this.render()):this.layout_.update(e,this.options_)}setSkin(){this.layout_.setCls()}total(){const e=parseInt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.total,10);return e!==this.options_.total&&"number"==typeof e&&e>0&&this.update("total",{total:e}),this}direction(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.direction;return"horizontal"!==e&&"vertical"!==e||this.update("direction",{direction:e}),this}},j=y().getComponent("ClickableComponent"),U={item:null,transformation:{width:300,aspect_ratio:"16:9",crop:"pad",background:"black"}},$=class extends j{constructor(e,t){super(e,y().obj.merge(U,t))}getItem(){return this.options_.item}getTitle(){return this.getItem().info().title}getDuration(){return" "}getThumbnail(){return this.getItem().poster().url({transformation:this.options_.transformation})}handleClick(e){e.preventDefault()}createControlTextEl(){}createEl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"a";const t=super.createEl(e,{className:"cld-thumbnail",href:"#"}),s=super.createEl("img",{className:"cld-thumbnail-img",src:this.getThumbnail()});return t.appendChild(s),t.style.backgroundImage=`url('${this.getThumbnail()}')`,t}},H=y().dom||y(),V={source:null,next:!1};class G extends ${constructor(e,t){super(e,y().obj.merge(V,t))}handleClick(e){super.handleClick(e),this.play()}play(){const e=this.getItem(),t=this.player().cloudinary.playlist().list().indexOf(e);if(-1===t)throw new Error("Invalid playlist item...");this.player().cloudinary.playlist().playAtIndex(t)}isCurrent(){return this.options_.current}getTitle(){return super.getTitle()}getDuration(){return super.getDuration()}createEl(){const e=super.createEl();e.classList.add("cld-plw-panel-item");const t=H.createEl("div",{className:"cld-plw-item-info-wrap"}),s=H.createEl("div",{className:"cld-plw-item-title"});if(this.isCurrent()){e.classList.add("cld-plw-panel-item-active");const t=H.createEl("span",{className:"cld-plw-item-title-curr"},{},"Now Playing: ");s.appendChild(t)}const i=H.createEl("span",{className:"cld-plw-item-title"},{},this.getTitle());s.appendChild(i);const r=H.createEl("div",{className:"cld-plw-item-duration"},{},this.getDuration());return t.appendChild(s),t.appendChild(r),e&&e.appendChild(t),e.appendChild(t),e}}y().registerComponent("playlistPanelItem",G);const W=G,z=y().getComponent("Component");y().registerComponent("playlistPanel",class extends z{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});const t=()=>{this.render()};e.on(r.f.PLAYLIST_ITEM_CHANGED,t),this.render(),this.dispose=()=>{super.dispose(),e.off(r.f.PLAYLIST_ITEM_CHANGED,t)}}createEl(){const e=super.createEl();return e.classList.add("cld-plw-panel"),e}removeAll(){const e=this.children();for(let t=e.length-1;t>=0;--t)this.removeChild(e[t])}getItems(){const e=this.player().cloudinary.playlist(),t=e._repeat;if(this.options_.showAll)return e.list();const s=[],i=this.options_.total;let r=e.currentIndex(),n=e.list()[r];for(s.push(n);s.length<i;){if(r=e.nextIndex(r),-1===r){if(!t&&s.length>0)break;r=0}n=e.list()[r],s.push(n)}return s}render(){const e=this.getItems();this.removeAll(),e.forEach(((e,t)=>{const s=new W(this.player(),y().obj.merge(this.options_,{item:e,next:1===t,current:0===t}));this.addChild(s)}))}});const K={format:"json",resource_type:"video",type:"list"},q=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=(0,i.sliceProperties)(t,"chainTarget").chainTarget;let a=null,o=null,l=null;const h=()=>{e.on(r.f.PLAYLIST_CREATED,(()=>{l&&l.dispose(),0!=t.playlistWidget?.show&&(e.fluid_&&(t.playlistWidget.fluid=!0),e.cloudinary.fontFace&&(t.playlistWidget.fontFace=e.cloudinary.fontFace),l=new B(e,t.playlistWidget))}))};return e.cloudinary.sourcesByTag=async function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=(0,n.KA)(t,Object.assign({},e.cloudinary.cloudinaryConfig(),K)),r=await fetch(i),a=await r.json(),o=u(a.resources);return s.sorter&&o.sort(s.sorter),o.map((t=>{let i=s.sourceParams||{};"function"==typeof i&&(i=i(t));const r=t.context&&t.context.custom||{},n=Object.assign({info:r},i,{publicId:t.publicId});return e.cloudinary.buildSource(n)}))},function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return void 0===t?a:(a&&(e.removeClass("vjs-playlist"),a=void 0,e.playlist().dispose(),e.off("cldsourcechanged",o)),((t,s)=>{t instanceof k?(a=t,a.resetState(),a.currentIndex(a.currentIndex())):(a=new k(e.cloudinary,t,s),a.currentIndex(0)),h(),o=(()=>{const t=()=>{a&&!a.currentSource().contains(e.currentSource())&&e.disposePlaylist()};return e.on("cldsourcechanged",t),t})(),e.addClass("vjs-playlist")})(t,i),e.trigger("playlistcreated"),s)}}},2130:(e,t,s)=>{s.d(t,{default:()=>h});var i=s(6673),r=s.n(i);const n=r().getComponent("ClickableComponent");r().registerComponent("ShareDownloadButton",class extends n{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}handleClick(e){super.handleClick(e),this.player().share&&"function"==typeof this.player().share.download&&this.player().share.download()}createEl(){const e=r().dom.createEl("button",{className:"vjs-control vjs-share-download-button vjs-button",ariaLabel:"Download video",title:"Download video"}),t=r().dom.createEl("span",{className:"vjs-icon-file-download vjs-icon-placeholder"});e.appendChild(t);const s=r().dom.createEl("span",{className:"vjs-loading-spinner"});return e.appendChild(s),e}setPreparing(e){const t=this.el();e?(t.classList.add("vjs-waiting"),t.setAttribute("title","Download is being prepared")):(t.classList.remove("vjs-waiting"),t.setAttribute("title","Download video"))}});var a=s(8033),o=s(4319),l=s.n(o);const h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(arguments.length>1?arguments[1]:void 0)||this;t.addClass("vjs-share");const s=()=>{const e=t.getChild("ControlBar");if(!e||e.getChild("ShareDownloadButton"))return;const s=e.children().findIndex((e=>"FullscreenToggle"===e.name_));e.addChild("ShareDownloadButton",{},-1!==s?s:void 0)};e.download&&s(),t.share={download:()=>{const e=(()=>{const e=t.currentSource?.();if(!e)return null;const s=["format","video_codec","streaming_profile"],i=e=>{if(Array.isArray(e))return e.map(i);if(e&&"object"==typeof e){const t=l()(e,s);return Object.keys(t).forEach((e=>{t[e]=i(t[e])})),t}return e},r=i(t.cloudinary.transformation()||{}),n=t.cloudinary.currentPublicId()?.split("/")?.pop(),o={...t.cloudinary.cloudinaryConfig(),...r,resource_type:"video",format:"mp4",video_codec:"h264",flags:`streaming_attachment:${n}`};return e.isAdaptive&&Object.assign(o,{crop:"limit",width:1920,height:1920}),"AudioSource"===t.cloudinary.source()?.getType()&&Object.assign(o,{format:"mp3",video_codec:void 0}),(0,a.KA)(t.cloudinary.currentPublicId(),o)})();if(!e)return void console.warn("Share plugin: Unable to resolve download URL.");const s=[423],i=t.controlBar?.getChild("ShareDownloadButton"),r=e=>{i?.setPreparing?.(e)},n=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const i=await fetch(e,{method:"HEAD"});if(s.includes(i.status)&&t<60)return await(1e4,new Promise((e=>setTimeout(e,1e4)))),n(t+1);r(!1),(()=>{const t=document.createElement("a");t.href=e,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)})()};r(!0),n()},addDownloadButton:s,removeDownloadButton:()=>{if(!t.controlBar)return;const e=t.controlBar.getChild("ShareDownloadButton");e&&t.controlBar.removeChild(e)}}}},9148:(e,t,s)=>{s.d(t,{default:()=>n});var i=s(6673),r=s.n(i);const n=(e,t)=>{t.addClass("vjs-visual-search");let s=!1;const i=(e=>{const t=()=>{e.$$(".vjs-visual-search-marker").forEach((e=>e.remove())),e.$$(".vjs-visual-search-results-wrapper").forEach((e=>e.remove())),e.removeClass("vjs-visual-search-results-active")};return{displayResults:s=>{t();const i=e.duration(),n=e.controlBar.progressControl.seekBar,a=r().dom.createEl("div",{className:"vjs-visual-search-results-wrapper",role:"presentation"});s.forEach((t=>{const{start_time:s,end_time:n}=t,o=s/i*100,l=(n-s)/i*100,h=`${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,"0")}`,c=r().dom.createEl("div",{className:"vjs-control vjs-visual-search-marker",style:`left: ${o}%; width: ${l}%`,tabIndex:0,role:"button",title:`Search result at ${h}`,ariaLabel:`Search result at ${h}`});a.appendChild(c),c.addEventListener("click",(()=>{e.currentTime(s)})),c.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.currentTime(s))}))})),n.el().appendChild(a),s.length>0&&e.addClass("vjs-visual-search-results-active")},clearMarkers:t}})(t),n=async e=>{const s=t.$(".vjs-visual-search-button");s.classList.add("vjs-waiting");try{const s=t.cloudinary.source(),r=s.publicId(),n=Object.assign({},s.transformation());n.flags=n.flags||[],n.flags.push(`getinfo:search_b64_${btoa(e)}`);const a=s.config().url(`${r}`,{transformation:n}),o=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Search request failed with status: ${o.status}`);const l=await o.json();i.displayResults(l.timestamps),l&&!t.hasStarted()&&t.play().then((()=>t.pause()))}catch(e){console.error("Error performing visual search:",e)}finally{s.classList.remove("vjs-waiting")}},a=()=>{s=!1,i.clearMarkers(),t.$(".vjs-visual-search-wrapper")?.remove()},o=()=>{a();const e=t.$(".vjs-title-bar");e&&e.classList.remove("vjs-hidden");const o=r().dom.createEl("div",{className:"vjs-visual-search-wrapper"}),l=()=>{s&&(s=!1,o.classList.remove("vjs-visual-search-active"),c.input.value="",c.input.tabIndex=-1,c.closeButton.tabIndex=-1,i.clearMarkers())},h=(e=>{const t=r().dom.createEl("button",{className:"vjs-control vjs-button vjs-visual-search-button",title:"Search video content",ariaLabel:"Search video content"}),i=r().dom.createEl("span",{className:"vjs-icon-search"});t.appendChild(i);const a=r().dom.createEl("span",{className:"vjs-loading-spinner"});return t.appendChild(a),t.addEventListener("click",(()=>{if(s){const e=c.input.value.trim();e&&n(e)}else s=!0,o.classList.add("vjs-visual-search-active"),c.input.tabIndex=0,c.closeButton.tabIndex=0,c.input.focus()})),t})(),c=((e,t)=>{const s=r().dom.createEl("form",{className:"vjs-visual-search-form"}),i=r().dom.createEl("input",{className:"vjs-visual-search-input",type:"text",ariaLabel:"Search input",tabIndex:-1}),n=r().dom.createEl("button",{className:"vjs-control vjs-button vjs-visual-search-close",type:"button",title:"Close search",ariaLabel:"Close search",tabIndex:-1}),a=r().dom.createEl("span",{className:"vjs-icon-close"});return n.appendChild(a),s.appendChild(i),s.appendChild(n),s.addEventListener("submit",(t=>{t.preventDefault();const s=i.value.trim();s&&e(s)})),n.addEventListener("click",(e=>{e.preventDefault(),t&&t()})),{element:s,input:i,closeButton:n}})(n,l);o.appendChild(h),o.appendChild(c.element),e.prepend(o),t.on("keydown",(e=>{"Escape"===e.key&&s&&l()}))};o(),t.visualSearch={createSearchUI:o,clearUI:a}}},5004:(e,t,s)=>{s.r(t),s.d(t,{GET_ERROR_DEFAULT_REQUEST:()=>n,handleCldError:()=>o,isKeyInTransformation:()=>l});var i=s(8033),r=s(9339);const n={method:"head"},a={method:"get",credentials:"include",headers:{"Content-Range":"bytes=0-0"}},o=(e,t)=>{const s=e.videojs.cloudinary.getCurrentSources(),r=t.fetchErrorUsingGet?a:n;r.credentials=t.sourceOptions.withCredentials?"include":"omit",s.length>0?Promise.all(s.map((e=>fetch(e.src,r)))).then((t=>{const r=(e=>e.reduce(((e,t)=>{if(t.status>=200&&t.status<399&&""!==t.url){const s=new URL(t.url);e.push(s.host+s.pathname)}return e}),[]))(t),n=t[0];if(r.length){const n=((e,t)=>e.filter((e=>{const s=new URL(e.src);return-1!==t.indexOf(s.host+s.pathname)&&!0!==e.try})))(s,r);n&&n.length?((e,t)=>{e.options.playerOptions.debug&&console.log("Trying sources: ",t),t.forEach((e=>{e.try=!0})),e.videojs.autoplay(e.videojs.autoplay()||e.playWasCalled),e.videojs.src(t)})(e,n):e.videojs.error({code:i.bo.NO_SUPPORTED_MEDIA,message:"No supported media sources",statusCode:t.status})}else((e,t)=>{e.videojs.error((0,i.ww)({errorMsg:t.headers.get("x-cld-error")||"",publicId:e.currentPublicId(),cloudName:e.cloudinaryConfig().cloud_name,error:t,statusCode:t.status}))})(e,n)})).catch((t=>{e.videojs.error({code:7,message:t&&t.message?t.message:"Failed to test sources"})})):e.videojs.error({code:i.bo.NO_SUPPORTED_MEDIA,message:"No supported media sources"})},l=(e,t)=>!!(e&&t&&(Array.isArray(e)?(0,r.I)(e,(e=>l(e,t))):e.getValue?e.getValue(t):e[t]))},1104:(e,t,s)=>{s.d(t,{f:()=>i,x:()=>r});const i={READY:"ready",PLAY:"play",PLAYING:"playing",PAUSE:"pause",SEEK:"seek",SEEKING:"seeking",MUTE:"mute",UNMUTE:"unmute",PAUSE_NO_SEEK:"pausenoseek",ERROR:"error",TIME_UPDATE:"timeupdate",EMPTIED:"emptied",RETRY_PLAYLIST:"retryplaylist",CAN_PLAY_THROUGH:"canplaythrough",CLD_SOURCE_CHANGED:"cldsourcechanged",SOURCE_CHANGED:"sourcechanged",LOADED_METADATA:"loadedmetadata",LOADED_DATA:"loadeddata",REFRESH_TEXT_TRACKS:"refreshTextTracks",PLAYLIST_CREATED:"playlistcreated",UP_COMING_VIDEO_SHOW:"upcomingvideoshow",UP_COMING_VIDEO_HIDE:"upcomingvideohide",PLAYLIST_ITEM_CHANGED:"playlistitemchanged",VOLUME_CHANGE:"volumechange",FLUID:"fluid",PLAYLIST_PANEL:"PlaylistPanel",ENDED:"ended",RESIZE:"resize",START:"start",VIDEO_LOAD:"videoload",PRODUCT_BAR_MIN:"productBarMin",SHOW_PRODUCTS_OVERLAY:"showProductsOverlay",SHOPPABLE_ITEM_CHANGED:"shoppableitemchanged",FULL_SCREEN_CHANGE:"fullscreenchange",PERCENTS_PLAYED:"percentsplayed",TIME_PLAYED:"timeplayed",PLAYER_LOAD:"playerload",DISPOSE:"dispose",QUALITY_CHANGED:"qualitychanged"},r={AUDIO:"AudioSource",VIDEO:"VideoSource"}},3066:(e,t,s)=>{s.r(t),s.d(t,{CLASS_PREFIX:()=>n,playerClassPrefix:()=>o,setSkinClassPrefix:()=>c,skinClass:()=>l,skinClassPrefix:()=>h});var i=s(7668),r=s(9339);const n="cld-video-player",a=`${n}-skin-`,o=e=>`${n}-${e.id_}`,l=e=>`${a}${e}`,h=e=>(0,r.I)(e.el().classList,(e=>e.startsWith(a))),c=(e,t)=>{const s=h(e),r=!!t&&t.replace(a,"");let n="";n=r?l(r):e.options_.skin?l(e.options_.skin):l(i.A.skin),n!==s&&(s&&e.removeClass(s),e.addClass(n)),r&&e.options_.skin!==r&&(e.options_.skin=r)}},7134:(e,t,s)=>{s.d(t,{It:()=>c,cu:()=>h,n:()=>o,q2:()=>d});var i=s(2160),r=s.n(i),n=s(9040),a=s.n(n);const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const i=document.createElement(e);for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.setAttribute(e,t[e]);return r()(s).forEach((e=>l(e,i))),i},l=(e,t)=>{if(a()(e))t.appendChild(e);else if(e&&"object"!=typeof e){const s=document.createTextNode(e);t.appendChild(s)}},h=(e,t)=>{for(let s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e.style[s]=t[s]);return e},c=e=>{const t=Array.isArray(e.children)?e.children.map(c):e.children,s=a()(e)?e:o(e.tag,e.attr,t);return e.onClick&&(e.event={name:"click",callback:e.onClick}),e.event&&s.addEventListener(e.event.name,e.event.callback,!1),e.style&&h(s,e.style),s},d=(e,t,s)=>(e.addEventListener(t,s,!1),()=>{e.removeEventListener(t,s,!1)})},9339:(e,t,s)=>{function i(e,t){return Array.prototype.find&&Array.isArray(e)?e.find(t):function(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(t(i,s,e))return[i,s]}return[void 0,-1]}(e,t)[0]}s.d(t,{I:()=>i})},7588:(e,t,s)=>{s.r(t),s.d(t,{fontFace:()=>n});var i=s(5303),r=s.n(i);const n=(e,t)=>{void 0===t&&(t="Inter"),t&&"inherit"!==t?(r().load({google:{families:[t]}}),e.style.fontFamily=t):"inherit"===t&&(e.style.fontFamily="inherit")}},5104:(e,t,s)=>{s.d(t,{A:()=>y});var i={};s.r(i),s.d(i,{mixin:()=>l});var r={};s.r(r),s.d(r,{normalizeAttributes:()=>m});var n=s(5871),a=s(3171),o=s(5004);function l(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.reduce(((e,t)=>t(e)),class{})}var h=s(7588),c=s(3066),d=s(3686),u=s.n(d);const p=/^(data-cld-)(\w+)/,f={},g=e=>function(e){let t=null;if(""===e)return!0;try{t=JSON.parse(e)}catch(e){}return t||(t=Number(e),t||e)}(e),m=e=>{const t={};if(e&&e.attributes&&e.attributes.length>0){const s=e.attributes;for(let i=s.length-1;i>=0;i--){let r=s[i].name,n=s[i].value;r.match(p)&&(r=u()(r.replace(p,"$2"))),n="boolean"==typeof e[r]?null!==n:(f[r]||g)(n),t[r]=n}}return t},y=Object.assign({},n,a,o,h,i,c,r)},3171:(e,t,s)=>{function i(e){const t=e.getBoundingClientRect(),s=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||s.scrollTop,n=window.pageXOffset||i.scrollLeft||s.scrollLeft,a=i.clientTop||s.clientTop||0,o=i.clientLeft||s.clientLeft||0,l=t.top+r-a,h=t.left+n-o;return{top:Math.round(l),left:Math.round(h)}}function r(e,t){const s={},r=i(e),n=e.offsetWidth,a=e.offsetHeight,o=r.top,l=r.left;let h=t.pageY,c=t.pageX;return t.changedTouches&&(c=t.changedTouches[0].pageX,h=t.changedTouches[0].pageY),s.y=Math.max(0,Math.min(1,(o-h+a)/a)),s.x=Math.max(0,Math.min(1,(c-l)/n)),s}function n(e,t){let{fraction:s}=t;const r=i(e),n=r.left,a=r.top,o=e.offsetHeight,l=e.offsetWidth,h=n+l,c=a+o;return Math.max(0,Math.min(l,window.pageXOffset+window.innerWidth-n,h-window.pageXOffset))*Math.max(0,Math.min(l,window.pageYOffset+window.innerHeight-a,c-window.pageYOffset))/(l*o)>s}function a(e,t,s){e.style.left=`${t}px`,e.style.top=`${s}px`}s.r(t),s.d(t,{getPointerPosition:()=>r,isElementInViewport:()=>n,setPosition:()=>a})},7311:(e,t,s)=>{s.d(t,{y:()=>i});const i=e=>{const t=Object.keys(e);return t.length?`?${t.map((t=>`${t}=${e[t]}`)).join("&")}`:""}},5871:(e,t,s)=>{function i(e,t){for(var s=arguments.length,i=new Array(s>2?s-2:0),r=2;r<s;r++)i[r-2]=arguments[r];return i.reduce(((s,i)=>(Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i],t&&delete e[i]),s)),{})}function r(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return i(e,!1,...s)}function n(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return i(e,!0,...s)}s.r(t),s.d(t,{sliceAndUnsetProperties:()=>n,sliceProperties:()=>r})},2415:(e,t,s)=>{function i(e){const t=(new TextEncoder).encode(e),s=String.fromCharCode(...t);return btoa(s)}s.d(t,{G:()=>i})},5779:(e,t,s)=>{s.d(t,{I6:()=>c,Is:()=>d,O6:()=>o,QF:()=>l});var i=s(8446),r=s.n(i),n=s(8953),a=s.n(n);const o=e=>r()(e)?e():e,l=(e,t,s)=>{const i=o(e),r=i.value(t);return r||console.error(`cloudinary video player: ${i.message(s)}`),r},h=(e,t)=>{if(a()(t))for(let s in e)if(Object.prototype.hasOwnProperty.call(t,s)){const i=e[s],r=t[s],n=a()(i);if(n&&!h(i,r))return!1;if(!n&&!l(r,i,s))return!1}return!0},c=async e=>s.e(40).then(s.bind(s,9754)).then((t=>{let{playerValidators:s}=t;return h(e,s)})),d=e=>s.e(40).then(s.bind(s,9754)).then((t=>{let{sourceValidators:s}=t;return h(e,s)}))},608:(e,t,s)=>{s.d(t,{Am:()=>c,HJ:()=>o,KE:()=>h,LU:()=>i,_V:()=>n,gi:()=>a,jK:()=>r,rT:()=>l});const i=["adaptiveStreaming","autoShowRecommendations","chapters","cloudinaryConfig","description","download","info","interactionAreas","poster","posterOptions","publicId","rawTransformation","recommendations","shoppable","source","sourceTransformation","sourceTypes","textTracks","title","transformation","type","visualSearch","withCredentials","videoSources"],r=i.concat(["_internalAnalyticsMetadata","ads","aiHighlightsGraph","allowUsageReport","analytics","autoplayMode","chaptersButton","cloudinaryAnalytics","colors","debug","fetchErrorUsingGet","floatingWhenNotVisible","fluid","fontFace","hideContextMenu","ima","pictureInPictureToggle","playedEventPercents","playedEventTimes","playlistWidget","qualitySelector","queryParams","seekThumbnails","showJumpControls"]),n=["api_secret","auth_token","cdn_subdomain","cloud_name","cname","private_cdn","secure","secure_cdn_subdomain","secure_distribution","shorten","sign_url","url_suffix","use_root_path"],a="cld-fluid",o={ALWAYS:"always",ON_SCROLL:"on-scroll",NEVER:"never"},l={LEFT:"left",RIGHT:"right",NONE:"none"},h={FIRST_VIDEO:"first-video",EVERY_VIDEO:"every-video"},c={AUTO:"auto",METADATA:"metadata",NONE:"none"}},8838:(e,t,s)=>{s.d(t,{T4:()=>p,Wi:()=>g,eo:()=>u,go:()=>m,iG:()=>f});var i=s(6673),r=s.n(i),n=s(5104),a=s(7668),o=s(608),l=s(7571),h=s.n(l),c=s(3337),d=s.n(c);const u=(e,t)=>e.addRemoteTextTrack({kind:"metadata",srclang:"en",src:t,default:!0},!0).track,p=e=>e.class.indexOf("cld-video-player-skin-light")>-1||"light"===e.skin,f=e=>{if(h()(e)){let t=e;0===t.indexOf("#")&&(t=t.slice(1));try{e=document.querySelector(`#${d()(t)}`)||r().getPlayer(t)}catch(t){e=null}if(!e)throw new Error(`Could not find element with id ${t}`)}if(!e.tagName)throw new Error("Must specify either an element or an element id.");if("VIDEO"!==e.tagName)throw new Error("Element is not a video tag.");return e},g=(e,t)=>{const s=n.A.normalizeAttributes(e);(r().dom.hasClass(e,o.gi)||r().dom.hasClass(e,"vjs-fluid"))&&(t.fluid=!0),(e=>{const t=e.autoplayMode;if(t)switch(t){case o.HJ.ALWAYS:e.autoplay=!0;break;case o.HJ.ON_SCROLL:case o.HJ.NEVER:default:e.autoplay=!1}})(t=r().obj.merge({},a.A,s,t));const i=n.A.sliceAndUnsetProperties(t,...o.jK);return i.cloudinary=n.A.sliceAndUnsetProperties(i,...o._V),i.cloudinaryConfig&&(Object.assign(i.cloudinary,i.cloudinaryConfig),delete i.cloudinaryConfig),i.sourceOptions=n.A.sliceAndUnsetProperties(i,...o.LU),t.videojs&&(Object.assign(t,t.videojs),delete t.videojs),{playerOptions:i,videojsOptions:t}},m=()=>{let e=r().getComponent("Player").prototype.options_.children;-1===e.indexOf("titleBar")&&e.push("titleBar");const t=r().getComponent("ControlBar");t&&(e=t.prototype.options_.children,e.splice(e.indexOf("progressControl"),0,"spacer","progressControlEventsBlocker"),e.splice(e.indexOf("playToggle"),1,"playToggle","JumpBackButton","JumpForwardButton"),e.splice(e.indexOf("chaptersButton"),1,"sourceSwitcherButton","chaptersButton"),e.push("logoButton"),e.splice(e.indexOf("skipForward"),1),e.splice(e.indexOf("skipBackward"),1))}},4138:e=>{self,e.exports=(()=>{var e={805:e=>{e.exports=r,e.exports.isMobile=r,e.exports.default=r;const t=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser.*mobile|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,s=/CrOS/,i=/android|ipad|playbook|silk/i;function r(e){e||(e={});let r=e.ua;if(r||"undefined"==typeof navigator||(r=navigator.userAgent),r&&r.headers&&"string"==typeof r.headers["user-agent"]&&(r=r.headers["user-agent"]),"string"!=typeof r)return!1;let n=t.test(r)&&!s.test(r)||!!e.tablet&&i.test(r);return!n&&e.tablet&&e.featureDetect&&navigator&&navigator.maxTouchPoints>1&&-1!==r.indexOf("Macintosh")&&-1!==r.indexOf("Safari")&&(n=!0),n}}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{connectCloudinaryAnalytics:()=>G});var e=s(805),t="pause",r="viewStart",n="viewEnd";function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}var o=function(e){return null!==e&&"object"===a(e)&&"string"==typeof e.cloudName&&e.cloudName&&"string"==typeof e.publicId&&e.publicId?{cloudName:e.cloudName,publicId:e.publicId}:null},l=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,h="native",c=[h,"cloudinary video player"],d=function(e){return c.includes(e)?e:h},u=function(e){return"string"==typeof e&&l.test(e)?e:null};function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=Array(t);s<t;s++)i[s]=e[s];return i}function g(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function m(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?g(Object(s),!0).forEach((function(t){y(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):g(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function y(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=p(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,"string");if("object"!=p(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var v=function(e,t){var s=function(e){var t="function"==typeof e?e():e;if("object"===a(t)&&null!==t&&!Array.isArray(t)){var s=function(e){return Array.from({length:5}).reduce((function(t,s,i){var r="customData".concat(i+1);return"string"==typeof e[r]&&(t[r]=e[r]),t}),{})}(t);return Object.keys(s).length>0?s:null}return null}(null==t?void 0:t.customData),i=function(e){return null!==e&&JSON.stringify(e).length<=1e3}(s),n=null!=t&&t.customVideoUrlFallback?function(e,t){try{var s=t(e);return{cloudName:s.cloudName,publicId:s.publicId}}catch(e){return null}}(e.videoUrl,t.customVideoUrlFallback):null,l=o(n);return b(r,m(m({},e),{},{analyticsModuleVersion:"1.8.2",videoPlayer:{type:d(null==t?void 0:t.videoPlayerType),version:u(null==t?void 0:t.videoPlayerVersion)},customerData:m(m({},i?{providedData:s}:{}),l?{videoData:l}:{})}))},_=function(){return b(n,m({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}))},b=function(e,t){return{eventName:e,eventTime:Date.now(),eventDetails:t}},T=function(e){var t=function(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var s={}.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?f(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e);return JSON.stringify(t)};function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=Array(t);s<t;s++)i[s]=e[s];return i}var E=function(e){var s={},i={};return function(){var r=null,n=[],a=function(e,t){if(!r)throw new Error("Events collector session not started");i[r].push(b(e,t))};return{flushEvents:function(){var e;if(!r)throw new Error("Events collector session not started");var t=i[r].splice(0,i[r].length);return(e=s[r]).splice.apply(e,[s[r].length,0].concat(function(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return A(e,t);var s={}.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?A(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t))),t},getCollectedEventsCount:function(){var e;return r&&(null===(e=i[r])||void 0===e?void 0:e.length)||0},addEvent:function(e){var t=e.eventName,s=e.eventDetails;return a(t,s)},start:function(o){if(r)throw new Error("Events collector session already started");s[r=o]=[],i[r]=[],n.push(function(e,t){var s=e.onPlay((function(){t("play",{})}));return function(){s()}}(e,a),function(e,s){var i=e.onPause((function(){s(t,{})})),r=e.onEmptied((function(){s(t,{})}));return function(){i(),r()}}(e,a),function(e,t){var s=function(){var s,i;t("loadMetadata",{videoDuration:(s=e.getDuration(),i=Number.isNaN(s)?null:s,Number.POSITIVE_INFINITY===i?"Infinity":i),videoUrl:e.getCurrentSrc()})},i=e.onLoadedMetadata((function(){return s()}));return e.getReadyState()>0&&setTimeout((function(){return s()}),0),function(){i()}}(e,a))},destroy:function(){if(!r)throw new Error("Events collector session not started");n.forEach((function(e){return e()})),r=null}}}};const S={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let C;const w=new Uint8Array(16);function k(){if(!C&&(C="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!C))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return C(w)}const L=[];for(let e=0;e<256;++e)L.push((e+256).toString(16).slice(1));const I=function(e,t,s){if(S.randomUUID&&!t&&!e)return S.randomUUID();const i=(e=e||{}).random||(e.rng||k)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){s=s||0;for(let e=0;e<16;++e)t[s+e]=i[e];return t}return function(e,t=0){return(L[e[t+0]]+L[e[t+1]]+L[e[t+2]]+L[e[t+3]]+"-"+L[e[t+4]]+L[e[t+5]]+"-"+L[e[t+6]]+L[e[t+7]]+"-"+L[e[t+8]]+L[e[t+9]]+"-"+L[e[t+10]]+L[e[t+11]]+L[e[t+12]]+L[e[t+13]]+L[e[t+14]]+L[e[t+15]]).toLowerCase()}(i)};var P="cld-analytics-user-id",R=function(){return I().replace(/-/g,"")},x=function(e,t){var s=Object.keys(t).reduce((function(e,s){return e.append(s,t[s]),e}),new FormData);return"function"!=typeof window.navigator.sendBeacon?window.fetch(e,{method:"POST",mode:"no-cors",body:s,keepalive:!0}):window.navigator.sendBeacon(e,s)};function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}var O=function(e,t){if(!e.isValid)throw t?"".concat(t,":")+"\n\n"+e.errorMessage:e.errorMessage},M=function(e){return e&&"object"!==D(e)?{isValid:!1,errorMessage:"Options property must be an object"}:{isValid:!0}},N=function(e,t,s){return e.addEventListener(t,s),function(){e.removeEventListener(t,s)}},F=function(e,t){return t?B(e):j(e)},B=function(e){var t=e.onPageViewStart,s=e.onPageViewEnd,i=function(){"visible"===document.visibilityState?null==t||t():"hidden"===document.visibilityState&&(null==s||s())};return document.addEventListener("visibilitychange",i),"visible"===document.visibilityState&&(null==t||t()),function(){document.removeEventListener("visibilitychange",i)}},j=function(e){var t=e.onPageViewStart,s=e.onPageViewEnd,i=function(){return null==t?void 0:t()},r=function(){return null==s?void 0:s()};return"complete"===document.readyState?i():window.addEventListener("load",i),window.addEventListener("beforeunload",r),function(){window.removeEventListener("load",i),window.removeEventListener("beforeunload",r)}};function U(e){return function(e){if(Array.isArray(e))return $(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return $(e,t);var s={}.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?$(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=Array(t);s<t;s++)i[s]=e[s];return i}var H="https://video-analytics-api.cloudinary.com/v1/video-analytics",V="https://video-analytics-api.cloudinary.com/v1/live-streams",G=function(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};O(function(e){return e&&"object"!==D(e)?{isValid:!1,errorMessage:"Options property must be an object"}:{isValid:!0}}(s),"Cloudinary video analytics requires proper options object"),s.playerAdapter||(s.playerAdapter=function(e){return{onCanPlay:function(t){return N(e,"canplay",t)},onCanPlayThrough:function(t){return N(e,"canplaythrough",t)},onComplete:function(t){return N(e,"complete",t)},onDurationChange:function(t){return N(e,"durationchange",t)},onEmptied:function(t){return N(e,"emptied",t)},onEnded:function(t){return N(e,"ended",t)},onError:function(t){return N(e,"error",t)},onLoadedData:function(t){return N(e,"loadeddata",t)},onLoadedMetadata:function(t){return N(e,"loadedmetadata",t)},onLoadStart:function(t){return N(e,"loadstart",t)},onPause:function(t){return N(e,"pause",t)},onPlay:function(t){return N(e,"play",t)},onPlaying:function(t){return N(e,"playing",t)},onProgress:function(t){return N(e,"progress",t)},onRateChange:function(t){return N(e,"ratechange",t)},onSeeked:function(t){return N(e,"seeked",t)},onSeeking:function(t){return N(e,"seeking",t)},onStalled:function(t){return N(e,"stalled",t)},onSuspend:function(t){return N(e,"suspend",t)},onTimeUpdate:function(t){return N(e,"timeupdate",t)},onVolumeChange:function(t){return N(e,"volumechange",t)},onWaiting:function(t){return N(e,"waiting",t)},getCurrentSrc:function(){return e.currentSrc},getCurrentTime:function(){return e.currentTime},getReadyState:function(){return e.readyState},getDuration:function(){return e.duration}}}(t));var i=null,a=function(){var e=window.localStorage.getItem(P);if(e)return e;var t=I().replace(/-/g,"");return window.localStorage.setItem(P,t),t}(),l=s.playerAdapter,h=(0,e.isMobile)({tablet:!0,featureDetect:!0}),c=E(l),p=function(){i&&(i.clear(),i=null)},f={_value:R(),getValue:function(){return f._value},regenerateValue:function(){return f._value=R(),i&&(i.viewId=f._value),f._value}};return{startManualTracking:function(e){var t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("auto"===(null===(t=i)||void 0===t?void 0:t.type))throw"Cloudinary video analytics auto tracking is already connected with this HTML Video Element, to start manual tracking you need to stop auto tracking";O(function(e){return"object"!==D(e)?{isValid:!1,errorMessage:"Metadata param needs to be an object"}:"string"!=typeof e.cloudName?{isValid:!1,errorMessage:"You need to provide proper cloud name of your Cloudinary account [cloudName: string]"}:"string"==typeof e.type&&"live"!==e.type?{isValid:!1,errorMessage:'Property "type" can be either undefined or "live" value'}:"string"!=typeof e.publicId?"live"===e.type?{isValid:!1,errorMessage:"You need to provide proper public ID of your Live Stream output"}:{isValid:!1,errorMessage:"You need to provide proper video public ID of your video on your Cloudinary cloud [videoPublicId: string]"}:{isValid:!0}}(e),"Cloudinary video analytics manual tracking called without necessary data"),O(M(s),"Cloudinary video analytics manual tracking called with invalid options"),p(),"live"===e.type?function(e,t){var s=o(e),l=function(e){x(V,{userId:a,viewId:f.getValue(),events:T([e])})},c=F({onPageViewStart:function(){var e;f.regenerateValue(),l((e=t,b(r,m(m({},{liveStreamData:s}),{},{analyticsModuleVersion:"1.8.2",videoPlayer:{type:d(null==e?void 0:e.videoPlayerType),version:u(null==e?void 0:e.videoPlayerVersion)}}))))},onPageViewEnd:function(){l(b(n,m({},{liveStreamData:s})))}},h);i={viewId:f.getValue(),type:"manual",subtype:"live-stream",clear:function(){c()}}}(e,s):(s.customVideoUrlFallback=s.customVideoUrlFallback||function(){return e},function(e,t){var s=c(),r=function(){if(s.getCollectedEventsCount()>0){s.addEvent(_());var e=T(U(s.flushEvents()));t={userId:a,viewId:f.getValue(),events:e},x(H,t)}var t},n=F({onPageViewStart:function(){f.regenerateValue(),s.start(f.getValue()),s.addEvent(v({videoUrl:l.getCurrentSrc(),trackingType:"manual"},t))},onPageViewEnd:function(){r(),s.destroy()}},h);i={viewId:f,type:"manual",subtype:"default",clear:function(){r(),s.destroy(),n()}}}(0,s))},stopManualTracking:p,startAutoTracking:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i)throw"Cloudinary video analytics tracking is already connected with this HTML Video Element";O(M(e),"Cloudinary video analytics auto tracking called with invalid options");var t=c(),s=function(){if(t.getCollectedEventsCount()>0){t.addEvent(_());var e=T(U(t.flushEvents()));s={userId:a,viewId:f.getValue(),events:e},x(H,s)}var s},r=function(){var r=l.getCurrentSrc();if(r===window.location.href||!r)return null;f.regenerateValue(),t.start(f.getValue()),t.addEvent(v({videoUrl:r,trackingType:"auto"},e)),i={viewId:f,type:"auto",clear:function(){s(),t.destroy()}}};F({onPageViewStart:function(){return r()},onPageViewEnd:function(){s(),t.destroy()}},h),l.onLoadStart((function(){return!i&&r()})),l.onEmptied((function(){return p()}))}}}})(),i})()},3337:function(e,t,s){var i;i=void 0!==s.g?s.g:this,e.exports=function(e){if(e.CSS&&e.CSS.escape)return e.CSS.escape;var t=function(e){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var t,s=String(e),i=s.length,r=-1,n="",a=s.charCodeAt(0);++r<i;)0!=(t=s.charCodeAt(r))?n+=t>=1&&t<=31||127==t||0==r&&t>=48&&t<=57||1==r&&t>=48&&t<=57&&45==a?"\\"+t.toString(16)+" ":0==r&&1==i&&45==t||!(t>=128||45==t||95==t||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122)?"\\"+s.charAt(r):s.charAt(r):n+="�";return n};return e.CSS||(e.CSS={}),e.CSS.escape=t,t}(i)},6827:e=>{var t,s="object"==typeof Reflect?Reflect:null,i=s&&"function"==typeof s.apply?s.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)};t=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function n(){n.init.call(this)}e.exports=n,e.exports.once=function(e,t){return new Promise((function(s,i){function r(s){e.removeListener(t,n),i(s)}function n(){"function"==typeof e.removeListener&&e.removeListener("error",r),s([].slice.call(arguments))}g(e,t,n,{once:!0}),"error"!==t&&function(e,t,s){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,r)}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function h(e,t,s,i){var r,n,a,h;if(o(s),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),n=e._events),a=n[t]),void 0===a)a=n[t]=s,++e._eventsCount;else if("function"==typeof a?a=n[t]=i?[s,a]:[a,s]:i?a.unshift(s):a.push(s),(r=l(e))>0&&a.length>r&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,h=c,console&&console.warn&&console.warn(h)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,s){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:s},r=c.bind(i);return r.listener=s,i.wrapFn=r,r}function u(e,t,s){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?s?[r.listener||r]:[r]:s?function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(r):f(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var s=t[e];if("function"==typeof s)return 1;if(void 0!==s)return s.length}return 0}function f(e,t){for(var s=new Array(t),i=0;i<t;++i)s[i]=e[i];return s}function g(e,t,s,i){if("function"==typeof e.on)i.once?e.once(t,s):e.on(t,s);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(n){i.once&&e.removeEventListener(t,r),s(n)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=n[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var h=l.length,c=f(l,h);for(s=0;s<h;++s)i(c[s],this,t)}return!0},n.prototype.addListener=function(e,t){return h(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return h(this,e,t,!0)},n.prototype.once=function(e,t){return o(t),this.on(e,d(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,d(this,e,t)),this},n.prototype.removeListener=function(e,t){var s,i,r,n,a;if(o(t),void 0===(i=this._events))return this;if(void 0===(s=i[e]))return this;if(s===t||s.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(r=-1,n=s.length-1;n>=0;n--)if(s[n]===t||s[n].listener===t){a=s[n].listener,r=n;break}if(r<0)return this;0===r?s.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(s,r),1===s.length&&(i[e]=s[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(e){var t,s,i;if(void 0===(s=this._events))return this;if(void 0===s.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==s[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete s[e]),this;if(0===arguments.length){var r,n=Object.keys(s);for(i=0;i<n.length;++i)"removeListener"!==(r=n[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},n.prototype.listeners=function(e){return u(this,e,!0)},n.prototype.rawListeners=function(e){return u(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},n.prototype.listenerCount=p,n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},6673:(e,t,s)=>{var i=s(9228);s(8364).videojs=i,e.exports=i},8364:(e,t,s)=>{e.exports=function(){if("object"==typeof globalThis)return globalThis;var e;try{e=this||new Function("return this")()}catch(e){if("object"==typeof window)return window;if("object"==typeof self)return self;if(void 0!==s.g)return s.g}return e}()},7509:(e,t,s)=>{var i,r=void 0!==s.g?s.g:"undefined"!=typeof window?window:{},n=s(4626);"undefined"!=typeof document?i=document:(i=r["__GLOBAL_DOCUMENT_CACHE@4"])||(i=r["__GLOBAL_DOCUMENT_CACHE@4"]=n),e.exports=i},5204:(e,t,s)=>{var i;i="undefined"!=typeof window?window:void 0!==s.g?s.g:"undefined"!=typeof self?self:{},e.exports=i},1416:(e,t,s)=>{var i=s(9138)(s(1433),"DataView");e.exports=i},9073:(e,t,s)=>{var i=s(2316),r=s(6458),n=s(2149),a=s(4297),o=s(3121);function l(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=n,l.prototype.has=a,l.prototype.set=o,e.exports=l},2707:(e,t,s)=>{var i=s(9714),r=s(3812),n=s(4727),a=s(8379),o=s(8291);function l(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=n,l.prototype.has=a,l.prototype.set=o,e.exports=l},1955:(e,t,s)=>{var i=s(9138)(s(1433),"Map");e.exports=i},369:(e,t,s)=>{var i=s(2092),r=s(9626),n=s(9925),a=s(6809),o=s(4385);function l(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=n,l.prototype.has=a,l.prototype.set=o,e.exports=l},2616:(e,t,s)=>{var i=s(9138)(s(1433),"Promise");e.exports=i},157:(e,t,s)=>{var i=s(9138)(s(1433),"Set");e.exports=i},6469:(e,t,s)=>{var i=s(2707),r=s(1848),n=s(7406),a=s(8569),o=s(3109),l=s(3389);function h(e){var t=this.__data__=new i(e);this.size=t.size}h.prototype.clear=r,h.prototype.delete=n,h.prototype.get=a,h.prototype.has=o,h.prototype.set=l,e.exports=h},2781:(e,t,s)=>{var i=s(1433).Symbol;e.exports=i},8944:(e,t,s)=>{var i=s(1433).Uint8Array;e.exports=i},8499:(e,t,s)=>{var i=s(9138)(s(1433),"WeakMap");e.exports=i},6701:e=>{e.exports=function(e,t,s){switch(s.length){case 0:return e.call(t);case 1:return e.call(t,s[0]);case 2:return e.call(t,s[0],s[1]);case 3:return e.call(t,s[0],s[1],s[2])}return e.apply(t,s)}},149:e=>{e.exports=function(e,t){for(var s=-1,i=null==e?0:e.length;++s<i&&!1!==t(e[s],s,e););return e}},1414:e=>{e.exports=function(e,t){for(var s=-1,i=null==e?0:e.length,r=0,n=[];++s<i;){var a=e[s];t(a,s,e)&&(n[r++]=a)}return n}},1163:(e,t,s)=>{var i=s(6204),r=s(1256),n=s(6397),a=s(492),o=s(2845),l=s(7995),h=Object.prototype.hasOwnProperty;e.exports=function(e,t){var s=n(e),c=!s&&r(e),d=!s&&!c&&a(e),u=!s&&!c&&!d&&l(e),p=s||c||d||u,f=p?i(e.length,String):[],g=f.length;for(var m in e)!t&&!h.call(e,m)||p&&("length"==m||d&&("offset"==m||"parent"==m)||u&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||o(m,g))||f.push(m);return f}},4272:e=>{e.exports=function(e,t){for(var s=-1,i=null==e?0:e.length,r=Array(i);++s<i;)r[s]=t(e[s],s,e);return r}},8740:e=>{e.exports=function(e,t){for(var s=-1,i=t.length,r=e.length;++s<i;)e[r+s]=t[s];return e}},2814:e=>{e.exports=function(e,t,s,i){var r=-1,n=null==e?0:e.length;for(i&&n&&(s=e[++r]);++r<n;)s=t(s,e[r],r,e);return s}},9174:e=>{e.exports=function(e){return e.split("")}},8273:e=>{var t=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;e.exports=function(e){return e.match(t)||[]}},2863:(e,t,s)=>{var i=s(4772),r=s(9316),n=Object.prototype.hasOwnProperty;e.exports=function(e,t,s){var a=e[t];n.call(e,t)&&r(a,s)&&(void 0!==s||t in e)||i(e,t,s)}},8301:(e,t,s)=>{var i=s(9316);e.exports=function(e,t){for(var s=e.length;s--;)if(i(e[s][0],t))return s;return-1}},1145:(e,t,s)=>{var i=s(2083),r=s(1178);e.exports=function(e,t){return e&&i(t,r(t),e)}},4306:(e,t,s)=>{var i=s(2083),r=s(5405);e.exports=function(e,t){return e&&i(t,r(t),e)}},4772:(e,t,s)=>{var i=s(8559);e.exports=function(e,t,s){"__proto__"==t&&i?i(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}},2931:(e,t,s)=>{var i=s(6469),r=s(149),n=s(2863),a=s(1145),o=s(4306),l=s(7030),h=s(8835),c=s(859),d=s(6728),u=s(966),p=s(9697),f=s(1201),g=s(6785),m=s(3283),y=s(9181),v=s(6397),_=s(492),b=s(422),T=s(8953),A=s(3764),E=s(1178),S=s(5405),C="[object Arguments]",w="[object Function]",k="[object Object]",L={};L[C]=L["[object Array]"]=L["[object ArrayBuffer]"]=L["[object DataView]"]=L["[object Boolean]"]=L["[object Date]"]=L["[object Float32Array]"]=L["[object Float64Array]"]=L["[object Int8Array]"]=L["[object Int16Array]"]=L["[object Int32Array]"]=L["[object Map]"]=L["[object Number]"]=L[k]=L["[object RegExp]"]=L["[object Set]"]=L["[object String]"]=L["[object Symbol]"]=L["[object Uint8Array]"]=L["[object Uint8ClampedArray]"]=L["[object Uint16Array]"]=L["[object Uint32Array]"]=!0,L["[object Error]"]=L[w]=L["[object WeakMap]"]=!1,e.exports=function e(t,s,I,P,R,x){var D,O=1&s,M=2&s,N=4&s;if(I&&(D=R?I(t,P,R,x):I(t)),void 0!==D)return D;if(!T(t))return t;var F=v(t);if(F){if(D=g(t),!O)return h(t,D)}else{var B=f(t),j=B==w||"[object GeneratorFunction]"==B;if(_(t))return l(t,O);if(B==k||B==C||j&&!R){if(D=M||j?{}:y(t),!O)return M?d(t,o(D,t)):c(t,a(D,t))}else{if(!L[B])return R?t:{};D=m(t,B,O)}}x||(x=new i);var U=x.get(t);if(U)return U;x.set(t,D),A(t)?t.forEach((function(i){D.add(e(i,s,I,i,t,x))})):b(t)&&t.forEach((function(i,r){D.set(r,e(i,s,I,r,t,x))}));var $=F?void 0:(N?M?p:u:M?S:E)(t);return r($||t,(function(i,r){$&&(i=t[r=i]),n(D,r,e(i,s,I,r,t,x))})),D}},3508:(e,t,s)=>{var i=s(8953),r=Object.create,n=function(){function e(){}return function(t){if(!i(t))return{};if(r)return r(t);e.prototype=t;var s=new e;return e.prototype=void 0,s}}();e.exports=n},1044:(e,t,s)=>{var i=s(8740),r=s(8031);e.exports=function e(t,s,n,a,o){var l=-1,h=t.length;for(n||(n=r),o||(o=[]);++l<h;){var c=t[l];s>0&&n(c)?s>1?e(c,s-1,n,a,o):i(o,c):a||(o[o.length]=c)}return o}},7722:(e,t,s)=>{var i=s(7181),r=s(6729);e.exports=function(e,t){for(var s=0,n=(t=i(t,e)).length;null!=e&&s<n;)e=e[r(t[s++])];return s&&s==n?e:void 0}},4403:(e,t,s)=>{var i=s(8740),r=s(6397);e.exports=function(e,t,s){var n=t(e);return r(e)?n:i(n,s(e))}},7148:(e,t,s)=>{var i=s(2781),r=s(7903),n=s(1738),a=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?r(e):n(e)}},809:e=>{e.exports=function(e,t){return null!=e&&t in Object(e)}},9250:(e,t,s)=>{var i=s(7148),r=s(2934);e.exports=function(e){return r(e)&&"[object Arguments]"==i(e)}},4800:(e,t,s)=>{var i=s(1201),r=s(2934);e.exports=function(e){return r(e)&&"[object Map]"==i(e)}},6567:(e,t,s)=>{var i=s(8446),r=s(8092),n=s(8953),a=s(1485),o=/^\[object .+?Constructor\]$/,l=Function.prototype,h=Object.prototype,c=l.toString,d=h.hasOwnProperty,u=RegExp("^"+c.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!n(e)||r(e))&&(i(e)?u:o).test(a(e))}},7866:(e,t,s)=>{var i=s(1201),r=s(2934);e.exports=function(e){return r(e)&&"[object Set]"==i(e)}},7129:(e,t,s)=>{var i=s(7148),r=s(3330),n=s(2934),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return n(e)&&r(e.length)&&!!a[i(e)]}},1452:(e,t,s)=>{var i=s(7499),r=s(9566),n=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return r(e);var t=[];for(var s in Object(e))n.call(e,s)&&"constructor"!=s&&t.push(s);return t}},1491:(e,t,s)=>{var i=s(8953),r=s(7499),n=s(8201),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return n(e);var t=r(e),s=[];for(var o in e)("constructor"!=o||!t&&a.call(e,o))&&s.push(o);return s}},6733:(e,t,s)=>{var i=s(5576),r=s(8235);e.exports=function(e,t){return i(e,t,(function(t,s){return r(e,s)}))}},5576:(e,t,s)=>{var i=s(7722),r=s(8230),n=s(7181);e.exports=function(e,t,s){for(var a=-1,o=t.length,l={};++a<o;){var h=t[a],c=i(e,h);s(c,h)&&r(l,n(h,e),c)}return l}},6764:e=>{e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},8230:(e,t,s)=>{var i=s(2863),r=s(7181),n=s(2845),a=s(8953),o=s(6729);e.exports=function(e,t,s,l){if(!a(e))return e;for(var h=-1,c=(t=r(t,e)).length,d=c-1,u=e;null!=u&&++h<c;){var p=o(t[h]),f=s;if("__proto__"===p||"constructor"===p||"prototype"===p)return e;if(h!=d){var g=u[p];void 0===(f=l?l(g,p,u):void 0)&&(f=a(g)?g:n(t[h+1])?[]:{})}i(u,p,f),u=u[p]}return e}},7310:(e,t,s)=>{var i=s(3122),r=s(8559),n=s(4796),a=r?function(e,t){return r(e,"toString",{configurable:!0,enumerable:!1,value:i(t),writable:!0})}:n;e.exports=a},9772:e=>{e.exports=function(e,t,s){var i=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(s=s>r?r:s)<0&&(s+=r),r=t>s?0:s-t>>>0,t>>>=0;for(var n=Array(r);++i<r;)n[i]=e[i+t];return n}},6204:e=>{e.exports=function(e,t){for(var s=-1,i=Array(e);++s<e;)i[s]=t(s);return i}},6584:(e,t,s)=>{var i=s(2781),r=s(4272),n=s(6397),a=s(5414),o=i?i.prototype:void 0,l=o?o.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(n(t))return r(t,e)+"";if(a(t))return l?l.call(t):"";var s=t+"";return"0"==s&&1/t==-1/0?"-0":s}},8812:(e,t,s)=>{var i=s(2140),r=/^\s+/;e.exports=function(e){return e?e.slice(0,i(e)+1).replace(r,""):e}},41:e=>{e.exports=function(e){return function(t){return e(t)}}},5263:(e,t,s)=>{var i=s(7181),r=s(5342),n=s(8549),a=s(6729);e.exports=function(e,t){return t=i(t,e),null==(e=n(e,t))||delete e[a(r(t))]}},7181:(e,t,s)=>{var i=s(6397),r=s(3726),n=s(3614),a=s(3506);e.exports=function(e,t){return i(e)?e:r(e,t)?[e]:n(a(e))}},9270:(e,t,s)=>{var i=s(9772);e.exports=function(e,t,s){var r=e.length;return s=void 0===s?r:s,!t&&s>=r?e:i(e,t,s)}},7177:(e,t,s)=>{var i=s(8944);e.exports=function(e){var t=new e.constructor(e.byteLength);return new i(t).set(new i(e)),t}},7030:(e,t,s)=>{e=s.nmd(e);var i=s(1433),r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r?i.Buffer:void 0,o=a?a.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var s=e.length,i=o?o(s):new e.constructor(s);return e.copy(i),i}},4893:(e,t,s)=>{var i=s(7177);e.exports=function(e,t){var s=t?i(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}},4021:e=>{var t=/\w*$/;e.exports=function(e){var s=new e.constructor(e.source,t.exec(e));return s.lastIndex=e.lastIndex,s}},1548:(e,t,s)=>{var i=s(2781),r=i?i.prototype:void 0,n=r?r.valueOf:void 0;e.exports=function(e){return n?Object(n.call(e)):{}}},9114:(e,t,s)=>{var i=s(7177);e.exports=function(e,t){var s=t?i(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}},8835:e=>{e.exports=function(e,t){var s=-1,i=e.length;for(t||(t=Array(i));++s<i;)t[s]=e[s];return t}},2083:(e,t,s)=>{var i=s(2863),r=s(4772);e.exports=function(e,t,s,n){var a=!s;s||(s={});for(var o=-1,l=t.length;++o<l;){var h=t[o],c=n?n(s[h],e[h],h,s,e):void 0;void 0===c&&(c=e[h]),a?r(s,h,c):i(s,h,c)}return s}},859:(e,t,s)=>{var i=s(2083),r=s(8876);e.exports=function(e,t){return i(e,r(e),t)}},6728:(e,t,s)=>{var i=s(2083),r=s(8355);e.exports=function(e,t){return i(e,r(e),t)}},8109:(e,t,s)=>{var i=s(1433)["__core-js_shared__"];e.exports=i},7383:(e,t,s)=>{var i=s(9270),r=s(654),n=s(4092),a=s(3506);e.exports=function(e){return function(t){t=a(t);var s=r(t)?n(t):void 0,o=s?s[0]:t.charAt(0),l=s?i(s,1).join(""):t.slice(1);return o[e]()+l}}},6983:(e,t,s)=>{var i=s(2814),r=s(3768),n=s(7385),a=RegExp("['’]","g");e.exports=function(e){return function(t){return i(n(r(t).replace(a,"")),e,"")}}},7222:(e,t,s)=>{var i=s(4679);e.exports=function(e){return i(e)?void 0:e}},8795:(e,t,s)=>{var i=s(6764)({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"});e.exports=i},8559:(e,t,s)=>{var i=s(9138),r=function(){try{var e=i(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=r},9820:(e,t,s)=>{var i=s(3406),r=s(5265),n=s(6805);e.exports=function(e){return n(r(e,void 0,i),e+"")}},5380:(e,t,s)=>{var i="object"==typeof s.g&&s.g&&s.g.Object===Object&&s.g;e.exports=i},966:(e,t,s)=>{var i=s(4403),r=s(8876),n=s(1178);e.exports=function(e){return i(e,n,r)}},9697:(e,t,s)=>{var i=s(4403),r=s(8355),n=s(5405);e.exports=function(e){return i(e,n,r)}},5535:(e,t,s)=>{var i=s(5662);e.exports=function(e,t){var s=e.__data__;return i(t)?s["string"==typeof t?"string":"hash"]:s.map}},9138:(e,t,s)=>{var i=s(6567),r=s(6772);e.exports=function(e,t){var s=r(e,t);return i(s)?s:void 0}},3347:(e,t,s)=>{var i=s(1019)(Object.getPrototypeOf,Object);e.exports=i},7903:(e,t,s)=>{var i=s(2781),r=Object.prototype,n=r.hasOwnProperty,a=r.toString,o=i?i.toStringTag:void 0;e.exports=function(e){var t=n.call(e,o),s=e[o];try{e[o]=void 0;var i=!0}catch(e){}var r=a.call(e);return i&&(t?e[o]=s:delete e[o]),r}},8876:(e,t,s)=>{var i=s(1414),r=s(3629),n=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,o=a?function(e){return null==e?[]:(e=Object(e),i(a(e),(function(t){return n.call(e,t)})))}:r;e.exports=o},8355:(e,t,s)=>{var i=s(8740),r=s(3347),n=s(8876),a=s(3629),o=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)i(t,n(e)),e=r(e);return t}:a;e.exports=o},1201:(e,t,s)=>{var i=s(1416),r=s(1955),n=s(2616),a=s(157),o=s(8499),l=s(7148),h=s(1485),c="[object Map]",d="[object Promise]",u="[object Set]",p="[object WeakMap]",f="[object DataView]",g=h(i),m=h(r),y=h(n),v=h(a),_=h(o),b=l;(i&&b(new i(new ArrayBuffer(1)))!=f||r&&b(new r)!=c||n&&b(n.resolve())!=d||a&&b(new a)!=u||o&&b(new o)!=p)&&(b=function(e){var t=l(e),s="[object Object]"==t?e.constructor:void 0,i=s?h(s):"";if(i)switch(i){case g:return f;case m:return c;case y:return d;case v:return u;case _:return p}return t}),e.exports=b},6772:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},6866:(e,t,s)=>{var i=s(7181),r=s(1256),n=s(6397),a=s(2845),o=s(3330),l=s(6729);e.exports=function(e,t,s){for(var h=-1,c=(t=i(t,e)).length,d=!1;++h<c;){var u=l(t[h]);if(!(d=null!=e&&s(e,u)))break;e=e[u]}return d||++h!=c?d:!!(c=null==e?0:e.length)&&o(c)&&a(u,c)&&(n(e)||r(e))}},654:e=>{var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return t.test(e)}},5854:e=>{var t=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;e.exports=function(e){return t.test(e)}},2316:(e,t,s)=>{var i=s(4558);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},6458:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},2149:(e,t,s)=>{var i=s(4558),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(i){var s=t[e];return"__lodash_hash_undefined__"===s?void 0:s}return r.call(t,e)?t[e]:void 0}},4297:(e,t,s)=>{var i=s(4558),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?void 0!==t[e]:r.call(t,e)}},3121:(e,t,s)=>{var i=s(4558);e.exports=function(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=i&&void 0===t?"__lodash_hash_undefined__":t,this}},6785:e=>{var t=Object.prototype.hasOwnProperty;e.exports=function(e){var s=e.length,i=new e.constructor(s);return s&&"string"==typeof e[0]&&t.call(e,"index")&&(i.index=e.index,i.input=e.input),i}},3283:(e,t,s)=>{var i=s(7177),r=s(4893),n=s(4021),a=s(1548),o=s(9114);e.exports=function(e,t,s){var l=e.constructor;switch(t){case"[object ArrayBuffer]":return i(e);case"[object Boolean]":case"[object Date]":return new l(+e);case"[object DataView]":return r(e,s);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return o(e,s);case"[object Map]":case"[object Set]":return new l;case"[object Number]":case"[object String]":return new l(e);case"[object RegExp]":return n(e);case"[object Symbol]":return a(e)}}},9181:(e,t,s)=>{var i=s(3508),r=s(3347),n=s(7499);e.exports=function(e){return"function"!=typeof e.constructor||n(e)?{}:i(r(e))}},8031:(e,t,s)=>{var i=s(2781),r=s(1256),n=s(6397),a=i?i.isConcatSpreadable:void 0;e.exports=function(e){return n(e)||r(e)||!!(a&&e&&e[a])}},2845:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,s){var i=typeof e;return!!(s=null==s?9007199254740991:s)&&("number"==i||"symbol"!=i&&t.test(e))&&e>-1&&e%1==0&&e<s}},3726:(e,t,s)=>{var i=s(6397),r=s(5414),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=function(e,t){if(i(e))return!1;var s=typeof e;return!("number"!=s&&"symbol"!=s&&"boolean"!=s&&null!=e&&!r(e))||a.test(e)||!n.test(e)||null!=t&&e in Object(t)}},5662:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},8092:(e,t,s)=>{var i,r=s(8109),n=(i=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";e.exports=function(e){return!!n&&n in e}},7499:e=>{var t=Object.prototype;e.exports=function(e){var s=e&&e.constructor;return e===("function"==typeof s&&s.prototype||t)}},9714:e=>{e.exports=function(){this.__data__=[],this.size=0}},3812:(e,t,s)=>{var i=s(8301),r=Array.prototype.splice;e.exports=function(e){var t=this.__data__,s=i(t,e);return!(s<0||(s==t.length-1?t.pop():r.call(t,s,1),--this.size,0))}},4727:(e,t,s)=>{var i=s(8301);e.exports=function(e){var t=this.__data__,s=i(t,e);return s<0?void 0:t[s][1]}},8379:(e,t,s)=>{var i=s(8301);e.exports=function(e){return i(this.__data__,e)>-1}},8291:(e,t,s)=>{var i=s(8301);e.exports=function(e,t){var s=this.__data__,r=i(s,e);return r<0?(++this.size,s.push([e,t])):s[r][1]=t,this}},2092:(e,t,s)=>{var i=s(9073),r=s(2707),n=s(1955);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(n||r),string:new i}}},9626:(e,t,s)=>{var i=s(5535);e.exports=function(e){var t=i(this,e).delete(e);return this.size-=t?1:0,t}},9925:(e,t,s)=>{var i=s(5535);e.exports=function(e){return i(this,e).get(e)}},6809:(e,t,s)=>{var i=s(5535);e.exports=function(e){return i(this,e).has(e)}},4385:(e,t,s)=>{var i=s(5535);e.exports=function(e,t){var s=i(this,e),r=s.size;return s.set(e,t),this.size+=s.size==r?0:1,this}},9268:(e,t,s)=>{var i=s(4556);e.exports=function(e){var t=i(e,(function(e){return 500===s.size&&s.clear(),e})),s=t.cache;return t}},4558:(e,t,s)=>{var i=s(9138)(Object,"create");e.exports=i},9566:(e,t,s)=>{var i=s(1019)(Object.keys,Object);e.exports=i},8201:e=>{e.exports=function(e){var t=[];if(null!=e)for(var s in Object(e))t.push(s);return t}},3685:(e,t,s)=>{e=s.nmd(e);var i=s(5380),r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r&&i.process,o=function(){try{return n&&n.require&&n.require("util").types||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=o},1738:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},1019:e=>{e.exports=function(e,t){return function(s){return e(t(s))}}},5265:(e,t,s)=>{var i=s(6701),r=Math.max;e.exports=function(e,t,s){return t=r(void 0===t?e.length-1:t,0),function(){for(var n=arguments,a=-1,o=r(n.length-t,0),l=Array(o);++a<o;)l[a]=n[t+a];a=-1;for(var h=Array(t+1);++a<t;)h[a]=n[a];return h[t]=s(l),i(e,this,h)}}},8549:(e,t,s)=>{var i=s(7722),r=s(9772);e.exports=function(e,t){return t.length<2?e:i(e,r(t,0,-1))}},1433:(e,t,s)=>{var i=s(5380),r="object"==typeof self&&self&&self.Object===Object&&self,n=i||r||Function("return this")();e.exports=n},6805:(e,t,s)=>{var i=s(7310),r=s(3983)(i);e.exports=r},3983:e=>{var t=Date.now;e.exports=function(e){var s=0,i=0;return function(){var r=t(),n=16-(r-i);if(i=r,n>0){if(++s>=800)return arguments[0]}else s=0;return e.apply(void 0,arguments)}}},1848:(e,t,s)=>{var i=s(2707);e.exports=function(){this.__data__=new i,this.size=0}},7406:e=>{e.exports=function(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}},8569:e=>{e.exports=function(e){return this.__data__.get(e)}},3109:e=>{e.exports=function(e){return this.__data__.has(e)}},3389:(e,t,s)=>{var i=s(2707),r=s(1955),n=s(369);e.exports=function(e,t){var s=this.__data__;if(s instanceof i){var a=s.__data__;if(!r||a.length<199)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new n(a)}return s.set(e,t),this.size=s.size,this}},4092:(e,t,s)=>{var i=s(9174),r=s(654),n=s(4082);e.exports=function(e){return r(e)?n(e):i(e)}},3614:(e,t,s)=>{var i=s(9268),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,a=i((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(r,(function(e,s,i,r){t.push(i?r.replace(n,"$1"):s||e)})),t}));e.exports=a},6729:(e,t,s)=>{var i=s(5414);e.exports=function(e){if("string"==typeof e||i(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},1485:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},2140:e=>{var t=/\s/;e.exports=function(e){for(var s=e.length;s--&&t.test(e.charAt(s)););return s}},4082:e=>{var t="\\ud800-\\udfff",s="["+t+"]",i="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",r="\\ud83c[\\udffb-\\udfff]",n="[^"+t+"]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",o="[\\ud800-\\udbff][\\udc00-\\udfff]",l="(?:"+i+"|"+r+")?",h="[\\ufe0e\\ufe0f]?",c=h+l+"(?:\\u200d(?:"+[n,a,o].join("|")+")"+h+l+")*",d="(?:"+[n+i+"?",i,a,o,s].join("|")+")",u=RegExp(r+"(?="+r+")|"+d+c,"g");e.exports=function(e){return e.match(u)||[]}},5701:e=>{var t="\\ud800-\\udfff",s="\\u2700-\\u27bf",i="a-z\\xdf-\\xf6\\xf8-\\xff",r="A-Z\\xc0-\\xd6\\xd8-\\xde",n="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",a="["+n+"]",o="\\d+",l="["+s+"]",h="["+i+"]",c="[^"+t+n+o+s+i+r+"]",d="(?:\\ud83c[\\udde6-\\uddff]){2}",u="[\\ud800-\\udbff][\\udc00-\\udfff]",p="["+r+"]",f="(?:"+h+"|"+c+")",g="(?:"+p+"|"+c+")",m="(?:['’](?:d|ll|m|re|s|t|ve))?",y="(?:['’](?:D|LL|M|RE|S|T|VE))?",v="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",_="[\\ufe0e\\ufe0f]?",b=_+v+"(?:\\u200d(?:"+["[^"+t+"]",d,u].join("|")+")"+_+v+")*",T="(?:"+[l,d,u].join("|")+")"+b,A=RegExp([p+"?"+h+"+"+m+"(?="+[a,p,"$"].join("|")+")",g+"+"+y+"(?="+[a,p+f,"$"].join("|")+")",p+"?"+f+"+"+m,p+"+"+y,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",o,T].join("|"),"g");e.exports=function(e){return e.match(A)||[]}},3686:(e,t,s)=>{var i=s(8756),r=s(6983)((function(e,t,s){return t=t.toLowerCase(),e+(s?i(t):t)}));e.exports=r},8756:(e,t,s)=>{var i=s(3506),r=s(8580);e.exports=function(e){return r(i(e).toLowerCase())}},2160:(e,t,s)=>{var i=s(6397);e.exports=function(){if(!arguments.length)return[];var e=arguments[0];return i(e)?e:[e]}},3122:e=>{e.exports=function(e){return function(){return e}}},6177:(e,t,s)=>{var i=s(8953),r=s(3664),n=s(5378),a=Math.max,o=Math.min;e.exports=function(e,t,s){var l,h,c,d,u,p,f=0,g=!1,m=!1,y=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var s=l,i=h;return l=h=void 0,f=t,d=e.apply(i,s)}function _(e){var s=e-p;return void 0===p||s>=t||s<0||m&&e-f>=c}function b(){var e=r();if(_(e))return T(e);u=setTimeout(b,function(e){var s=t-(e-p);return m?o(s,c-(e-f)):s}(e))}function T(e){return u=void 0,y&&l?v(e):(l=h=void 0,d)}function A(){var e=r(),s=_(e);if(l=arguments,h=this,p=e,s){if(void 0===u)return function(e){return f=e,u=setTimeout(b,t),g?v(e):d}(p);if(m)return clearTimeout(u),u=setTimeout(b,t),v(p)}return void 0===u&&(u=setTimeout(b,t)),d}return t=n(t)||0,i(s)&&(g=!!s.leading,c=(m="maxWait"in s)?a(n(s.maxWait)||0,t):c,y="trailing"in s?!!s.trailing:y),A.cancel=function(){void 0!==u&&clearTimeout(u),f=0,l=p=h=u=void 0},A.flush=function(){return void 0===u?d:T(r())},A}},3768:(e,t,s)=>{var i=s(8795),r=s(3506),n=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,a=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");e.exports=function(e){return(e=r(e))&&e.replace(n,i).replace(a,"")}},9316:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},3406:(e,t,s)=>{var i=s(1044);e.exports=function(e){return null!=e&&e.length?i(e,1):[]}},2832:(e,t,s)=>{var i=s(7722);e.exports=function(e,t,s){var r=null==e?void 0:i(e,t);return void 0===r?s:r}},8235:(e,t,s)=>{var i=s(809),r=s(6866);e.exports=function(e,t){return null!=e&&r(e,t,i)}},4796:e=>{e.exports=function(e){return e}},1256:(e,t,s)=>{var i=s(9250),r=s(2934),n=Object.prototype,a=n.hasOwnProperty,o=n.propertyIsEnumerable,l=i(function(){return arguments}())?i:function(e){return r(e)&&a.call(e,"callee")&&!o.call(e,"callee")};e.exports=l},6397:e=>{var t=Array.isArray;e.exports=t},8330:(e,t,s)=>{var i=s(8446),r=s(3330);e.exports=function(e){return null!=e&&r(e.length)&&!i(e)}},492:(e,t,s)=>{e=s.nmd(e);var i=s(1433),r=s(659),n=t&&!t.nodeType&&t,a=n&&e&&!e.nodeType&&e,o=a&&a.exports===n?i.Buffer:void 0,l=(o?o.isBuffer:void 0)||r;e.exports=l},9040:(e,t,s)=>{var i=s(2934),r=s(4679);e.exports=function(e){return i(e)&&1===e.nodeType&&!r(e)}},5685:(e,t,s)=>{var i=s(1452),r=s(1201),n=s(1256),a=s(6397),o=s(8330),l=s(492),h=s(7499),c=s(7995),d=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(o(e)&&(a(e)||"string"==typeof e||"function"==typeof e.splice||l(e)||c(e)||n(e)))return!e.length;var t=r(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(h(e))return!i(e).length;for(var s in e)if(d.call(e,s))return!1;return!0}},8446:(e,t,s)=>{var i=s(7148),r=s(8953);e.exports=function(e){if(!r(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},4466:(e,t,s)=>{var i=s(9445);e.exports=function(e){return"number"==typeof e&&e==i(e)}},3330:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},422:(e,t,s)=>{var i=s(4800),r=s(41),n=s(3685),a=n&&n.isMap,o=a?r(a):i;e.exports=o},8953:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},2934:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},4679:(e,t,s)=>{var i=s(7148),r=s(3347),n=s(2934),a=Function.prototype,o=Object.prototype,l=a.toString,h=o.hasOwnProperty,c=l.call(Object);e.exports=function(e){if(!n(e)||"[object Object]"!=i(e))return!1;var t=r(e);if(null===t)return!0;var s=h.call(t,"constructor")&&t.constructor;return"function"==typeof s&&s instanceof s&&l.call(s)==c}},3764:(e,t,s)=>{var i=s(7866),r=s(41),n=s(3685),a=n&&n.isSet,o=a?r(a):i;e.exports=o},7571:(e,t,s)=>{var i=s(7148),r=s(6397),n=s(2934);e.exports=function(e){return"string"==typeof e||!r(e)&&n(e)&&"[object String]"==i(e)}},5414:(e,t,s)=>{var i=s(7148),r=s(2934);e.exports=function(e){return"symbol"==typeof e||r(e)&&"[object Symbol]"==i(e)}},7995:(e,t,s)=>{var i=s(7129),r=s(41),n=s(3685),a=n&&n.isTypedArray,o=a?r(a):i;e.exports=o},1178:(e,t,s)=>{var i=s(1163),r=s(1452),n=s(8330);e.exports=function(e){return n(e)?i(e):r(e)}},5405:(e,t,s)=>{var i=s(1163),r=s(1491),n=s(8330);e.exports=function(e){return n(e)?i(e,!0):r(e)}},5342:e=>{e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},4556:(e,t,s)=>{var i=s(369);function r(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var s=function(){var i=arguments,r=t?t.apply(this,i):i[0],n=s.cache;if(n.has(r))return n.get(r);var a=e.apply(this,i);return s.cache=n.set(r,a)||n,a};return s.cache=new(r.Cache||i),s}r.Cache=i,e.exports=r},5114:e=>{e.exports=function(){}},3664:(e,t,s)=>{var i=s(1433);e.exports=function(){return i.Date.now()}},4319:(e,t,s)=>{var i=s(4272),r=s(2931),n=s(5263),a=s(7181),o=s(2083),l=s(7222),h=s(9820),c=s(9697),d=h((function(e,t){var s={};if(null==e)return s;var h=!1;t=i(t,(function(t){return t=a(t,e),h||(h=t.length>1),t})),o(e,c(e),s),h&&(s=r(s,7,l));for(var d=t.length;d--;)n(s,t[d]);return s}));e.exports=d},7171:(e,t,s)=>{var i=s(6733),r=s(9820)((function(e,t){return null==e?{}:i(e,t)}));e.exports=r},5072:(e,t,s)=>{var i=s(6983)((function(e,t,s){return e+(s?"_":"")+t.toLowerCase()}));e.exports=i},3629:e=>{e.exports=function(){return[]}},659:e=>{e.exports=function(){return!1}},2858:(e,t,s)=>{var i=s(6177),r=s(8953);e.exports=function(e,t,s){var n=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return r(s)&&(n="leading"in s?!!s.leading:n,a="trailing"in s?!!s.trailing:a),i(e,t,{leading:n,maxWait:t,trailing:a})}},4764:(e,t,s)=>{var i=s(5378),r=1/0;e.exports=function(e){return e?(e=i(e))===r||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},9445:(e,t,s)=>{var i=s(4764);e.exports=function(e){var t=i(e),s=t%1;return t==t?s?t-s:t:0}},5378:(e,t,s)=>{var i=s(8812),r=s(8953),n=s(5414),a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,l=/^0o[0-7]+$/i,h=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(n(e))return NaN;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=i(e);var s=o.test(e);return s||l.test(e)?h(e.slice(2),s?2:8):a.test(e)?NaN:+e}},3506:(e,t,s)=>{var i=s(6584);e.exports=function(e){return null==e?"":i(e)}},8580:(e,t,s)=>{var i=s(7383)("toUpperCase");e.exports=i},7385:(e,t,s)=>{var i=s(8273),r=s(5854),n=s(3506),a=s(5701);e.exports=function(e,t,s){return e=n(e),void 0===(t=s?void 0:t)?r(e)?a(e):i(e):e.match(t)||[]}},9228:function(e,t,s){e.exports=function(){var e="8.23.3";const t={},i=function(e,s){return t[e]=t[e]||[],s&&(t[e]=t[e].concat(s)),t[e]},r=function(e,s){const r=i(e).indexOf(s);return!(r<=-1||(t[e]=t[e].slice(),t[e].splice(r,1),0))},n={prefixed:!0},a=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],o=a[0];let l;for(let e=0;e<a.length;e++)if(a[e][1]in document){l=a[e];break}if(l){for(let e=0;e<l.length;e++)n[o[e]]=l[e];n.prefixed=l[0]!==o[0]}let h=[];const c=function e(t,s=":",i=""){let r,n="info";function a(...e){r("log",n,e)}return r=((e,t,s)=>(i,r,n)=>{const a=t.levels[r],o=new RegExp(`^(${a})$`);let l=e;if("log"!==i&&n.unshift(i.toUpperCase()+":"),s&&(l=`%c${e}`,n.unshift(s)),n.unshift(l+":"),h){h.push([].concat(n));const e=h.length-1e3;h.splice(0,e>0?e:0)}if(!window.console)return;let c=window.console[i];c||"debug"!==i||(c=window.console.info||window.console.log),c&&a&&o.test(i)&&c[Array.isArray(n)?"apply":"call"](window.console,n)})(t,a,i),a.createLogger=(r,n,a)=>{const o=void 0!==n?n:s;return e(`${t} ${o} ${r}`,o,void 0!==a?a:i)},a.createNewLogger=(t,s,i)=>e(t,s,i),a.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:n},a.level=e=>{if("string"==typeof e){if(!a.levels.hasOwnProperty(e))throw new Error(`"${e}" in not a valid log level`);n=e}return n},a.history=()=>h?[].concat(h):[],a.history.filter=e=>(h||[]).filter((t=>new RegExp(`.*${e}.*`).test(t[0]))),a.history.clear=()=>{h&&(h.length=0)},a.history.disable=()=>{null!==h&&(h.length=0,h=null)},a.history.enable=()=>{null===h&&(h=[])},a.error=(...e)=>r("error",n,e),a.warn=(...e)=>r("warn",n,e),a.debug=(...e)=>r("debug",n,e),a}("VIDEOJS"),d=c.createLogger,u=Object.prototype.toString,p=function(e){return m(e)?Object.keys(e):[]};function f(e,t){p(e).forEach((s=>t(e[s],s)))}function g(e,t,s=0){return p(e).reduce(((s,i)=>t(s,e[i],i)),s)}function m(e){return!!e&&"object"==typeof e}function y(e){return m(e)&&"[object Object]"===u.call(e)&&e.constructor===Object}function v(...e){const t={};return e.forEach((e=>{e&&f(e,((e,s)=>{y(e)?(y(t[s])||(t[s]={}),t[s]=v(t[s],e)):t[s]=e}))})),t}function _(e={}){const t=[];for(const s in e)if(e.hasOwnProperty(s)){const i=e[s];t.push(i)}return t}function b(e,t,s,i=!0){const r=s=>Object.defineProperty(e,t,{value:s,enumerable:!0,writable:!0}),n={configurable:!0,enumerable:!0,get(){const e=s();return r(e),e}};return i&&(n.set=r),Object.defineProperty(e,t,n)}var T=Object.freeze({__proto__:null,each:f,reduce:g,isObject:m,isPlain:y,merge:v,values:_,defineLazyProperty:b});let A,E=!1,S=null,C=!1,w=!1,k=!1,L=!1,I=!1,P=null,R=null;const x=Boolean(window.cast&&window.cast.framework&&window.cast.framework.CastReceiverContext);let D=null,O=!1,M=!1,N=!1,F=!1,B=!1,j=!1,U=!1;const $=Boolean(K()&&("ontouchstart"in window||window.navigator.maxTouchPoints||window.DocumentTouch&&window.document instanceof window.DocumentTouch)),H=window.navigator&&window.navigator.userAgentData;if(H&&H.platform&&H.brands&&(C="Android"===H.platform,k=Boolean(H.brands.find((e=>"Microsoft Edge"===e.brand))),L=Boolean(H.brands.find((e=>"Chromium"===e.brand))),I=!k&&L,P=R=(H.brands.find((e=>"Chromium"===e.brand))||{}).version||null,M="Windows"===H.platform),!L){const e=window.navigator&&window.navigator.userAgent||"";E=/iPod/i.test(e),S=function(){const t=e.match(/OS (\d+)_/i);return t&&t[1]?t[1]:null}(),C=/Android/i.test(e),A=function(){const t=e.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const s=t[1]&&parseFloat(t[1]),i=t[2]&&parseFloat(t[2]);return s&&i?parseFloat(t[1]+"."+t[2]):s||null}(),w=/Firefox/i.test(e),k=/Edg/i.test(e),L=/Chrome/i.test(e)||/CriOS/i.test(e),I=!k&&L,P=R=function(){const t=e.match(/(Chrome|CriOS)\/(\d+)/);return t&&t[2]?parseFloat(t[2]):null}(),D=function(){const t=/MSIE\s(\d+)\.\d/.exec(e);let s=t&&parseFloat(t[1]);return!s&&/Trident\/7.0/i.test(e)&&/rv:11.0/.test(e)&&(s=11),s}(),B=/Tizen/i.test(e),j=/Web0S/i.test(e),U=B||j,O=/Safari/i.test(e)&&!I&&!C&&!k&&!U,M=/Windows/i.test(e),N=/iPad/i.test(e)||O&&$&&!/iPhone/i.test(e),F=/iPhone/i.test(e)&&!N}const V=F||N||E,G=(O||V)&&!I;var W=Object.freeze({__proto__:null,get IS_IPOD(){return E},get IOS_VERSION(){return S},get IS_ANDROID(){return C},get ANDROID_VERSION(){return A},get IS_FIREFOX(){return w},get IS_EDGE(){return k},get IS_CHROMIUM(){return L},get IS_CHROME(){return I},get CHROMIUM_VERSION(){return P},get CHROME_VERSION(){return R},IS_CHROMECAST_RECEIVER:x,get IE_VERSION(){return D},get IS_SAFARI(){return O},get IS_WINDOWS(){return M},get IS_IPAD(){return N},get IS_IPHONE(){return F},get IS_TIZEN(){return B},get IS_WEBOS(){return j},get IS_SMART_TV(){return U},TOUCH_ENABLED:$,IS_IOS:V,IS_ANY_SAFARI:G});function z(e){return"string"==typeof e&&Boolean(e.trim())}function K(){return document===window.document}function q(e){return m(e)&&1===e.nodeType}function Y(){try{return window.parent!==window.self}catch(e){return!0}}function X(e){return function(t,s){if(!z(t))return document[e](null);z(s)&&(s=document.querySelector(s));const i=q(s)?s:document;return i[e]&&i[e](t)}}function Q(e="div",t={},s={},i){const r=document.createElement(e);return Object.getOwnPropertyNames(t).forEach((function(e){const s=t[e];"textContent"===e?Z(r,s):r[e]===s&&"tabIndex"!==e||(r[e]=s)})),Object.getOwnPropertyNames(s).forEach((function(e){r.setAttribute(e,s[e])})),i&&ye(r,i),r}function Z(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function J(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function ee(e,t){return function(e){if(e.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}(t),e.classList.contains(t)}function te(e,...t){return e.classList.add(...t.reduce(((e,t)=>e.concat(t.split(/\s+/))),[])),e}function se(e,...t){return e?(e.classList.remove(...t.reduce(((e,t)=>e.concat(t.split(/\s+/))),[])),e):(c.warn("removeClass was called with an element that doesn't exist"),null)}function ie(e,t,s){return"function"==typeof s&&(s=s(e,t)),"boolean"!=typeof s&&(s=void 0),t.split(/\s+/).forEach((t=>e.classList.toggle(t,s))),e}function re(e,t){Object.getOwnPropertyNames(t).forEach((function(s){const i=t[s];null==i||!1===i?e.removeAttribute(s):e.setAttribute(s,!0===i?"":i)}))}function ne(e){const t={},s=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(e&&e.attributes&&e.attributes.length>0){const i=e.attributes;for(let e=i.length-1;e>=0;e--){const r=i[e].name;let n=i[e].value;s.includes(r)&&(n=null!==n),t[r]=n}}return t}function ae(e,t){return e.getAttribute(t)}function oe(e,t,s){e.setAttribute(t,s)}function le(e,t){e.removeAttribute(t)}function he(){document.body.focus(),document.onselectstart=function(){return!1}}function ce(){document.onselectstart=function(){return!0}}function de(e){if(e&&e.getBoundingClientRect&&e.parentNode){const t=e.getBoundingClientRect(),s={};return["bottom","height","left","right","top","width"].forEach((e=>{void 0!==t[e]&&(s[e]=t[e])})),s.height||(s.height=parseFloat(Ae(e,"height"))),s.width||(s.width=parseFloat(Ae(e,"width"))),s}}function ue(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};const t=e.offsetWidth,s=e.offsetHeight;let i=0,r=0;for(;e.offsetParent&&e!==document[n.fullscreenElement];)i+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return{left:i,top:r,width:t,height:s}}function pe(e,t){const s={x:0,y:0};if(V){let t=e;for(;t&&"html"!==t.nodeName.toLowerCase();){const e=Ae(t,"transform");if(/^matrix/.test(e)){const t=e.slice(7,-1).split(/,\s/).map(Number);s.x+=t[4],s.y+=t[5]}else if(/^matrix3d/.test(e)){const t=e.slice(9,-1).split(/,\s/).map(Number);s.x+=t[12],s.y+=t[13]}if(t.assignedSlot&&t.assignedSlot.parentElement&&window.WebKitCSSMatrix){const e=window.getComputedStyle(t.assignedSlot.parentElement).transform,i=new window.WebKitCSSMatrix(e);s.x+=i.m41,s.y+=i.m42}t=t.parentNode||t.host}}const i={},r=ue(t.target),n=ue(e),a=n.width,o=n.height;let l=t.offsetY-(n.top-r.top),h=t.offsetX-(n.left-r.left);return t.changedTouches&&(h=t.changedTouches[0].pageX-n.left,l=t.changedTouches[0].pageY+n.top,V&&(h-=s.x,l-=s.y)),i.y=1-Math.max(0,Math.min(1,l/o)),i.x=Math.max(0,Math.min(1,h/a)),i}function fe(e){return m(e)&&3===e.nodeType}function ge(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function me(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map((e=>("function"==typeof e&&(e=e()),q(e)||fe(e)?e:"string"==typeof e&&/\S/.test(e)?document.createTextNode(e):void 0))).filter((e=>e))}function ye(e,t){return me(t).forEach((t=>e.appendChild(t))),e}function ve(e,t){return ye(ge(e),t)}function _e(e){return void 0===e.button&&void 0===e.buttons||0===e.button&&void 0===e.buttons||"mouseup"===e.type&&0===e.button&&0===e.buttons||"mousedown"===e.type&&0===e.button&&0===e.buttons||0===e.button&&1===e.buttons}const be=X("querySelector"),Te=X("querySelectorAll");function Ae(e,t){if(!e||!t)return"";if("function"==typeof window.getComputedStyle){let s;try{s=window.getComputedStyle(e)}catch(e){return""}return s?s.getPropertyValue(t)||s[t]:""}return""}function Ee(e){[...document.styleSheets].forEach((t=>{try{const s=[...t.cssRules].map((e=>e.cssText)).join(""),i=document.createElement("style");i.textContent=s,e.document.head.appendChild(i)}catch(s){const i=document.createElement("link");i.rel="stylesheet",i.type=t.type,i.media=t.media.mediaText,i.href=t.href,e.document.head.appendChild(i)}}))}var Se=Object.freeze({__proto__:null,isReal:K,isEl:q,isInFrame:Y,createEl:Q,textContent:Z,prependTo:J,hasClass:ee,addClass:te,removeClass:se,toggleClass:ie,setAttributes:re,getAttributes:ne,getAttribute:ae,setAttribute:oe,removeAttribute:le,blockTextSelection:he,unblockTextSelection:ce,getBoundingClientRect:de,findPosition:ue,getPointerPosition:pe,isTextNode:fe,emptyEl:ge,normalizeContent:me,appendContent:ye,insertContent:ve,isSingleLeftClick:_e,$:be,$$:Te,computedStyle:Ae,copyStyleSheetsToWindow:Ee});let Ce,we=!1;const ke=function(){if(!1===Ce.options.autoSetup)return;const e=Array.prototype.slice.call(document.getElementsByTagName("video")),t=Array.prototype.slice.call(document.getElementsByTagName("audio")),s=Array.prototype.slice.call(document.getElementsByTagName("video-js")),i=e.concat(t,s);if(i&&i.length>0)for(let e=0,t=i.length;e<t;e++){const t=i[e];if(!t||!t.getAttribute){Le(1);break}void 0===t.player&&null!==t.getAttribute("data-setup")&&Ce(t)}else we||Le(1)};function Le(e,t){K()&&(t&&(Ce=t),window.setTimeout(ke,e))}function Ie(){we=!0,window.removeEventListener("load",Ie)}K()&&("complete"===document.readyState?Ie():window.addEventListener("load",Ie));const Pe=function(e){const t=document.createElement("style");return t.className=e,t},Re=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t};var xe=new WeakMap;let De,Oe=3;function Me(){return Oe++}function Ne(e,t){if(!xe.has(e))return;const s=xe.get(e);0===s.handlers[t].length&&(delete s.handlers[t],e.removeEventListener?e.removeEventListener(t,s.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,s.dispatcher)),Object.getOwnPropertyNames(s.handlers).length<=0&&(delete s.handlers,delete s.dispatcher,delete s.disabled),0===Object.getOwnPropertyNames(s).length&&xe.delete(e)}function Fe(e,t,s,i){s.forEach((function(s){e(t,s,i)}))}function Be(e){if(e.fixed_)return e;function t(){return!0}function s(){return!1}if(!e||!e.isPropagationStopped||!e.isImmediatePropagationStopped){const i=e||window.event;e={};const r=["layerX","layerY","keyLocation","path","webkitMovementX","webkitMovementY","mozPressure","mozInputSource"];for(const t in i)r.includes(t)||"returnValue"===t&&i.preventDefault||(e[t]=i[t]);if(e.target||(e.target=e.srcElement||document),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){i.preventDefault&&i.preventDefault(),e.returnValue=!1,i.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){i.stopPropagation&&i.stopPropagation(),e.cancelBubble=!0,i.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=s,e.stopImmediatePropagation=function(){i.stopImmediatePropagation&&i.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=s,null!==e.clientX&&void 0!==e.clientX){const t=document.documentElement,s=document.body;e.pageX=e.clientX+(t&&t.scrollLeft||s&&s.scrollLeft||0)-(t&&t.clientLeft||s&&s.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||s&&s.scrollTop||0)-(t&&t.clientTop||s&&s.clientTop||0)}e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e.fixed_=!0,e}const je=function(){if("boolean"!=typeof De){De=!1;try{const e=Object.defineProperty({},"passive",{get(){De=!0}});window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){}}return De},Ue=["touchstart","touchmove"];function $e(e,t,s){if(Array.isArray(t))return Fe($e,e,t,s);xe.has(e)||xe.set(e,{});const i=xe.get(e);if(i.handlers||(i.handlers={}),i.handlers[t]||(i.handlers[t]=[]),s.guid||(s.guid=Me()),i.handlers[t].push(s),i.dispatcher||(i.disabled=!1,i.dispatcher=function(t,s){if(i.disabled)return;t=Be(t);const r=i.handlers[t.type];if(r){const i=r.slice(0);for(let r=0,n=i.length;r<n&&!t.isImmediatePropagationStopped();r++)try{i[r].call(e,t,s)}catch(e){c.error(e)}}}),1===i.handlers[t].length)if(e.addEventListener){let s=!1;je()&&Ue.indexOf(t)>-1&&(s={passive:!0}),e.addEventListener(t,i.dispatcher,s)}else e.attachEvent&&e.attachEvent("on"+t,i.dispatcher)}function He(e,t,s){if(!xe.has(e))return;const i=xe.get(e);if(!i.handlers)return;if(Array.isArray(t))return Fe(He,e,t,s);const r=function(e,t){i.handlers[t]=[],Ne(e,t)};if(void 0===t){for(const t in i.handlers)Object.prototype.hasOwnProperty.call(i.handlers||{},t)&&r(e,t);return}const n=i.handlers[t];if(n)if(s){if(s.guid)for(let e=0;e<n.length;e++)n[e].guid===s.guid&&n.splice(e--,1);Ne(e,t)}else r(e,t)}function Ve(e,t,s){const i=xe.has(e)?xe.get(e):{},r=e.parentNode||e.ownerDocument;if("string"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=Be(t),i.dispatcher&&i.dispatcher.call(e,t,s),r&&!t.isPropagationStopped()&&!0===t.bubbles)Ve.call(null,r,t,s);else if(!r&&!t.defaultPrevented&&t.target&&t.target[t.type]){xe.has(t.target)||xe.set(t.target,{});const e=xe.get(t.target);t.target[t.type]&&(e.disabled=!0,"function"==typeof t.target[t.type]&&t.target[t.type](),e.disabled=!1)}return!t.defaultPrevented}function Ge(e,t,s){if(Array.isArray(t))return Fe(Ge,e,t,s);const i=function(){He(e,t,i),s.apply(this,arguments)};i.guid=s.guid=s.guid||Me(),$e(e,t,i)}function We(e,t,s){const i=function(){He(e,t,i),s.apply(this,arguments)};i.guid=s.guid=s.guid||Me(),$e(e,t,i)}var ze=Object.freeze({__proto__:null,fixEvent:Be,on:$e,off:He,trigger:Ve,one:Ge,any:We});const Ke=30,qe=function(e,t,s){t.guid||(t.guid=Me());const i=t.bind(e);return i.guid=s?s+"_"+t.guid:t.guid,i},Ye=function(e,t){let s=window.performance.now();return function(...i){const r=window.performance.now();r-s>=t&&(e(...i),s=r)}},Xe=function(e,t,s,i=window){let r;const n=function(){const n=this,a=arguments;let o=function(){r=null,o=null,s||e.apply(n,a)};!r&&s&&e.apply(n,a),i.clearTimeout(r),r=i.setTimeout(o,t)};return n.cancel=()=>{i.clearTimeout(r),r=null},n};var Qe=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:Ke,bind_:qe,throttle:Ye,debounce:Xe});let Ze;class Je{on(e,t){const s=this.addEventListener;this.addEventListener=()=>{},$e(this,e,t),this.addEventListener=s}off(e,t){He(this,e,t)}one(e,t){const s=this.addEventListener;this.addEventListener=()=>{},Ge(this,e,t),this.addEventListener=s}any(e,t){const s=this.addEventListener;this.addEventListener=()=>{},We(this,e,t),this.addEventListener=s}trigger(e){const t=e.type||e;"string"==typeof e&&(e={type:t}),e=Be(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),Ve(this,e)}queueTrigger(e){Ze||(Ze=new Map);const t=e.type||e;let s=Ze.get(this);s||(s=new Map,Ze.set(this,s));const i=s.get(t);s.delete(t),window.clearTimeout(i);const r=window.setTimeout((()=>{s.delete(t),0===s.size&&(s=null,Ze.delete(this)),this.trigger(e)}),0);s.set(t,r)}}Je.prototype.allowedEvents_={},Je.prototype.addEventListener=Je.prototype.on,Je.prototype.removeEventListener=Je.prototype.off,Je.prototype.dispatchEvent=Je.prototype.trigger;const et=e=>"function"==typeof e.name?e.name():"string"==typeof e.name?e.name:e.name_?e.name_:e.constructor&&e.constructor.name?e.constructor.name:typeof e,tt=e=>e instanceof Je||!!e.eventBusEl_&&["on","one","off","trigger"].every((t=>"function"==typeof e[t])),st=e=>"string"==typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length,it=(e,t,s)=>{if(!e||!e.nodeName&&!tt(e))throw new Error(`Invalid target for ${et(t)}#${s}; must be a DOM node or evented object.`)},rt=(e,t,s)=>{if(!st(e))throw new Error(`Invalid event type for ${et(t)}#${s}; must be a non-empty string or array.`)},nt=(e,t,s)=>{if("function"!=typeof e)throw new Error(`Invalid listener for ${et(t)}#${s}; must be a function.`)},at=(e,t,s)=>{const i=t.length<3||t[0]===e||t[0]===e.eventBusEl_;let r,n,a;return i?(r=e.eventBusEl_,t.length>=3&&t.shift(),[n,a]=t):(r=t[0],n=t[1],a=t[2]),it(r,e,s),rt(n,e,s),nt(a,e,s),a=qe(e,a),{isTargetingSelf:i,target:r,type:n,listener:a}},ot=(e,t,s,i)=>{it(e,e,t),e.nodeName?ze[t](e,s,i):e[t](s,i)},lt={on(...e){const{isTargetingSelf:t,target:s,type:i,listener:r}=at(this,e,"on");if(ot(s,"on",i,r),!t){const e=()=>this.off(s,i,r);e.guid=r.guid;const t=()=>this.off("dispose",e);t.guid=r.guid,ot(this,"on","dispose",e),ot(s,"on","dispose",t)}},one(...e){const{isTargetingSelf:t,target:s,type:i,listener:r}=at(this,e,"one");if(t)ot(s,"one",i,r);else{const e=(...t)=>{this.off(s,i,e),r.apply(null,t)};e.guid=r.guid,ot(s,"one",i,e)}},any(...e){const{isTargetingSelf:t,target:s,type:i,listener:r}=at(this,e,"any");if(t)ot(s,"any",i,r);else{const e=(...t)=>{this.off(s,i,e),r.apply(null,t)};e.guid=r.guid,ot(s,"any",i,e)}},off(e,t,s){if(!e||st(e))He(this.eventBusEl_,e,t);else{const i=e,r=t;it(i,this,"off"),rt(r,this,"off"),nt(s,this,"off"),s=qe(this,s),this.off("dispose",s),i.nodeName?(He(i,r,s),He(i,"dispose",s)):tt(i)&&(i.off(r,s),i.off("dispose",s))}},trigger(e,t){it(this.eventBusEl_,this,"trigger");const s=e&&"string"!=typeof e?e.type:e;if(!st(s))throw new Error(`Invalid event type for ${et(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return Ve(this.eventBusEl_,e,t)}};function ht(e,t={}){const{eventBusKey:s}=t;if(s){if(!e[s].nodeName)throw new Error(`The eventBusKey "${s}" does not refer to an element.`);e.eventBusEl_=e[s]}else e.eventBusEl_=Q("span",{className:"vjs-event-bus"});return Object.assign(e,lt),e.eventedCallbacks&&e.eventedCallbacks.forEach((e=>{e()})),e.on("dispose",(()=>{e.off(),[e,e.el_,e.eventBusEl_].forEach((function(e){e&&xe.has(e)&&xe.delete(e)})),window.setTimeout((()=>{e.eventBusEl_=null}),0)})),e}const ct={state:{},setState(e){let t;return"function"==typeof e&&(e=e()),f(e,((e,s)=>{this.state[s]!==e&&(t=t||{},t[s]={from:this.state[s],to:e}),this.state[s]=e})),t&&tt(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function dt(e,t){return Object.assign(e,ct),e.state=Object.assign({},e.state,t),"function"==typeof e.handleStateChanged&&tt(e)&&e.on("statechanged",e.handleStateChanged),e}const ut=function(e){return"string"!=typeof e?e:e.replace(/./,(e=>e.toLowerCase()))},pt=function(e){return"string"!=typeof e?e:e.replace(/./,(e=>e.toUpperCase()))},ft=function(e,t){return pt(e)===pt(t)};var gt=Object.freeze({__proto__:null,toLowerCase:ut,toTitleCase:pt,titleCaseEquals:ft});class mt{constructor(e,t,s){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=v({},this.options_),t=this.options_=v(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const t=e&&e.id&&e.id()||"no_player";this.id_=`${t}_component_${Me()}`}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach((e=>this.addClass(e))),["on","off","one","any","trigger"].forEach((e=>{this[e]=void 0})),!1!==t.evented&&(ht(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),dt(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(s),!1!==t.reportTouchActivity&&this.enableTouchActivity()}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return Boolean(this.isDisposed_)}player(){return this.player_}options(e){return e?(this.options_=v(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,s){return Q(e,t,s)}localize(e,t,s=e){const i=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),n=r&&r[i],a=i&&i.split("-")[0],o=r&&r[a];let l=s;return n&&n[e]?l=n[e]:o&&o[e]&&(l=o[e]),t&&(l=l.replace(/\{(\d+)\}/g,(function(e,s){const i=t[s-1];let r=i;return void 0===i&&(r=e),r}))),l}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce(((e,t)=>e.concat(t)),[]);let t=this;for(let s=0;s<e.length;s++)if(t=t.getChild(e[s]),!t||!t.getChild)return;return t}setIcon(e,t=this.el()){if(!this.player_.options_.experimentalSvgIcons)return;const s="http://www.w3.org/2000/svg",i=Q("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),r=document.createElementNS(s,"svg");r.setAttributeNS(null,"viewBox","0 0 512 512");const n=document.createElementNS(s,"use");return r.appendChild(n),n.setAttributeNS(null,"href",`#vjs-icon-${e}`),i.appendChild(r),this.iconIsSet_?t.replaceChild(i,t.querySelector(".vjs-icon-placeholder")):t.appendChild(i),this.iconIsSet_=!0,i}addChild(e,t={},s=this.children_.length){let i,r;if("string"==typeof e){r=pt(e);const s=t.componentClass||r;t.name=r;const n=mt.getComponent(s);if(!n)throw new Error(`Component ${s} does not exist`);if("function"!=typeof n)return null;i=new n(this.player_||this,t)}else i=e;if(i.parentComponent_&&i.parentComponent_.removeChild(i),this.children_.splice(s,0,i),i.parentComponent_=this,"function"==typeof i.id&&(this.childIndex_[i.id()]=i),r=r||i.name&&pt(i.name()),r&&(this.childNameIndex_[r]=i,this.childNameIndex_[ut(r)]=i),"function"==typeof i.el&&i.el()){let e=null;this.children_[s+1]&&(this.children_[s+1].el_?e=this.children_[s+1].el_:q(this.children_[s+1])&&(e=this.children_[s+1])),this.contentEl().insertBefore(i.el(),e)}return i}removeChild(e){if("string"==typeof e&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let s=this.children_.length-1;s>=0;s--)if(this.children_[s]===e){t=!0,this.children_.splice(s,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[pt(e.name())]=null,this.childNameIndex_[ut(e.name())]=null;const s=e.el();s&&s.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,s=e=>{const s=e.name;let i=e.opts;if(void 0!==t[s]&&(i=t[s]),!1===i)return;!0===i&&(i={}),i.playerOptions=this.options_.playerOptions;const r=this.addChild(s,i);r&&(this[s]=r)};let i;const r=mt.getComponent("Tech");i=Array.isArray(e)?e:Object.keys(e),i.concat(Object.keys(this.options_).filter((function(e){return!i.some((function(t){return"string"==typeof t?e===t:e===t.name}))}))).map((t=>{let s,i;return"string"==typeof t?(s=t,i=e[s]||this.options_[s]||{}):(s=t.name,i=t),{name:s,opts:i}})).filter((e=>{const t=mt.getComponent(e.opts.componentClass||pt(e.name));return t&&!r.isTech(t)})).forEach(s)}}buildCSSClass(){return""}ready(e,t=!1){if(e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))}triggerReady(){this.isReady_=!0,this.setTimeout((function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach((function(e){e.call(this)}),this),this.trigger("ready")}),1)}$(e,t){return be(e,t||this.contentEl())}$$(e,t){return Te(e,t||this.contentEl())}hasClass(e){return ee(this.el_,e)}addClass(...e){te(this.el_,...e)}removeClass(...e){se(this.el_,...e)}toggleClass(e,t){ie(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return ae(this.el_,e)}setAttribute(e,t){oe(this.el_,e,t)}removeAttribute(e){le(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,s){if(void 0!==t)return null!==t&&t==t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(s||this.trigger("componentresize"));if(!this.el_)return 0;const i=this.el_.style[e],r=i.indexOf("px");return-1!==r?parseInt(i.slice(0,r),10):parseInt(this.el_["offset"+pt(e)],10)}currentDimension(e){let t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=Ae(this.el_,e),t=parseFloat(t),0===t||isNaN(t)){const s=`offset${pt(e)}`;t=this.el_[s]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}getPositions(){const e=this.el_.getBoundingClientRect();return{boundingClientRect:{x:e.x,y:e.y,width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left},center:{x:e.left+e.width/2,y:e.top+e.height/2,width:0,height:0,top:e.top+e.height/2,right:e.left+e.width/2,bottom:e.top+e.height/2,left:e.left+e.width/2}}}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&("Tab"===e.key||this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled||e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;let s;this.on("touchstart",(function(i){1===i.touches.length&&(t={pageX:i.touches[0].pageX,pageY:i.touches[0].pageY},e=window.performance.now(),s=!0)})),this.on("touchmove",(function(e){if(e.touches.length>1)s=!1;else if(t){const i=e.touches[0].pageX-t.pageX,r=e.touches[0].pageY-t.pageY;Math.sqrt(i*i+r*r)>10&&(s=!1)}}));const i=function(){s=!1};this.on("touchleave",i),this.on("touchcancel",i),this.on("touchend",(function(i){t=null,!0===s&&window.performance.now()-e<200&&(i.preventDefault(),this.trigger("tap"))}))}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=qe(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",(function(){e(),this.clearInterval(t),t=this.setInterval(e,250)}));const s=function(s){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",s),this.on("touchcancel",s)}setTimeout(e,t){var s;return e=qe(this,e),this.clearTimersOnDispose_(),s=window.setTimeout((()=>{this.setTimeoutIds_.has(s)&&this.setTimeoutIds_.delete(s),e()}),t),this.setTimeoutIds_.add(s),s}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),window.clearTimeout(e)),e}setInterval(e,t){e=qe(this,e),this.clearTimersOnDispose_();const s=window.setInterval(e,t);return this.setIntervalIds_.add(s),s}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),window.clearInterval(e)),e}requestAnimationFrame(e){var t;return this.clearTimersOnDispose_(),e=qe(this,e),t=window.requestAnimationFrame((()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()})),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){this.namedRafs_.has(e)&&this.cancelNamedAnimationFrame(e),this.clearTimersOnDispose_(),t=qe(this,t);const s=this.requestAnimationFrame((()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)}));return this.namedRafs_.set(e,s),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),window.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",(()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach((([e,t])=>{this[e].forEach(((e,s)=>this[t](s)))})),this.clearingTimersOnDispose_=!1})))}getIsDisabled(){return Boolean(this.el_.disabled)}getIsExpresslyInert(){return this.el_.inert&&!this.el_.ownerDocument.documentElement.inert}getIsFocusable(e){return(e||this.el_).tabIndex>=0&&!(this.getIsDisabled()||this.getIsExpresslyInert())}getIsAvailableToBeFocused(e){function t(e){const t=window.getComputedStyle(e,null),s=t.getPropertyValue("visibility");return"none"!==t.getPropertyValue("display")&&!["hidden","collapse"].includes(s)}return e||(e=this.el()),!(!function(e){if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let s=document.elementFromPoint(t.x,t.y);for(;s;){if(s===e)return!0;if(!s.parentNode)return!1;s=s.parentNode}}(e)||(s=e,!t(s.parentElement)||!t(s)||"0"===s.style.opacity||"0px"===window.getComputedStyle(s).height||"0px"===window.getComputedStyle(s).width)||e.parentElement&&!(e.tabIndex>=0));var s}static registerComponent(e,t){if("string"!=typeof e||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const s=mt.getComponent("Tech"),i=s&&s.isTech(t),r=mt===t||mt.prototype.isPrototypeOf(t.prototype);if(i||!r){let t;throw t=i?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error(`Illegal component, "${e}"; ${t}.`)}e=pt(e),mt.components_||(mt.components_={});const n=mt.getComponent("Player");if("Player"===e&&n&&n.players){const e=n.players,t=Object.keys(e);if(e&&t.length>0)for(let s=0;s<t.length;s++)if(null!==e[t[s]])throw new Error("Can not register Player component after player has been created.")}return mt.components_[e]=t,mt.components_[ut(e)]=t,t}static getComponent(e){if(e&&mt.components_)return mt.components_[e]}}function yt(e,t,s,i){return function(e,t,s){if("number"!=typeof t||t<0||t>s)throw new Error(`Failed to execute '${e}' on 'TimeRanges': The index provided (${t}) is non-numeric or out of bounds (0-${s}).`)}(e,i,s.length-1),s[i][t]}function vt(e){let t;return t=void 0===e||0===e.length?{length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:yt.bind(null,"start",0,e),end:yt.bind(null,"end",1,e)},window.Symbol&&window.Symbol.iterator&&(t[window.Symbol.iterator]=()=>(e||[]).values()),t}function _t(e,t){return Array.isArray(e)?vt(e):void 0===e||void 0===t?vt():vt([[e,t]])}mt.registerComponent("Component",mt);const bt=function(e,t){e=e<0?0:e;let s=Math.floor(e%60),i=Math.floor(e/60%60),r=Math.floor(e/3600);const n=Math.floor(t/60%60),a=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(r=i=s="-"),r=r>0||a>0?r+":":"",i=((r||n>=10)&&i<10?"0"+i:i)+":",s=s<10?"0"+s:s,r+i+s};let Tt=bt;function At(e){Tt=e}function Et(){Tt=bt}function St(e,t=e){return Tt(e,t)}var Ct=Object.freeze({__proto__:null,createTimeRanges:_t,createTimeRange:_t,setFormatTime:At,resetFormatTime:Et,formatTime:St});function wt(e,t){let s,i,r=0;if(!t)return 0;e&&e.length||(e=_t(0,0));for(let n=0;n<e.length;n++)s=e.start(n),i=e.end(n),i>t&&(i=t),r+=i-s;return r/t}function kt(e){if(e instanceof kt)return e;"number"==typeof e?this.code=e:"string"==typeof e?this.message=e:m(e)&&("number"==typeof e.code&&(this.code=e.code),Object.assign(this,e)),this.message||(this.message=kt.defaultMessages[this.code]||"")}function Lt(e){return null!=e&&"function"==typeof e.then}function It(e){Lt(e)&&e.then(null,(e=>{}))}kt.prototype.code=0,kt.prototype.message="",kt.prototype.status=null,kt.prototype.metadata=null,kt.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],kt.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."},kt.MEDIA_ERR_CUSTOM=0,kt.prototype.MEDIA_ERR_CUSTOM=0,kt.MEDIA_ERR_ABORTED=1,kt.prototype.MEDIA_ERR_ABORTED=1,kt.MEDIA_ERR_NETWORK=2,kt.prototype.MEDIA_ERR_NETWORK=2,kt.MEDIA_ERR_DECODE=3,kt.prototype.MEDIA_ERR_DECODE=3,kt.MEDIA_ERR_SRC_NOT_SUPPORTED=4,kt.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED=4,kt.MEDIA_ERR_ENCRYPTED=5,kt.prototype.MEDIA_ERR_ENCRYPTED=5;const Pt=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(((t,s,i)=>(e[s]&&(t[s]=e[s]),t)),{cues:e.cues&&Array.prototype.map.call(e.cues,(function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}}))})};var Rt=function(e){const t=e.$$("track"),s=Array.prototype.map.call(t,(e=>e.track));return Array.prototype.map.call(t,(function(e){const t=Pt(e.track);return e.src&&(t.src=e.src),t})).concat(Array.prototype.filter.call(e.textTracks(),(function(e){return-1===s.indexOf(e)})).map(Pt))},xt=function(e,t){return e.forEach((function(e){const s=t.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach((e=>s.addCue(e)))})),t.textTracks()},Dt=Pt;const Ot="vjs-modal-dialog";class Mt extends mt{constructor(e,t){super(e,t),this.handleKeyDown_=e=>this.handleKeyDown(e),this.close_=e=>this.close(e),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=Q("div",{className:`${Ot}-content`},{role:"document"}),this.descEl_=Q("p",{className:`${Ot}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),Z(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog","aria-live":"polite"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${Ot} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(this.opened_)return void(this.options_.fillAlways&&this.fill());const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}opened(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger({type:"modalclose",bubbles:!0}),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if("boolean"==typeof e){const t=this.closeable_=!!e;let s=this.getChild("closeButton");if(t&&!s){const e=this.contentEl_;this.contentEl_=this.el_,s=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=e,this.on(s,"close",this.close_)}!t&&s&&(this.off(s,"close",this.close_),this.removeChild(s),s.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),s=t.parentNode,i=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,s.removeChild(t),this.empty(),ve(t,e),this.trigger("modalfill"),i?s.insertBefore(t,i):s.appendChild(t);const r=this.getChild("closeButton");r&&s.appendChild(r.el_),this.trigger("aftermodalfill")}empty(){this.trigger("beforemodalempty"),ge(this.contentEl()),this.trigger("modalempty")}content(e){return void 0!==e&&(this.content_=e),this.content_}conditionalFocus_(){const e=document.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(this.trigger({type:"modalKeydown",originalEvent:e,target:this,bubbles:!0}),e.stopPropagation(),"Escape"===e.key&&this.closeable())return e.preventDefault(),void this.close();if("Tab"!==e.key)return;const t=this.focusableEls_(),s=this.el_.querySelector(":focus");let i;for(let e=0;e<t.length;e++)if(s===t[e]){i=e;break}document.activeElement===this.el_&&(i=0),e.shiftKey&&0===i?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||i!==t.length-1||(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,(e=>(e instanceof window.HTMLAnchorElement||e instanceof window.HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof window.HTMLInputElement||e instanceof window.HTMLSelectElement||e instanceof window.HTMLTextAreaElement||e instanceof window.HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof window.HTMLIFrameElement||e instanceof window.HTMLObjectElement||e instanceof window.HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable")))}}Mt.prototype.options_={pauseOnOpen:!0,temporary:!0},mt.registerComponent("ModalDialog",Mt);class Nt extends Je{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},tt(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let s=0,i=this.length;s<i;s++)if(this[s]===e){t=this[s],t.off&&t.off(),this.tracks_.splice(s,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let s=0,i=this.length;s<i;s++){const i=this[s];if(i.id===e){t=i;break}}return t}}Nt.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const e in Nt.prototype.allowedEvents_)Nt.prototype["on"+e]=null;const Ft=function(e,t){for(let s=0;s<e.length;s++)Object.keys(e[s]).length&&t.id!==e[s].id&&(e[s].enabled=!1)};class Bt extends Nt{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){Ft(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&Ft(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,Ft(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const jt=function(e,t){for(let s=0;s<e.length;s++)Object.keys(e[s]).length&&t.id!==e[s].id&&(e[s].selected=!1)};class Ut extends Nt{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){jt(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set(){}})}addTrack(e){e.selected&&jt(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,jt(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class $t extends Nt{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_),-1===["metadata","chapters"].indexOf(e.kind)&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}toJSON(){return this.tracks_.map((e=>e.toJSON()))}}class Ht{constructor(e){Ht.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let s=0;const i=e.length;this.cues_=e,this.length_=e.length;const r=function(e){""+e in this||Object.defineProperty(this,""+e,{get(){return this.cues_[e]}})};if(t<i)for(s=t;s<i;s++)r.call(this,s)}getCueById(e){let t=null;for(let s=0,i=this.length;s<i;s++){const i=this[s];if(i.id===e){t=i;break}}return t}}const Vt={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},Gt={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},Wt={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},zt={disabled:"disabled",hidden:"hidden",showing:"showing"};class Kt extends Je{constructor(e={}){super();const t={id:e.id||"vjs_track_"+Me(),kind:e.kind||"",language:e.language||""};let s=e.label||"";for(const e in t)Object.defineProperty(this,e,{get:()=>t[e],set(){}});Object.defineProperty(this,"label",{get:()=>s,set(e){e!==s&&(s=e,this.trigger("labelchange"))}})}}const qt=function(e){return new URL(e,document.baseURI)},Yt=function(e){return new URL(e,document.baseURI).href},Xt=function(e){if("string"==typeof e){const t=e.split("?")[0].replace(/\/+$/,"").match(/\.([^.\/]+)$/);return t?t[1].toLowerCase():""}return""},Qt=function(e,t=window.location){return qt(e).origin!==t.origin};var Zt=Object.freeze({__proto__:null,parseUrl:qt,getAbsoluteURL:Yt,getFileExtension:Xt,isCrossOrigin:Qt}),Jt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==s.g?s.g:"undefined"!=typeof self?self:{};function es(e,t){return e(t={exports:{}},t.exports),t.exports}var ts,ss="undefined"!=typeof window?window:void 0!==Jt?Jt:"undefined"!=typeof self?self:{},is=es((function(e){function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)({}).hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}));(ts=is)&&ts.__esModule&&Object.prototype.hasOwnProperty.call(ts,"default")&&ts.default;var rs=function(e){if(!e)return!1;var t=ns.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)},ns=Object.prototype.toString;function as(e,t){var s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return(s=s.call(e)).next.bind(s);if(Array.isArray(e)||(s=function(e,t){if(e){if("string"==typeof e)return os(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?os(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){s&&(e=s);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function os(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}var ls=function(){function e(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1}var t=e.prototype;return t.getIsEnabled=function(){return this.enabled_},t.enable=function(){this.enabled_=!0},t.disable=function(){this.enabled_=!1},t.reset=function(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1},t.addInterceptor=function(e,t){this.typeToInterceptorsMap_.has(e)||this.typeToInterceptorsMap_.set(e,new Set);var s=this.typeToInterceptorsMap_.get(e);return!s.has(t)&&(s.add(t),!0)},t.removeInterceptor=function(e,t){var s=this.typeToInterceptorsMap_.get(e);return!(!s||!s.has(t)||(s.delete(t),0))},t.clearInterceptorsByType=function(e){return!!this.typeToInterceptorsMap_.get(e)&&(this.typeToInterceptorsMap_.delete(e),this.typeToInterceptorsMap_.set(e,new Set),!0)},t.clear=function(){return!!this.typeToInterceptorsMap_.size&&(this.typeToInterceptorsMap_=new Map,!0)},t.getForType=function(e){return this.typeToInterceptorsMap_.get(e)||new Set},t.execute=function(e,t){for(var s,i=as(this.getForType(e));!(s=i()).done;){var r=s.value;try{t=r(t)}catch(e){}}return t},e}(),hs=function(){function e(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1}var t=e.prototype;return t.getIsEnabled=function(){return this.enabled_},t.enable=function(){this.enabled_=!0},t.disable=function(){this.enabled_=!1},t.reset=function(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1},t.getMaxAttempts=function(){return this.maxAttempts_},t.setMaxAttempts=function(e){this.maxAttempts_=e},t.getDelayFactor=function(){return this.delayFactor_},t.setDelayFactor=function(e){this.delayFactor_=e},t.getFuzzFactor=function(){return this.fuzzFactor_},t.setFuzzFactor=function(e){this.fuzzFactor_=e},t.getInitialDelay=function(){return this.initialDelay_},t.setInitialDelay=function(e){this.initialDelay_=e},t.createRetry=function(e){var t=void 0===e?{}:e,s=t.maxAttempts,i=t.delayFactor,r=t.fuzzFactor,n=t.initialDelay;return new cs({maxAttempts:s||this.maxAttempts_,delayFactor:i||this.delayFactor_,fuzzFactor:r||this.fuzzFactor_,initialDelay:n||this.initialDelay_})},e}(),cs=function(){function e(e){this.maxAttempts_=e.maxAttempts,this.delayFactor_=e.delayFactor,this.fuzzFactor_=e.fuzzFactor,this.currentDelay_=e.initialDelay,this.currentAttempt_=1}var t=e.prototype;return t.moveToNextAttempt=function(){this.currentAttempt_++;var e=this.currentDelay_*this.delayFactor_;this.currentDelay_=this.currentDelay_+e},t.shouldRetry=function(){return this.currentAttempt_<this.maxAttempts_},t.getCurrentDelay=function(){return this.currentDelay_},t.getCurrentMinPossibleDelay=function(){return(1-this.fuzzFactor_)*this.currentDelay_},t.getCurrentMaxPossibleDelay=function(){return(1+this.fuzzFactor_)*this.currentDelay_},t.getCurrentFuzzedDelay=function(){var e=this.getCurrentMinPossibleDelay(),t=this.getCurrentMaxPossibleDelay();return e+Math.random()*(t-e)},e}(),ds=hs;ms.httpHandler=function(e,t){return void 0===t&&(t=!1),function(s,i,r){if(s)e(s);else if(i.statusCode>=400&&i.statusCode<=599){var n=r;if(t)if(ss.TextDecoder){var a=(void 0===(o=i.headers&&i.headers["content-type"])&&(o=""),o.toLowerCase().split(";").reduce((function(e,t){var s=t.split("="),i=s[0],r=s[1];return"charset"===i.trim()?r.trim():e}),"utf-8"));try{n=new TextDecoder(a).decode(r)}catch(e){}}else n=String.fromCharCode.apply(null,new Uint8Array(r));e({cause:n})}else e(null,r);var o}},ms.requestInterceptorsStorage=new ls,ms.responseInterceptorsStorage=new ls,ms.retryManager=new ds;var us=function(e){var t={};return e?(e.trim().split("\n").forEach((function(e){var s=e.indexOf(":"),i=e.slice(0,s).trim().toLowerCase(),r=e.slice(s+1).trim();void 0===t[i]?t[i]=r:Array.isArray(t[i])?t[i].push(r):t[i]=[t[i],r]})),t):t},ps=ms,fs=ms;function gs(e,t,s){var i=e;return rs(t)?(s=t,"string"==typeof e&&(i={uri:e})):i=is({},t,{uri:e}),i.callback=s,i}function ms(e,t,s){return ys(t=gs(e,t,s))}function ys(e){if(void 0===e.callback)throw new Error("callback argument missing");if(e.requestType&&ms.requestInterceptorsStorage.getIsEnabled()){var t={uri:e.uri||e.url,headers:e.headers||{},body:e.body,metadata:e.metadata||{},retry:e.retry,timeout:e.timeout},s=ms.requestInterceptorsStorage.execute(e.requestType,t);e.uri=s.uri,e.headers=s.headers,e.body=s.body,e.metadata=s.metadata,e.retry=s.retry,e.timeout=s.timeout}var i=!1,r=function(t,s,r){i||(i=!0,e.callback(t,s,r))};function n(){var e=void 0;if(e=c.response?c.response:c.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(c),y)try{e=JSON.parse(e)}catch(e){}return e}function a(t){if(clearTimeout(d),clearTimeout(e.retryTimeout),t instanceof Error||(t=new Error(""+(t||"Unknown XMLHttpRequest Error"))),t.statusCode=0,h||!ms.retryManager.getIsEnabled()||!e.retry||!e.retry.shouldRetry()){if(e.requestType&&ms.responseInterceptorsStorage.getIsEnabled()){var s={headers:v.headers||{},body:v.body,responseUrl:c.responseURL,responseType:c.responseType},i=ms.responseInterceptorsStorage.execute(e.requestType,s);v.body=i.body,v.headers=i.headers}return r(t,v)}e.retryTimeout=setTimeout((function(){e.retry.moveToNextAttempt(),e.xhr=c,ys(e)}),e.retry.getCurrentFuzzedDelay())}function o(){if(!h){var t;clearTimeout(d),clearTimeout(e.retryTimeout),t=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var s=v,i=null;if(0!==t?(s={body:n(),statusCode:t,method:p,headers:{},url:u,rawRequest:c},c.getAllResponseHeaders&&(s.headers=us(c.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),e.requestType&&ms.responseInterceptorsStorage.getIsEnabled()){var a={headers:s.headers||{},body:s.body,responseUrl:c.responseURL,responseType:c.responseType},o=ms.responseInterceptorsStorage.execute(e.requestType,a);s.body=o.body,s.headers=o.headers}return r(i,s,s.body)}}var l,h,c=e.xhr||null;c||(c=e.cors||e.useXDR?new ms.XDomainRequest:new ms.XMLHttpRequest);var d,u=c.url=e.uri||e.url,p=c.method=e.method||"GET",f=e.body||e.data,g=c.headers=e.headers||{},m=!!e.sync,y=!1,v={body:void 0,headers:{},statusCode:0,method:p,url:u,rawRequest:c};if("json"in e&&!1!==e.json&&(y=!0,g.accept||g.Accept||(g.Accept="application/json"),"GET"!==p&&"HEAD"!==p&&(g["content-type"]||g["Content-Type"]||(g["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),c.onreadystatechange=function(){4!==c.readyState||ms.responseInterceptorsStorage.getIsEnabled()||setTimeout(o,0)},c.onload=o,c.onerror=a,c.onprogress=function(){},c.onabort=function(){h=!0,clearTimeout(e.retryTimeout)},c.ontimeout=a,c.open(p,u,!m,e.username,e.password),m||(c.withCredentials=!!e.withCredentials),!m&&e.timeout>0&&(d=setTimeout((function(){if(!h){h=!0,c.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",a(e)}}),e.timeout)),c.setRequestHeader)for(l in g)g.hasOwnProperty(l)&&c.setRequestHeader(l,g[l]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(f||null),c}ms.XMLHttpRequest=ss.XMLHttpRequest||function(){},ms.XDomainRequest="withCredentials"in new ms.XMLHttpRequest?ms.XMLHttpRequest:ss.XDomainRequest,function(e,t){for(var s=0;s<e.length;s++)t(e[s])}(["get","put","post","patch","head","delete"],(function(e){ms["delete"===e?"del":e]=function(t,s,i){return(s=gs(t,s,i)).method=e.toUpperCase(),ys(s)}})),ps.default=fs;const vs=function(e,t){const s=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()),i=[];s.oncue=function(e){t.addCue(e)},s.onparsingerror=function(e){i.push(e)},s.onflush=function(){t.trigger({type:"loadeddata",target:t})},s.parse(e),i.length>0&&(window.console&&window.console.groupCollapsed&&window.console.groupCollapsed(`Text Track parsing errors for ${t.src}`),i.forEach((e=>c.error(e))),window.console&&window.console.groupEnd&&window.console.groupEnd()),s.flush()},_s=function(e,t){const s={uri:e},i=Qt(e);i&&(s.cors=i);const r="use-credentials"===t.tech_.crossOrigin();r&&(s.withCredentials=r),ps(s,qe(this,(function(e,s,i){if(e)return c.error(e,s);t.loaded_=!0,"function"!=typeof window.WebVTT?t.tech_&&t.tech_.any(["vttjsloaded","vttjserror"],(e=>{if("vttjserror"!==e.type)return vs(i,t);c.error(`vttjs failed to load, stopping trying to process ${t.src}`)})):vs(i,t)})))};class bs extends Kt{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=v(e,{kind:Wt[e.kind]||"subtitles",language:e.language||e.srclang||""});let s=zt[t.mode]||"disabled";const i=t.default;"metadata"!==t.kind&&"chapters"!==t.kind||(s="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=!1!==this.tech_.preloadTextTracks;const r=new Ht(this.cues_),n=new Ht(this.activeCues_);let a=!1;this.timeupdateHandler=qe(this,(function(e={}){this.tech_.isDisposed()||(this.tech_.isReady_?(this.activeCues=this.activeCues,a&&(this.trigger("cuechange"),a=!1),"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))):"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)))}));this.tech_.one("dispose",(()=>{this.stopTracking()})),"disabled"!==s&&this.startTracking(),Object.defineProperties(this,{default:{get:()=>i,set(){}},mode:{get:()=>s,set(e){zt[e]&&s!==e&&(s=e,this.preload_||"disabled"===s||0!==this.cues.length||_s(this.src,this),this.stopTracking(),"disabled"!==s&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?r:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(0===this.cues.length)return n;const e=this.tech_.currentTime(),t=[];for(let s=0,i=this.cues.length;s<i;s++){const i=this.cues[s];i.startTime<=e&&i.endTime>=e&&t.push(i)}if(a=!1,t.length!==this.activeCues_.length)a=!0;else for(let e=0;e<t.length;e++)-1===this.activeCues_.indexOf(t[e])&&(a=!0);return this.activeCues_=t,n.setCues_(this.activeCues_),n},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||"subtitles"!==t.kind&&"captions"!==t.kind)&&_s(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(!("getCueAsHTML"in t)){t=new window.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const s in e)s in t||(t[s]=e[s]);t.id=e.id,t.originalCue_=e}const s=this.tech_.textTracks();for(let e=0;e<s.length;e++)s[e]!==this&&s[e].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}toJSON(){return Dt(this)}removeCue(e){let t=this.cues_.length;for(;t--;){const s=this.cues_[t];if(s===e||s.originalCue_&&s.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}bs.prototype.allowedEvents_={cuechange:"cuechange"};class Ts extends Kt{constructor(e={}){const t=v(e,{kind:Gt[e.kind]||""});super(t);let s=!1;Object.defineProperty(this,"enabled",{get:()=>s,set(e){"boolean"==typeof e&&e!==s&&(s=e,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class As extends Kt{constructor(e={}){const t=v(e,{kind:Vt[e.kind]||""});super(t);let s=!1;Object.defineProperty(this,"selected",{get:()=>s,set(e){"boolean"==typeof e&&e!==s&&(s=e,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class Es extends Je{constructor(e={}){let t;super();const s=new bs(e);this.kind=s.kind,this.src=s.src,this.srclang=s.language,this.label=s.label,this.default=s.default,Object.defineProperties(this,{readyState:{get:()=>t},track:{get:()=>s}}),t=Es.NONE,s.addEventListener("loadeddata",(()=>{t=Es.LOADED,this.trigger({type:"load",target:this})}))}}Es.prototype.allowedEvents_={load:"load"},Es.NONE=0,Es.LOADING=1,Es.LOADED=2,Es.ERROR=3;const Ss={audio:{ListClass:Bt,TrackClass:Ts,capitalName:"Audio"},video:{ListClass:Ut,TrackClass:As,capitalName:"Video"},text:{ListClass:$t,TrackClass:bs,capitalName:"Text"}};Object.keys(Ss).forEach((function(e){Ss[e].getterName=`${e}Tracks`,Ss[e].privateName=`${e}Tracks_`}));const Cs={remoteText:{ListClass:$t,TrackClass:bs,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:class{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,s=e.length;t<s;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let s=0,i=this.trackElements_.length;s<i;s++)if(e===this.trackElements_[s].track){t=this.trackElements_[s];break}return t}removeTrackElement_(e){for(let t=0,s=this.trackElements_.length;t<s;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"==typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"==typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}},TrackClass:Es,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},ws=Object.assign({},Ss,Cs);Cs.names=Object.keys(Cs),Ss.names=Object.keys(Ss),ws.names=[].concat(Cs.names).concat(Ss.names);var ks,Ls=void 0!==Jt?Jt:"undefined"!=typeof window?window:{};"undefined"!=typeof document?ks=document:(ks=Ls["__GLOBAL_DOCUMENT_CACHE@4"])||(ks=Ls["__GLOBAL_DOCUMENT_CACHE@4"]={});var Is=ks,Ps=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function Rs(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function xs(e){function t(e,t,s,i){return 3600*(0|e)+60*(0|t)+(0|s)+(0|i)/1e3}var s=e.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return s?s[3]?t(s[1],s[2],s[3].replace(":",""),s[4]):s[1]>59?t(s[1],s[2],0,s[4]):t(0,s[1],s[2],s[4]):null}function Ds(){this.values=Ps(null)}function Os(e,t,s,i){var r=i?e.split(i):[e];for(var n in r)if("string"==typeof r[n]){var a=r[n].split(s);2===a.length&&t(a[0].trim(),a[1].trim())}}function Ms(e,t,s){var i=e;function r(){var t=xs(e);if(null===t)throw new Rs(Rs.Errors.BadTimeStamp,"Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function n(){e=e.replace(/^\s+/,"")}if(n(),t.startTime=r(),n(),"--\x3e"!==e.substr(0,3))throw new Rs(Rs.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),n(),t.endTime=r(),n(),function(e,t){var i=new Ds;Os(e,(function(e,t){switch(e){case"region":for(var r=s.length-1;r>=0;r--)if(s[r].id===t){i.set(e,s[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var n=t.split(","),a=n[0];i.integer(e,a),i.percent(e,a)&&i.set("snapToLines",!1),i.alt(e,a,["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start","center","end"]);break;case"position":n=t.split(","),i.percent(e,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start","center","end"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start","center","end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");try{t.line=i.get("line","auto")}catch(e){}t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100);try{t.align=i.get("align","center")}catch(e){t.align=i.get("align","middle")}try{t.position=i.get("position","auto")}catch(e){t.position=i.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},t.align)}t.positionAlign=i.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},t.align)}(e,t)}Rs.prototype=Ps(Error.prototype),Rs.prototype.constructor=Rs,Rs.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},Ds.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,s){for(var i=0;i<s.length;++i)if(t===s[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var Ns=Is.createElement&&Is.createElement("textarea"),Fs={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},Bs={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},js={v:"title",lang:"lang"},Us={rt:"ruby"};function $s(e,t){function s(){if(!t)return null;var e,s=t.match(/^([^<]*)(<[^>]*>?)?/);return e=s[1]?s[1]:s[2],t=t.substr(e.length),e}function i(e,t){return!Us[t.localName]||Us[t.localName]===e.localName}function r(t,s){var i=Fs[t];if(!i)return null;var r=e.document.createElement(i),n=js[t];return n&&s&&(r[n]=s.trim()),r}for(var n,a=e.document.createElement("div"),o=a,l=[];null!==(n=s());)if("<"!==n[0])o.appendChild(e.document.createTextNode((p=n,Ns.innerHTML=p,p=Ns.textContent,Ns.textContent="",p)));else{if("/"===n[1]){l.length&&l[l.length-1]===n.substr(2).replace(">","")&&(l.pop(),o=o.parentNode);continue}var h,c=xs(n.substr(1,n.length-2));if(c){h=e.document.createProcessingInstruction("timestamp",c),o.appendChild(h);continue}var d=n.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!d)continue;if(!(h=r(d[1],d[3])))continue;if(!i(o,h))continue;if(d[2]){var u=d[2].split(".");u.forEach((function(e){var t=/^bg_/.test(e),s=t?e.slice(3):e;if(Bs.hasOwnProperty(s)){var i=t?"background-color":"color",r=Bs[s];h.style[i]=r}})),h.className=u.join(" ")}l.push(d[1]),o.appendChild(h),o=h}var p;return a}var Hs=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function Vs(e){for(var t=0;t<Hs.length;t++){var s=Hs[t];if(e>=s[0]&&e<=s[1])return!0}return!1}function Gs(e){var t=[],s="";if(!e||!e.childNodes)return"ltr";function i(e,t){for(var s=t.childNodes.length-1;s>=0;s--)e.push(t.childNodes[s])}function r(e){if(!e||!e.length)return null;var t=e.pop(),s=t.textContent||t.innerText;if(s){var n=s.match(/^.*(\n|\r)/);return n?(e.length=0,n[0]):s}return"ruby"===t.tagName?r(e):t.childNodes?(i(e,t),r(e)):void 0}for(i(t,e);s=r(t);)for(var n=0;n<s.length;n++)if(Vs(s.charCodeAt(n)))return"rtl";return"ltr"}function Ws(){}function zs(e,t,s){Ws.call(this),this.cue=t,this.cueDiv=$s(e,t.text);var i={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(i,this.cueDiv),this.div=e.document.createElement("div"),i={direction:Gs(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:s.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(i),this.div.appendChild(this.cueDiv);var r=0;switch(t.positionAlign){case"start":case"line-left":r=t.position;break;case"center":r=t.position-t.size/2;break;case"end":case"line-right":r=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(r,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(r,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function Ks(e){var t,s,i,r;if(e.div){s=e.div.offsetHeight,i=e.div.offsetWidth,r=e.div.offsetTop;var n=(n=e.div.childNodes)&&(n=n[0])&&n.getClientRects&&n.getClientRects();e=e.div.getBoundingClientRect(),t=n?Math.max(n[0]&&n[0].height||0,e.height/n.length):0}this.left=e.left,this.right=e.right,this.top=e.top||r,this.height=e.height||s,this.bottom=e.bottom||r+(e.height||s),this.width=e.width||i,this.lineHeight=void 0!==t?t:e.lineHeight}function qs(e,t,s,i){var r=new Ks(t),n=t.cue,a=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,s=t.textTrackList,i=0,r=0;r<s.length&&s[r]!==t;r++)"showing"===s[r].mode&&i++;return-1*++i}(n),o=[];if(n.snapToLines){var l;switch(n.vertical){case"":o=["+y","-y"],l="height";break;case"rl":o=["+x","-x"],l="width";break;case"lr":o=["-x","+x"],l="width"}var h=r.lineHeight,c=h*Math.round(a),d=s[l]+h,u=o[0];Math.abs(c)>d&&(c=c<0?-1:1,c*=Math.ceil(d/h)*h),a<0&&(c+=""===n.vertical?s.height:s.width,o=o.reverse()),r.move(u,c)}else{var p=r.lineHeight/s.height*100;switch(n.lineAlign){case"center":a-=p/2;break;case"end":a-=p}switch(n.vertical){case"":t.applyStyles({top:t.formatStyle(a,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(a,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(a,"%")})}o=["+y","-x","+x","-y"],r=new Ks(t)}var f=function(e,t){for(var r,n=new Ks(e),a=1,o=0;o<t.length;o++){for(;e.overlapsOppositeAxis(s,t[o])||e.within(s)&&e.overlapsAny(i);)e.move(t[o]);if(e.within(s))return e;var l=e.intersectPercentage(s);a>l&&(r=new Ks(e),a=l),e=new Ks(n)}return r||n}(r,o);t.move(f.toCSSCompatValues(s))}function Ys(){}Ws.prototype.applyStyles=function(e,t){for(var s in t=t||this.div,e)e.hasOwnProperty(s)&&(t.style[s]=e[s])},Ws.prototype.formatStyle=function(e,t){return 0===e?0:e+t},zs.prototype=Ps(Ws.prototype),zs.prototype.constructor=zs,Ks.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},Ks.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},Ks.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},Ks.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},Ks.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},Ks.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},Ks.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},Ks.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,s=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,i=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||i,height:e.height||t,bottom:e.bottom||i+(e.height||t),width:e.width||s}},Ys.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},Ys.convertCueToDOMTree=function(e,t){return e&&t?$s(e,t):null};Ys.processCues=function(e,t,s){if(!e||!t||!s)return null;for(;s.firstChild;)s.removeChild(s.firstChild);var i=e.document.createElement("div");if(i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0",i.style.margin="1.5%",s.appendChild(i),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var r=[],n=Ks.getSimpleBoxPosition(i),a={font:Math.round(.05*n.height*100)/100+"px sans-serif"};!function(){for(var s,o,l=0;l<t.length;l++)o=t[l],s=new zs(e,o,a),i.appendChild(s.div),qs(0,s,n,r),o.displayState=s.div,r.push(Ks.getSimpleBoxPosition(s))}()}else for(var o=0;o<t.length;o++)i.appendChild(t[o].displayState)},Ys.Parser=function(e,t,s){s||(s=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=s||new TextDecoder("utf8"),this.regionList=[]},Ys.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof Rs))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function s(){for(var e=t.buffer,s=0;s<e.length&&"\r"!==e[s]&&"\n"!==e[s];)++s;var i=e.substr(0,s);return"\r"===e[s]&&++s,"\n"===e[s]&&++s,t.buffer=e.substr(s),i}function i(e){e.match(/X-TIMESTAMP-MAP/)?Os(e,(function(e,s){"X-TIMESTAMP-MAP"===e&&function(e){var s=new Ds;Os(e,(function(e,t){switch(e){case"MPEGT":s.integer(e+"S",t);break;case"LOCA":s.set(e+"L",xs(t))}}),/[^\d]:/,/,/),t.ontimestampmap&&t.ontimestampmap({MPEGTS:s.get("MPEGTS"),LOCAL:s.get("LOCAL")})}(s)}),/=/):Os(e,(function(e,s){"Region"===e&&function(e){var s=new Ds;if(Os(e,(function(e,t){switch(e){case"id":s.set(e,t);break;case"width":s.percent(e,t);break;case"lines":s.integer(e,t);break;case"regionanchor":case"viewportanchor":var i=t.split(",");if(2!==i.length)break;var r=new Ds;if(r.percent("x",i[0]),r.percent("y",i[1]),!r.has("x")||!r.has("y"))break;s.set(e+"X",r.get("x")),s.set(e+"Y",r.get("y"));break;case"scroll":s.alt(e,t,["up"])}}),/=/,/\s/),s.has("id")){var i=new(t.vttjs.VTTRegion||t.window.VTTRegion);i.width=s.get("width",100),i.lines=s.get("lines",3),i.regionAnchorX=s.get("regionanchorX",0),i.regionAnchorY=s.get("regionanchorY",100),i.viewportAnchorX=s.get("viewportanchorX",0),i.viewportAnchorY=s.get("viewportanchorY",100),i.scroll=s.get("scroll",""),t.onregion&&t.onregion(i),t.regionList.push({id:s.get("id"),region:i})}}(s)}),/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var r;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var n=(r=s()).match(/^WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Rs(Rs.Errors.BadSignature);t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:r=s(),t.state){case"HEADER":/:/.test(r)?i(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,"");try{t.cue.align="center"}catch(e){t.cue.align="middle"}if(t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{Ms(r,t.cue,t.regionList)}catch(e){t.reportOrThrowError(e),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var o=-1!==r.indexOf("--\x3e");if(!r||o&&(a=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":r||(t.state="ID");continue}}}catch(e){t.reportOrThrowError(e),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new Rs(Rs.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}};var Xs=Ys,Qs={"":1,lr:1,rl:1},Zs={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function Js(e){return"string"==typeof e&&!!Zs[e.toLowerCase()]&&e.toLowerCase()}function ei(e,t,s){this.hasBeenReset=!1;var i="",r=!1,n=e,a=t,o=s,l=null,h="",c=!0,d="auto",u="start",p="auto",f="auto",g=100,m="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return i},set:function(e){i=""+e}},pauseOnExit:{enumerable:!0,get:function(){return r},set:function(e){r=!!e}},startTime:{enumerable:!0,get:function(){return n},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");n=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");a=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return o},set:function(e){o=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return l},set:function(e){l=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return h},set:function(e){var t=function(e){return"string"==typeof e&&!!Qs[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===t)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");h=t,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return c},set:function(e){c=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return d},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("Line: an invalid number or illegal string was specified.");d=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return u},set:function(e){var t=Js(e);t?(u=t,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return p},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");p=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return f},set:function(e){var t=Js(e);t?(f=t,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return g},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");g=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return m},set:function(e){var t=Js(e);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");m=t,this.hasBeenReset=!0}}}),this.displayState=void 0}ei.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var ti=ei,si={"":!0,up:!0};function ii(e){return"number"==typeof e&&e>=0&&e<=100}var ri=function(){var e=100,t=3,s=0,i=100,r=0,n=100,a="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!ii(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return t},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");t=e}},regionAnchorY:{enumerable:!0,get:function(){return i},set:function(e){if(!ii(e))throw new Error("RegionAnchorX must be between 0 and 100.");i=e}},regionAnchorX:{enumerable:!0,get:function(){return s},set:function(e){if(!ii(e))throw new Error("RegionAnchorY must be between 0 and 100.");s=e}},viewportAnchorY:{enumerable:!0,get:function(){return n},set:function(e){if(!ii(e))throw new Error("ViewportAnchorY must be between 0 and 100.");n=e}},viewportAnchorX:{enumerable:!0,get:function(){return r},set:function(e){if(!ii(e))throw new Error("ViewportAnchorX must be between 0 and 100.");r=e}},scroll:{enumerable:!0,get:function(){return a},set:function(e){var t=function(e){return"string"==typeof e&&!!si[e.toLowerCase()]&&e.toLowerCase()}(e);!1===t?console.warn("Scroll: an invalid or illegal string was specified."):a=t}}})},ni=es((function(e){var t=e.exports={WebVTT:Xs,VTTCue:ti,VTTRegion:ri};ss.vttjs=t,ss.WebVTT=t.WebVTT;var s=t.VTTCue,i=t.VTTRegion,r=ss.VTTCue,n=ss.VTTRegion;t.shim=function(){ss.VTTCue=s,ss.VTTRegion=i},t.restore=function(){ss.VTTCue=r,ss.VTTRegion=n},ss.VTTCue||t.shim()}));ni.WebVTT,ni.VTTCue,ni.VTTRegion;class ai extends mt{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=e=>this.onDurationChange(e),this.trackProgress_=e=>this.trackProgress(e),this.trackCurrentTime_=e=>this.trackCurrentTime(e),this.stopTrackingCurrentTime_=e=>this.stopTrackingCurrentTime(e),this.disposeSourceHandler_=e=>this.disposeSourceHandler(e),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",(function(){this.hasStarted_=!0})),this.on("loadstart",(function(){this.hasStarted_=!1})),ws.names.forEach((t=>{const s=ws[t];e&&e[s.getterName]&&(this[s.privateName]=e[s.getterName])})),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach((t=>{!1===e[`native${t}Tracks`]&&(this[`featuresNative${t}Tracks`]=!1)})),!1===e.nativeCaptions||!1===e.nativeTextTracks?this.featuresNativeTextTracks=!1:!0!==e.nativeCaptions&&!0!==e.nativeTextTracks||(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=!1!==e.preloadTextTracks,this.autoRemoteTextTracks_=new ws.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",(()=>this.setTimeout((()=>this.triggerSourceset(e)),1))),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(qe(this,(function(){const e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()})),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return _t(0,0)}bufferedPercent(){return wt(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval((function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}),250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(Ss.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){(e=[].concat(e)).forEach((e=>{const t=this[`${e}Tracks`]()||[];let s=t.length;for(;s--;){const i=t[s];"text"===e&&this.removeRemoteTextTrack(i),t.removeTrack(i)}}))}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const s=e[t];this.removeRemoteTextTrack(s)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return void 0!==e&&(this.error_=new kt(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?_t(0,0):_t()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){Ss.names.forEach((e=>{const t=Ss[e],s=()=>{this.trigger(`${e}trackchange`)},i=this[t.getterName]();i.addEventListener("removetrack",s),i.addEventListener("addtrack",s),this.on("dispose",(()=>{i.removeEventListener("removetrack",s),i.removeEventListener("addtrack",s)}))}))}addWebVttScript_(){if(!window.WebVTT)if(document.body.contains(this.el())){if(!this.options_["vtt.js"]&&y(ni)&&Object.keys(ni).length>0)return void this.trigger("vttjsloaded");const e=document.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",(()=>{e.onload=null,e.onerror=null})),window.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),s=t=>e.addTrack(t.track),i=t=>e.removeTrack(t.track);t.on("addtrack",s),t.on("removetrack",i),this.addWebVttScript_();const r=()=>this.trigger("texttrackchange"),n=()=>{r();for(let t=0;t<e.length;t++){const s=e[t];s.removeEventListener("cuechange",r),"showing"===s.mode&&s.addEventListener("cuechange",r)}};n(),e.addEventListener("change",n),e.addEventListener("addtrack",n),e.addEventListener("removetrack",n),this.on("dispose",(function(){t.off("addtrack",s),t.off("removetrack",i),e.removeEventListener("change",n),e.removeEventListener("addtrack",n),e.removeEventListener("removetrack",n);for(let t=0;t<e.length;t++)e[t].removeEventListener("cuechange",r)}))}addTextTrack(e,t,s){if(!e)throw new Error("TextTrack kind is required but was not provided");return function(e,t,s,i,r={}){const n=e.textTracks();r.kind=t,s&&(r.label=s),i&&(r.language=i),r.tech=e;const a=new ws.text.TrackClass(r);return n.addTrack(a),a}(this,e,t,s)}createRemoteTextTrack(e){const t=v(e,{tech:this});return new Cs.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const s=this.createRemoteTextTrack(e);return"boolean"!=typeof t&&(t=!1),this.remoteTextTrackEls().addTrackElement_(s),this.remoteTextTracks().addTrack(s.track),!1===t&&this.ready((()=>this.autoRemoteTextTracks_.addTrack(s.track))),s}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=Me();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",(()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())}))):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return ai.canPlayType(e.type)}static isTech(e){return e.prototype instanceof ai||e instanceof ai||e===ai}static registerTech(e,t){if(ai.techs_||(ai.techs_={}),!ai.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!ai.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!ai.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=pt(e),ai.techs_[e]=t,ai.techs_[ut(e)]=t,"Tech"!==e&&ai.defaultTechOrder_.push(e),t}static getTech(e){if(e)return ai.techs_&&ai.techs_[e]?ai.techs_[e]:(e=pt(e),window&&window.videojs&&window.videojs[e]?(c.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),window.videojs[e]):void 0)}}ws.names.forEach((function(e){const t=ws[e];ai.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}})),ai.prototype.featuresVolumeControl=!0,ai.prototype.featuresMuteControl=!0,ai.prototype.featuresFullscreenResize=!1,ai.prototype.featuresPlaybackRate=!1,ai.prototype.featuresProgressEvents=!1,ai.prototype.featuresSourceset=!1,ai.prototype.featuresTimeupdateEvents=!1,ai.prototype.featuresNativeTextTracks=!1,ai.prototype.featuresVideoFrameCallback=!1,ai.withSourceHandlers=function(e){e.registerSourceHandler=function(t,s){let i=e.sourceHandlers;i||(i=e.sourceHandlers=[]),void 0===s&&(s=i.length),i.splice(s,0,t)},e.canPlayType=function(t){const s=e.sourceHandlers||[];let i;for(let e=0;e<s.length;e++)if(i=s[e].canPlayType(t),i)return i;return""},e.selectSourceHandler=function(t,s){const i=e.sourceHandlers||[];let r;for(let e=0;e<i.length;e++)if(r=i[e].canHandleSource(t,s),r)return i[e];return null},e.canPlaySource=function(t,s){const i=e.selectSourceHandler(t,s);return i?i.canHandleSource(t,s):""},["seekable","seeking","duration"].forEach((function(e){const t=this[e];"function"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})}),e.prototype),e.prototype.setSource=function(t){let s=e.selectSourceHandler(t,this.options_);s||(e.nativeSourceHandler?s=e.nativeSourceHandler:c.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),s!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=s.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},mt.registerComponent("Tech",ai),ai.registerTech("Tech",ai),ai.defaultTechOrder_=[];const oi={},li={},hi={};function ci(e,t,s){e.setTimeout((()=>mi(t,oi[t.type],s,e)),1)}function di(e,t,s,i=null){const r="call"+pt(s),n=e.reduce(gi(r),i),a=n===hi,o=a?null:t[s](n);return function(e,t,s,i){for(let r=e.length-1;r>=0;r--){const n=e[r];n[t]&&n[t](i,s)}}(e,s,o,a),o}const ui={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},pi={setCurrentTime:1,setMuted:1,setVolume:1},fi={play:1,pause:1};function gi(e){return(t,s)=>t===hi?hi:s[e]?s[e](t):t}function mi(e={},t=[],s,i,r=[],n=!1){const[a,...o]=t;if("string"==typeof a)mi(e,oi[a],s,i,r,n);else if(a){const t=function(e,t){const s=li[e.id()];let i=null;if(null==s)return i=t(e),li[e.id()]=[[t,i]],i;for(let e=0;e<s.length;e++){const[r,n]=s[e];r===t&&(i=n)}return null===i&&(i=t(e),s.push([t,i])),i}(i,a);if(!t.setSource)return r.push(t),mi(e,o,s,i,r,n);t.setSource(Object.assign({},e),(function(a,l){if(a)return mi(e,o,s,i,r,n);r.push(t),mi(l,e.type===l.type?o:oi[l.type],s,i,r,n)}))}else o.length?mi(e,o,s,i,r,n):n?s(e,r):mi(e,oi["*"],s,i,r,!0)}const yi={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},vi=function(e=""){const t=Xt(e);return yi[t.toLowerCase()]||""},_i=function(e){if(Array.isArray(e)){let t=[];e.forEach((function(e){e=_i(e),Array.isArray(e)?t=t.concat(e):m(e)&&t.push(e)})),e=t}else e="string"==typeof e&&e.trim()?[bi({src:e})]:m(e)&&"string"==typeof e.src&&e.src&&e.src.trim()?[bi(e)]:[];return e};function bi(e){if(!e.type){const t=vi(e.src);t&&(e.type=t)}return e}const Ti=B?10009:j?461:8,Ai={codes:{play:415,pause:19,ff:417,rw:412,back:Ti},names:{415:"play",19:"pause",417:"ff",412:"rw",[Ti]:"back"},isEventKey(e,t){return t=t.toLowerCase(),!(!this.names[e.keyCode]||this.names[e.keyCode]!==t)},getEventName(e){if(this.names[e.keyCode])return this.names[e.keyCode];if(this.codes[e.code]){const t=this.codes[e.code];return this.names[t]}return null}};class Ei extends Je{constructor(e){super(),this.player_=e,this.focusableComponents=[],this.isListening_=!1,this.isPaused_=!1,this.onKeyDown_=this.onKeyDown_.bind(this),this.lastFocusedComponent_=null}start(){this.isListening_||(this.player_.on("keydown",this.onKeyDown_),this.player_.on("modalKeydown",this.onKeyDown_),this.player_.on("loadedmetadata",(()=>{this.focus(this.updateFocusableComponents()[0])})),this.player_.on("modalclose",(()=>{this.refocusComponent()})),this.player_.on("focusin",this.handlePlayerFocus_.bind(this)),this.player_.on("focusout",this.handlePlayerBlur_.bind(this)),this.isListening_=!0,this.player_.errorDisplay&&this.player_.errorDisplay.on("aftermodalfill",(()=>{this.updateFocusableComponents(),this.focusableComponents.length&&(this.focusableComponents.length>1?this.focusableComponents[1].focus():this.focusableComponents[0].focus())})))}stop(){this.player_.off("keydown",this.onKeyDown_),this.isListening_=!1}onKeyDown_(e){const t=e.originalEvent?e.originalEvent:e;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)){if(this.isPaused_)return;t.preventDefault();const e=t.key.substring(5).toLowerCase();this.move(e)}else if(Ai.isEventKey(t,"play")||Ai.isEventKey(t,"pause")||Ai.isEventKey(t,"ff")||Ai.isEventKey(t,"rw")){t.preventDefault();const e=Ai.getEventName(t);this.performMediaAction_(e)}else Ai.isEventKey(t,"Back")&&e.target&&"function"==typeof e.target.closeable&&e.target.closeable()&&(t.preventDefault(),e.target.close())}performMediaAction_(e){if(this.player_)switch(e){case"play":this.player_.paused()&&this.player_.play();break;case"pause":this.player_.paused()||this.player_.pause();break;case"ff":this.userSeek_(this.player_.currentTime()+5);break;case"rw":this.userSeek_(this.player_.currentTime()-5)}}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}pause(){this.isPaused_=!0}resume(){this.isPaused_=!1}handlePlayerBlur_(e){const t=e.relatedTarget;let s=null;const i=this.getCurrentComponent(e.target);t&&(s=Boolean(t.closest(".video-js")),t.classList.contains("vjs-text-track-settings")&&!this.isPaused_&&this.searchForTrackSelect_()),(e.currentTarget.contains(e.relatedTarget)||s)&&t||(i&&"CloseButton"===i.name()?this.refocusComponent():(this.pause(),i&&i.el()&&(this.lastFocusedComponent_=i)))}handlePlayerFocus_(){this.getCurrentComponent()&&this.getCurrentComponent().getIsFocusable()&&this.resume()}updateFocusableComponents(){const e=this.player_,t=[];function s(e){for(const i of e)i.hasOwnProperty("el_")&&i.getIsFocusable()&&i.getIsAvailableToBeFocused(i.el())&&t.push(i),i.hasOwnProperty("children_")&&i.children_.length>0&&s(i.children_)}return e.children_.forEach((e=>{if(e.hasOwnProperty("el_")){if(e.getIsFocusable&&e.getIsAvailableToBeFocused&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el()))return void t.push(e);e.hasOwnProperty("children_")&&e.children_.length>0?s(e.children_):e.hasOwnProperty("items")&&e.items.length>0?s(e.items):this.findSuitableDOMChild(e)&&t.push(e)}if("ErrorDisplay"===e.name_&&e.opened_){const s=e.el_.querySelector(".vjs-errors-ok-button-container");s&&s.querySelectorAll("button").forEach(((e,s)=>{t.push({name:()=>"ModalButton"+(s+1),el:()=>e,getPositions:()=>{const t=e.getBoundingClientRect();return{boundingClientRect:{x:t.x,y:t.y,width:t.width,height:t.height,top:t.top,right:t.right,bottom:t.bottom,left:t.left},center:{x:t.left+t.width/2,y:t.top+t.height/2,width:0,height:0,top:t.top+t.height/2,right:t.left+t.width/2,bottom:t.top+t.height/2,left:t.left+t.width/2}}},getIsAvailableToBeFocused:()=>!0,getIsFocusable:e=>!0,focus:()=>e.focus()})}))}})),this.focusableComponents=t,this.focusableComponents}findSuitableDOMChild(e){return e.el()?function t(s){if(e.getIsFocusable(s)&&e.getIsAvailableToBeFocused(s))return s;for(let e=0;e<s.children.length;e++){const i=t(s.children[e]);if(i)return i}return null}(e.el()):null}getCurrentComponent(e){this.updateFocusableComponents();const t=e||document.activeElement;if(this.focusableComponents.length)for(const e of this.focusableComponents)if(e.el()===t)return e}add(e){const t=[...this.focusableComponents];e.hasOwnProperty("el_")&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el())&&t.push(e),this.focusableComponents=t,this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}remove(e){for(let t=0;t<this.focusableComponents.length;t++)if(this.focusableComponents[t].name()===e.name())return this.focusableComponents.splice(t,1),void this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}clear(){this.focusableComponents.length>0&&(this.focusableComponents=[],this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents}))}move(e){const t=this.getCurrentComponent();if(!t)return;const s=t.getPositions(),i=this.focusableComponents.filter((i=>i!==t&&this.isInDirection_(s.boundingClientRect,i.getPositions().boundingClientRect,e))),r=this.findBestCandidate_(s.center,i,e);r?this.focus(r):this.trigger({type:"endOfFocusableComponents",direction:e,focusedComponent:t})}findBestCandidate_(e,t,s){let i=1/0,r=null;for(const n of t){const t=n.getPositions().center,a=this.calculateDistance_(e,t,s);a<i&&(i=a,r=n)}return r}isInDirection_(e,t,s){switch(s){case"right":return t.left>=e.right;case"left":return t.right<=e.left;case"down":return t.top>=e.bottom;case"up":return t.bottom<=e.top;default:return!1}}refocusComponent(){if(this.lastFocusedComponent_){this.player_.userActive()||this.player_.userActive(!0),this.updateFocusableComponents();for(let e=0;e<this.focusableComponents.length;e++)if(this.focusableComponents[e].name()===this.lastFocusedComponent_.name())return void this.focus(this.focusableComponents[e])}else this.focus(this.updateFocusableComponents()[0])}focus(e){"object"==typeof e&&(e.getIsAvailableToBeFocused(e.el())?e.focus():this.findSuitableDOMChild(e)&&this.findSuitableDOMChild(e).focus())}calculateDistance_(e,t,s){const i=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);let n;switch(s){case"right":case"left":n=i+100*r;break;case"up":n=2*r+.5*i;break;case"down":n=5*r+i;break;default:n=i+r}return n}searchForTrackSelect_(){const e=this;for(const t of e.updateFocusableComponents())if("TextTrackSelect"===t.constructor.name){e.focus(t);break}}}mt.registerComponent("MediaLoader",class extends mt{constructor(e,t,s){if(super(e,v({createEl:!1},t),s),t.playerOptions.sources&&0!==t.playerOptions.sources.length)e.src(t.playerOptions.sources);else for(let s=0,i=t.playerOptions.techOrder;s<i.length;s++){const t=pt(i[s]);let r=ai.getTech(t);if(t||(r=mt.getComponent(t)),r&&r.isSupported()){e.loadTech_(t);break}}}});class Si extends mt{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=e=>this.handleMouseOver(e),this.handleMouseOut_=e=>this.handleMouseOut(e),this.handleClick_=e=>this.handleClick(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.emitTapEvents(),this.enable()}createEl(e="div",t={},s={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),"button"===e&&c.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),s=Object.assign({role:"button"},s),this.tabIndex_=t.tabIndex;const i=Q(e,t,s);return this.player_.options_.experimentalSvgIcons||i.appendChild(Q("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(i),i}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=Q("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(void 0===e)return this.controlText_||"Need Text";const s=this.localize(e);this.controlText_=e,Z(this.controlTextEl_,s),this.nonIconControl||this.player_.options_.noUITitleAttributes||t.setAttribute("title",s)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){" "===e.key||"Enter"===e.key?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}mt.registerComponent("ClickableComponent",Si);class Ci extends Si{constructor(e,t){super(e,t),this.update(),this.update_=e=>this.update(e),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return Q("div",{className:"vjs-poster"})}crossOrigin(e){if(void 0===e)return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;null===e||"anonymous"===e||"use-credentials"===e?this.$("img")&&(this.$("img").crossOrigin=e):this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){e?(this.$("img")||this.el_.appendChild(Q("picture",{className:"vjs-poster",tabIndex:-1},{},Q("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e):this.el_.textContent=""}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?It(this.player_.play()):this.player_.pause())}}Ci.prototype.crossorigin=Ci.prototype.crossOrigin,mt.registerComponent("PosterImage",Ci);const wi="#222",ki="#ccc",Li={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Ii(e,t){let s;if(4===e.length)s=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");s=e.slice(1)}return"rgba("+parseInt(s.slice(0,2),16)+","+parseInt(s.slice(2,4),16)+","+parseInt(s.slice(4,6),16)+","+t+")"}function Pi(e,t,s){try{e.style[t]=s}catch(e){return}}function Ri(e){return e?`${e}px`:""}mt.registerComponent("TextTrackDisplay",class extends mt{constructor(e,t,s){super(e,t,s);const i=e=>this.updateDisplay(e),r=e=>{this.updateDisplayOverlay(),this.updateDisplay(e)};e.on("loadstart",(e=>this.toggleDisplay(e))),e.on("useractive",i),e.on("userinactive",i),e.on("texttrackchange",i),e.on("loadedmetadata",(e=>{this.updateDisplayOverlay(),this.preselectTrack(e)})),e.ready(qe(this,(function(){if(e.tech_&&e.tech_.featuresNativeTextTracks)return void this.hide();e.on("fullscreenchange",r),e.on("playerresize",r);const t=window.screen.orientation||window,s=window.screen.orientation?"change":"orientationchange";t.addEventListener(s,r),e.on("dispose",(()=>t.removeEventListener(s,r)));const i=this.options_.playerOptions.tracks||[];for(let e=0;e<i.length;e++)this.player_.addRemoteTextTrack(i[e],!0);this.preselectTrack()})))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),s=this.player_.cache_.selectedLanguage;let i,r,n;for(let a=0;a<t.length;a++){const o=t[a];s&&s.enabled&&s.language&&s.language===o.language&&o.kind in e?o.kind===s.kind?n=o:n||(n=o):s&&!s.enabled?(n=null,i=null,r=null):o.default&&("descriptions"!==o.kind||i?o.kind in e&&!r&&(r=o):i=o)}n?n.mode="showing":r?r.mode="showing":i&&(i.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){"function"==typeof window.WebVTT&&window.WebVTT.processCues(window,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const t=[];for(let s=0;s<e.length;++s){const i=e[s];"showing"===i.mode&&t.push(i)}return void this.updateForTrack(t)}let s=null,i=null,r=e.length;for(;r--;){const t=e[r];"showing"===t.mode&&("descriptions"===t.kind?s=t:i=t)}if(i?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(i)):s&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(s)),!window.CSS.supports("inset","10px")){const e=this.el_,t=e.querySelectorAll(".vjs-text-track-cue"),s=this.player_.controlBar.el_.getBoundingClientRect().height,i=this.player_.el_.getBoundingClientRect().height;e.style="",Pi(e,"position","relative"),Pi(e,"height",i-s+"px"),Pi(e,"top","unset"),Pi(e,"bottom",U?i+"px":"0px"),t.length>0&&t.forEach((e=>{if(e.style.inset){const t=e.style.inset.split(" ");3===t.length&&Object.assign(e.style,{top:t[0],right:t[1],bottom:t[2],left:"unset"})}}))}}updateDisplayOverlay(){if(!this.player_.videoHeight()||!window.CSS.supports("inset-inline: 10px"))return;const e=this.player_.currentWidth(),t=this.player_.currentHeight(),s=e/t,i=this.player_.videoWidth()/this.player_.videoHeight();let r=0,n=0;Math.abs(s-i)>.1&&(s>i?r=Math.round((e-t*i)/2):n=Math.round((t-e/i)/2)),Pi(this.el_,"insetInline",Ri(r)),Pi(this.el_,"insetBlock",Ri(n))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),s=e.activeCues;let i=s.length;for(;i--;){const e=s[i];if(!e)continue;const r=e.displayState;if(t.color&&(r.firstChild.style.color=t.color),t.textOpacity&&Pi(r.firstChild,"color",Ii(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(r.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&Pi(r.firstChild,"backgroundColor",Ii(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?Pi(r,"backgroundColor",Ii(t.windowColor,t.windowOpacity)):r.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?r.firstChild.style.textShadow=`2px 2px 3px ${wi}, 2px 2px 4px ${wi}, 2px 2px 5px ${wi}`:"raised"===t.edgeStyle?r.firstChild.style.textShadow=`1px 1px ${wi}, 2px 2px ${wi}, 3px 3px ${wi}`:"depressed"===t.edgeStyle?r.firstChild.style.textShadow=`1px 1px ${ki}, 0 1px ${ki}, -1px -1px ${wi}, 0 -1px ${wi}`:"uniform"===t.edgeStyle&&(r.firstChild.style.textShadow=`0 0 4px ${wi}, 0 0 4px ${wi}, 0 0 4px ${wi}, 0 0 4px ${wi}`)),t.fontPercent&&1!==t.fontPercent){const e=window.parseFloat(r.style.fontSize);r.style.fontSize=e*t.fontPercent+"px",r.style.height="auto",r.style.top="auto"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?r.firstChild.style.fontVariant="small-caps":r.firstChild.style.fontFamily=Li[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),"function"!=typeof window.WebVTT||e.every((e=>!e.activeCues)))return;const t=[];for(let s=0;s<e.length;++s){const i=e[s];for(let e=0;e<i.activeCues.length;++e)t.push(i.activeCues[e])}window.WebVTT.processCues(window,t,this.el_);for(let t=0;t<e.length;++t){const s=e[t];for(let e=0;e<s.activeCues.length;++e){const i=s.activeCues[e].displayState;te(i,"vjs-text-track-cue","vjs-text-track-cue-"+(s.language?s.language:t)),s.language&&oe(i,"lang",s.language)}this.player_.textTrackSettings&&this.updateDisplayState(s)}}});mt.registerComponent("LoadingSpinner",class extends mt{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),s=Q("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),i=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return i.appendChild(s),i}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}});class xi extends Si{createEl(e,t={},s={}){const i=Q("button",t=Object.assign({className:this.buildCSSClass()},t),s=Object.assign({type:"button"},s));return this.player_.options_.experimentalSvgIcons||i.appendChild(Q("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(i),i}addChild(e,t={}){const s=this.constructor.name;return c.warn(`Adding an actionable (user controllable) child to a Button (${s}) is not supported; use a ClickableComponent instead.`),mt.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){" "!==e.key&&"Enter"!==e.key?super.handleKeyDown(e):e.stopPropagation()}}mt.registerComponent("Button",xi);class Di extends xi{constructor(e,t){super(e,t),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",(e=>this.handleMouseDown(e)))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if("tap"===e.type||this.mouseused_&&"clientX"in e&&"clientY"in e)return It(t),void(this.player_.tech(!0)&&this.player_.tech(!0).focus());const s=this.player_.getChild("controlBar"),i=s&&s.getChild("playToggle");if(!i)return void this.player_.tech(!0).focus();const r=()=>i.focus();Lt(t)?t.then(r,(()=>{})):this.setTimeout(r,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}Di.prototype.controlText_="Play Video",mt.registerComponent("BigPlayButton",Di);mt.registerComponent("CloseButton",class extends xi{constructor(e,t){super(e,t),this.setIcon("cancel"),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){"Escape"===e.key?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}});class Oi extends xi{constructor(e,t={}){super(e,t),t.replay=void 0===t.replay||t.replay,this.setIcon("play"),this.on(e,"play",(e=>this.handlePlay(e))),this.on(e,"pause",(e=>this.handlePause(e))),t.replay&&this.on(e,"ended",(e=>this.handleEnded(e)))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?It(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",(e=>this.handleSeeked(e)))}}Oi.prototype.controlText_="Play",mt.registerComponent("PlayToggle",Oi);class Mi extends mt{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended","seeking"],(e=>this.update(e))),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),s=Q("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)} `},{role:"presentation"});return t.appendChild(s),this.contentEl_=Q("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){(this.player_.options_.enableSmoothSeeking||"seeking"!==e.type)&&this.updateContent(e)}updateTextNode_(e=0){e=St(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",(()=>{if(!this.contentEl_)return;let e=this.textNode_;e&&this.contentEl_.firstChild!==e&&(e=null,c.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=document.createTextNode(this.formattedTime_),this.textNode_&&(e?this.contentEl_.replaceChild(this.textNode_,e):this.contentEl_.appendChild(this.textNode_))})))}updateContent(e){}}Mi.prototype.labelText_="Time",Mi.prototype.controlText_="Time",mt.registerComponent("TimeDisplay",Mi);class Ni extends Mi{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;t=this.player_.ended()?this.player_.duration():e&&e.target&&"function"==typeof e.target.pendingSeekTime?e.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}Ni.prototype.labelText_="Current Time",Ni.prototype.controlText_="Current Time",mt.registerComponent("CurrentTimeDisplay",Ni);class Fi extends Mi{constructor(e,t){super(e,t);const s=e=>this.updateContent(e);this.on(e,"durationchange",s),this.on(e,"loadstart",s),this.on(e,"loadedmetadata",s)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}Fi.prototype.labelText_="Duration",Fi.prototype.controlText_="Duration",mt.registerComponent("DurationDisplay",Fi);mt.registerComponent("TimeDivider",class extends mt{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),s=super.createEl("span",{textContent:"/"});return t.appendChild(s),e.appendChild(t),e}});class Bi extends Mi{constructor(e,t){super(e,t),this.on(e,"durationchange",(e=>this.updateContent(e)))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return!1!==this.options_.displayNegative&&e.insertBefore(Q("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if("number"!=typeof this.player_.duration())return;let t;t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t)}}Bi.prototype.labelText_="Remaining Time",Bi.prototype.controlText_="Remaining Time",mt.registerComponent("RemainingTimeDisplay",Bi);mt.registerComponent("LiveDisplay",class extends mt{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",(e=>this.updateShowing(e)))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Q("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(Q("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")} `})),this.contentEl_.appendChild(document.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}});class ji extends xi{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=e=>this.updateLiveEdgeStatus(e),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=Q("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}function Ui(e,t,s){return e=Number(e),Math.min(s,Math.max(t,isNaN(e)?t:e))}ji.prototype.controlText_="Seek to live, currently playing live",mt.registerComponent("SeekToLive",ji);var $i=Object.freeze({__proto__:null,clamp:Ui});class Hi extends mt{constructor(e,t){super(e,t),this.handleMouseDown_=e=>this.handleMouseDown(e),this.handleMouseUp_=e=>this.handleMouseUp(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.handleClick_=e=>this.handleClick(e),this.handleMouseMove_=e=>this.handleMouseMove(e),this.update_=e=>this.update(e),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},s={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),s=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},s),super.createEl(e,t,s)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||I||e.preventDefault(),he(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;ce(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",(()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(100*e).toFixed(2)+"%"}))),e}getProgress(){return Number(Ui(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=pe(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){const t=this.options_.playerOptions.spatialNavigation,s=t&&t.enabled,i=t&&t.horizontalSeek;s?i&&"ArrowLeft"===e.key||!i&&"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepBack()):i&&"ArrowRight"===e.key||!i&&"ArrowUp"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(this.pendingSeekTime()&&(this.pendingSeekTime(null),this.userSeek_(this.player_.currentTime())),super.handleKeyDown(e)):"ArrowLeft"===e.key||"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepBack()):"ArrowUp"===e.key||"ArrowRight"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}mt.registerComponent("Slider",Hi);const Vi=(e,t)=>Ui(e/t*100,0,100).toFixed(2)+"%";mt.registerComponent("LoadProgressBar",class extends mt{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",(e=>this.update(e)))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=Q("span",{className:"vjs-control-text"}),s=Q("span",{textContent:this.localize("Loaded")}),i=document.createTextNode(": ");return this.percentageEl_=Q("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(s),t.appendChild(i),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",(()=>{const e=this.player_.liveTracker,t=this.player_.buffered(),s=e&&e.isLive()?e.seekableEnd():this.player_.duration(),i=this.player_.bufferedEnd(),r=this.partEls_,n=Vi(i,s);this.percent_!==n&&(this.el_.style.width=n,Z(this.percentageEl_,n),this.percent_=n);for(let e=0;e<t.length;e++){const s=t.start(e),n=t.end(e);let a=r[e];a||(a=this.el_.appendChild(Q()),r[e]=a),a.dataset.start===s&&a.dataset.end===n||(a.dataset.start=s,a.dataset.end=n,a.style.left=Vi(s,i),a.style.width=Vi(n-s,i))}for(let e=r.length;e>t.length;e--)this.el_.removeChild(r[e-1]);r.length=t.length}))}});mt.registerComponent("TimeTooltip",class extends mt{constructor(e,t){super(e,t),this.update=Ye(qe(this,this.update),Ke)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,s){const i=ue(this.el_),r=de(this.player_.el()),n=e.width*t;if(!r||!i)return;let a=e.left-r.left+n,o=e.width-n+(r.right-e.right);o||(o=e.width-n,a=n);let l=i.width/2;a<l?l+=l-a:o<l&&(l=o),l<0?l=0:l>i.width&&(l=i.width),l=Math.round(l),this.el_.style.right=`-${l}px`,this.write(s)}write(e){Z(this.el_,e)}updateTime(e,t,s,i){this.requestNamedAnimationFrame("TimeTooltip#updateTime",(()=>{let r;const n=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const e=this.player_.liveTracker.liveWindow(),s=e-t*e;r=(s<1?"":"-")+St(s,e)}else r=St(s,n);this.update(e,t,r),i&&i()}))}});class Gi extends mt{constructor(e,t){super(e,t),this.setIcon("circle"),this.update=Ye(qe(this,this.update),Ke)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t,s){const i=this.getChild("timeTooltip");if(!i)return;const r=s&&s.target&&"function"==typeof s.target.pendingSeekTime?s.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();i.updateTime(e,t,r)}}Gi.prototype.options_={children:[]},V||C||Gi.prototype.options_.children.push("timeTooltip"),mt.registerComponent("PlayProgressBar",Gi);class Wi extends mt{constructor(e,t){super(e,t),this.update=Ye(qe(this,this.update),Ke)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const s=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,s,(()=>{this.el_.style.left=e.width*t+"px"}))}}Wi.prototype.options_={children:["timeTooltip"]},mt.registerComponent("MouseTimeDisplay",Wi);class zi extends Hi{constructor(e,t){(t=v(zi.prototype.options_,t)).children=[...t.children];const s=e.options_.disableSeekWhileScrubbingOnMobile&&(V||C)||e.options_.disableSeekWhileScrubbingOnSTV;(!V&&!C||s)&&t.children.splice(1,0,"mouseTimeDisplay"),super(e,t),this.shouldDisableSeekWhileScrubbing_=s,this.pendingSeekTime_=null,this.setEventHandlers_()}setEventHandlers_(){this.update_=qe(this,this.update),this.update=Ye(this.update_,Ke),this.on(this.player_,["durationchange","timeupdate"],this.update),this.on(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document&&"visibilityState"in document&&this.on(document,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){"hidden"===document.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,Ke))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if("hidden"===document.visibilityState)return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",(()=>{const s=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),i=this.player_.liveTracker;let r=this.player_.duration();i&&i.isLive()&&(r=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(100*t).toFixed(2)),this.percent_=t),this.currentTime_===s&&this.duration_===r||(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[St(s,r),St(r,r)],"{1} of {2}")),this.currentTime_=s,this.duration_=r),this.bar&&this.bar.update(de(this.el()),this.getProgress(),e)})),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}pendingSeekTime(e){if(void 0!==e)if(null!==e){const t=this.player_.duration();this.pendingSeekTime_=Math.max(0,Math.min(e,t))}else this.pendingSeekTime_=null;return this.pendingSeekTime_}getPercent(){if(null!==this.pendingSeekTime())return this.pendingSeekTime()/this.player_.duration();const e=this.getCurrentTime_();let t;const s=this.player_.liveTracker;return s&&s.isLive()?(t=(e-s.seekableStart())/s.liveWindow(),s.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){_e(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.shouldDisableSeekWhileScrubbing_||this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!_e(e)||isNaN(this.player_.duration()))return;let s;t||this.player_.scrubbing()||this.player_.scrubbing(!0);const i=this.calculateDistance(e),r=this.player_.liveTracker;if(r&&r.isLive()){if(i>=.99)return void r.seekToLiveEdge();const e=r.seekableStart(),t=r.liveCurrentTime();if(s=e+i*r.liveWindow(),s>=t&&(s=t),s<=e&&(s=e+.1),s===1/0)return}else s=i*this.player_.duration(),s===this.player_.duration()&&(s-=.1);this.shouldDisableSeekWhileScrubbing_?this.pendingSeekTime(s):this.userSeek_(s),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),null!==this.pendingSeekTime()&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?It(this.player_.play()):this.update_()}handlePendingSeek_(e){this.player_.paused()||this.player_.pause();const t=null!==this.pendingSeekTime()?this.pendingSeekTime():this.player_.currentTime();this.pendingSeekTime(t+e),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}stepForward(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(this.options().stepSeconds):this.userSeek_(this.player_.currentTime()+this.options().stepSeconds)}stepBack(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(-this.options().stepSeconds):this.userSeek_(this.player_.currentTime()-this.options().stepSeconds)}handleAction(e){null!==this.pendingSeekTime()&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(" "===e.key||"Enter"===e.key)e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if("Home"===e.key)e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if("End"===e.key)e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(e.key)){e.preventDefault(),e.stopPropagation();const s=.1*parseInt(e.key,10);t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*s):this.userSeek_(this.player_.duration()*s)}else"PageDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-this.options().stepSeconds*this.options().pageMultiplier)):"PageUp"===e.key?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+this.options().stepSeconds*this.options().pageMultiplier)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["durationchange","timeupdate"],this.update),this.off(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document&&"visibilityState"in document&&this.off(document,"visibilitychange",this.toggleVisibility_),super.dispose()}}zi.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar",stepSeconds:5,pageMultiplier:12},mt.registerComponent("SeekBar",zi);class Ki extends mt{constructor(e,t){super(e,t),this.handleMouseMove=Ye(qe(this,this.handleMouseMove),Ke),this.throttledHandleMouseSeek=Ye(qe(this,this.handleMouseSeek),Ke),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.handleMouseDownHandler_=e=>this.handleMouseDown(e),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const s=t.getChild("playProgressBar"),i=t.getChild("mouseTimeDisplay");if(!s&&!i)return;const r=t.el(),n=ue(r);let a=pe(r,e).x;a=Ui(a,0,1),i&&i.update(n,a),s&&s.update(n,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach((e=>e.disable&&e.disable())),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&It(this.player_.play())}}enable(){this.children().forEach((e=>e.enable&&e.enable())),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,s=this.getChild("seekBar");s&&s.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}Ki.prototype.options_={children:["seekBar"]},mt.registerComponent("ProgressControl",Ki);class qi extends xi{constructor(e,t){super(e,t),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],(e=>this.handlePictureInPictureChange(e))),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],(e=>this.handlePictureInPictureEnabledChange(e))),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],(()=>this.handlePictureInPictureAudioModeChange())),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control vjs-hidden ${super.buildCSSClass()}`}handlePictureInPictureAudioModeChange(){"audio"===this.player_.currentType().substring(0,5)||this.player_.audioPosterMode()||this.player_.audioOnlyMode()?(this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()):this.show()}handlePictureInPictureEnabledChange(){document.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in window?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){"function"==typeof document.exitPictureInPicture&&super.show()}}qi.prototype.controlText_="Picture-in-Picture",mt.registerComponent("PictureInPictureToggle",qi);class Yi extends xi{constructor(e,t){super(e,t),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",(e=>this.handleFullscreenChange(e))),!1===document[e.fsApi_.fullscreenEnabled]&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}Yi.prototype.controlText_="Fullscreen",mt.registerComponent("FullscreenToggle",Yi);mt.registerComponent("VolumeLevel",class extends mt{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}});mt.registerComponent("VolumeLevelTooltip",class extends mt{constructor(e,t){super(e,t),this.update=Ye(qe(this,this.update),Ke)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,s,i){if(!s){const s=de(this.el_),i=de(this.player_.el()),r=e.width*t;if(!i||!s)return;const n=e.left-i.left+r,a=e.width-r+(i.right-e.right);let o=s.width/2;n<o?o+=o-n:a<o&&(o=a),o<0?o=0:o>s.width&&(o=s.width),this.el_.style.right=`-${o}px`}this.write(`${i}%`)}write(e){Z(this.el_,e)}updateVolume(e,t,s,i,r){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",(()=>{this.update(e,t,s,i.toFixed(0)),r&&r()}))}});class Xi extends mt{constructor(e,t){super(e,t),this.update=Ye(qe(this,this.update),Ke)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,s){const i=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,s,i,(()=>{s?this.el_.style.bottom=e.height*t+"px":this.el_.style.left=e.width*t+"px"}))}}Xi.prototype.options_={children:["volumeLevelTooltip"]},mt.registerComponent("MouseVolumeLevelDisplay",Xi);class Qi extends Hi{constructor(e,t){super(e,t),this.on("slideractive",(e=>this.updateLastVolume_(e))),this.on(e,"volumechange",(e=>this.updateARIAAttributes(e))),e.ready((()=>this.updateARIAAttributes()))}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){_e(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const s=this.el(),i=de(s),r=this.vertical();let n=pe(s,e);n=r?n.y:n.x,n=Ui(n,0,1),t.update(i,n,r)}_e(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(100*this.player_.volume())}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",(()=>{0===this.player_.volume()&&this.player_.lastVolume_(e)}))}}Qi.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},V||C||Qi.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),Qi.prototype.playerEvent="volumechange",mt.registerComponent("VolumeBar",Qi);class Zi extends mt{constructor(e,t={}){t.vertical=t.vertical||!1,(void 0===t.volumeBar||y(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",(function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")}))}(this,e),this.throttledHandleMouseMove=Ye(qe(this,this.handleMouseMove),Ke),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.on("mousedown",(e=>this.handleMouseDown(e))),this.on("touchstart",(e=>this.handleMouseDown(e))),this.on("mousemove",(e=>this.handleMouseMove(e))),this.on(this.volumeBar,["focus","slideractive"],(()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")})),this.on(this.volumeBar,["blur","sliderinactive"],(()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")}))}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}Zi.prototype.options_={children:["volumeBar"]},mt.registerComponent("VolumeControl",Zi);class Ji extends xi{constructor(e,t){super(e,t),function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",(function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")}))}(this,e),this.on(e,["loadstart","volumechange"],(e=>this.update(e)))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),s=this.player_.lastVolume_();if(0===t){const e=s<.1?.1:s;this.player_.volume(e),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;this.setIcon("volume-high"),V&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?(this.setIcon("volume-mute"),t=0):e<.33?(this.setIcon("volume-low"),t=1):e<.67&&(this.setIcon("volume-medium"),t=2),se(this.el_,[0,1,2,3].reduce(((e,t)=>e+`${t?" ":""}vjs-vol-${t}`),"")),te(this.el_,`vjs-vol-${t}`)}updateControlText_(){const e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)}}Ji.prototype.controlText_="Mute",mt.registerComponent("MuteToggle",Ji);class er extends mt{constructor(e,t={}){void 0!==t.inline?t.inline=t.inline:t.inline=!0,(void 0===t.volumeControl||y(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=e=>this.handleKeyPress(e),this.on(e,["loadstart"],(e=>this.volumePanelState_(e))),this.on(this.muteToggle,"keyup",(e=>this.handleKeyPress(e))),this.on(this.volumeControl,"keyup",(e=>this.handleVolumeControlKeyUp(e))),this.on("keydown",(e=>this.handleKeyPress(e))),this.on("mouseover",(e=>this.handleMouseOver(e))),this.on("mouseout",(e=>this.handleMouseOut(e))),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){"Escape"===e.key&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),$e(document,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),He(document,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){"Escape"===e.key&&this.handleMouseOut()}}er.prototype.options_={children:["muteToggle","volumeControl"]},mt.registerComponent("VolumePanel",er);class tr extends xi{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`forward-${this.skipTime}`),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){if(isNaN(this.player_.duration()))return;const t=this.player_.currentTime(),s=this.player_.liveTracker,i=s&&s.isLive()?s.seekableEnd():this.player_.duration();let r;r=t+this.skipTime<=i?t+this.skipTime:i,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}tr.prototype.controlText_="Skip Forward",mt.registerComponent("SkipForward",tr);class sr extends xi{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`replay-${this.skipTime}`),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),s=this.player_.liveTracker,i=s&&s.isLive()&&s.seekableStart();let r;r=i&&t-this.skipTime<=i?i:t>=this.skipTime?t-this.skipTime:0,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}sr.prototype.controlText_="Skip Backward",mt.registerComponent("SkipBackward",sr);class ir extends mt{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",(e=>this.handleKeyDown(e))),this.boundHandleBlur_=e=>this.handleBlur(e),this.boundHandleTapClick_=e=>this.handleTapClick(e)}addEventListenerForItem(e){e instanceof mt&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof mt&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){"string"==typeof e&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=Q(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),$e(t,"click",(function(e){e.preventDefault(),e.stopImmediatePropagation()})),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||document.activeElement;if(!this.children().some((e=>e.el()===t))){const e=this.menuButton_;e&&e.buttonPressed_&&t!==e.el().firstChild&&e.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const s=t.filter((t=>t.el()===e.target))[0];if(!s)return;"CaptionSettingsMenuItem"!==s.name()&&this.menuButton_.focus()}}handleKeyDown(e){"ArrowLeft"===e.key||"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):"ArrowRight"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}mt.registerComponent("Menu",ir);class rr extends mt{constructor(e,t={}){super(e,t),this.menuButton_=new xi(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const s=xi.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+s,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const i=e=>this.handleClick(e);this.handleMenuKeyUp_=e=>this.handleMenuKeyUp(e),this.on(this.menuButton_,"tap",i),this.on(this.menuButton_,"click",i),this.on(this.menuButton_,"keydown",(e=>this.handleKeyDown(e))),this.on(this.menuButton_,"mouseenter",(()=>{this.addClass("vjs-hover"),this.menu.show(),$e(document,"keyup",this.handleMenuKeyUp_)})),this.on("mouseleave",(e=>this.handleMouseLeave(e))),this.on("keydown",(e=>this.handleSubmenuKeyDown(e)))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new ir(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=Q("li",{className:"vjs-menu-title",textContent:pt(this.options_.title),tabIndex:-1}),s=new mt(this.player_,{el:t});e.addItem(s)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";return!0===this.options_.inline?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${xi.prototype.buildCSSClass()} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return!0===this.options_.inline?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),He(document,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){"Escape"===e.key||"Tab"===e.key?(this.buttonPressed_&&this.unpressButton(),"Tab"===!e.key&&(e.preventDefault(),this.menuButton_.focus())):"Up"!==e.key&&("Down"!==e.key||this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled)||this.buttonPressed_||(e.preventDefault(),this.pressButton())}handleMenuKeyUp(e){"Escape"!==e.key&&"Tab"!==e.key||this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){"Escape"!==e.key&&"Tab"!==e.key||(this.buttonPressed_&&this.unpressButton(),"Tab"===!e.key&&(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),V&&Y())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}mt.registerComponent("MenuButton",rr);class nr extends rr{constructor(e,t){const s=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!s)return;const i=qe(this,this.update);s.addEventListener("removetrack",i),s.addEventListener("addtrack",i),s.addEventListener("labelchange",i),this.player_.on("ready",i),this.player_.on("dispose",(function(){s.removeEventListener("removetrack",i),s.removeEventListener("addtrack",i),s.removeEventListener("labelchange",i)}))}}mt.registerComponent("TrackButton",nr);class ar extends Si{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,s){this.nonIconControl=!0;const i=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),s),r=Q("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?i.appendChild(r):i.replaceChild(r,i.querySelector(".vjs-icon-placeholder")),i}handleKeyDown(e){["Tab","Escape","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"].includes(e.key)||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}mt.registerComponent("MenuItem",ar);class or extends ar{constructor(e,t){const s=t.track,i=e.textTracks();t.label=s.label||s.language||"Unknown",t.selected="showing"===s.mode,super(e,t),this.track=s,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const r=(...e)=>{this.handleTracksChange.apply(this,e)},n=(...e)=>{this.handleSelectedLanguageChange.apply(this,e)};if(e.on(["loadstart","texttrackchange"],r),i.addEventListener("change",r),i.addEventListener("selectedlanguagechange",n),this.on("dispose",(function(){e.off(["loadstart","texttrackchange"],r),i.removeEventListener("change",r),i.removeEventListener("selectedlanguagechange",n)})),void 0===i.onchange){let e;this.on(["tap","click"],(function(){if("object"!=typeof window.Event)try{e=new window.Event("change")}catch(e){}e||(e=document.createEvent("Event"),e.initEvent("change",!0,!0)),i.dispatchEvent(e)}))}this.handleTracksChange()}handleClick(e){const t=this.track,s=this.player_.textTracks();if(super.handleClick(e),s)for(let e=0;e<s.length;e++){const i=s[e];-1!==this.kinds.indexOf(i.kind)&&(i===t?"showing"!==i.mode&&(i.mode="showing"):"disabled"!==i.mode&&(i.mode="disabled"))}}handleTracksChange(e){const t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if("showing"===this.track.mode){const e=this.player_.cache_.selectedLanguage;if(e&&e.enabled&&e.language===this.track.language&&e.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}mt.registerComponent("TextTrackMenuItem",or);class lr extends or{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let s=!0;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(this.options_.kinds.indexOf(i.kind)>-1&&"showing"===i.mode){s=!1;break}}s!==this.isSelected_&&this.selected(s)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let s=!0;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(["captions","descriptions","subtitles"].indexOf(i.kind)>-1&&"showing"===i.mode){s=!1;break}}s&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}mt.registerComponent("OffTextTrackMenuItem",lr);class hr extends nr{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=or){let s;this.label_&&(s=`${this.label_} off`),e.push(new lr(this.player_,{kinds:this.kinds_,kind:this.kind_,label:s})),this.hideThreshold_+=1;const i=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let s=0;s<i.length;s++){const r=i[s];if(this.kinds_.indexOf(r.kind)>-1){const s=new t(this.player_,{track:r,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});s.addClass(`vjs-${r.kind}-menu-item`),e.push(s)}}return e}}mt.registerComponent("TextTrackButton",hr);class cr extends ar{constructor(e,t){const s=t.track,i=t.cue,r=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=i.text,t.selected=i.startTime<=r&&r<i.endTime,super(e,t),this.track=s,this.cue=i}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}mt.registerComponent("ChaptersTrackMenuItem",cr);class dr extends hr{constructor(e,t,s){super(e,t,s),this.setIcon("chapters"),this.selectCurrentItem_=()=>{this.items.forEach((e=>{e.selected(this.track_.activeCues[0]===e.cue)}))}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&"chapters"!==e.track.kind)return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const s=e[t];if(s.kind===this.kind_)return s}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(pt(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let s=0,i=t.length;s<i;s++){const i=t[s],r=new cr(this.player_,{track:this.track_,cue:i});e.push(r)}return e}}dr.prototype.kind_="chapters",dr.prototype.controlText_="Chapters",mt.registerComponent("ChaptersButton",dr);class ur extends hr{constructor(e,t,s){super(e,t,s),this.setIcon("audio-description");const i=e.textTracks(),r=qe(this,this.handleTracksChange);i.addEventListener("change",r),this.on("dispose",(function(){i.removeEventListener("change",r)}))}handleTracksChange(e){const t=this.player().textTracks();let s=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(i.kind!==this.kind_&&"showing"===i.mode){s=!0;break}}s?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}ur.prototype.kind_="descriptions",ur.prototype.controlText_="Descriptions",mt.registerComponent("DescriptionsButton",ur);class pr extends hr{constructor(e,t,s){super(e,t,s),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}pr.prototype.kind_="subtitles",pr.prototype.controlText_="Subtitles",mt.registerComponent("SubtitlesButton",pr);class fr extends or{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}mt.registerComponent("CaptionSettingsMenuItem",fr);class gr extends hr{constructor(e,t,s){super(e,t,s),this.setIcon("captions")}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new fr(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}gr.prototype.kind_="captions",gr.prototype.controlText_="Captions",mt.registerComponent("CaptionsButton",gr);class mr extends or{createEl(e,t,s){const i=super.createEl(e,t,s),r=i.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",i):r.appendChild(Q("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(Q("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),i}}mt.registerComponent("SubsCapsMenuItem",mr);class yr extends hr{constructor(e,t={}){super(e,t),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText(pt(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new fr(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,mr),e}}yr.prototype.kinds_=["captions","subtitles"],yr.prototype.controlText_="Subtitles",mt.registerComponent("SubsCapsButton",yr);class vr extends ar{constructor(e,t){const s=t.track,i=e.audioTracks();t.label=s.label||s.language||"Unknown",t.selected=s.enabled,super(e,t),this.track=s,this.addClass(`vjs-${s.kind}-menu-item`);const r=(...e)=>{this.handleTracksChange.apply(this,e)};i.addEventListener("change",r),this.on("dispose",(()=>{i.removeEventListener("change",r)}))}createEl(e,t,s){const i=super.createEl(e,t,s),r=i.querySelector(".vjs-menu-item-text");return["main-desc","descriptions"].indexOf(this.options_.track.kind)>=0&&(r.appendChild(Q("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(Q("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),i}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const e=this.player_.audioTracks();for(let t=0;t<e.length;t++){const s=e[t];s!==this.track&&(s.enabled=s===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}mt.registerComponent("AudioTrackMenuItem",vr);class _r extends nr{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t),this.setIcon("audio")}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let s=0;s<t.length;s++){const i=t[s];e.push(new vr(this.player_,{track:i,selectable:!0,multiSelectable:!1}))}return e}}_r.prototype.controlText_="Audio Track",mt.registerComponent("AudioTrackButton",_r);class br extends ar{constructor(e,t){const s=t.rate,i=parseFloat(s,10);t.label=s,t.selected=i===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=s,this.rate=i,this.on(e,"ratechange",(e=>this.update(e)))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}br.prototype.contentElType="button",mt.registerComponent("PlaybackRateMenuItem",br);class Tr extends rr{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",(e=>this.updateVisibility(e))),this.on(e,"ratechange",(e=>this.updateLabel(e))),this.on(e,"playbackrateschange",(e=>this.handlePlaybackRateschange(e)))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=Q("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let s=e.length-1;s>=0;s--)t.push(new br(this.player(),{rate:e[s]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}Tr.prototype.controlText_="Playback Rate",mt.registerComponent("PlaybackRateMenuButton",Tr);class Ar extends mt{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},s={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,s)}}mt.registerComponent("Spacer",Ar);mt.registerComponent("CustomControlSpacer",class extends Ar{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:" "})}});class Er extends mt{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}Er.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]},mt.registerComponent("ControlBar",Er);class Sr extends Mt{constructor(e,t){super(e,t),this.on(e,"error",(e=>{this.open(e)}))}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}Sr.prototype.options_=Object.assign({},Mt.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),mt.registerComponent("ErrorDisplay",Sr);class Cr extends mt{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-labelledby",this.selectLabelledbyIds)}createEl(){return this.selectLabelledbyIds=[this.options_.legendId,this.options_.labelId].join(" ").trim(),Q("select",{id:this.options_.id},{},this.options_.SelectOptions.map((e=>{const t=(this.options_.labelId?this.options_.labelId:`vjs-track-option-${Me()}`)+"-"+e[1].replace(/\W+/g,""),s=Q("option",{id:t,value:this.localize(e[0]),textContent:this.localize(e[1])});return s.setAttribute("aria-labelledby",`${this.selectLabelledbyIds} ${t}`),s})))}}mt.registerComponent("TextTrackSelect",Cr);class wr extends mt{constructor(e,t={}){super(e,t);const s=Q("legend",{textContent:this.localize(this.options_.legendText),id:this.options_.legendId});this.el().appendChild(s);const i=this.options_.selects;for(const t of i){const s=this.options_.selectConfigs[t],i=s.className,r=s.id.replace("%s",this.options_.id_);let n=null;const a=`vjs_select_${Me()}`;if("colors"===this.options_.type){n=Q("span",{className:i});const e=Q("label",{id:r,className:"vjs-label",textContent:this.localize(s.label)});e.setAttribute("for",a),n.appendChild(e)}const o=new Cr(e,{SelectOptions:s.options,legendId:this.options_.legendId,id:a,labelId:r});this.addChild(o),"colors"===this.options_.type&&(n.appendChild(o.el()),this.el().appendChild(n))}}createEl(){return Q("fieldset",{className:this.options_.className})}}mt.registerComponent("TextTrackFieldset",wr);class kr extends mt{constructor(e,t={}){super(e,t);const s=this.options_.textTrackComponentid,i=new wr(e,{id_:s,legendId:`captions-text-legend-${s}`,legendText:this.localize("Text"),className:"vjs-fg vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(i);const r=new wr(e,{id_:s,legendId:`captions-background-${s}`,legendText:this.localize("Text Background"),className:"vjs-bg vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(r);const n=new wr(e,{id_:s,legendId:`captions-window-${s}`,legendText:this.localize("Caption Area Background"),className:"vjs-window vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(n)}createEl(){return Q("div",{className:"vjs-track-settings-colors"})}}mt.registerComponent("TextTrackSettingsColors",kr);class Lr extends mt{constructor(e,t={}){super(e,t);const s=this.options_.textTrackComponentid,i=new wr(e,{id_:s,legendId:`captions-font-size-${s}`,legendText:"Font Size",className:"vjs-font-percent vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(i);const r=new wr(e,{id_:s,legendId:`captions-edge-style-${s}`,legendText:this.localize("Text Edge Style"),className:"vjs-edge-style vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(r);const n=new wr(e,{id_:s,legendId:`captions-font-family-${s}`,legendText:this.localize("Font Family"),className:"vjs-font-family vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(n)}createEl(){return Q("div",{className:"vjs-track-settings-font"})}}mt.registerComponent("TextTrackSettingsFont",Lr);class Ir extends mt{constructor(e,t={}){super(e,t);const s=new xi(e,{controlText:this.localize("restore all settings to the default values"),className:"vjs-default-button"});s.el().classList.remove("vjs-control","vjs-button"),s.el().textContent=this.localize("Reset"),this.addChild(s);const i=this.localize("Done"),r=new xi(e,{controlText:i,className:"vjs-done-button"});r.el().classList.remove("vjs-control","vjs-button"),r.el().textContent=i,this.addChild(r)}createEl(){return Q("div",{className:"vjs-track-settings-controls"})}}mt.registerComponent("TrackSettingsControls",Ir);const Pr="vjs-text-track-settings",Rr=["#000","Black"],xr=["#00F","Blue"],Dr=["#0FF","Cyan"],Or=["#0F0","Green"],Mr=["#F0F","Magenta"],Nr=["#F00","Red"],Fr=["#FFF","White"],Br=["#FF0","Yellow"],jr=["1","Opaque"],Ur=["0.5","Semi-Transparent"],$r=["0","Transparent"],Hr={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[Rr,Fr,Nr,Or,xr,Br,Mr,Dr],className:"vjs-bg-color"},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[jr,Ur,$r],className:"vjs-bg-opacity vjs-opacity"},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Fr,Rr,Nr,Or,xr,Br,Mr,Dr],className:"vjs-text-color"},edgeStyle:{selector:".vjs-edge-style > select",id:"",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:e=>"1.00"===e?null:Number(e)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[jr,Ur],className:"vjs-text-opacity vjs-opacity"},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color",className:"vjs-window-color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[$r,Ur,jr],className:"vjs-window-opacity vjs-opacity"}};function Vr(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}Hr.windowColor.options=Hr.backgroundColor.options;mt.registerComponent("TextTrackSettings",class extends Mt{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.renderModalComponents(e),this.endDialog=Q("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),void 0===t.persistTextTrackSettings&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.bindFunctionsToSelectsAndButtons(),this.options_.persistTextTrackSettings&&this.restoreSettings()}renderModalComponents(e){const t=new kr(e,{textTrackComponentid:this.id_,selectConfigs:Hr,fieldSets:[["color","textOpacity"],["backgroundColor","backgroundOpacity"],["windowColor","windowOpacity"]]});this.addChild(t);const s=new Lr(e,{textTrackComponentid:this.id_,selectConfigs:Hr,fieldSets:[["fontPercent"],["edgeStyle"],["fontFamily"]]});this.addChild(s);const i=new Ir(e);this.addChild(i)}bindFunctionsToSelectsAndButtons(){this.on(this.$(".vjs-done-button"),["click","tap"],(()=>{this.saveSettings(),this.close()})),this.on(this.$(".vjs-default-button"),["click","tap"],(()=>{this.setDefaults(),this.updateDisplay()})),f(Hr,(e=>{this.on(this.$(e.selector),"change",this.updateDisplay)}))}dispose(){this.endDialog=null,super.dispose()}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return g(Hr,((e,t,s)=>{const i=(r=this.$(t.selector),n=t.parser,Vr(r.options[r.options.selectedIndex].value,n));var r,n;return void 0!==i&&(e[s]=i),e}),{})}setValues(e){f(Hr,((t,s)=>{!function(e,t,s){if(t)for(let i=0;i<e.options.length;i++)if(Vr(e.options[i].value,s)===t){e.selectedIndex=i;break}}(this.$(t.selector),e[s],t.parser)}))}setDefaults(){f(Hr,(e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t}))}restoreSettings(){let e;try{e=JSON.parse(window.localStorage.getItem(Pr))}catch(e){c.warn(e)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?window.localStorage.setItem(Pr,JSON.stringify(e)):window.localStorage.removeItem(Pr)}catch(e){c.warn(e)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}handleLanguagechange(){this.fill(),this.renderModalComponents(this.player_),this.bindFunctionsToSelectsAndButtons()}});mt.registerComponent("ResizeManager",class extends mt{constructor(e,t){let s=t.ResizeObserver||window.ResizeObserver;null===t.ResizeObserver&&(s=!1),super(e,v({createEl:!s,reportTouchActivity:!1},t)),this.ResizeObserver=t.ResizeObserver||window.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=Xe((()=>{this.resizeHandler()}),100,!1,this),s?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const e=this.debouncedHandler_;let t=this.unloadListener_=function(){He(this,"resize",e),He(this,"unload",t),t=null};$e(this.el_.contentWindow,"unload",t),$e(this.el_.contentWindow,"resize",e)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}});const Gr={trackingThreshold:20,liveTolerance:15};mt.registerComponent("LiveTracker",class extends mt{constructor(e,t){super(e,v(Gr,t,{createEl:!1})),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=e=>this.handlePlay(e),this.handleFirstTimeupdate_=e=>this.handleFirstTimeupdate(e),this.handleSeeked_=e=>this.handleSeeked(e),this.seekToLiveEdge_=e=>this.seekToLiveEdge(e),this.reset_(),this.on(this.player_,"durationchange",(e=>this.handleDurationchange(e))),this.on(this.player_,"canplay",(()=>this.toggleTracking()))}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(window.performance.now().toFixed(4)),s=-1===this.lastTime_?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+s;const i=this.liveCurrentTime(),r=this.player_.currentTime();let n=this.player_.paused()||this.seekedBehindLive_||Math.abs(i-r)>this.options_.liveTolerance;this.timeupdateSeen_&&i!==1/0||(n=!1),n!==this.behindLiveEdge_&&(this.behindLiveEdge_=n,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,Ke),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let s=e?e.length:0;for(;s--;)t.push(e.end(s));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let s=e?e.length:0;for(;s--;)t.push(e.start(s));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return"number"==typeof this.trackingInterval_}seekToLiveEdge(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}});mt.registerComponent("TitleBar",class extends mt{constructor(e,t){super(e,t),this.on("statechanged",(e=>this.updateDom_())),this.updateDom_()}createEl(){return this.els={title:Q("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${Me()}`}),description:Q("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${Me()}`})},Q("div",{className:"vjs-title-bar"},{},_(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,s={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach((e=>{const i=this.state[e],r=this.els[e],n=s[e];ge(r),i&&Z(r,i),t&&(t.removeAttribute(n),i&&t.setAttribute(n,r.id))})),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}});const Wr={initialDisplay:4e3,position:[],takeFocus:!1};mt.registerComponent("TransientButton",class extends xi{constructor(e,t){super(e,t=v(Wr,t)),this.controlText(t.controlText),this.hide(),this.on(this.player_,["useractive","userinactive"],(e=>{this.removeClass("force-display")}))}buildCSSClass(){return`vjs-transient-button focus-visible ${this.options_.position.map((e=>`vjs-${e}`)).join(" ")}`}createEl(){const e=Q("button",{},{type:"button",class:this.buildCSSClass()},Q("span"));return this.controlTextEl_=e.querySelector("span"),e}show(){super.show(),this.addClass("force-display"),this.options_.takeFocus&&this.el().focus({preventScroll:!0}),this.forceDisplayTimeout=this.player_.setTimeout((()=>{this.removeClass("force-display")}),this.options_.initialDisplay)}hide(){this.removeClass("force-display"),super.hide()}dispose(){this.player_.clearTimeout(this.forceDisplayTimeout),super.dispose()}});const zr=e=>{const t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;const s=e.$$("source"),i=[];let r="";if(!s.length)return!1;for(let e=0;e<s.length;e++){const t=s[e].src;t&&-1===i.indexOf(t)&&i.push(t)}return!!i.length&&(1===i.length&&(r=i[0]),e.triggerSourceset(r),!0)},Kr=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(e){const t=document.createElement(this.nodeName.toLowerCase());t.innerHTML=e;const s=document.createDocumentFragment();for(;t.childNodes.length;)s.appendChild(t.childNodes[0]);return this.innerText="",window.Element.prototype.appendChild.call(this,s),this.innerHTML}}),qr=(e,t)=>{let s={};for(let i=0;i<e.length&&(s=Object.getOwnPropertyDescriptor(e[i],t),!(s&&s.set&&s.get));i++);return s.enumerable=!0,s.configurable=!0,s},Yr=function(e){const t=e.el();if(t.resetSourceWatch_)return;const s={},i=(e=>qr([e.el(),window.HTMLMediaElement.prototype,window.Element.prototype,Kr],"innerHTML"))(e),r=s=>(...i)=>{const r=s.apply(t,i);return zr(e),r};["append","appendChild","insertAdjacentHTML"].forEach((e=>{t[e]&&(s[e]=t[e],t[e]=r(s[e]))})),Object.defineProperty(t,"innerHTML",v(i,{set:r(i.set)})),t.resetSourceWatch_=()=>{t.resetSourceWatch_=null,Object.keys(s).forEach((e=>{t[e]=s[e]})),Object.defineProperty(t,"innerHTML",i)},e.one("sourceset",t.resetSourceWatch_)},Xr=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?Yt(window.Element.prototype.getAttribute.call(this,"src")):""},set(e){return window.Element.prototype.setAttribute.call(this,"src",e),e}}),Qr=function(e){if(!e.featuresSourceset)return;const t=e.el();if(t.resetSourceset_)return;const s=(e=>qr([e.el(),window.HTMLMediaElement.prototype,Xr],"src"))(e),i=t.setAttribute,r=t.load;Object.defineProperty(t,"src",v(s,{set:i=>{const r=s.set.call(t,i);return e.triggerSourceset(t.src),r}})),t.setAttribute=(s,r)=>{const n=i.call(t,s,r);return/src/i.test(s)&&e.triggerSourceset(t.src),n},t.load=()=>{const s=r.call(t);return zr(e)||(e.triggerSourceset(""),Yr(e)),s},t.currentSrc?e.triggerSourceset(t.currentSrc):zr(e)||Yr(e),t.resetSourceset_=()=>{t.resetSourceset_=null,t.load=r,t.setAttribute=i,Object.defineProperty(t,"src",s),t.resetSourceWatch_&&t.resetSourceWatch_()}};class Zr extends ai{constructor(e,t){super(e,t);const s=e.source;let i=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&"VIDEO"===this.el_.tagName,s&&(this.el_.currentSrc!==s.src||e.tag&&3===e.tag.initNetworkState_)?this.setSource(s):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const e=this.el_.childNodes;let t=e.length;const s=[];for(;t--;){const r=e[t];"track"===r.nodeName.toLowerCase()&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(r),this.remoteTextTracks().addTrack(r.track),this.textTracks().addTrack(r.track),i||this.el_.hasAttribute("crossorigin")||!Qt(r.src)||(i=!0)):s.push(r))}for(let e=0;e<s.length;e++)this.el_.removeChild(s[e])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&i&&c.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),this.restoreMetadataTracksInIOSNativePlayer_(),($||F)&&!0===e.nativeControlsForTouch&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),Zr.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){Qr(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const s=()=>{t=[];for(let s=0;s<e.length;s++){const i=e[s];"metadata"===i.kind&&t.push({track:i,storedMode:i.mode})}};s(),e.addEventListener("change",s),this.on("dispose",(()=>e.removeEventListener("change",s)));const i=()=>{for(let e=0;e<t.length;e++){const s=t[e];"disabled"===s.track.mode&&s.track.mode!==s.storedMode&&(s.track.mode=s.storedMode)}e.removeEventListener("change",i)};this.on("webkitbeginfullscreen",(()=>{e.removeEventListener("change",s),e.removeEventListener("change",i),e.addEventListener("change",i)})),this.on("webkitendfullscreen",(()=>{e.removeEventListener("change",s),e.addEventListener("change",s),e.removeEventListener("change",i)}))}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const s=e.toLowerCase();this[`${s}TracksListeners_`]&&Object.keys(this[`${s}TracksListeners_`]).forEach((e=>{this.el()[`${s}Tracks`].removeEventListener(e,this[`${s}TracksListeners_`][e])})),this[`featuresNative${e}Tracks`]=!t,this[`${s}TracksListeners_`]=null,this.proxyNativeTracksForType_(s)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=Ss[e],s=this.el()[t.getterName],i=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!s||!s.addEventListener)return;const r={change:t=>{const s={type:"change",target:i,currentTarget:i,srcElement:i};i.trigger(s),"text"===e&&this[Cs.remoteText.getterName]().trigger(s)},addtrack(e){i.addTrack(e.track)},removetrack(e){i.removeTrack(e.track)}},n=function(){const e=[];for(let t=0;t<i.length;t++){let r=!1;for(let e=0;e<s.length;e++)if(s[e]===i[t]){r=!0;break}r||e.push(i[t])}for(;e.length;)i.removeTrack(e.shift())};this[t.getterName+"Listeners_"]=r,Object.keys(r).forEach((e=>{const t=r[e];s.addEventListener(e,t),this.on("dispose",(i=>s.removeEventListener(e,t)))})),this.on("loadstart",n),this.on("dispose",(e=>this.off("loadstart",n)))}proxyNativeTracks_(){Ss.names.forEach((e=>{this.proxyNativeTracksForType_(e)}))}createEl(){let e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){const t=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(t,e),Zr.disposeMediaElement(e),e=t}else{e=document.createElement("video");const t=v({},this.options_.tag&&ne(this.options_.tag));$&&!0===this.options_.nativeControlsForTouch||delete t.controls,re(e,Object.assign(t,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}void 0!==this.options_.preload&&oe(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let s=0;s<t.length;s++){const i=t[s],r=this.options_[i];void 0!==r&&(r?oe(e,i,i):le(e,i),e[i]=r)}return e}handleLateInit_(e){if(0===e.networkState||3===e.networkState)return;if(0===e.readyState){let e=!1;const t=function(){e=!0};this.on("loadstart",t);const s=function(){e||this.trigger("loadstart")};return this.on("loadedmetadata",s),void this.ready((function(){this.off("loadstart",t),this.off("loadedmetadata",s),e||this.trigger("loadstart")}))}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready((function(){t.forEach((function(e){this.trigger(e)}),this)}))}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&G?this.el_.fastSeek(e):this.el_.currentTime=e}catch(e){c(e,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&C&&I&&0===this.el_.currentTime){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",(()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)}))}supportsFullScreen(){return"function"==typeof this.el_.webkitEnterFullScreen}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)It(this.el_.play()),this.setTimeout((function(){e.pause();try{e.webkitEnterFullScreen()}catch(e){this.trigger("fullscreenerror",e)}}),0);else try{e.webkitEnterFullScreen()}catch(e){this.trigger("fullscreenerror",e)}}exitFullScreen(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(void 0===e)return this.el_.src;this.setSrc(e)}addSourceElement(e,t){if(!e)return c.error("Invalid source URL."),!1;const s={src:e};t&&(s.type=t);const i=Q("source",{},s);return this.el_.appendChild(i),!0}removeSourceElement(e){if(!e)return c.error("Source URL is required to remove the source element."),!1;const t=this.el_.querySelectorAll("source");for(const s of t)if(s.src===e)return this.el_.removeChild(s),!0;return c.warn(`No matching source element found with src: ${e}`),!1}reset(){Zr.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,s){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,s):super.addTextTrack(e,t,s)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=document.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const s=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(s),s}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let s=t.length;for(;s--;)e!==t[s]&&e!==t[s].track||this.el().removeChild(t[s])}}getVideoPlaybackQuality(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();const e={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),window.performance&&(e.creationTime=window.performance.now()),e}}b(Zr,"TEST_VID",(function(){if(!K())return;const e=document.createElement("video"),t=document.createElement("track");return t.kind="captions",t.srclang="en",t.label="English",e.appendChild(t),e})),Zr.isSupported=function(){try{Zr.TEST_VID.volume=.5}catch(e){return!1}return!(!Zr.TEST_VID||!Zr.TEST_VID.canPlayType)},Zr.canPlayType=function(e){return Zr.TEST_VID.canPlayType(e)},Zr.canPlaySource=function(e,t){return Zr.canPlayType(e.type)},Zr.canControlVolume=function(){try{const e=Zr.TEST_VID.volume;Zr.TEST_VID.volume=e/2+.1;const t=e!==Zr.TEST_VID.volume;return t&&V?(window.setTimeout((()=>{Zr&&Zr.prototype&&(Zr.prototype.featuresVolumeControl=e!==Zr.TEST_VID.volume)})),!1):t}catch(e){return!1}},Zr.canMuteVolume=function(){try{const e=Zr.TEST_VID.muted;return Zr.TEST_VID.muted=!e,Zr.TEST_VID.muted?oe(Zr.TEST_VID,"muted","muted"):le(Zr.TEST_VID,"muted"),e!==Zr.TEST_VID.muted}catch(e){return!1}},Zr.canControlPlaybackRate=function(){if(C&&I&&R<58)return!1;try{const e=Zr.TEST_VID.playbackRate;return Zr.TEST_VID.playbackRate=e/2+.1,e!==Zr.TEST_VID.playbackRate}catch(e){return!1}},Zr.canOverrideAttributes=function(){try{const e=()=>{};Object.defineProperty(document.createElement("video"),"src",{get:e,set:e}),Object.defineProperty(document.createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(document.createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(document.createElement("audio"),"innerHTML",{get:e,set:e})}catch(e){return!1}return!0},Zr.supportsNativeTextTracks=function(){return G||V&&I},Zr.supportsNativeVideoTracks=function(){return!(!Zr.TEST_VID||!Zr.TEST_VID.videoTracks)},Zr.supportsNativeAudioTracks=function(){return!(!Zr.TEST_VID||!Zr.TEST_VID.audioTracks)},Zr.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach((function([e,t]){b(Zr.prototype,e,(()=>Zr[t]()),!0)})),Zr.prototype.featuresVolumeControl=Zr.canControlVolume(),Zr.prototype.movingMediaElementInDOM=!V,Zr.prototype.featuresFullscreenResize=!0,Zr.prototype.featuresProgressEvents=!0,Zr.prototype.featuresTimeupdateEvents=!0,Zr.prototype.featuresVideoFrameCallback=!(!Zr.TEST_VID||!Zr.TEST_VID.requestVideoFrameCallback),Zr.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(e){}}()}},Zr.resetMediaElement=function(e){if(!e)return;const t=e.querySelectorAll("source");let s=t.length;for(;s--;)e.removeChild(t[s]);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(e){}}()},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach((function(e){Zr.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}})),["muted","defaultMuted","autoplay","loop","playsinline"].forEach((function(e){Zr.prototype["set"+pt(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}})),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach((function(e){Zr.prototype[e]=function(){return this.el_[e]}})),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach((function(e){Zr.prototype["set"+pt(e)]=function(t){this.el_[e]=t}})),["pause","load","play"].forEach((function(e){Zr.prototype[e]=function(){return this.el_[e]()}})),ai.withSourceHandlers(Zr),Zr.nativeSourceHandler={},Zr.nativeSourceHandler.canPlayType=function(e){try{return Zr.TEST_VID.canPlayType(e)}catch(e){return""}},Zr.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return Zr.nativeSourceHandler.canPlayType(e.type);if(e.src){const t=Xt(e.src);return Zr.nativeSourceHandler.canPlayType(`video/${t}`)}return""},Zr.nativeSourceHandler.handleSource=function(e,t,s){t.setSrc(e.src)},Zr.nativeSourceHandler.dispose=function(){},Zr.registerSourceHandler(Zr.nativeSourceHandler),ai.registerTech("Html5",Zr);const Jr=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],en={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},tn=["tiny","xsmall","small","medium","large","xlarge","huge"],sn={};tn.forEach((e=>{const t="x"===e.charAt(0)?`x-${e.substring(1)}`:e;sn[e]=`vjs-layout-${t}`}));const rn={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class nn extends mt{constructor(t,s,i){if(t.id=t.id||s.id||`vjs_video_${Me()}`,(s=Object.assign(nn.getTagSettings(t),s)).initChildren=!1,s.createEl=!1,s.evented=!1,s.reportTouchActivity=!1,!s.language){const e=t.closest("[lang]");e&&(s.language=e.getAttribute("lang"))}if(super(null,s,i),this.boundDocumentFullscreenChange_=e=>this.documentFullscreenChange_(e),this.boundFullWindowOnEscKey_=e=>this.fullWindowOnEscKey(e),this.boundUpdateStyleEl_=e=>this.updateStyleEl_(e),this.boundApplyInitTime_=e=>this.applyInitTime_(e),this.boundUpdateCurrentBreakpoint_=e=>this.updateCurrentBreakpoint_(e),this.boundHandleTechClick_=e=>this.handleTechClick_(e),this.boundHandleTechDoubleClick_=e=>this.handleTechDoubleClick_(e),this.boundHandleTechTouchStart_=e=>this.handleTechTouchStart_(e),this.boundHandleTechTouchMove_=e=>this.handleTechTouchMove_(e),this.boundHandleTechTouchEnd_=e=>this.handleTechTouchEnd_(e),this.boundHandleTechTap_=e=>this.handleTechTap_(e),this.boundUpdatePlayerHeightOnAudioOnlyMode_=e=>this.updatePlayerHeightOnAudioOnlyMode_(e),this.isFullscreen_=!1,this.log=d(this.id_),this.fsApi_=n,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={controlBarHeight:null,playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=t,this.tagAttributes=t&&ne(t),this.language(this.options_.language),s.languages){const e={};Object.getOwnPropertyNames(s.languages).forEach((function(t){e[t.toLowerCase()]=s.languages[t]})),this.languages_=e}else this.languages_=nn.prototype.options_.languages;this.resetCache_(),this.poster_=s.poster||"",this.controls_=!!s.controls,t.controls=!1,t.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],t.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),s.plugins&&Object.keys(s.plugins).forEach((e=>{if("function"!=typeof this[e])throw new Error(`plugin "${e}" does not exist`)})),this.scrubbing_=!1,this.el_=this.createEl(),ht(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&($e(document,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const r=v(this.options_);if(s.plugins&&Object.keys(s.plugins).forEach((e=>{this[e](s.plugins[e])})),s.debug&&this.debug(!0),this.options_.playerOptions=r,this.middleware_=[],this.playbackRates(s.playbackRates),s.experimentalSvgIcons){const e=(new window.DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg">\n  <defs>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play">\n      <path d="M16 10v28l22-14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">\n      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">\n      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">\n      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">\n      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">\n      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">\n      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">\n      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">\n      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">\n      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">\n      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">\n      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">\n      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>\n    </symbol>\n    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">\n      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">\n      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">\n      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">\n      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">\n      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">\n      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-share">\n      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">\n      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-square">\n      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">\n      <circle cx="24" cy="24" r="20"></circle>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">\n      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">\n      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">\n      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">\n      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">\n      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">\n      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">\n      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">\n      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">\n      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>\n    </symbol>\n    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">\n      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">\n      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">\n      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">\n      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">\n      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">\n      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">\n      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>\n      <path fill="none" d="M-1-3h24v24H-1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">\n      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">\n      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1200 1227" id="vjs-icon-twitter">\n      <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">\n      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">\n      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>\n    </symbol>\n  </defs>\n</svg>',"image/svg+xml");if(e.querySelector("parsererror"))c.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const t=e.documentElement;t.style.display="none",this.el_.appendChild(t),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio("audio"===t.nodeName.toLowerCase()),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),s.spatialNavigation&&s.spatialNavigation.enabled&&(this.spatialNavigation=new Ei(this),this.addClass("vjs-spatial-navigation-enabled")),$&&this.addClass("vjs-touch-enabled"),V||this.addClass("vjs-workinghover"),nn.players[this.id_]=this;const a=e.split(".")[0];this.addClass(`vjs-v${a}`),this.userActive(!0),this.reportUserActivity(),this.one("play",(e=>this.listenForUserActivity_(e))),this.on("keydown",(e=>this.handleKeyDown(e))),this.on("languagechange",(e=>this.handleLanguagechange(e))),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",(()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)}))}dispose(){var e;this.trigger("dispose"),this.off("dispose"),He(document,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),He(document,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),nn.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),e=this,li.hasOwnProperty(e.id())&&delete li[e.id()],ws.names.forEach((e=>{const t=this[ws[e].getterName]();t&&t.off&&t.off()})),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e,t=this.tag,s=this.playerElIngest_=t.parentNode&&t.parentNode.hasAttribute&&t.parentNode.hasAttribute("data-vjs-player");const i="video-js"===this.tag.tagName.toLowerCase();s?e=this.el_=t.parentNode:i||(e=this.el_=super.createEl("div"));const r=ne(t);if(i){for(e=this.el_=t,t=this.tag=document.createElement("video");e.children.length;)t.appendChild(e.firstChild);ee(e,"video-js")||te(e,"video-js"),e.appendChild(t),s=this.playerElIngest_=e,Object.keys(e).forEach((s=>{try{t[s]=e[s]}catch(e){}}))}t.setAttribute("tabindex","-1"),r.tabindex="-1",I&&M&&(t.setAttribute("role","application"),r.role="application"),t.removeAttribute("width"),t.removeAttribute("height"),"width"in r&&delete r.width,"height"in r&&delete r.height,Object.getOwnPropertyNames(r).forEach((function(s){i&&"class"===s||e.setAttribute(s,r[s]),i&&t.setAttribute(s,r[s])})),t.playerId=t.id,t.id+="_html5_api",t.className="vjs-tech",t.player=e.player=this,this.addClass("vjs-paused");const n=["IS_SMART_TV","IS_TIZEN","IS_WEBOS","IS_ANDROID","IS_IPAD","IS_IPHONE","IS_CHROMECAST_RECEIVER"].filter((e=>W[e])).map((e=>"vjs-device-"+e.substring(3).toLowerCase().replace(/\_/g,"-")));if(this.addClass(...n),!0!==window.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=Pe("vjs-styles-dimensions");const e=be(".vjs-styles-defaults"),t=be("head");t.insertBefore(this.styleEl_,e?e.nextSibling:t.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const a=t.getElementsByTagName("a");for(let e=0;e<a.length;e++){const t=a.item(e);te(t,"vjs-hidden"),t.setAttribute("hidden","hidden")}return t.initNetworkState_=t.networkState,t.parentNode&&!s&&t.parentNode.insertBefore(e,t),J(t,e),this.children_.unshift(t),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=e,e}crossOrigin(e){if(void 0===e)return this.techGet_("crossOrigin");null===e||"anonymous"===e||"use-credentials"===e?(this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)):c.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const s=e+"_";if(void 0===t)return this[s]||0;if(""===t||"auto"===t)return this[s]=void 0,void this.updateStyleEl_();const i=parseFloat(t);isNaN(i)?c.error(`Improper value "${t}" supplied for for ${e}`):(this[s]=i,this.updateStyleEl_())}fluid(e){if(void 0===e)return!!this.fluid_;var t,s;this.fluid_=!!e,tt(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),s=()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)},tt(t=this)?s():(t.eventedCallbacks||(t.eventedCallbacks=[]),t.eventedCallbacks.push(s))):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(!0===window.VIDEOJS_NO_DYNAMIC_STYLE){const e="number"==typeof this.width_?this.width_:this.options_.width,t="number"==typeof this.height_?this.height_:this.options_.height,s=this.tech_&&this.tech_.el();return void(s&&(e>=0&&(s.width=e),t>=0&&(s.height=t)))}let e,t,s,i;s=void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9";const r=s.split(":"),n=r[1]/r[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/n:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*n,i=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(i),Re(this.styleEl_,`\n      .${i} {\n        width: ${e}px;\n        height: ${t}px;\n      }\n\n      .${i}.vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: ${100*n}%;\n      }\n    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const s=pt(e),i=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==s&&this.tag&&(ai.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=s,this.isReady_=!1;let r=this.autoplay();("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(r=!1);const n={source:t,autoplay:r,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${i}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};ws.names.forEach((e=>{const t=ws[e];n[t.getterName]=this[t.privateName]})),Object.assign(n,this.options_[s]),Object.assign(n,this.options_[i]),Object.assign(n,this.options_[e.toLowerCase()]),this.tag&&(n.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(n.startTime=this.cache_.currentTime);const a=ai.getTech(e);if(!a)throw new Error(`No Tech named '${s}' exists! '${s}' should be registered using videojs.registerTech()'`);this.tech_=new a(n),this.tech_.ready(qe(this,this.handleTechReady_),!0),xt(this.textTracksJson_||[],this.tech_),Jr.forEach((e=>{this.on(this.tech_,e,(t=>this[`handleTech${pt(e)}_`](t)))})),Object.keys(en).forEach((e=>{this.on(this.tech_,e,(t=>{0===this.tech_.playbackRate()&&this.tech_.seeking()?this.queuedCallbacks_.push({callback:this[`handleTech${en[e]}_`].bind(this),event:t}):this[`handleTech${en[e]}_`](t)}))})),this.on(this.tech_,"loadstart",(e=>this.handleTechLoadStart_(e))),this.on(this.tech_,"sourceset",(e=>this.handleTechSourceset_(e))),this.on(this.tech_,"waiting",(e=>this.handleTechWaiting_(e))),this.on(this.tech_,"ended",(e=>this.handleTechEnded_(e))),this.on(this.tech_,"seeking",(e=>this.handleTechSeeking_(e))),this.on(this.tech_,"play",(e=>this.handleTechPlay_(e))),this.on(this.tech_,"pause",(e=>this.handleTechPause_(e))),this.on(this.tech_,"durationchange",(e=>this.handleTechDurationChange_(e))),this.on(this.tech_,"fullscreenchange",((e,t)=>this.handleTechFullscreenChange_(e,t))),this.on(this.tech_,"fullscreenerror",((e,t)=>this.handleTechFullscreenError_(e,t))),this.on(this.tech_,"enterpictureinpicture",(e=>this.handleTechEnterPictureInPicture_(e))),this.on(this.tech_,"leavepictureinpicture",(e=>this.handleTechLeavePictureInPicture_(e))),this.on(this.tech_,"error",(e=>this.handleTechError_(e))),this.on(this.tech_,"posterchange",(e=>this.handleTechPosterChange_(e))),this.on(this.tech_,"textdata",(e=>this.handleTechTextData_(e))),this.on(this.tech_,"ratechange",(e=>this.handleTechRateChange_(e))),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===s&&this.tag||J(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){ws.names.forEach((e=>{const t=ws[e];this[t.privateName]=this[t.getterName]()})),this.textTracksJson_=Rt(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return void 0===e&&c.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_}version(){return{"video.js":e}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||"string"!=typeof e)return;const t=()=>{const e=this.muted();this.muted(!0);const t=()=>{this.muted(e)};this.playTerminatedQueue_.push(t);const s=this.play();if(Lt(s))return s.catch((e=>{throw t(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${e||""}`)}))};let s;return"any"!==e||this.muted()?s="muted"!==e||this.muted()?this.play():t():(s=this.play(),Lt(s)&&(s=s.catch(t))),Lt(s)?s.then((()=>{this.trigger({type:"autoplay-success",autoplay:e})})).catch((()=>{this.trigger({type:"autoplay-failure",autoplay:e})})):void 0}updateSourceCaches_(e=""){let t=e,s="";"string"!=typeof t&&(t=e.src,s=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!s&&(s=((e,t)=>{if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;const s=e.cache_.sources.filter((e=>e.src===t));if(s.length)return s[0].type;const i=e.$$("source");for(let e=0;e<i.length;e++){const s=i[e];if(s.type&&s.src&&s.src===t)return s.type}return vi(t)})(this,t)),this.cache_.source=v({},e,{src:t,type:s});const i=this.cache_.sources.filter((e=>e.src&&e.src===t)),r=[],n=this.$$("source"),a=[];for(let e=0;e<n.length;e++){const s=ne(n[e]);r.push(s),s.src&&s.src===t&&a.push(s.src)}a.length&&!i.length?this.cache_.sources=r:i.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=e=>this.updateSourceCaches_(e);const s=this.currentSource().src,i=e.src;s&&!/^blob:/.test(s)&&/^blob:/.test(i)&&(!this.lastSource_||this.lastSource_.tech!==i&&this.lastSource_.player!==s)&&(t=()=>{}),t(i),e.src||this.tech_.any(["sourceset","loadstart"],(e=>{if("sourceset"===e.type)return;const t=this.techGet_("currentSrc");this.lastSource_.tech=t,this.updateSourceCaches_(t)}))}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach((e=>e.callback(e.event))),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.click&&!1===this.options_.userActions.click||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?It(this.play()):this.pause()))}handleTechDoubleClick_(e){this.controls_&&(Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),(t=>t.contains(e.target)))||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isInPictureInPicture()&&!document.pictureInPictureElement?this.exitPictureInPicture():this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const s=this.el();let i=document[this.fsApi_.fullscreenElement]===s;!i&&s.matches&&(i=s.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(i)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",(()=>{this.removeClass("vjs-ios-native-fs")}))),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready((function(){if(e in pi)return function(e,t,s,i){return t[s](e.reduce(gi(s),i))}(this.middleware_,this.tech_,e,t);if(e in fi)return di(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(e){throw c(e),e}}),!0)}techGet_(e){if(this.tech_&&this.tech_.isReady_){if(e in ui)return function(e,t,s){return e.reduceRight(gi(s),t[s]())}(this.middleware_,this.tech_,e);if(e in fi)return di(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){if(void 0===this.tech_[e])throw c(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,t),t;if("TypeError"===t.name)throw c(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,t),this.tech_.isReady_=!1,t;throw c(t),t}}}play(){return new Promise((e=>{this.play_(e)}))}play_(e=It){this.playCallbacks_.push(e);const t=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),s=Boolean(G||V);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t)return this.waitToPlay_=e=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(!t&&s&&this.load());const i=this.techGet_("play");s&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),null===i?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(i)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach((function(e){e()}))}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach((function(t){t(e)}))}pause(){this.techCall_("pause")}paused(){return!1!==this.techGet_("paused")}played(){return this.techGet_("played")||_t(0,0)}scrubbing(e){if(void 0===e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){return void 0===e?(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime):(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),this.cache_.initTime=0,void(isFinite(e)&&(this.cache_.currentTime=Number(e)))):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_)))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return e&&e.length||(e=_t(0,0)),e}seekable(){let e=this.techGet_("seekable");return e&&e.length||(e=_t(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return wt(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let s=e.end(e.length-1);return s>t&&(s=t),s}volume(e){let t;return void 0!==e?(t=Math.max(0,Math.min(1,e)),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)}muted(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)}defaultMuted(e){return void 0!==e&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(void 0!==e){const t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise(((s,i)=>{function r(){t.off("fullscreenerror",a),t.off("fullscreenchange",n)}function n(){r(),s()}function a(e,t){r(),i(t)}t.one("fullscreenchange",n),t.one("fullscreenerror",a);const o=t.requestFullscreenHelper_(e);o&&(o.then(r,r),o.then(s,i))}))}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),this.fsApi_.requestFullscreen){const e=this.el_[this.fsApi_.requestFullscreen](t);return e&&e.then((()=>this.isFullscreen(!0)),(()=>this.isFullscreen(!1))),e}this.tech_.supportsFullScreen()&&1==!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise(((t,s)=>{function i(){e.off("fullscreenerror",n),e.off("fullscreenchange",r)}function r(){i(),t()}function n(e,t){i(),s(t)}e.one("fullscreenchange",r),e.one("fullscreenerror",n);const a=e.exitFullscreenHelper_();a&&(a.then(i,i),a.then(t,s))}))}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=document[this.fsApi_.exitFullscreen]();return e&&It(e.then((()=>this.isFullscreen(!1)))),e}this.tech_.supportsFullScreen()&&1==!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=document.documentElement.style.overflow,$e(document,"keydown",this.boundFullWindowOnEscKey_),document.documentElement.style.overflow="hidden",te(document.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){"Escape"===e.key&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,He(document,"keydown",this.boundFullWindowOnEscKey_),document.documentElement.style.overflow=this.docOrigOverflow,se(document.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&window.documentPictureInPicture){const e=document.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(Q("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),window.documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then((t=>(Ee(t),this.el_.parentNode.insertBefore(e,this.el_),t.document.body.appendChild(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger({type:"enterpictureinpicture",pipWindow:t}),t.addEventListener("pagehide",(t=>{const s=t.target.querySelector(".video-js");e.parentNode.replaceChild(s,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")})),t)))}return"pictureInPictureEnabled"in document&&!1===this.disablePictureInPicture()?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){return window.documentPictureInPicture&&window.documentPictureInPicture.window?(window.documentPictureInPicture.window.close(),Promise.resolve()):"pictureInPictureEnabled"in document?document.exitPictureInPicture():void 0}handleKeyDown(e){const{userActions:t}=this.options_;t&&t.hotkeys&&((e=>{const t=e.tagName.toLowerCase();return!!e.isContentEditable||("input"===t?-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(e.type):-1!==["textarea"].indexOf(t))})(this.el_.ownerDocument.activeElement)||("function"==typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e)))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:s=(t=>"f"===e.key.toLowerCase()),muteKey:i=(t=>"m"===e.key.toLowerCase()),playPauseKey:r=(t=>"k"===e.key.toLowerCase()||" "===e.key.toLowerCase())}=t;if(s.call(this,e)){e.preventDefault(),e.stopPropagation();const t=mt.getComponent("FullscreenToggle");!1!==document[this.fsApi_.fullscreenEnabled]&&t.prototype.handleClick.call(this,e)}else i.call(this,e)?(e.preventDefault(),e.stopPropagation(),mt.getComponent("MuteToggle").prototype.handleClick.call(this,e)):r.call(this,e)&&(e.preventDefault(),e.stopPropagation(),mt.getComponent("PlayToggle").prototype.handleClick.call(this,e))}canPlayType(e){let t;for(let s=0,i=this.options_.techOrder;s<i.length;s++){const r=i[s];let n=ai.getTech(r);if(n||(n=mt.getComponent(r)),n){if(n.isSupported()&&(t=n.canPlayType(e),t))return t}else c.error(`The "${r}" tech is undefined. Skipped browser support check for that tech.`)}return""}selectSource(e){const t=this.options_.techOrder.map((e=>[e,ai.getTech(e)])).filter((([e,t])=>t?t.isSupported():(c.error(`The "${e}" tech is undefined. Skipped browser support check for that tech.`),!1))),s=function(e,t,s){let i;return e.some((e=>t.some((t=>{if(i=s(e,t),i)return!0})))),i};let i;const r=([e,t],s)=>{if(t.canPlaySource(s,this.options_[e.toLowerCase()]))return{source:s,tech:e}};return i=this.options_.sourceOrder?s(e,t,(n=r,(e,t)=>n(t,e))):s(t,e,r),i||!1;var n}handleSrc_(e,t){if(void 0===e)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const s=_i(e);if(s.length){if(this.changingSrc_=!0,t||(this.cache_.sources=s),this.updateSourceCaches_(s[0]),ci(this,s[0],((e,i)=>{if(this.middleware_=i,t||(this.cache_.sources=s),this.updateSourceCaches_(e),this.src_(e))return s.length>1?this.handleSrc_(s.slice(1)):(this.changingSrc_=!1,this.setTimeout((function(){this.error({code:4,message:this.options_.notSupportedMessage})}),0),void this.triggerReady());var r,n;r=i,n=this.tech_,r.forEach((e=>e.setTech&&e.setTech(n)))})),s.length>1){const e=()=>{this.error(null),this.handleSrc_(s.slice(1),!0)},t=()=>{this.off("error",e)};this.one("error",e),this.one("playing",t),this.resetRetryOnError_=()=>{this.off("error",e),this.off("playing",t)}}}else this.setTimeout((function(){this.error({code:4,message:this.options_.notSupportedMessage})}),0)}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return!t||(ft(t.tech,this.techName_)?(this.ready((function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1}),!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready((()=>{this.changingSrc_=!1})),!1))}addSourceElement(e,t){return!!this.tech_&&this.tech_.addSourceElement(e,t)}removeSourceElement(e){return!!this.tech_&&this.tech_.removeSourceElement(e)}load(){this.tech_&&this.tech_.vhs?this.src(this.currentSource()):this.techCall_("load")}reset(){this.paused()?this.doReset_():It(this.play().then((()=>this.doReset_())))}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),tt(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:s,remainingTimeDisplay:i}=this.controlBar||{},{seekBar:r}=s||{};e&&e.updateContent(),t&&t.updateContent(),i&&i.updateContent(),r&&(r.update(),r.loadProgressBar&&r.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")}autoplay(e){if(void 0===e)return this.options_.autoplay||!1;let t;"string"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"==typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t=void 0===t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return void 0!==e&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")}poster(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(void 0===e)return this.error_||null;if(i("beforeerror").forEach((t=>{const s=t(this,e);m(s)&&!Array.isArray(s)||"string"==typeof s||"number"==typeof s||null===s?e=s:this.log.error("please return a value that MediaError expects in beforeerror hooks")})),this.options_.suppressNotSupportedError&&e&&4===e.code){const t=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),void this.one("loadstart",(function(){this.off(["click","touchstart"],t)}))}if(null===e)return this.error_=null,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new kt(e),this.addClass("vjs-error"),c.error(`(CODE:${this.error_.code} ${kt.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),i("error").forEach((e=>e(this,this.error_)))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",(function(e){e.stopPropagation(),e.preventDefault()})),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,s;const i=qe(this,this.reportUserActivity),r=function(t){i(),this.clearInterval(e)};this.on("mousedown",(function(){i(),this.clearInterval(e),e=this.setInterval(i,250)})),this.on("mousemove",(function(e){e.screenX===t&&e.screenY===s||(t=e.screenX,s=e.screenY,i())})),this.on("mouseup",r),this.on("mouseleave",r);const n=this.getChild("controlBar");let a;!n||V||C||(n.on("mouseenter",(function(e){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0})),n.on("mouseleave",(function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout}))),this.on("keydown",i),this.on("keyup",i);this.setInterval((function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(a);const e=this.options_.inactivityTimeout;e<=0||(a=this.setTimeout((function(){this.userActivity_||this.userActive(!1)}),e))}),250)}playbackRate(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)}defaultPlaybackRate(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e}updatePlayerHeightOnAudioOnlyMode_(){const e=this.getChild("ControlBar");e&&this.audioOnlyCache_.controlBarHeight!==e.currentHeight()&&(this.audioOnlyCache_.controlBarHeight=e.currentHeight(),this.height(this.audioOnlyCache_.controlBarHeight))}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),s=t&&t.currentHeight();e.forEach((e=>{e!==t&&e.el_&&!e.hasClass("vjs-hidden")&&(e.hide(),this.audioOnlyCache_.hiddenChildren.push(e))})),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.audioOnlyCache_.controlBarHeight=s,this.on("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.height(s),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.off("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.audioOnlyCache_.hiddenChildren.forEach((e=>e.show())),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if("boolean"!=typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const e=[];return this.isInPictureInPicture()&&e.push(this.exitPictureInPicture()),this.isFullscreen()&&e.push(this.exitFullscreen()),this.audioPosterMode()&&e.push(this.audioPosterMode(!1)),Promise.all(e).then((()=>this.enableAudioOnlyUI_()))}return Promise.resolve().then((()=>this.disableAudioOnlyUI_()))}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){return"boolean"!=typeof e||e===this.audioPosterMode_?this.audioPosterMode_:(this.audioPosterMode_=e,e?this.audioOnlyMode()?this.audioOnlyMode(!1).then((()=>{this.enablePosterModeUI_()})):Promise.resolve().then((()=>{this.enablePosterModeUI_()})):Promise.resolve().then((()=>{this.disablePosterModeUI_()})))}addTextTrack(e,t,s){if(this.tech_)return this.tech_.addTextTrack(e,t,s)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),tt(this)&&this.trigger("languagechange"))}languages(){return v(nn.prototype.options_.languages,this.languages_)}toJSON(){const e=v(this.options_),t=e.tracks;e.tracks=[];for(let s=0;s<t.length;s++){let i=t[s];i=v(i),i.player=void 0,e.tracks[s]=i}return e}createModal(e,t){(t=t||{}).content=e||"";const s=new Mt(this,t);return this.addChild(s),s.on("dispose",(()=>{this.removeChild(s)})),s.open(),s}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let s=0;s<tn.length;s++){const i=tn[s];if(t<=this.breakpoints_[i]){if(e===i)return;e&&this.removeClass(sn[e]),this.addClass(sn[i]),this.breakpoint_=i;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return void 0===e||(this.breakpoint_="",this.breakpoints_=Object.assign({},rn,e),this.updateCurrentBreakpoint_()),Object.assign(this.breakpoints_)}responsive(e){return void 0===e?this.responsive_:(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return sn[this.breakpoint_]||""}loadMedia(e,t){if(!e||"object"!=typeof e)return;const s=this.crossOrigin();this.reset(),this.cache_.media=v(e);const{artist:i,artwork:r,description:n,poster:a,src:o,textTracks:l,title:h}=this.cache_.media;!r&&a&&(this.cache_.media.artwork=[{src:a,type:vi(a)}]),s&&this.crossOrigin(s),o&&this.src(o),a&&this.poster(a),Array.isArray(l)&&l.forEach((e=>this.addRemoteTextTrack(e,!1))),this.titleBar&&this.titleBar.update({title:h,description:n||i||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),(e=>({kind:e.kind,label:e.label,language:e.language,src:e.src})))};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:vi(t.poster)}]),t}return v(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},s=ne(e),i=s["data-setup"];if(ee(e,"vjs-fill")&&(s.fill=!0),ee(e,"vjs-fluid")&&(s.fluid=!0),null!==i)try{Object.assign(s,JSON.parse(i||"{}"))}catch(e){c.error("data-setup",e)}if(Object.assign(t,s),e.hasChildNodes()){const s=e.childNodes;for(let e=0,i=s.length;e<i;e++){const i=s[e],r=i.nodeName.toLowerCase();"source"===r?t.sources.push(ne(i)):"track"===r&&t.tracks.push(ne(i))}}return t}debug(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(void 0===e)return this.cache_.playbackRates;Array.isArray(e)&&e.every((e=>"number"==typeof e))&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}nn.prototype.videoTracks=()=>{},nn.prototype.audioTracks=()=>{},nn.prototype.textTracks=()=>{},nn.prototype.remoteTextTracks=()=>{},nn.prototype.remoteTextTrackEls=()=>{},ws.names.forEach((function(e){const t=ws[e];nn.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}})),nn.prototype.crossorigin=nn.prototype.crossOrigin,nn.players={};const an=window.navigator;nn.prototype.options_={techOrder:ai.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:an&&(an.languages&&an.languages[0]||an.userLanguage||an.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,spatialNavigation:{enabled:!1,horizontalSeek:!1},enableSmoothSeeking:!1,disableSeekWhileScrubbingOnMobile:!1,disableSeekWhileScrubbingOnSTV:!1},Jr.forEach((function(e){nn.prototype[`handleTech${pt(e)}_`]=function(){return this.trigger(e)}})),mt.registerComponent("Player",nn);const on="plugin",ln="activePlugins_",hn={},cn=e=>hn.hasOwnProperty(e),dn=e=>cn(e)?hn[e]:void 0,un=(e,t)=>{e[ln]=e[ln]||{},e[ln][t]=!0},pn=(e,t,s)=>{const i=(s?"before":"")+"pluginsetup";e.trigger(i,t),e.trigger(i+":"+t.name,t)},fn=(e,t)=>(t.prototype.name=e,function(...s){pn(this,{name:e,plugin:t,instance:null},!0);const i=new t(...[this,...s]);return this[e]=()=>i,pn(this,i.getEventHash()),i});class gn{constructor(e){if(this.constructor===gn)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),ht(this),delete this.trigger,dt(this,this.constructor.defaultState),un(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return Ve(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[ln][e]=!1,this.player=this.state=null,t[e]=fn(e,hn[e])}static isBasic(e){const t="string"==typeof e?dn(e):e;return"function"==typeof t&&!gn.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if("string"!=typeof e)throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(cn(e))c.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(nn.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if("function"!=typeof t)throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return hn[e]=t,e!==on&&(gn.isBasic(t)?nn.prototype[e]=function(e,t){const s=function(){pn(this,{name:e,plugin:t,instance:null},!0);const s=t.apply(this,arguments);return un(this,e),pn(this,{name:e,plugin:t,instance:s}),s};return Object.keys(t).forEach((function(e){s[e]=t[e]})),s}(e,t):nn.prototype[e]=fn(e,t)),t}static deregisterPlugin(e){if(e===on)throw new Error("Cannot de-register base plugin.");cn(e)&&(delete hn[e],delete nn.prototype[e])}static getPlugins(e=Object.keys(hn)){let t;return e.forEach((e=>{const s=dn(e);s&&(t=t||{},t[e]=s)})),t}static getPluginVersion(e){const t=dn(e);return t&&t.VERSION||""}}function mn(e,t,s,i){return function(e,t){let s=!1;return function(...i){return s||c.warn(e),s=!0,t.apply(this,i)}}(`${t} is deprecated and will be removed in ${e}.0; please use ${s} instead.`,i)}gn.getPlugin=dn,gn.BASE_PLUGIN_NAME=on,gn.registerPlugin(on,gn),nn.prototype.usingPlugin=function(e){return!!this[ln]&&!0===this[ln][e]},nn.prototype.hasPlugin=function(e){return!!cn(e)};const yn=e=>0===e.indexOf("#")?e.slice(1):e;function vn(e,t,s){let r=vn.getPlayer(e);if(r)return t&&c.warn(`Player "${e}" is already initialised. Options will not be applied.`),s&&r.ready(s),r;const n="string"==typeof e?be("#"+yn(e)):e;if(!q(n))throw new TypeError("The element or ID supplied is not valid. (videojs)");const a="getRootNode"in n&&n.getRootNode()instanceof window.ShadowRoot?n.getRootNode():n.ownerDocument.body;n.ownerDocument.defaultView&&a.contains(n)||c.warn("The element supplied is not included in the DOM"),!0===(t=t||{}).restoreEl&&(t.restoreEl=(n.parentNode&&n.parentNode.hasAttribute&&n.parentNode.hasAttribute("data-vjs-player")?n.parentNode:n).cloneNode(!0)),i("beforesetup").forEach((e=>{const s=e(n,v(t));m(s)&&!Array.isArray(s)?t=v(t,s):c.error("please return an object in beforesetup hooks")}));const o=mt.getComponent("Player");return r=new o(n,t,s),i("setup").forEach((e=>e(r))),r}if(vn.hooks_=t,vn.hooks=i,vn.hook=function(e,t){i(e,t)},vn.hookOnce=function(e,t){i(e,[].concat(t).map((t=>{const s=(...i)=>(r(e,s),t(...i));return s})))},vn.removeHook=r,!0!==window.VIDEOJS_NO_DYNAMIC_STYLE&&K()){let e=be(".vjs-styles-defaults");if(!e){e=Pe("vjs-styles-defaults");const t=be("head");t&&t.insertBefore(e,t.firstChild),Re(e,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    ")}}return Le(1,vn),vn.VERSION=e,vn.options=nn.prototype.options_,vn.getPlayers=()=>nn.players,vn.getPlayer=e=>{const t=nn.players;let s;if("string"==typeof e){const i=yn(e),r=t[i];if(r)return r;s=be("#"+i)}else s=e;if(q(s)){const{player:e,playerId:i}=s;if(e||t[i])return e||t[i]}},vn.getAllPlayers=()=>Object.keys(nn.players).map((e=>nn.players[e])).filter(Boolean),vn.players=nn.players,vn.getComponent=mt.getComponent,vn.registerComponent=(e,t)=>(ai.isTech(t)&&c.warn(`The ${e} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),mt.registerComponent.call(mt,e,t)),vn.getTech=ai.getTech,vn.registerTech=ai.registerTech,vn.use=function(e,t){oi[e]=oi[e]||[],oi[e].push(t)},Object.defineProperty(vn,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(vn.middleware,"TERMINATOR",{value:hi,writeable:!1,enumerable:!0}),vn.browser=W,vn.obj=T,vn.mergeOptions=mn(9,"videojs.mergeOptions","videojs.obj.merge",v),vn.defineLazyProperty=mn(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",b),vn.bind=mn(9,"videojs.bind","native Function.prototype.bind",qe),vn.registerPlugin=gn.registerPlugin,vn.deregisterPlugin=gn.deregisterPlugin,vn.plugin=(e,t)=>(c.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),gn.registerPlugin(e,t)),vn.getPlugins=gn.getPlugins,vn.getPlugin=gn.getPlugin,vn.getPluginVersion=gn.getPluginVersion,vn.addLanguage=function(e,t){return e=(""+e).toLowerCase(),vn.options.languages=v(vn.options.languages,{[e]:t}),vn.options.languages[e]},vn.log=c,vn.createLogger=d,vn.time=Ct,vn.createTimeRange=mn(9,"videojs.createTimeRange","videojs.time.createTimeRanges",_t),vn.createTimeRanges=mn(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",_t),vn.formatTime=mn(9,"videojs.formatTime","videojs.time.formatTime",St),vn.setFormatTime=mn(9,"videojs.setFormatTime","videojs.time.setFormatTime",At),vn.resetFormatTime=mn(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",Et),vn.parseUrl=mn(9,"videojs.parseUrl","videojs.url.parseUrl",qt),vn.isCrossOrigin=mn(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",Qt),vn.EventTarget=Je,vn.any=We,vn.on=$e,vn.one=Ge,vn.off=He,vn.trigger=Ve,vn.xhr=ps,vn.TrackList=Nt,vn.TextTrack=bs,vn.TextTrackList=$t,vn.AudioTrack=Ts,vn.AudioTrackList=Bt,vn.VideoTrack=As,vn.VideoTrackList=Ut,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach((e=>{vn[e]=function(){return c.warn(`videojs.${e}() is deprecated; use videojs.dom.${e}() instead`),Se[e].apply(null,arguments)}})),vn.computedStyle=mn(9,"videojs.computedStyle","videojs.dom.computedStyle",Ae),vn.dom=Se,vn.fn=Qe,vn.num=$i,vn.str=gt,vn.url=Zt,vn.Error={NetworkBadStatus:"networkbadstatus",NetworkRequestFailed:"networkrequestfailed",NetworkRequestAborted:"networkrequestaborted",NetworkRequestTimeout:"networkrequesttimeout",NetworkBodyParserFailed:"networkbodyparserfailed",StreamingHlsPlaylistParserError:"streaminghlsplaylistparsererror",StreamingDashManifestParserError:"streamingdashmanifestparsererror",StreamingContentSteeringParserError:"streamingcontentsteeringparsererror",StreamingVttParserError:"streamingvttparsererror",StreamingFailedToSelectNextSegment:"streamingfailedtoselectnextsegment",StreamingFailedToDecryptSegment:"streamingfailedtodecryptsegment",StreamingFailedToTransmuxSegment:"streamingfailedtotransmuxsegment",StreamingFailedToAppendSegment:"streamingfailedtoappendsegment",StreamingCodecsChangeError:"streamingcodecschangeerror"},vn}()},7884:function(e,t,s){e.exports=function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=t(e);class i{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get:()=>t.enabled_(),set(e){t.enabled_(e)}}),t}}class r extends s.default.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get:()=>e.selectedIndex_}),Object.defineProperty(e,"length",{get:()=>e.levels_.length}),e[Symbol.iterator]=()=>e.levels_.values(),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const s=this.levels_.length;return t=new i(e),""+s in this||Object.defineProperty(this,s,{get(){return this.levels_[s]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let s=0,i=this.length;s<i;s++)if(this[s]===e){t=this.levels_.splice(s,1)[0],this.selectedIndex_===s?this.selectedIndex_=-1:this.selectedIndex_>s&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,s=this.length;t<s;t++){const s=this[t];if(s.id===e)return s}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}r.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const e in r.prototype.allowedEvents_)r.prototype["on"+e]=null;var n="4.1.0";const a=function(e){return function(e,t){const s=e.qualityLevels,i=new r,a=function(){i.dispose(),e.qualityLevels=s,e.off("dispose",a)};return e.on("dispose",a),e.qualityLevels=()=>i,e.qualityLevels.VERSION=n,i}(this,s.default.obj.merge({},e))};return s.default.registerPlugin("qualityLevels",a),a.VERSION=n,a}(s(6673))},5303:(e,t,s)=>{var i;!function(){function r(e,t,s){return e.call.apply(e.bind,arguments)}function n(e,t,s){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,i),e.apply(t,s)}}return function(){return e.apply(t,arguments)}}function a(e,t,s){return(a=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?r:n).apply(null,arguments)}var o=Date.now||function(){return+new Date};function l(e,t){this.a=e,this.o=t||e,this.c=this.o.document}var h=!!window.FontFace;function c(e,t,s,i){if(t=e.c.createElement(t),s)for(var r in s)s.hasOwnProperty(r)&&("style"==r?t.style.cssText=s[r]:t.setAttribute(r,s[r]));return i&&t.appendChild(e.c.createTextNode(i)),t}function d(e,t,s){(e=e.c.getElementsByTagName(t)[0])||(e=document.documentElement),e.insertBefore(s,e.lastChild)}function u(e){e.parentNode&&e.parentNode.removeChild(e)}function p(e,t,s){t=t||[],s=s||[];for(var i=e.className.split(/\s+/),r=0;r<t.length;r+=1){for(var n=!1,a=0;a<i.length;a+=1)if(t[r]===i[a]){n=!0;break}n||i.push(t[r])}for(t=[],r=0;r<i.length;r+=1){for(n=!1,a=0;a<s.length;a+=1)if(i[r]===s[a]){n=!0;break}n||t.push(i[r])}e.className=t.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function f(e,t){for(var s=e.className.split(/\s+/),i=0,r=s.length;i<r;i++)if(s[i]==t)return!0;return!1}function g(e,t,s){function i(){o&&r&&n&&(o(a),o=null)}t=c(e,"link",{rel:"stylesheet",href:t,media:"all"});var r=!1,n=!0,a=null,o=s||null;h?(t.onload=function(){r=!0,i()},t.onerror=function(){r=!0,a=Error("Stylesheet failed to load"),i()}):setTimeout((function(){r=!0,i()}),0),d(e,"head",t)}function m(e,t,s,i){var r=e.c.getElementsByTagName("head")[0];if(r){var n=c(e,"script",{src:t}),a=!1;return n.onload=n.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,s&&s(null),n.onload=n.onreadystatechange=null,"HEAD"==n.parentNode.tagName&&r.removeChild(n))},r.appendChild(n),setTimeout((function(){a||(a=!0,s&&s(Error("Script load timeout")))}),i||5e3),n}return null}function y(){this.a=0,this.c=null}function v(e){return e.a++,function(){e.a--,b(e)}}function _(e,t){e.c=t,b(e)}function b(e){0==e.a&&e.c&&(e.c(),e.c=null)}function T(e){this.a=e||"-"}function A(e,t){this.c=e,this.f=4,this.a="n";var s=(t||"n4").match(/^([nio])([1-9])$/i);s&&(this.a=s[1],this.f=parseInt(s[2],10))}function E(e){var t=[];e=e.split(/,\s*/);for(var s=0;s<e.length;s++){var i=e[s].replace(/['"]/g,"");-1!=i.indexOf(" ")||/^\d/.test(i)?t.push("'"+i+"'"):t.push(i)}return t.join(",")}function S(e){return e.a+e.f}function C(e){var t="normal";return"o"===e.a?t="oblique":"i"===e.a&&(t="italic"),t}function w(e){var t=4,s="n",i=null;return e&&((i=e.match(/(normal|oblique|italic)/i))&&i[1]&&(s=i[1].substr(0,1).toLowerCase()),(i=e.match(/([1-9]00|normal|bold)/i))&&i[1]&&(/bold/i.test(i[1])?t=7:/[1-9]00/.test(i[1])&&(t=parseInt(i[1].substr(0,1),10)))),s+t}function k(e,t){this.c=e,this.f=e.o.document.documentElement,this.h=t,this.a=new T("-"),this.j=!1!==t.events,this.g=!1!==t.classes}function L(e){if(e.g){var t=f(e.f,e.a.c("wf","active")),s=[],i=[e.a.c("wf","loading")];t||s.push(e.a.c("wf","inactive")),p(e.f,s,i)}I(e,"inactive")}function I(e,t,s){e.j&&e.h[t]&&(s?e.h[t](s.c,S(s)):e.h[t]())}function P(){this.c={}}function R(e,t){this.c=e,this.f=t,this.a=c(this.c,"span",{"aria-hidden":"true"},this.f)}function x(e){d(e.c,"body",e.a)}function D(e){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+E(e.c)+";font-style:"+C(e)+";font-weight:"+e.f+"00;"}function O(e,t,s,i,r,n){this.g=e,this.j=t,this.a=i,this.c=s,this.f=r||3e3,this.h=n||void 0}function M(e,t,s,i,r,n,a){this.v=e,this.B=t,this.c=s,this.a=i,this.s=a||"BESbswy",this.f={},this.w=r||3e3,this.u=n||null,this.m=this.j=this.h=this.g=null,this.g=new R(this.c,this.s),this.h=new R(this.c,this.s),this.j=new R(this.c,this.s),this.m=new R(this.c,this.s),e=D(e=new A(this.a.c+",serif",S(this.a))),this.g.a.style.cssText=e,e=D(e=new A(this.a.c+",sans-serif",S(this.a))),this.h.a.style.cssText=e,e=D(e=new A("serif",S(this.a))),this.j.a.style.cssText=e,e=D(e=new A("sans-serif",S(this.a))),this.m.a.style.cssText=e,x(this.g),x(this.h),x(this.j),x(this.m)}T.prototype.c=function(e){for(var t=[],s=0;s<arguments.length;s++)t.push(arguments[s].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.a)},O.prototype.start=function(){var e=this.c.o.document,t=this,s=o(),i=new Promise((function(i,r){!function n(){o()-s>=t.f?r():e.fonts.load(function(e){return C(e)+" "+e.f+"00 300px "+E(e.c)}(t.a),t.h).then((function(e){1<=e.length?i():setTimeout(n,25)}),(function(){r()}))}()})),r=null,n=new Promise((function(e,s){r=setTimeout(s,t.f)}));Promise.race([n,i]).then((function(){r&&(clearTimeout(r),r=null),t.g(t.a)}),(function(){t.j(t.a)}))};var N={D:"serif",C:"sans-serif"},F=null;function B(){if(null===F){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);F=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))}return F}function j(e,t,s){for(var i in N)if(N.hasOwnProperty(i)&&t===e.f[N[i]]&&s===e.f[N[i]])return!0;return!1}function U(e){var t,s=e.g.a.offsetWidth,i=e.h.a.offsetWidth;(t=s===e.f.serif&&i===e.f["sans-serif"])||(t=B()&&j(e,s,i)),t?o()-e.A>=e.w?B()&&j(e,s,i)&&(null===e.u||e.u.hasOwnProperty(e.a.c))?$(e,e.v):$(e,e.B):function(e){setTimeout(a((function(){U(this)}),e),50)}(e):$(e,e.v)}function $(e,t){setTimeout(a((function(){u(this.g.a),u(this.h.a),u(this.j.a),u(this.m.a),t(this.a)}),e),0)}function H(e,t,s){this.c=e,this.a=t,this.f=0,this.m=this.j=!1,this.s=s}M.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=o(),U(this)};var V=null;function G(e){0==--e.f&&e.j&&(e.m?((e=e.a).g&&p(e.f,[e.a.c("wf","active")],[e.a.c("wf","loading"),e.a.c("wf","inactive")]),I(e,"active")):L(e.a))}function W(e){this.j=e,this.a=new P,this.h=0,this.f=this.g=!0}function z(e,t,s,i,r){var n=0==--e.h;(e.f||e.g)&&setTimeout((function(){var e=r||null,o=i||{};if(0===s.length&&n)L(t.a);else{t.f+=s.length,n&&(t.j=n);var l,h=[];for(l=0;l<s.length;l++){var c=s[l],d=o[c.c],u=t.a,f=c;if(u.g&&p(u.f,[u.a.c("wf",f.c,S(f).toString(),"loading")]),I(u,"fontloading",f),u=null,null===V)if(window.FontFace){f=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var g=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);V=f?42<parseInt(f[1],10):!g}else V=!1;u=V?new O(a(t.g,t),a(t.h,t),t.c,c,t.s,d):new M(a(t.g,t),a(t.h,t),t.c,c,t.s,e,d),h.push(u)}for(l=0;l<h.length;l++)h[l].start()}}),0)}function K(e,t){this.c=e,this.a=t}function q(e,t){this.c=e,this.a=t}function Y(e,t){this.c=e||X,this.a=[],this.f=[],this.g=t||""}H.prototype.g=function(e){var t=this.a;t.g&&p(t.f,[t.a.c("wf",e.c,S(e).toString(),"active")],[t.a.c("wf",e.c,S(e).toString(),"loading"),t.a.c("wf",e.c,S(e).toString(),"inactive")]),I(t,"fontactive",e),this.m=!0,G(this)},H.prototype.h=function(e){var t=this.a;if(t.g){var s=f(t.f,t.a.c("wf",e.c,S(e).toString(),"active")),i=[],r=[t.a.c("wf",e.c,S(e).toString(),"loading")];s||i.push(t.a.c("wf",e.c,S(e).toString(),"inactive")),p(t.f,i,r)}I(t,"fontinactive",e),G(this)},W.prototype.load=function(e){this.c=new l(this.j,e.context||this.j),this.g=!1!==e.events,this.f=!1!==e.classes,function(e,t,s){var i=[],r=s.timeout;!function(e){e.g&&p(e.f,[e.a.c("wf","loading")]),I(e,"loading")}(t),i=function(e,t,s){var i,r=[];for(i in t)if(t.hasOwnProperty(i)){var n=e.c[i];n&&r.push(n(t[i],s))}return r}(e.a,s,e.c);var n=new H(e.c,t,r);for(e.h=i.length,t=0,s=i.length;t<s;t++)i[t].load((function(t,s,i){z(e,n,t,s,i)}))}(this,new k(this.c,e),e)},K.prototype.load=function(e){function t(){if(n["__mti_fntLst"+i]){var s,r=n["__mti_fntLst"+i](),a=[];if(r)for(var o=0;o<r.length;o++){var l=r[o].fontfamily;null!=r[o].fontStyle&&null!=r[o].fontWeight?(s=r[o].fontStyle+r[o].fontWeight,a.push(new A(l,s))):a.push(new A(l))}e(a)}else setTimeout((function(){t()}),50)}var s=this,i=s.a.projectId,r=s.a.version;if(i){var n=s.c.o;m(this.c,(s.a.api||"https://fast.fonts.net/jsapi")+"/"+i+".js"+(r?"?v="+r:""),(function(r){r?e([]):(n["__MonotypeConfiguration__"+i]=function(){return s.a},t())})).id="__MonotypeAPIScript__"+i}else e([])},q.prototype.load=function(e){var t,s,i=this.a.urls||[],r=this.a.families||[],n=this.a.testStrings||{},a=new y;for(t=0,s=i.length;t<s;t++)g(this.c,i[t],v(a));var o=[];for(t=0,s=r.length;t<s;t++)if((i=r[t].split(":"))[1])for(var l=i[1].split(","),h=0;h<l.length;h+=1)o.push(new A(i[0],l[h]));else o.push(new A(i[0]));_(a,(function(){e(o,n)}))};var X="https://fonts.googleapis.com/css";function Q(e){this.f=e,this.a=[],this.c={}}var Z={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},J={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},ee={i:"i",italic:"i",n:"n",normal:"n"},te=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function se(e,t){this.c=e,this.a=t}var ie={Arimo:!0,Cousine:!0,Tinos:!0};function re(e,t){this.c=e,this.a=t}function ne(e,t){this.c=e,this.f=t,this.a=[]}se.prototype.load=function(e){var t=new y,s=this.c,i=new Y(this.a.api,this.a.text),r=this.a.families;!function(e,t){for(var s=t.length,i=0;i<s;i++){var r=t[i].split(":");3==r.length&&e.f.push(r.pop());var n="";2==r.length&&""!=r[1]&&(n=":"),e.a.push(r.join(n))}}(i,r);var n=new Q(r);!function(e){for(var t=e.f.length,s=0;s<t;s++){var i=e.f[s].split(":"),r=i[0].replace(/\+/g," "),n=["n4"];if(2<=i.length){var a;if(a=[],o=i[1])for(var o,l=(o=o.split(",")).length,h=0;h<l;h++){var c;if((c=o[h]).match(/^[\w-]+$/))if(null==(d=te.exec(c.toLowerCase())))c="";else{if(c=null==(c=d[2])||""==c?"n":ee[c],null==(d=d[1])||""==d)d="4";else var d=J[d]||(isNaN(d)?"4":d.substr(0,1));c=[c,d].join("")}else c="";c&&a.push(c)}0<a.length&&(n=a),3==i.length&&(a=[],0<(i=(i=i[2])?i.split(","):a).length&&(i=Z[i[0]])&&(e.c[r]=i))}for(e.c[r]||(i=Z[r])&&(e.c[r]=i),i=0;i<n.length;i+=1)e.a.push(new A(r,n[i]))}}(n),g(s,function(e){if(0==e.a.length)throw Error("No fonts to load!");if(-1!=e.c.indexOf("kit="))return e.c;for(var t=e.a.length,s=[],i=0;i<t;i++)s.push(e.a[i].replace(/ /g,"+"));return t=e.c+"?family="+s.join("%7C"),0<e.f.length&&(t+="&subset="+e.f.join(",")),0<e.g.length&&(t+="&text="+encodeURIComponent(e.g)),t}(i),v(t)),_(t,(function(){e(n.a,n.c,ie)}))},re.prototype.load=function(e){var t=this.a.id,s=this.c.o;t?m(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",(function(t){if(t)e([]);else if(s.Typekit&&s.Typekit.config&&s.Typekit.config.fn){t=s.Typekit.config.fn;for(var i=[],r=0;r<t.length;r+=2)for(var n=t[r],a=t[r+1],o=0;o<a.length;o++)i.push(new A(n,a[o]));try{s.Typekit.load({events:!1,classes:!1,async:!0})}catch(e){}e(i)}}),2e3):e([])},ne.prototype.load=function(e){var t=this.f.id,s=this.c.o,i=this;t?(s.__webfontfontdeckmodule__||(s.__webfontfontdeckmodule__={}),s.__webfontfontdeckmodule__[t]=function(t,s){for(var r=0,n=s.fonts.length;r<n;++r){var a=s.fonts[r];i.a.push(new A(a.name,w("font-weight:"+a.weight+";font-style:"+a.style)))}e(i.a)},m(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(e){return e.o.location.hostname||e.a.location.hostname}(this.c)+"/"+t+".js",(function(t){t&&e([])}))):e([])};var ae=new W(window);ae.a.c.custom=function(e,t){return new q(t,e)},ae.a.c.fontdeck=function(e,t){return new ne(t,e)},ae.a.c.monotype=function(e,t){return new K(t,e)},ae.a.c.typekit=function(e,t){return new re(t,e)},ae.a.c.google=function(e,t){return new se(t,e)};var oe={load:a(ae.load,ae)};void 0===(i=function(){return oe}.call(t,s,t,e))||(e.exports=i)}()},4626:()=>{},6606:(e,t)=>{var s={607:function(e,t,s){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultProfiles=t.cldLiveStreamingProfile=t.cldAdaptiveStreamProfile=t.cldLoopingProfile=t.cldDefaultProfile=void 0;const r=i(s(704)),n=i(s(83)),a=i(s(832)),o=i(s(877));t.cldDefaultProfile={name:"cld-default",isDefault:!0,config:r.default},t.cldLoopingProfile={name:"cld-looping",isDefault:!0,config:n.default},t.cldAdaptiveStreamProfile={name:"cld-adaptive-stream",isDefault:!0,config:a.default},t.cldLiveStreamingProfile={name:"cld-live-streaming",isDefault:!0,config:o.default},t.defaultProfiles=[t.cldDefaultProfile,t.cldLoopingProfile,t.cldAdaptiveStreamProfile,t.cldLiveStreamingProfile]},832:e=>{e.exports=JSON.parse('{"playerOptions":{"fluid":true,"controls":true,"controlBar":{"fullscreenToggle":false},"showJumpControls":true,"hideContextMenu":false,"floatingWhenNotVisible":"none"},"sourceOptions":{"chapters":true,"sourceTypes":["hls"]}}')},704:e=>{e.exports=JSON.parse('{"playerOptions":{},"sourceOptions":{}}')},877:e=>{e.exports=JSON.parse('{"playerOptions":{},"sourceOptions":{"type":"live","sourceTypes":["hls"]}}')},83:e=>{e.exports=JSON.parse('{"playerOptions":{"fluid":true,"controls":false,"muted":true,"floatingWhenNotVisible":"none","hideContextMenu":false,"autoplay":true,"loop":true},"sourceOptions":{}}')}},i={},r=function e(t){var r=i[t];if(void 0!==r)return r.exports;var n=i[t]={exports:{}};return s[t].call(n.exports,n,n.exports,e),n.exports}(607),n=t;for(var a in r)n[a]=r[a];r.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})}},i={};function r(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={id:e,loaded:!1,exports:{}};return s[e].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}r.m=s,e=[],r.O=(t,s,i,n)=>{if(!s){var a=1/0;for(c=0;c<e.length;c++){for(var[s,i,n]=e[c],o=!0,l=0;l<s.length;l++)(!1&n||a>=n)&&Object.keys(r.O).every((e=>r.O[e](s[l])))?s.splice(l--,1):(o=!1,n<a&&(a=n));if(o){e.splice(c--,1);var h=i();void 0!==h&&(t=h)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[s,i,n]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,s)=>(r.f[s](e,t),t)),[])),r.u=e=>({26:"adaptive-streaming",33:"playlist",40:"debug",330:"ima",367:"dash",404:"interaction-areas",410:"recommendations-overlay",525:"shoppable",625:"chapters",691:"colors",728:"visual-search",976:"share"}[e]+".js"),r.miniCssF=e=>{},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},r.l=(e,s,i,n)=>{if(t[e])t[e].push(s);else{var a,o;if(void 0!==i)for(var l=document.getElementsByTagName("script"),h=0;h<l.length;h++){var c=l[h];if(c.getAttribute("src")==e){a=c;break}}a||(o=!0,(a=document.createElement("script")).type="module",a.charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.src=e),t[e]=[s];var d=(s,i)=>{a.onerror=a.onload=null,clearTimeout(u);var r=t[e];if(delete t[e],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(i))),s)return s(i)},u=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),o&&document.head.appendChild(a)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r.p="",(()=>{var e={668:0,26:0,410:0,625:0,691:0,330:0,404:0,33:0,525:0,728:0,976:0,869:0};r.f.j=(t,s)=>{var i=r.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else if(869!=t){var n=new Promise(((s,r)=>i=e[t]=[s,r]));s.push(i[2]=n);var a=r.p+r.u(t),o=new Error;r.l(a,(s=>{if(r.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var n=s&&("load"===s.type?"missing":s.type),a=s&&s.target&&s.target.src;o.message="Loading chunk "+t+" failed.\n("+n+": "+a+")",o.name="ChunkLoadError",o.type=n,o.request=a,i[1](o)}}),"chunk-"+t,t)}else e[t]=0},r.O.j=t=>0===e[t];var t=(t,s)=>{var i,n,[a,o,l]=s,h=0;if(a.some((t=>0!==e[t]))){for(i in o)r.o(o,i)&&(r.m[i]=o[i]);if(l)var c=l(r)}for(t&&t(s);h<a.length;h++)n=a[h],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return r.O(c)},s=self.cloudinaryVideoPlayerChunkLoading=self.cloudinaryVideoPlayerChunkLoading||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var n=r.O(void 0,[869],(()=>r(7623))),a=(n=r.O(n)).Ay,o=n.wR,l=n.Qc,h=n.OC,c=n.Fk,d=n.xY,u=n.Iy;export{a as default,o as getDefaultPlayerColor,l as interactionAreasService,h as player,c as players,d as videoPlayer,u as videoPlayers};